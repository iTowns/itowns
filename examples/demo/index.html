<!DOCTYPE html>
<html>
    <head>
        <title>Itowns - Demonstration</title>

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <script type="importmap">
            {
                "imports": {
                    "itowns": "../../dist/itowns.js",
                    "debug": "../../dist/debug.js",
                    "lil": "https://unpkg.com/lil-gui@0.20.0/dist/lil-gui.esm.js",
                    "dat": "https://unpkg.com/dat.gui@0.7.9/build/dat.gui.module.js",
                    "GuiTools": "../jsm/GUI/GuiTools.js",
                    "LoadingScreen": "../jsm/GUI/LoadingScreen.js",
                    "OGC3DTilesHelper": "../jsm/OGC3DTilesHelper.js",
                    "FeatureToolTip": "../jsm/plugins/FeatureToolTip.js",
                    "itowns_widgets": "../../dist/itowns_widgets.js",
                    "three": "https://unpkg.com/three@0.170.0/build/three.module.js",
                    "three/addons/": "https://unpkg.com/three@0.170.0/examples/jsm/"
                }
            }
        </script>

        <link rel="stylesheet" type="text/css" href="../css/example.css" />
        <link
            rel="stylesheet"
            type="text/css"
            href="../css/LoadingScreen.css"
        />
        <link rel="stylesheet" type="text/css" href="../css/widgets.css" />
        <link rel="stylesheet" type="text/css" href="css/demo.css" />
    </head>
    <body>
        <div id="menu">
            <div id="textContainer">
                <h1 id="sceneTitle"></h1>
                <p id="sceneDescription"></p>
            </div>
            <div id="buttonContainer">
                <button id="resetDemo">R</button>
                <button id="prevButton"><</button>
                <button id="resetScene">o</button>
                <button id="nextButton">></button>
            </div>
        </div>
        <script type="module">
            import GuiTools from "GuiTools";
            import * as THREE from "three";
            import * as itowns from "itowns";
            import * as debug from "debug";
            import * as itowns_widgets from "itowns_widgets";
            import { transitionToScene, updateUIForScene } from "./dist/Utils/transitionToScene.js";
            import { Scene as Globe3D } from "./dist/Scenes/Globe3D.js";
            import { Scene as PlanarView } from "./dist/Scenes/PlanarView.js";
            import { Scene as Terrain3D } from "./dist/Scenes/Terrain3D.js";
            import { Scene as ProjectedData2D } from "./dist/Scenes/ProjectedData2D.js";
            import { Scene as ExtrudedData3D } from "./dist/Scenes/ExtrudedData3D.js";
            import { Scene as ImmersiveView } from "./dist/Scenes/ImmersiveView.js";
            import { Scene as PointCloud } from "./dist/Scenes/PointCloud.js";
            import { Scene as TexturedMeshes3D } from "./dist/Scenes/TexturedMeshes3D.js";
            import { Scene as InstancedData } from "./dist/Scenes/InstancedData.js";

            // ---------- CREATE A GlobeView FOR SUPPORTING DATA VISUALIZATION : ----------

            // Define camera initial position
            const placement = {
                coord: new itowns.Coordinates("EPSG:4326", 80, 50),
                range: 25000000,
            };

            const scenes = [Globe3D, Terrain3D, ProjectedData2D, ExtrudedData3D, InstancedData, PointCloud, PlanarView, TexturedMeshes3D, ImmersiveView];

            updateUIForScene(scenes[0]);

            for (const layer of scenes[0].layers) {
                scenes[0].view.getView().addLayer(layer);
            }
            scenes[0].view.setVisible(true);
            await scenes[0].onCreate();
            await scenes[0].onEnter?.();
            scenes[0].view.getGuiTools().addLayersGUI(scenes[0].layers);
            scenes[0].view.getGuiTools().gui.show();

            let currentIndex = 0;

            const SceneManager = {
                next() {
                    const newIndex = (currentIndex + 1) % scenes.length;
                    transitionToScene(
                        scenes[currentIndex],
                        scenes[newIndex]
                    );
                    currentIndex = newIndex;
                },
                previous() {
                    const newIndex =
                        (currentIndex - 1 + scenes.length) % scenes.length;
                    transitionToScene(
                        scenes[currentIndex],
                        scenes[newIndex]
                    );
                    currentIndex = newIndex;
                },
            };

            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const resetSceneButton = document.getElementById('resetScene');
            const resetDemoButton = document.getElementById('resetDemo');

            prevButton.onclick = () => SceneManager.previous();
            nextButton.onclick = () => SceneManager.next();
            resetSceneButton.onclick = () => {
                transitionToScene(
                    scenes[currentIndex],
                    scenes[currentIndex]
                );
            };
            resetDemoButton.onclick = () => {
                transitionToScene(
                    scenes[currentIndex],
                    scenes[0]
                );
                currentIndex = 0;
            };
        </script>
    </body>
</html>
