!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("itowns",[],e):"object"==typeof exports?exports.itowns=e():t.itowns=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i=window.webpackJsonp_name_;window.webpackJsonp_name_=function(o,a){for(var s,h,u=0,c=[];u<o.length;u++)h=o[u],r[h]&&c.push.apply(c,r[h]),r[h]=0;for(s in a)t[s]=a[s];for(i&&i(o,a);c.length;)c.shift().call(null,e);if(a[0])return n[0]=0,e(0)};var n={},r={0:0};return e.e=function(t,i){if(0===r[t])return i.call(null,e);if(void 0!==r[t])r[t].push(i);else{r[t]=[i];var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.charset="utf-8",o.async=!0,o.src=e.p+""+t+"."+({1:"debug"}[t]||t)+".js",n.appendChild(o)}},e.m=t,e.c=n,e.p="",e(0)}([function(t,e,i){i(384),i(458),i(49),t.exports=i(251)},,function(t,e,i){!function(t,i){i(e)}(this,function(t){"use strict";function e(){}function i(t,e){this.x=t||0,this.y=e||0}function n(t,e,r,o,a,s,h,u,c,l){Object.defineProperty(this,"id",{value:fs++}),this.uuid=ls.generateUUID(),this.name="",this.image=void 0!==t?t:n.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:n.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:aa,this.wrapT=void 0!==o?o:aa,this.magFilter=void 0!==a?a:la,this.minFilter=void 0!==s?s:pa,this.anisotropy=void 0!==c?c:1,this.format=void 0!==h?h:La,this.type=void 0!==u?u:da,this.offset=new i(0,0),this.repeat=new i(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:es,this.version=0,this.onUpdate=null}function r(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function o(t,e,i){this.uuid=ls.generateUUID(),this.width=t,this.height=e,this.scissor=new r(0,0,t,e),this.scissorTest=!1,this.viewport=new r(0,0,t,e),i=i||{},void 0===i.minFilter&&(i.minFilter=la),this.texture=new n(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function a(t,e,i){o.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function s(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function h(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function u(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function c(t,e,i,r,o,a,s,h,u,c){t=void 0!==t?t:[],e=void 0!==e?e:Ko,n.call(this,t,e,i,r,o,a,s,h,u,c),this.flipY=!1}function l(){this.seq=[],this.map={}}function f(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,o=ms[r];if(void 0===o&&(o=new Float32Array(r),ms[r]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=i,t[a].toArray(o,s)}return o}function p(t,e){var i=vs[e];void 0===i&&(i=new Int32Array(e),vs[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function d(t,e){t.uniform1f(this.addr,e)}function m(t,e){t.uniform1i(this.addr,e)}function v(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function g(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function y(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function x(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function _(t,e){t.uniformMatrix3fv(this.addr,!1,e.elements||e)}function b(t,e){t.uniformMatrix4fv(this.addr,!1,e.elements||e)}function M(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTexture2D(e||ps,n)}function w(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTextureCube(e||ds,n)}function E(t,e){t.uniform2iv(this.addr,e)}function S(t,e){t.uniform3iv(this.addr,e)}function T(t,e){t.uniform4iv(this.addr,e)}function P(t){switch(t){case 5126:return d;case 35664:return v;case 35665:return g;case 35666:return y;case 35674:return x;case 35675:return _;case 35676:return b;case 35678:return M;case 35680:return w;case 5124:case 35670:return m;case 35667:case 35671:return E;case 35668:case 35672:return S;case 35669:case 35673:return T}}function L(t,e){t.uniform1fv(this.addr,e)}function A(t,e){t.uniform1iv(this.addr,e)}function C(t,e){t.uniform2fv(this.addr,f(e,this.size,2))}function R(t,e){t.uniform3fv(this.addr,f(e,this.size,3))}function I(t,e){t.uniform4fv(this.addr,f(e,this.size,4))}function O(t,e){t.uniformMatrix2fv(this.addr,!1,f(e,this.size,4))}function D(t,e){t.uniformMatrix3fv(this.addr,!1,f(e,this.size,9))}function N(t,e){t.uniformMatrix4fv(this.addr,!1,f(e,this.size,16))}function U(t,e,i){var n=e.length,r=p(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTexture2D(e[o]||ps,r[o])}function F(t,e,i){var n=e.length,r=p(i,n);t.uniform1iv(this.addr,r);for(var o=0;o!==n;++o)i.setTextureCube(e[o]||ds,r[o])}function z(t){switch(t){case 5126:return L;case 35664:return C;case 35665:return R;case 35666:return I;case 35674:return O;case 35675:return D;case 35676:return N;case 35678:return U;case 35680:return F;case 5124:case 35670:return A;case 35667:case 35671:return E;case 35668:case 35672:return S;case 35669:case 35673:return T}}function B(t,e,i){this.id=t,this.addr=i,this.setValue=P(e.type)}function G(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=z(e.type)}function j(t){this.id=t,l.call(this)}function k(t,e){t.seq.push(e),t.map[e.id]=e}function V(t,e,i){var n=t.name,r=n.length;for(gs.lastIndex=0;;){var o=gs.exec(n),a=gs.lastIndex,s=o[1],h="]"===o[2],u=o[3];if(h&&(s|=0),void 0===u||"["===u&&a+2===r){k(i,void 0===u?new B(s,t,e):new G(s,t,e));break}var c=i.map,l=c[s];void 0===l&&(l=new j(s),k(i,l)),i=l}}function H(t,e,i){l.call(this),this.renderer=i;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var o=t.getActiveUniform(e,r),a=o.name,s=t.getUniformLocation(e,a);V(o,s,this)}}function W(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}function q(t,e,i,r,o,a,s,h,u,c,l,f){n.call(this,null,a,s,h,u,c,r,o,l,f),this.image={data:t,width:e,height:i},this.magFilter=void 0!==u?u:ha,this.minFilter=void 0!==c?c:ha,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function X(t,e){this.min=void 0!==t?t:new i(+(1/0),+(1/0)),this.max=void 0!==e?e:new i(-(1/0),-(1/0))}function Y(t,e){function n(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),e=new Uint16Array([0,1,2,0,2,3]);o=d.createBuffer(),a=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,o),d.bufferData(d.ARRAY_BUFFER,t,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),d.bufferData(d.ELEMENT_ARRAY_BUFFER,e,d.STATIC_DRAW),f=d.createTexture(),p=d.createTexture(),m.bindTexture(d.TEXTURE_2D,f),d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),m.bindTexture(d.TEXTURE_2D,p),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),s={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},u=r(s),c={vertex:d.getAttribLocation(u,"position"),uv:d.getAttribLocation(u,"uv")},l={renderType:d.getUniformLocation(u,"renderType"),map:d.getUniformLocation(u,"map"),occlusionMap:d.getUniformLocation(u,"occlusionMap"),opacity:d.getUniformLocation(u,"opacity"),color:d.getUniformLocation(u,"color"),scale:d.getUniformLocation(u,"scale"),rotation:d.getUniformLocation(u,"rotation"),screenPosition:d.getUniformLocation(u,"screenPosition")}}function r(e){var i=d.createProgram(),n=d.createShader(d.FRAGMENT_SHADER),r=d.createShader(d.VERTEX_SHADER),o="precision "+t.getPrecision()+" float;\n";return d.shaderSource(n,o+e.fragmentShader),d.shaderSource(r,o+e.vertexShader),d.compileShader(n),d.compileShader(r),d.attachShader(i,n),d.attachShader(i,r),d.linkProgram(i),i}var o,a,s,u,c,l,f,p,d=t.context,m=t.state;this.render=function(r,s,v){if(0!==e.length){var g=new h,y=v.w/v.z,x=.5*v.z,_=.5*v.w,b=16/v.w,M=new i(b*y,b),w=new h(1,1,0),E=new i(1,1),S=new X;S.min.set(v.x,v.y),S.max.set(v.x+(v.z-16),v.y+(v.w-16)),void 0===u&&n(),d.useProgram(u),m.initAttributes(),m.enableAttribute(c.vertex),m.enableAttribute(c.uv),m.disableUnusedAttributes(),d.uniform1i(l.occlusionMap,0),d.uniform1i(l.map,1),d.bindBuffer(d.ARRAY_BUFFER,o),d.vertexAttribPointer(c.vertex,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(c.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),m.disable(d.CULL_FACE),m.setDepthWrite(!1);for(var T=0,P=e.length;T<P;T++){b=16/v.w,M.set(b*y,b);var L=e[T];if(g.set(L.matrixWorld.elements[12],L.matrixWorld.elements[13],L.matrixWorld.elements[14]),g.applyMatrix4(s.matrixWorldInverse),g.applyMatrix4(s.projectionMatrix),w.copy(g),E.x=v.x+w.x*x+x-8,E.y=v.y+w.y*_+_-8,S.containsPoint(E)===!0){m.activeTexture(d.TEXTURE0),m.bindTexture(d.TEXTURE_2D,null),m.activeTexture(d.TEXTURE1),m.bindTexture(d.TEXTURE_2D,f),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,E.x,E.y,16,16,0),d.uniform1i(l.renderType,0),d.uniform2f(l.scale,M.x,M.y),d.uniform3f(l.screenPosition,w.x,w.y,w.z),m.disable(d.BLEND),m.enable(d.DEPTH_TEST),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),m.activeTexture(d.TEXTURE0),m.bindTexture(d.TEXTURE_2D,p),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,E.x,E.y,16,16,0),d.uniform1i(l.renderType,1),m.disable(d.DEPTH_TEST),m.activeTexture(d.TEXTURE1),m.bindTexture(d.TEXTURE_2D,f),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),L.positionScreen.copy(w),L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares(),d.uniform1i(l.renderType,2),m.enable(d.BLEND);for(var A=0,C=L.lensFlares.length;A<C;A++){var R=L.lensFlares[A];R.opacity>.001&&R.scale>.001&&(w.x=R.x,w.y=R.y,w.z=R.z,b=R.size*R.scale/v.w,M.x=b*y,M.y=b,d.uniform3f(l.screenPosition,w.x,w.y,w.z),d.uniform2f(l.scale,M.x,M.y),d.uniform1f(l.rotation,R.rotation),d.uniform1f(l.opacity,R.opacity),d.uniform3f(l.color,R.color.r,R.color.g,R.color.b),m.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst),t.setTexture2D(R.texture,1),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0))}}}m.enable(d.CULL_FACE),m.enable(d.DEPTH_TEST),m.setDepthWrite(!0),t.resetGLState()}}}function Z(t,e){function i(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),e=new Uint16Array([0,1,2,0,2,3]);a=d.createBuffer(),u=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,a),d.bufferData(d.ARRAY_BUFFER,t,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,u),d.bufferData(d.ELEMENT_ARRAY_BUFFER,e,d.STATIC_DRAW),c=r(),l={position:d.getAttribLocation(c,"position"),uv:d.getAttribLocation(c,"uv")},f={uvOffset:d.getUniformLocation(c,"uvOffset"),uvScale:d.getUniformLocation(c,"uvScale"),rotation:d.getUniformLocation(c,"rotation"),scale:d.getUniformLocation(c,"scale"),color:d.getUniformLocation(c,"color"),map:d.getUniformLocation(c,"map"),opacity:d.getUniformLocation(c,"opacity"),modelViewMatrix:d.getUniformLocation(c,"modelViewMatrix"),projectionMatrix:d.getUniformLocation(c,"projectionMatrix"),fogType:d.getUniformLocation(c,"fogType"),fogDensity:d.getUniformLocation(c,"fogDensity"),fogNear:d.getUniformLocation(c,"fogNear"),fogFar:d.getUniformLocation(c,"fogFar"),fogColor:d.getUniformLocation(c,"fogColor"),alphaTest:d.getUniformLocation(c,"alphaTest")};var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=8,i.height=8;var o=i.getContext("2d");o.fillStyle="white",o.fillRect(0,0,8,8),p=new n(i),p.needsUpdate=!0}function r(){var e=d.createProgram(),i=d.createShader(d.VERTEX_SHADER),n=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(i,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),d.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),d.compileShader(i),d.compileShader(n),d.attachShader(e,i),d.attachShader(e,n),d.linkProgram(e),e}function o(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}var a,u,c,l,f,p,d=t.context,m=t.state,v=new h,g=new s,y=new h;this.render=function(n,r){if(0!==e.length){void 0===c&&i(),d.useProgram(c),m.initAttributes(),m.enableAttribute(l.position),m.enableAttribute(l.uv),m.disableUnusedAttributes(),m.disable(d.CULL_FACE),m.enable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,a),d.vertexAttribPointer(l.position,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(l.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,u),d.uniformMatrix4fv(f.projectionMatrix,!1,r.projectionMatrix.elements),m.activeTexture(d.TEXTURE0),d.uniform1i(f.map,0);var s=0,h=0,x=n.fog;x?(d.uniform3f(f.fogColor,x.color.r,x.color.g,x.color.b),x.isFog?(d.uniform1f(f.fogNear,x.near),d.uniform1f(f.fogFar,x.far),d.uniform1i(f.fogType,1),s=1,h=1):x.isFogExp2&&(d.uniform1f(f.fogDensity,x.density),d.uniform1i(f.fogType,2),s=2,h=2)):(d.uniform1i(f.fogType,0),s=0,h=0);for(var _=0,b=e.length;_<b;_++){var M=e[_];M.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,M.matrixWorld),M.z=-M.modelViewMatrix.elements[14]}e.sort(o);for(var w=[],_=0,b=e.length;_<b;_++){var M=e[_],E=M.material;if(E.visible!==!1){d.uniform1f(f.alphaTest,E.alphaTest),d.uniformMatrix4fv(f.modelViewMatrix,!1,M.modelViewMatrix.elements),M.matrixWorld.decompose(v,g,y),w[0]=y.x,w[1]=y.y;var S=0;n.fog&&E.fog&&(S=h),s!==S&&(d.uniform1i(f.fogType,S),s=S),null!==E.map?(d.uniform2f(f.uvOffset,E.map.offset.x,E.map.offset.y),d.uniform2f(f.uvScale,E.map.repeat.x,E.map.repeat.y)):(d.uniform2f(f.uvOffset,0,0),d.uniform2f(f.uvScale,1,1)),d.uniform1f(f.opacity,E.opacity),d.uniform3f(f.color,E.color.r,E.color.g,E.color.b),d.uniform1f(f.rotation,E.rotation),d.uniform2fv(f.scale,w),m.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),m.setDepthTest(E.depthTest),m.setDepthWrite(E.depthWrite),E.map?t.setTexture2D(E.map,0):t.setTexture2D(p,0),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0)}}m.enable(d.CULL_FACE),t.resetGLState()}}}function Q(){Object.defineProperty(this,"id",{value:wu++}),this.uuid=ls.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=po,this.side=ro,this.shading=ho,this.vertexColors=uo,this.opacity=1,this.transparent=!1,this.blendSrc=Lo,this.blendDst=Ao,this.blendEquation=xo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=zo,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function J(t){Q.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function K(t){Q.call(this),this.type="MeshDepthMaterial",this.depthPacking=us,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function $(t,e){this.min=void 0!==t?t:new h(+(1/0),+(1/0),+(1/0)),this.max=void 0!==e?e:new h(-(1/0),-(1/0),-(1/0))}function tt(t,e){this.center=void 0!==t?t:new h,this.radius=void 0!==e?e:0}function et(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function it(t,e){this.normal=void 0!==t?t:new h(1,0,0),this.constant=void 0!==e?e:0}function nt(t,e,i,n,r,o){this.planes=[void 0!==t?t:new it,void 0!==e?e:new it,void 0!==i?i:new it,void 0!==n?n:new it,void 0!==r?r:new it,void 0!==o?o:new it]}function rt(t,e,n,a){function s(e,i,n,r){var o=e.geometry,a=null,s=E,h=e.customDepthMaterial;if(n&&(s=S,h=e.customDistanceMaterial),h)a=h;else{var u=!1;i.morphTargets&&(o&&o.isBufferGeometry?u=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(u=o.morphTargets&&o.morphTargets.length>0));var c=e.isSkinnedMesh&&i.skinning,l=0;u&&(l|=b),c&&(l|=M),a=s[l]}if(t.localClippingEnabled&&i.clipShadows===!0&&0!==i.clippingPlanes.length){var f=a.uuid,p=i.uuid,d=T[f];void 0===d&&(d={},T[f]=d);var m=d[p];void 0===m&&(m=a.clone(),d[p]=m),a=m}a.visible=i.visible,a.wireframe=i.wireframe;var v=i.side;return z.renderSingleSided&&v==ao&&(v=ro),z.renderReverseSided&&(v===ro?v=oo:v===oo&&(v=ro)),a.side=v,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,n&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(r),a}function c(t,e,i){if(t.visible!==!1){var n=0!==(t.layers.mask&e.layers.mask);if(n&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(t.frustumCulled===!1||p.intersectsObject(t)===!0)){var r=t.material;r.visible===!0&&(t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),_.push(t))}for(var o=t.children,a=0,s=o.length;a<s;a++)c(o[a],e,i)}}var l=t.context,f=t.state,p=new nt,d=new u,m=e.shadows,v=new i,g=new i(a.maxTextureSize,a.maxTextureSize),y=new h,x=new h,_=[],b=1,M=2,w=(b|M)+1,E=new Array(w),S=new Array(w),T={},P=[new h(1,0,0),new h(-1,0,0),new h(0,0,1),new h(0,0,-1),new h(0,1,0),new h(0,-1,0)],L=[new h(0,1,0),new h(0,1,0),new h(0,1,0),new h(0,1,0),new h(0,0,1),new h(0,0,-1)],A=[new r,new r,new r,new r,new r,new r],C=new K;C.depthPacking=cs,C.clipping=!0;for(var R=Mu.distanceRGBA,I=ys.clone(R.uniforms),O=0;O!==w;++O){var D=0!==(O&b),N=0!==(O&M),U=C.clone();U.morphTargets=D,U.skinning=N,E[O]=U;var F=new J({defines:{USE_SHADOWMAP:""},uniforms:I,vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,morphTargets:D,skinning:N,clipping:!0});S[O]=F}var z=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=io,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(e,i){if(z.enabled!==!1&&(z.autoUpdate!==!1||z.needsUpdate!==!1)&&0!==m.length){f.buffers.color.setClear(1,1,1,1),f.disable(l.BLEND),f.setDepthTest(!0),f.setScissorTest(!1);for(var r,a,h=0,u=m.length;h<u;h++){var b=m[h],M=b.shadow;if(void 0!==M){var w=M.camera;if(v.copy(M.mapSize),v.min(g),b&&b.isPointLight){r=6,a=!0;var E=v.x,S=v.y;A[0].set(2*E,S,E,S),A[1].set(0,S,E,S),A[2].set(3*E,S,E,S),A[3].set(E,S,E,S),A[4].set(3*E,0,E,S),A[5].set(E,0,E,S),v.x*=4,v.y*=2}else r=1,a=!1;if(null===M.map){var T={minFilter:ha,magFilter:ha,format:La};M.map=new o(v.x,v.y,T),w.updateProjectionMatrix()}M.isSpotLightShadow&&M.update(b),M&&M.isRectAreaLightShadow&&M.update(b);var C=M.map,R=M.matrix;x.setFromMatrixPosition(b.matrixWorld),w.position.copy(x),t.setRenderTarget(C),t.clear();for(var I=0;I<r;I++){if(a){y.copy(w.position),y.add(P[I]),w.up.copy(L[I]),w.lookAt(y);var O=A[I];f.viewport(O)}else y.setFromMatrixPosition(b.target.matrixWorld),w.lookAt(y);w.updateMatrixWorld(),w.matrixWorldInverse.getInverse(w.matrixWorld),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(w.projectionMatrix),R.multiply(w.matrixWorldInverse),d.multiplyMatrices(w.projectionMatrix,w.matrixWorldInverse),p.setFromMatrix(d),_.length=0,c(e,i,w);for(var D=0,N=_.length;D<N;D++){var U=_[D],F=n.update(U),B=U.material;if(B&&B.isMultiMaterial)for(var G=F.groups,j=B.materials,k=0,V=G.length;k<V;k++){var H=G[k],W=j[H.materialIndex];if(W.visible===!0){var q=s(U,W,a,x);t.renderBufferDirect(w,null,F,q,U,H)}}else{var q=s(U,B,a,x);t.renderBufferDirect(w,null,F,q,U,null)}}}}else console.warn("THREE.WebGLShadowMap:",b,"has no shadow.")}var X=t.getClearColor(),Y=t.getClearAlpha();t.setClearColor(X,Y),z.needsUpdate=!1}}}function ot(t,e){this.origin=void 0!==t?t:new h,this.direction=void 0!==e?e:new h}function at(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||at.DefaultOrder}function st(){this.mask=1}function ht(){function t(){r.setFromEuler(n,!1)}function e(){n.setFromQuaternion(r,void 0,!1)}Object.defineProperty(this,"id",{value:Eu++}),this.uuid=ls.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ht.DefaultUp.clone();var i=new h,n=new at,r=new s,o=new h(1,1,1);n.onChange(t),r.onChange(e),Object.defineProperties(this,{position:{enumerable:!0,value:i},rotation:{enumerable:!0,value:n},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:o},modelViewMatrix:{value:new u},normalMatrix:{value:new et}}),this.matrix=new u,this.matrixWorld=new u,this.matrixAutoUpdate=ht.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new st,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function ut(t,e){this.start=void 0!==t?t:new h,this.end=void 0!==e?e:new h}function ct(t,e,i){this.a=void 0!==t?t:new h,this.b=void 0!==e?e:new h,this.c=void 0!==i?i:new h}function lt(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new h,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new W,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}function ft(t){Q.call(this),this.type="MeshBasicMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function pt(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=ls.generateUUID(),this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i===!0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function dt(t,e){pt.call(this,new Int8Array(t),e)}function mt(t,e){pt.call(this,new Uint8Array(t),e)}function vt(t,e){pt.call(this,new Uint8ClampedArray(t),e)}function gt(t,e){pt.call(this,new Int16Array(t),e)}function yt(t,e){pt.call(this,new Uint16Array(t),e)}function xt(t,e){pt.call(this,new Int32Array(t),e)}function _t(t,e){pt.call(this,new Uint32Array(t),e)}function bt(t,e){pt.call(this,new Float32Array(t),e)}function Mt(t,e){pt.call(this,new Float64Array(t),e)}function wt(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Et(t){for(var e=t.length,i=-(1/0);e--;)t[e]>i&&(i=t[e]);return i}function St(){return Su++}function Tt(){Object.defineProperty(this,"id",{value:St()}),this.uuid=ls.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Pt(){Object.defineProperty(this,"id",{value:St()}),this.uuid=ls.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Lt(t,e){ht.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Pt,this.material=void 0!==e?e:new ft({color:16777215*Math.random()}),this.drawMode=Ka,this.updateMorphTargets()}function At(t,e,i,n,r,o){Tt.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new Ct(t,e,i,n,r,o)),this.mergeVertices()}function Ct(t,e,i,n,r,o){function a(t,e,i,n,r,o,a,m,v,g,y){var x,_,b=o/v,M=a/g,w=o/2,E=a/2,S=m/2,T=v+1,P=g+1,L=0,A=0,C=new h;for(_=0;_<P;_++){var R=_*M-E;for(x=0;x<T;x++){var I=x*b-w;C[t]=I*n,C[e]=R*r,C[i]=S,c.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=m>0?1:-1,l.push(C.x,C.y,C.z),f.push(x/v),f.push(1-_/g),L+=1}}for(_=0;_<g;_++)for(x=0;x<v;x++){var O=p+x+T*_,D=p+x+T*(_+1),N=p+(x+1)+T*(_+1),U=p+(x+1)+T*_;u.push(O,D,U),u.push(D,N,U),A+=6}s.addGroup(d,A,y),d+=A,p+=L}Pt.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};var s=this;n=Math.floor(n)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;var u=[],c=[],l=[],f=[],p=0,d=0;a("z","y","x",-1,-1,i,e,t,o,r,0),a("z","y","x",1,-1,i,e,-t,o,r,1),a("x","z","y",1,1,t,i,e,n,o,2),a("x","z","y",1,-1,t,i,-e,n,o,3),a("x","y","z",1,-1,t,e,i,n,r,4),a("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(u),this.addAttribute("position",new bt(c,3)),this.addAttribute("normal",new bt(l,3)),this.addAttribute("uv",new bt(f,2))}function Rt(t,e,i,n){Tt.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new It(t,e,i,n))}function It(t,e,i,n){Pt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r,o,a=t/2,s=e/2,h=Math.floor(i)||1,u=Math.floor(n)||1,c=h+1,l=u+1,f=t/h,p=e/u,d=[],m=[],v=[],g=[];for(o=0;o<l;o++){var y=o*p-s;for(r=0;r<c;r++){var x=r*f-a;m.push(x,-y,0),v.push(0,0,1),g.push(r/h),g.push(1-o/u)}}for(o=0;o<u;o++)for(r=0;r<h;r++){var _=r+c*o,b=r+c*(o+1),M=r+1+c*(o+1),w=r+1+c*o;d.push(_,b,w),d.push(b,M,w)}this.setIndex(d),this.addAttribute("position",new bt(m,3)),this.addAttribute("normal",new bt(v,3)),this.addAttribute("uv",new bt(g,2))}function Ot(){ht.call(this),this.type="Camera",this.matrixWorldInverse=new u,this.projectionMatrix=new u}function Dt(t,e,i,n){Ot.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Nt(t,e,i,n,r,o){Ot.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Ut(t,e,i){function n(t){s=t}function r(i){i.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(h=t.UNSIGNED_INT,u=4):i.array instanceof Uint16Array?(h=t.UNSIGNED_SHORT,u=2):(h=t.UNSIGNED_BYTE,u=1)}function o(e,n){t.drawElements(s,n,h,e*u),i.calls++,i.vertices+=n,s===t.TRIANGLES&&(i.faces+=n/3)}function a(n,r,o){var a=e.get("ANGLE_instanced_arrays");return null===a?void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(a.drawElementsInstancedANGLE(s,o,h,r*u,n.maxInstancedCount),i.calls++,i.vertices+=o*n.maxInstancedCount,void(s===t.TRIANGLES&&(i.faces+=n.maxInstancedCount*o/3)))}var s,h,u;return{setMode:n,setIndex:r,render:o,renderInstances:a}}function Ft(t,e,i){function n(t){a=t}function r(e,n){t.drawArrays(a,e,n),i.calls++,i.vertices+=n,a===t.TRIANGLES&&(i.faces+=n/3)}function o(n){var r=e.get("ANGLE_instanced_arrays");if(null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var o=n.attributes.position,s=0;
o.isInterleavedBufferAttribute?(s=o.data.count,r.drawArraysInstancedANGLE(a,0,s,n.maxInstancedCount)):(s=o.count,r.drawArraysInstancedANGLE(a,0,s,n.maxInstancedCount)),i.calls++,i.vertices+=s*n.maxInstancedCount,a===t.TRIANGLES&&(i.faces+=n.maxInstancedCount*s/3)}var a;return{setMode:n,render:r,renderInstances:o}}function zt(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new h,color:new W,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":n={position:new h,direction:new h,color:new W,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":n={position:new h,color:new W,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"HemisphereLight":n={direction:new h,skyColor:new W,groundColor:new W};break;case"RectAreaLight":n={color:new W,position:new h,halfWidth:new h,halfHeight:new h}}return t[e.id]=n,n}}}function Bt(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}function Gt(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),Bt(i)),n}function jt(t){switch(t){case es:return["Linear","( value )"];case is:return["sRGB","( value )"];case rs:return["RGBE","( value )"];case as:return["RGBM","( value, 7.0 )"];case ss:return["RGBM","( value, 16.0 )"];case hs:return["RGBD","( value, 256.0 )"];case ns:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function kt(t,e){var i=jt(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Vt(t,e){var i=jt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Ht(t,e){var i;switch(e){case Xo:i="Linear";break;case Yo:i="Reinhard";break;case Zo:i="Uncharted2";break;case Qo:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Wt(t,e,i){t=t||{};var n=[t.derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return n.filter(Yt).join("\n")}function qt(t){var e=[];for(var i in t){var n=t[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join("\n")}function Xt(t,e,i){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var a=t.getActiveAttrib(e,o),s=a.name;n[s]=t.getAttribLocation(e,s)}return n}function Yt(t){return""!==t}function Zt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Qt(t){function e(t,e){var i=xu[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Qt(i)}var i=/#include +<([\w\d.]+)>/g;return t.replace(i,e)}function Jt(t){function e(t,e,i,n){for(var r="",o=parseInt(e);o<parseInt(i);o++)r+=n.replace(/\[ i \]/g,"[ "+o+" ]");return r}var i=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return t.replace(i,e)}function Kt(t,e,i,n){var r=t.context,o=i.extensions,a=i.defines,s=i.__webglShader.vertexShader,h=i.__webglShader.fragmentShader,u="SHADOWMAP_TYPE_BASIC";n.shadowMapType===io?u="SHADOWMAP_TYPE_PCF":n.shadowMapType===no&&(u="SHADOWMAP_TYPE_PCF_SOFT");var c="ENVMAP_TYPE_CUBE",l="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(i.envMap.mapping){case Ko:case $o:c="ENVMAP_TYPE_CUBE";break;case na:case ra:c="ENVMAP_TYPE_CUBE_UV";break;case ta:case ea:c="ENVMAP_TYPE_EQUIREC";break;case ia:c="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case $o:case ea:l="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Vo:f="ENVMAP_BLENDING_MULTIPLY";break;case Ho:f="ENVMAP_BLENDING_MIX";break;case Wo:f="ENVMAP_BLENDING_ADD"}}var p,d,m=t.gammaFactor>0?t.gammaFactor:1,v=Wt(o,n,t.extensions),g=qt(a),y=r.createProgram();i.isRawShaderMaterial?(p=[g,"\n"].filter(Yt).join("\n"),d=[v,g,"\n"].filter(Yt).join("\n")):(p=["precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,g,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Yt).join("\n"),d=[v,"precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+i.__webglShader.name,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+l:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(n.numClippingPlanes-n.numClipIntersection),n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",n.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",n.toneMapping!==qo?"#define TONE_MAPPING":"",n.toneMapping!==qo?xu.tonemapping_pars_fragment:"",n.toneMapping!==qo?Ht("toneMapping",n.toneMapping):"",n.outputEncoding||n.mapEncoding||n.envMapEncoding||n.emissiveMapEncoding?xu.encodings_pars_fragment:"",n.mapEncoding?kt("mapTexelToLinear",n.mapEncoding):"",n.envMapEncoding?kt("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?kt("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?Vt("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Yt).join("\n")),s=Qt(s,n),s=Zt(s,n),h=Qt(h,n),h=Zt(h,n),i.isShaderMaterial||(s=Jt(s),h=Jt(h));var x=p+s,_=d+h,b=Gt(r,r.VERTEX_SHADER,x),M=Gt(r,r.FRAGMENT_SHADER,_);r.attachShader(y,b),r.attachShader(y,M),void 0!==i.index0AttributeName?r.bindAttribLocation(y,0,i.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y);var w=r.getProgramInfoLog(y),E=r.getShaderInfoLog(b),S=r.getShaderInfoLog(M),T=!0,P=!0;r.getProgramParameter(y,r.LINK_STATUS)===!1?(T=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(y,r.VALIDATE_STATUS),"gl.getProgramInfoLog",w,E,S)):""!==w?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",w):""!==E&&""!==S||(P=!1),P&&(this.diagnostics={runnable:T,material:i,programLog:w,vertexShader:{log:E,prefix:p},fragmentShader:{log:S,prefix:d}}),r.deleteShader(b),r.deleteShader(M);var L;this.getUniforms=function(){return void 0===L&&(L=new H(r,y,t)),L};var A;return this.getAttributes=function(){return void 0===A&&(A=Xt(r,y)),A},this.destroy=function(){r.deleteProgram(y),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Tu++,this.code=e,this.usedTimes=1,this.program=y,this.vertexShader=b,this.fragmentShader=M,this}function $t(t,e){function i(t){if(e.floatVertexTextures&&t&&t.skeleton&&t.skeleton.useVertexTexture)return 1024;var i=e.maxVertexUniforms,n=Math.floor((i-20)/4),r=n;return void 0!==t&&t&&t.isSkinnedMesh&&(r=Math.min(t.skeleton.bones.length,r),r<t.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+t.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function n(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=t.texture.encoding):i=es,i===es&&e&&(i=ns),i}var r=[],o={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking"];this.getParameters=function(r,a,s,h,u,c){var l=o[r.type],f=i(c),p=t.getPrecision();null!==r.precision&&(p=e.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead."));var d=t.getCurrentRenderTarget(),m={shaderID:l,precision:p,supportsVertexTextures:e.vertexTextures,outputEncoding:n(d?d.texture:null,t.gammaOutput),map:!!r.map,mapEncoding:n(r.map,t.gammaInput),envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,envMapEncoding:n(r.envMap,t.gammaInput),envMapCubeUV:!!r.envMap&&(r.envMap.mapping===na||r.envMap.mapping===ra),lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:n(r.emissiveMap,t.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,combine:r.combine,vertexColors:r.vertexColors,fog:!!s,useFog:r.fog,fogExp:s&&s.isFogExp2,flatShading:r.shading===so,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:r.skinning,maxBones:f,useVertexTexture:e.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numClippingPlanes:h,numClipIntersection:u,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&a.shadows.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===ao,flipSided:r.side===oo,depthPacking:void 0!==r.depthPacking&&r.depthPacking};return m},this.getProgramCode=function(t,e){var i=[];if(e.shaderID?i.push(e.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)i.push(n),i.push(t.defines[n]);for(var r=0;r<a.length;r++)i.push(e[a[r]]);return i.join()},this.acquireProgram=function(e,i,n){for(var o,a=0,s=r.length;a<s;a++){var h=r[a];if(h.code===n){o=h,++o.usedTimes;break}}return void 0===o&&(o=new Kt(t,n,e,i),r.push(o)),o},this.releaseProgram=function(t){if(0===--t.usedTimes){var e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},this.programs=r}function te(t,e,i){function n(t){var r=t.target,s=h[r.id];null!==s.index&&o(s.index),a(s.attributes),r.removeEventListener("dispose",n),delete h[r.id];var u=e.get(r);u.wireframe&&o(u.wireframe),e.delete(r);var c=e.get(s);c.wireframe&&o(c.wireframe),e.delete(s),i.memory.geometries--}function r(t){return t.isInterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function o(e){var i=r(e);void 0!==i&&(t.deleteBuffer(i),s(e))}function a(t){for(var e in t)o(t[e])}function s(t){t.isInterleavedBufferAttribute?e.delete(t.data):e.delete(t)}var h={};return{get:function(t){var e=t.geometry;if(void 0!==h[e.id])return h[e.id];e.addEventListener("dispose",n);var r;return e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Pt).setFromObject(t)),r=e._bufferGeometry),h[e.id]=r,i.memory.geometries++,r}}}function ee(t,e,i){function n(e){var i=c.get(e);e.geometry.isGeometry&&i.updateFromObject(e);var n=i.index,o=i.attributes;null!==n&&r(n,t.ELEMENT_ARRAY_BUFFER);for(var a in o)r(o[a],t.ARRAY_BUFFER);var s=i.morphAttributes;for(var a in s)for(var h=s[a],u=0,l=h.length;u<l;u++)r(h[u],t.ARRAY_BUFFER);return i}function r(t,i){var n=t.isInterleavedBufferAttribute?t.data:t,r=e.get(n);void 0===r.__webglBuffer?o(r,n,i):r.version!==n.version&&a(r,n,i)}function o(e,i,n){e.__webglBuffer=t.createBuffer(),t.bindBuffer(n,e.__webglBuffer);var r=i.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW;t.bufferData(n,i.array,r);var o=t.FLOAT,a=i.array;a instanceof Float32Array?o=t.FLOAT:a instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):a instanceof Uint16Array?o=t.UNSIGNED_SHORT:a instanceof Int16Array?o=t.SHORT:a instanceof Uint32Array?o=t.UNSIGNED_INT:a instanceof Int32Array?o=t.INT:a instanceof Int8Array?o=t.BYTE:a instanceof Uint8Array&&(o=t.UNSIGNED_BYTE),e.bytesPerElement=a.BYTES_PER_ELEMENT,e.type=o,e.version=i.version,i.onUploadCallback()}function a(e,i,n){t.bindBuffer(n,e.__webglBuffer),i.dynamic===!1?t.bufferData(n,i.array,t.STATIC_DRAW):i.updateRange.count===-1?t.bufferSubData(n,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),e.version=i.version}function s(t){return t.isInterleavedBufferAttribute?e.get(t.data).__webglBuffer:e.get(t).__webglBuffer}function h(t){return t.isInterleavedBufferAttribute?e.get(t.data):e.get(t)}function u(i){var n=e.get(i);if(void 0!==n.wireframe)return n.wireframe;var o=[],a=i.index,s=i.attributes;if(null!==a)for(var h=a.array,u=0,c=h.length;u<c;u+=3){var l=h[u+0],f=h[u+1],p=h[u+2];o.push(l,f,f,p,p,l)}else for(var h=s.position.array,u=0,c=h.length/3-1;u<c;u+=3){var l=u+0,f=u+1,p=u+2;o.push(l,f,f,p,p,l)}var d=new(Et(o)>65535?_t:yt)(o,1);return r(d,t.ELEMENT_ARRAY_BUFFER),n.wireframe=d,d}var c=new te(t,e,i);return{getAttributeBuffer:s,getAttributeProperties:h,getWireframeAttribute:u,update:n}}function ie(t,e,i,n,r,o,a){function s(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i);var r=n.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function h(t){return ls.isPowerOfTwo(t.width)&&ls.isPowerOfTwo(t.height)}function u(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");e.width=ls.nearestPowerOfTwo(t.width),e.height=ls.nearestPowerOfTwo(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,e.width,e.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}function c(t){return t.wrapS!==aa||t.wrapT!==aa||t.minFilter!==ha&&t.minFilter!==la}function l(e){return e===ha||e===ua||e===ca?t.NEAREST:t.LINEAR}function f(t){var e=t.target;e.removeEventListener("dispose",f),d(e),P.textures--}function p(t){var e=t.target;e.removeEventListener("dispose",p),m(e),P.textures--}function d(e){var i=n.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture)}n.delete(e)}function m(e){var i=n.get(e),r=n.get(e.texture);if(e){if(void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[o]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);n.delete(e.texture),n.delete(e)}}function v(e,r){var o=n.get(e);if(e.version>0&&o.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(a.complete!==!1)return void _(o,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D,o.__webglTexture)}function g(e,a){var u=n.get(e);if(6===e.image.length)if(e.version>0&&u.__version!==e.version){u.__image__webglTextureCube||(e.addEventListener("dispose",f),u.__image__webglTextureCube=t.createTexture(),P.textures++),i.activeTexture(t.TEXTURE0+a),i.bindTexture(t.TEXTURE_CUBE_MAP,u.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var c=e&&e.isCompressedTexture,l=e.image[0]&&e.image[0].isDataTexture,p=[],d=0;d<6;d++)c||l?p[d]=l?e.image[d].image:e.image[d]:p[d]=s(e.image[d],r.maxCubemapSize);var m=p[0],v=h(m),g=o(e.format),y=o(e.type);x(t.TEXTURE_CUBE_MAP,e,v);for(var d=0;d<6;d++)if(c)for(var _,b=p[d].mipmaps,M=0,w=b.length;M<w;M++)_=b[M],e.format!==La&&e.format!==Pa?i.getCompressedTextureFormats().indexOf(g)>-1?i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+d,M,g,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+d,M,g,_.width,_.height,0,g,y,_.data);else l?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,g,p[d].width,p[d].height,0,g,y,p[d].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,g,g,y,p[d]);e.generateMipmaps&&v&&t.generateMipmap(t.TEXTURE_CUBE_MAP),u.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+a),i.bindTexture(t.TEXTURE_CUBE_MAP,u.__image__webglTextureCube)}function y(e,r){i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)}function x(i,a,s){var h;if(s?(t.texParameteri(i,t.TEXTURE_WRAP_S,o(a.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,o(a.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,o(a.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,o(a.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),a.wrapS===aa&&a.wrapT===aa||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),t.texParameteri(i,t.TEXTURE_MAG_FILTER,l(a.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,l(a.minFilter)),a.minFilter!==ha&&a.minFilter!==la&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),h=e.get("EXT_texture_filter_anisotropic")){if(a.type===_a&&null===e.get("OES_texture_float_linear"))return;if(a.type===ba&&null===e.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(i,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function _(e,n,a){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",f),e.__webglTexture=t.createTexture(),P.textures++),i.activeTexture(t.TEXTURE0+a),i.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var l=s(n.image,r.maxTextureSize);c(n)&&h(l)===!1&&(l=u(l));var p=h(l),d=o(n.format),m=o(n.type);x(t.TEXTURE_2D,n,p);var v,g=n.mipmaps;if(n.isDepthTexture){var y=t.DEPTH_COMPONENT;if(n.type===_a){if(!L)throw new Error("Float Depth Texture only supported in WebGL2.0");y=t.DEPTH_COMPONENT32F}else L&&(y=t.DEPTH_COMPONENT16);n.format===Ia&&y===t.DEPTH_COMPONENT&&n.type!==ga&&n.type!==xa&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=ga,m=o(n.type)),n.format===Oa&&(y=t.DEPTH_STENCIL,n.type!==Sa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Sa,m=o(n.type))),i.texImage2D(t.TEXTURE_2D,0,y,l.width,l.height,0,d,m,null)}else if(n.isDataTexture)if(g.length>0&&p){for(var _=0,b=g.length;_<b;_++)v=g[_],i.texImage2D(t.TEXTURE_2D,_,d,v.width,v.height,0,d,m,v.data);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,d,l.width,l.height,0,d,m,l.data);else if(n.isCompressedTexture)for(var _=0,b=g.length;_<b;_++)v=g[_],n.format!==La&&n.format!==Pa?i.getCompressedTextureFormats().indexOf(d)>-1?i.compressedTexImage2D(t.TEXTURE_2D,_,d,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(t.TEXTURE_2D,_,d,v.width,v.height,0,d,m,v.data);else if(g.length>0&&p){for(var _=0,b=g.length;_<b;_++)v=g[_],i.texImage2D(t.TEXTURE_2D,_,d,d,m,v);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,d,d,m,l);n.generateMipmaps&&p&&t.generateMipmap(t.TEXTURE_2D),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function b(e,r,a,s){var h=o(r.texture.format),u=o(r.texture.type);i.texImage2D(s,0,h,r.width,r.height,0,h,u,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,a,s,n.get(r.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function M(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function w(e,i){var r=i&&i.isWebGLRenderTargetCube;if(r)throw new Error("Depth Texture with cube render targets is not supported!");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),v(i.depthTexture,0);var o=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ia)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==Oa)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}function E(e){var i=n.get(e),r=e.isWebGLRenderTargetCube===!0;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");w(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=t.createRenderbuffer(),M(i.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),M(i.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}function S(e){var r=n.get(e),o=n.get(e.texture);e.addEventListener("dispose",p),o.__webglTexture=t.createTexture(),P.textures++;var a=e.isWebGLRenderTargetCube===!0,s=h(e);if(a){r.__webglFramebuffer=[];for(var u=0;u<6;u++)r.__webglFramebuffer[u]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(a){i.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),x(t.TEXTURE_CUBE_MAP,e.texture,s);for(var u=0;u<6;u++)b(r.__webglFramebuffer[u],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+u);e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_CUBE_MAP),i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,o.__webglTexture),x(t.TEXTURE_2D,e.texture,s),b(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&E(e)}function T(e){var r=e.texture;if(r.generateMipmaps&&h(e)&&r.minFilter!==ha&&r.minFilter!==la){var o=e&&e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,a=n.get(r).__webglTexture;i.bindTexture(o,a),t.generateMipmap(o),i.bindTexture(o,null)}}var P=a.memory,L="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;this.setTexture2D=v,this.setTextureCube=g,this.setTextureCubeDynamic=y,this.setupRenderTarget=S,this.updateRenderTargetMipmap=T}function ne(){var t={};return{get:function(e){var i=e.uuid,n=t[i];return void 0===n&&(n={},t[i]=n),n},delete:function(e){delete t[e.uuid]},clear:function(){t={}}}}function re(t,e,i){function n(){var e=!1,i=new r,n=null,o=new r;return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,a,s){s===!0&&(e*=a,n*=a,r*=a),i.set(e,n,r,a),o.equals(i)===!1&&(t.clearColor(e,n,r,a),o.copy(i))},reset:function(){e=!1,n=null,o.set(0,0,0,1)}}}function o(){var e=!1,i=null,n=null,r=null;return{setTest:function(e){e?p(t.DEPTH_TEST):d(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case No:t.depthFunc(t.NEVER);break;case Uo:t.depthFunc(t.ALWAYS);break;case Fo:t.depthFunc(t.LESS);break;case zo:t.depthFunc(t.LEQUAL);break;case Bo:t.depthFunc(t.EQUAL);break;case Go:t.depthFunc(t.GEQUAL);break;case jo:t.depthFunc(t.GREATER);break;case ko:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}}function a(){var e=!1,i=null,n=null,r=null,o=null,a=null,s=null,h=null,u=null;return{setTest:function(e){e?p(t.STENCIL_TEST):d(t.STENCIL_TEST)},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&o===a||(t.stencilFunc(e,i,a),n=e,r=i,o=a)},setOp:function(e,i,n){a===e&&s===i&&h===n||(t.stencilOp(e,i,n),a=e,s=i,h=n)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,i=null,n=null,r=null,o=null,a=null,s=null,h=null,u=null}}}function s(e,i,n){var r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var a=0;a<n;a++)t.texImage2D(i+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return o}function h(){z.setClear(0,0,0,1),B.setClear(1),G.setClear(0),p(t.DEPTH_TEST),_(zo),S(!1),T(Qr),p(t.CULL_FACE),p(t.BLEND),v(po)}function u(){for(var t=0,e=k.length;t<e;t++)k[t]=0}function c(i){if(k[i]=1,0===V[i]&&(t.enableVertexAttribArray(i),V[i]=1),0!==H[i]){var n=e.get("ANGLE_instanced_arrays");n.vertexAttribDivisorANGLE(i,0),H[i]=0}}function l(e,i,n){k[e]=1,0===V[e]&&(t.enableVertexAttribArray(e),V[e]=1),H[e]!==i&&(n.vertexAttribDivisorANGLE(e,i),H[e]=i)}function f(){for(var e=0,i=V.length;e!==i;++e)V[e]!==k[e]&&(t.disableVertexAttribArray(e),V[e]=0)}function p(e){W[e]!==!0&&(t.enable(e),W[e]=!0)}function d(e){W[e]!==!1&&(t.disable(e),W[e]=!1)}function m(){if(null===q&&(q=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)q.push(i[n]);return q}function v(e,n,r,o,a,s,h,u){e!==fo?p(t.BLEND):d(t.BLEND),e===X&&u===tt||(e===mo?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===vo?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===go?u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),
t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):u?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),X=e,tt=u),e===yo?(a=a||n,s=s||r,h=h||o,n===Y&&a===J||(t.blendEquationSeparate(i(n),i(a)),Y=n,J=a),r===Z&&o===Q&&s===K&&h===$||(t.blendFuncSeparate(i(r),i(o),i(s),i(h)),Z=r,Q=o,K=s,$=h)):(Y=null,Z=null,Q=null,J=null,K=null,$=null)}function g(t){z.setMask(t)}function y(t){B.setTest(t)}function x(t){B.setMask(t)}function _(t){B.setFunc(t)}function b(t){G.setTest(t)}function M(t){G.setMask(t)}function w(t,e,i){G.setFunc(t,e,i)}function E(t,e,i){G.setOp(t,e,i)}function S(e){et!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),et=e)}function T(e){e!==Zr?(p(t.CULL_FACE),e!==it&&(e===Qr?t.cullFace(t.BACK):e===Jr?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):d(t.CULL_FACE),it=e}function P(e){e!==nt&&(ut&&t.lineWidth(e),nt=e)}function L(e,i,n){e?(p(t.POLYGON_OFFSET_FILL),rt===i&&ot===n||(t.polygonOffset(i,n),rt=i,ot=n)):d(t.POLYGON_OFFSET_FILL)}function A(){return at}function C(e){at=e,e?p(t.SCISSOR_TEST):d(t.SCISSOR_TEST)}function R(e){void 0===e&&(e=t.TEXTURE0+st-1),ct!==e&&(t.activeTexture(e),ct=e)}function I(e,i){null===ct&&R();var n=lt[ct];void 0===n&&(n={type:void 0,texture:void 0},lt[ct]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||dt[e]),n.type=e,n.texture=i)}function O(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error(t)}}function D(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error(t)}}function N(e){ft.equals(e)===!1&&(t.scissor(e.x,e.y,e.z,e.w),ft.copy(e))}function U(e){pt.equals(e)===!1&&(t.viewport(e.x,e.y,e.z,e.w),pt.copy(e))}function F(){for(var e=0;e<V.length;e++)1===V[e]&&(t.disableVertexAttribArray(e),V[e]=0);W={},q=null,ct=null,lt={},X=null,et=null,it=null,z.reset(),B.reset(),G.reset()}var z=new n,B=new o,G=new a,j=t.getParameter(t.MAX_VERTEX_ATTRIBS),k=new Uint8Array(j),V=new Uint8Array(j),H=new Uint8Array(j),W={},q=null,X=null,Y=null,Z=null,Q=null,J=null,K=null,$=null,tt=!1,et=null,it=null,nt=null,rt=null,ot=null,at=null,st=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),ht=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),ut=parseFloat(ht)>=1,ct=null,lt={},ft=new r,pt=new r,dt={};return dt[t.TEXTURE_2D]=s(t.TEXTURE_2D,t.TEXTURE_2D,1),dt[t.TEXTURE_CUBE_MAP]=s(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:z,depth:B,stencil:G},init:h,initAttributes:u,enableAttribute:c,enableAttributeAndDivisor:l,disableUnusedAttributes:f,enable:p,disable:d,getCompressedTextureFormats:m,setBlending:v,setColorWrite:g,setDepthTest:y,setDepthWrite:x,setDepthFunc:_,setStencilTest:b,setStencilWrite:M,setStencilFunc:w,setStencilOp:E,setFlipSided:S,setCullFace:T,setLineWidth:P,setPolygonOffset:L,getScissorTest:A,setScissorTest:C,activeTexture:R,bindTexture:I,compressedTexImage2D:O,texImage2D:D,scissor:N,viewport:U,reset:F}}function oe(t,e,i){function n(){if(void 0!==o)return o;var i=e.get("EXT_texture_filter_anisotropic");return o=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o,a=void 0!==i.precision?i.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var h=i.logarithmicDepthBuffer===!0&&!!e.get("EXT_frag_depth"),u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_TEXTURE_SIZE),f=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),p=t.getParameter(t.MAX_VERTEX_ATTRIBS),d=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),m=t.getParameter(t.MAX_VARYING_VECTORS),v=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),g=c>0,y=!!e.get("OES_texture_float"),x=g&&y;return{getMaxAnisotropy:n,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:c,maxTextureSize:l,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:d,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:x}}function ae(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),e[i]=n,n}}}function se(){function t(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),i.numPlanes=r,i.numIntersection=0}function e(t,e,n,r){var o=null!==t?t.length:0,a=null;if(0!==o){if(a=u.value,r!==!0||null===a){var c=n+4*o,l=e.matrixWorldInverse;h.getNormalMatrix(l),(null===a||a.length<c)&&(a=new Float32Array(c));for(var f=0,p=n;f!==o;++f,p+=4)s.copy(t[f]).applyMatrix4(l,h),s.normal.toArray(a,p),a[p+3]=s.constant}u.value=a,u.needsUpdate=!0}return i.numPlanes=o,a}var i=this,n=null,r=0,o=!1,a=!1,s=new it,h=new et,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,a){var s=0!==t.length||i||0!==r||o;return o=i,n=e(t,a,0),r=t.length,s},this.beginShadows=function(){a=!0,e(null)},this.endShadows=function(){a=!1,t()},this.setState=function(i,s,h,c,l,f){if(!o||null===i||0===i.length||a&&!h)a?e(null):t();else{var p=a?0:r,d=4*p,m=l.clippingState||null;u.value=m,m=e(i,c,d,f);for(var v=0;v!==d;++v)m[v]=n[v];l.clippingState=m,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=p}}}function he(t){function e(){return null===pt?Tt:1}function i(){he.init(),he.scissor(yt.copy(At).multiplyScalar(Tt)),he.viewport(_t.copy(Ot).multiplyScalar(Tt)),he.buffers.color.setClear(Mt.r,Mt.g,Mt.b,wt,Q)}function n(){lt=null,gt=null,vt="",mt=-1,he.reset()}function o(t){t.preventDefault(),n(),i(),ue.clear()}function a(t){var e=t.target;e.removeEventListener("dispose",a),s(e)}function s(t){c(t),ue.delete(t)}function c(t){var e=ue.get(t).program;t.program=void 0,void 0!==e&&fe.releaseProgram(e)}function l(t,e,i,n){var r;if(i&&i.isInstancedBufferGeometry&&(r=Kt.get("ANGLE_instanced_arrays"),null===r))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0),he.initAttributes();var o=i.attributes,a=e.getAttributes(),s=t.defaultAttributeValues;for(var h in a){var u=a[h];if(u>=0){var c=o[h];if(void 0!==c){var l=c.normalized,f=c.itemSize,p=le.getAttributeProperties(c),d=p.__webglBuffer,m=p.type,v=p.bytesPerElement;if(c.isInterleavedBufferAttribute){var g=c.data,y=g.stride,x=c.offset;g&&g.isInstancedInterleavedBuffer?(he.enableAttributeAndDivisor(u,g.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=g.meshPerAttribute*g.count)):he.enableAttribute(u),Qt.bindBuffer(Qt.ARRAY_BUFFER,d),Qt.vertexAttribPointer(u,f,m,l,y*v,(n*y+x)*v)}else c.isInstancedBufferAttribute?(he.enableAttributeAndDivisor(u,c.meshPerAttribute,r),void 0===i.maxInstancedCount&&(i.maxInstancedCount=c.meshPerAttribute*c.count)):he.enableAttribute(u),Qt.bindBuffer(Qt.ARRAY_BUFFER,d),Qt.vertexAttribPointer(u,f,m,l,0,n*f*v)}else if(void 0!==s){var _=s[h];if(void 0!==_)switch(_.length){case 2:Qt.vertexAttrib2fv(u,_);break;case 3:Qt.vertexAttrib3fv(u,_);break;case 4:Qt.vertexAttrib4fv(u,_);break;default:Qt.vertexAttrib1fv(u,_)}}}}he.disableUnusedAttributes()}function f(t,e){return Math.abs(e[0])-Math.abs(t[0])}function p(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.material.program&&e.material.program&&t.material.program!==e.material.program?t.material.program.id-e.material.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function d(t,e){return t.object.renderOrder!==e.object.renderOrder?t.object.renderOrder-e.object.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function m(t,e,i,n,r){var o,a;i.transparent?(o=ot,a=++at):(o=et,a=++it);var s=o[a];void 0!==s?(s.id=t.id,s.object=t,s.geometry=e,s.material=i,s.z=Wt.z,s.group=r):(s={id:t.id,object:t,geometry:e,material:i,z:Wt.z,group:r},o.push(s))}function v(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Vt.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),y(Vt)}function g(t){return Vt.center.set(0,0,0),Vt.radius=.7071067811865476,Vt.applyMatrix4(t.matrixWorld),y(Vt)}function y(t){if(!Bt.intersectsSphere(t))return!1;var e=Gt.numPlanes;if(0===e)return!0;var i=ct.clippingPlanes,n=t.center,r=-t.radius,o=0;do if(i[o].distanceToPoint(n)<r)return!1;while(++o!==e);return!0}function x(t,e){if(t.visible!==!1){var i=0!==(t.layers.mask&e.layers.mask);if(i)if(t.isLight)$.push(t);else if(t.isSprite)t.frustumCulled!==!1&&g(t)!==!0||ht.push(t);else if(t.isLensFlare)ut.push(t);else if(t.isImmediateRenderObject)ct.sortObjects===!0&&(Wt.setFromMatrixPosition(t.matrixWorld),Wt.applyMatrix4(Ht)),m(t,null,t.material,Wt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),t.frustumCulled===!1||v(t)===!0)){var n=t.material;if(n.visible===!0){ct.sortObjects===!0&&(Wt.setFromMatrixPosition(t.matrixWorld),Wt.applyMatrix4(Ht));var r=le.update(t);if(n.isMultiMaterial)for(var o=r.groups,a=n.materials,s=0,h=o.length;s<h;s++){var u=o[s],c=a[u.materialIndex];c.visible===!0&&m(t,r,c,Wt.z,u)}else m(t,r,n,Wt.z,null)}}for(var l=t.children,s=0,h=l.length;s<h;s++)x(l[s],e)}}function _(t,e,i,n){for(var r=0,o=t.length;r<o;r++){var a=t[r],s=a.object,h=a.geometry,u=void 0===n?a.material:n,c=a.group;if(s.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s.onBeforeRender(ct,e,i,h,u,c),s.isImmediateRenderObject){M(u);var l=w(i,e.fog,u,s);vt="",s.render(function(t){ct.renderBufferImmediate(t,l,u)})}else ct.renderBufferDirect(i,e.fog,h,u,s,c);s.onAfterRender(ct,e,i,h,u,c)}}function b(t,e,i){var n=ue.get(t),r=fe.getParameters(t,Yt,e,Gt.numPlanes,Gt.numIntersection,i),o=fe.getProgramCode(t,r),s=n.program,h=!0;if(void 0===s)t.addEventListener("dispose",a);else if(s.code!==o)c(t);else{if(void 0!==r.shaderID)return;h=!1}if(h){if(r.shaderID){var u=Mu[r.shaderID];n.__webglShader={name:t.type,uniforms:ys.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else n.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=n.__webglShader,s=fe.acquireProgram(t,r,o),n.program=s,t.program=s}var l=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var f=0;f<ct.maxMorphTargets;f++)l["morphTarget"+f]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(var f=0;f<ct.maxMorphNormals;f++)l["morphNormal"+f]>=0&&t.numSupportedMorphNormals++}var p=n.__webglShader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&t.clipping!==!0||(n.numClippingPlanes=Gt.numPlanes,n.numIntersection=Gt.numIntersection,p.clippingPlanes=Gt.uniform),n.fog=e,n.lightsHash=Yt.hash,t.lights&&(p.ambientLightColor.value=Yt.ambient,p.directionalLights.value=Yt.directional,p.spotLights.value=Yt.spot,p.rectAreaLights.value=Yt.rectArea,p.pointLights.value=Yt.point,p.hemisphereLights.value=Yt.hemi,p.directionalShadowMap.value=Yt.directionalShadowMap,p.directionalShadowMatrix.value=Yt.directionalShadowMatrix,p.spotShadowMap.value=Yt.spotShadowMap,p.spotShadowMatrix.value=Yt.spotShadowMatrix,p.pointShadowMap.value=Yt.pointShadowMap,p.pointShadowMatrix.value=Yt.pointShadowMatrix);var d=n.program.getUniforms(),m=H.seqWithValue(d.seq,p);n.uniformsList=m}function M(t){t.side===ao?he.disable(Qt.CULL_FACE):he.enable(Qt.CULL_FACE),he.setFlipSided(t.side===oo),t.transparent===!0?he.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):he.setBlending(fo),he.setDepthFunc(t.depthFunc),he.setDepthTest(t.depthTest),he.setDepthWrite(t.depthWrite),he.setColorWrite(t.colorWrite),he.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function w(t,e,i,n){bt=0;var r=ue.get(i);if(jt&&(kt||t!==gt)){var o=t===gt&&i.id===mt;Gt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,o)}i.needsUpdate===!1&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==Yt.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===Gt.numPlanes&&r.numIntersection===Gt.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(b(i,e,n),i.needsUpdate=!1);var a=!1,s=!1,h=!1,u=r.program,c=u.getUniforms(),l=r.__webglShader.uniforms;if(u.id!==lt&&(Qt.useProgram(u.program),lt=u.id,a=!0,s=!0,h=!0),i.id!==mt&&(mt=i.id,s=!0),a||t!==gt){if(c.set(Qt,t,"projectionMatrix"),te.logarithmicDepthBuffer&&c.setValue(Qt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),t!==gt&&(gt=t,s=!0,h=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var f=c.map.cameraPosition;void 0!==f&&f.setValue(Qt,Wt.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&c.setValue(Qt,"viewMatrix",t.matrixWorldInverse),c.set(Qt,ct,"toneMappingExposure"),c.set(Qt,ct,"toneMappingWhitePoint")}if(i.skinning){c.setOptional(Qt,n,"bindMatrix"),c.setOptional(Qt,n,"bindMatrixInverse");var p=n.skeleton;p&&(te.floatVertexTextures&&p.useVertexTexture?(c.set(Qt,p,"boneTexture"),c.set(Qt,p,"boneTextureWidth"),c.set(Qt,p,"boneTextureHeight")):c.setOptional(Qt,p,"boneMatrices"))}return s&&(i.lights&&N(l,h),e&&i.fog&&L(l,e),(i.isMeshBasicMaterial||i.isMeshLambertMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isMeshNormalMaterial||i.isMeshDepthMaterial)&&E(l,i),i.isLineBasicMaterial?S(l,i):i.isLineDashedMaterial?(S(l,i),T(l,i)):i.isPointsMaterial?P(l,i):i.isMeshLambertMaterial?A(l,i):i.isMeshToonMaterial?R(l,i):i.isMeshPhongMaterial?C(l,i):i.isMeshPhysicalMaterial?O(l,i):i.isMeshStandardMaterial?I(l,i):i.isMeshDepthMaterial?i.displacementMap&&(l.displacementMap.value=i.displacementMap,l.displacementScale.value=i.displacementScale,l.displacementBias.value=i.displacementBias):i.isMeshNormalMaterial&&D(l,i),void 0!==l.ltcMat&&(l.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE),void 0!==l.ltcMag&&(l.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE),H.upload(Qt,r.uniformsList,l,ct)),c.set(Qt,n,"modelViewMatrix"),c.set(Qt,n,"normalMatrix"),c.setValue(Qt,"modelMatrix",n.matrixWorld),u}function E(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var i;if(e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var n=i.offset,r=i.repeat;t.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}function S(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function T(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function P(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*Tt,t.scale.value=.5*St,t.map.value=e.map,null!==e.map){var i=e.map.offset,n=e.map.repeat;t.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}function L(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}function A(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}function C(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function R(t,e){C(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}function I(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function O(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,I(t,e)}function D(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function N(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function U(t){for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r.castShadow&&(Yt.shadows[e++]=r)}Yt.shadows.length=e}function F(t,e){var i,n,r,o,a,s,h,c=0,l=0,f=0,p=e.matrixWorldInverse,d=0,m=0,v=0,g=0,y=0;for(i=0,n=t.length;i<n;i++)if(r=t[i],o=r.color,a=r.intensity,s=r.distance,h=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r.isAmbientLight)c+=o.r*a,l+=o.g*a,f+=o.b*a;else if(r.isDirectionalLight){var x=pe.get(r);x.color.copy(r.color).multiplyScalar(r.intensity),x.direction.setFromMatrixPosition(r.matrixWorld),Wt.setFromMatrixPosition(r.target.matrixWorld),x.direction.sub(Wt),x.direction.transformDirection(p),x.shadow=r.castShadow,r.castShadow&&(x.shadowBias=r.shadow.bias,x.shadowRadius=r.shadow.radius,x.shadowMapSize=r.shadow.mapSize),Yt.directionalShadowMap[d]=h,Yt.directionalShadowMatrix[d]=r.shadow.matrix,Yt.directional[d++]=x}else if(r.isSpotLight){var x=pe.get(r);x.position.setFromMatrixPosition(r.matrixWorld),x.position.applyMatrix4(p),x.color.copy(o).multiplyScalar(a),x.distance=s,x.direction.setFromMatrixPosition(r.matrixWorld),Wt.setFromMatrixPosition(r.target.matrixWorld),x.direction.sub(Wt),x.direction.transformDirection(p),x.coneCos=Math.cos(r.angle),x.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),x.decay=0===r.distance?0:r.decay,x.shadow=r.castShadow,r.castShadow&&(x.shadowBias=r.shadow.bias,x.shadowRadius=r.shadow.radius,x.shadowMapSize=r.shadow.mapSize),Yt.spotShadowMap[v]=h,Yt.spotShadowMatrix[v]=r.shadow.matrix,Yt.spot[v++]=x}else if(r.isRectAreaLight){var x=pe.get(r);x.color.copy(o).multiplyScalar(a/(r.width*r.height)),x.position.setFromMatrixPosition(r.matrixWorld),x.position.applyMatrix4(p),Xt.identity(),qt.copy(r.matrixWorld),qt.premultiply(p),Xt.extractRotation(qt),x.halfWidth.set(.5*r.width,0,0),x.halfHeight.set(0,.5*r.height,0),x.halfWidth.applyMatrix4(Xt),x.halfHeight.applyMatrix4(Xt),Yt.rectArea[g++]=x}else if(r.isPointLight){var x=pe.get(r);x.position.setFromMatrixPosition(r.matrixWorld),x.position.applyMatrix4(p),x.color.copy(r.color).multiplyScalar(r.intensity),x.distance=r.distance,x.decay=0===r.distance?0:r.decay,x.shadow=r.castShadow,r.castShadow&&(x.shadowBias=r.shadow.bias,x.shadowRadius=r.shadow.radius,x.shadowMapSize=r.shadow.mapSize),Yt.pointShadowMap[m]=h,void 0===Yt.pointShadowMatrix[m]&&(Yt.pointShadowMatrix[m]=new u),Wt.setFromMatrixPosition(r.matrixWorld).negate(),Yt.pointShadowMatrix[m].identity().setPosition(Wt),Yt.point[m++]=x}else if(r.isHemisphereLight){var x=pe.get(r);x.direction.setFromMatrixPosition(r.matrixWorld),x.direction.transformDirection(p),x.direction.normalize(),x.skyColor.copy(r.color).multiplyScalar(a),x.groundColor.copy(r.groundColor).multiplyScalar(a),Yt.hemi[y++]=x}Yt.ambient[0]=c,Yt.ambient[1]=l,Yt.ambient[2]=f,Yt.directional.length=d,Yt.spot.length=v,Yt.rectArea.length=g,Yt.point.length=m,Yt.hemi.length=y,Yt.hash=d+","+m+","+v+","+g+","+y+","+Yt.shadows.length}function z(){var t=bt;return t>=te.maxTextures&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+te.maxTextures),bt+=1,t}function B(t){var e;if(t===oa)return Qt.REPEAT;if(t===aa)return Qt.CLAMP_TO_EDGE;if(t===sa)return Qt.MIRRORED_REPEAT;if(t===ha)return Qt.NEAREST;if(t===ua)return Qt.NEAREST_MIPMAP_NEAREST;if(t===ca)return Qt.NEAREST_MIPMAP_LINEAR;if(t===la)return Qt.LINEAR;if(t===fa)return Qt.LINEAR_MIPMAP_NEAREST;if(t===pa)return Qt.LINEAR_MIPMAP_LINEAR;if(t===da)return Qt.UNSIGNED_BYTE;if(t===Ma)return Qt.UNSIGNED_SHORT_4_4_4_4;if(t===wa)return Qt.UNSIGNED_SHORT_5_5_5_1;if(t===Ea)return Qt.UNSIGNED_SHORT_5_6_5;if(t===ma)return Qt.BYTE;if(t===va)return Qt.SHORT;if(t===ga)return Qt.UNSIGNED_SHORT;if(t===ya)return Qt.INT;if(t===xa)return Qt.UNSIGNED_INT;if(t===_a)return Qt.FLOAT;if(t===ba&&(e=Kt.get("OES_texture_half_float"),null!==e))return e.HALF_FLOAT_OES;if(t===Ta)return Qt.ALPHA;if(t===Pa)return Qt.RGB;if(t===La)return Qt.RGBA;if(t===Aa)return Qt.LUMINANCE;if(t===Ca)return Qt.LUMINANCE_ALPHA;if(t===Ia)return Qt.DEPTH_COMPONENT;if(t===Oa)return Qt.DEPTH_STENCIL;if(t===xo)return Qt.FUNC_ADD;if(t===_o)return Qt.FUNC_SUBTRACT;if(t===bo)return Qt.FUNC_REVERSE_SUBTRACT;if(t===Eo)return Qt.ZERO;if(t===So)return Qt.ONE;if(t===To)return Qt.SRC_COLOR;if(t===Po)return Qt.ONE_MINUS_SRC_COLOR;if(t===Lo)return Qt.SRC_ALPHA;if(t===Ao)return Qt.ONE_MINUS_SRC_ALPHA;if(t===Co)return Qt.DST_ALPHA;if(t===Ro)return Qt.ONE_MINUS_DST_ALPHA;if(t===Io)return Qt.DST_COLOR;if(t===Oo)return Qt.ONE_MINUS_DST_COLOR;if(t===Do)return Qt.SRC_ALPHA_SATURATE;if((t===Da||t===Na||t===Ua||t===Fa)&&(e=Kt.get("WEBGL_compressed_texture_s3tc"),null!==e)){if(t===Da)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Na)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Ua)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Fa)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((t===za||t===Ba||t===Ga||t===ja)&&(e=Kt.get("WEBGL_compressed_texture_pvrtc"),null!==e)){if(t===za)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Ba)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Ga)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ja)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===ka&&(e=Kt.get("WEBGL_compressed_texture_etc1"),null!==e))return e.COMPRESSED_RGB_ETC1_WEBGL;if((t===Mo||t===wo)&&(e=Kt.get("EXT_blend_minmax"),null!==e)){if(t===Mo)return e.MIN_EXT;if(t===wo)return e.MAX_EXT}return t===Sa&&(e=Kt.get("WEBGL_depth_texture"),null!==e)?e.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer",Xr),t=t||{};var G=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),j=void 0!==t.context?t.context:null,k=void 0!==t.alpha&&t.alpha,V=void 0===t.depth||t.depth,q=void 0===t.stencil||t.stencil,X=void 0!==t.antialias&&t.antialias,Q=void 0===t.premultipliedAlpha||t.premultipliedAlpha,K=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,$=[],et=[],it=-1,ot=[],at=-1,st=new Float32Array(8),ht=[],ut=[];this.domElement=G,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Xo,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var ct=this,lt=null,pt=null,dt=null,mt=-1,vt="",gt=null,yt=new r,xt=null,_t=new r,bt=0,Mt=new W(0),wt=0,Et=G.width,St=G.height,Tt=1,At=new r(0,0,Et,St),Rt=!1,Ot=new r(0,0,Et,St),Bt=new nt,Gt=new se,jt=!1,kt=!1,Vt=new tt,Ht=new u,Wt=new h,qt=new u,Xt=new u,Yt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Zt={calls:0,vertices:0,faces:0,points:0};this.info={render:Zt,memory:{geometries:0,textures:0},programs:null};var Qt;try{var Jt={alpha:k,depth:V,stencil:q,antialias:X,premultipliedAlpha:Q,preserveDrawingBuffer:K};if(Qt=j||G.getContext("webgl",Jt)||G.getContext("experimental-webgl",Jt),null===Qt)throw null!==G.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Qt.getShaderPrecisionFormat&&(Qt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),G.addEventListener("webglcontextlost",o,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}var Kt=new ae(Qt);Kt.get("WEBGL_depth_texture"),Kt.get("OES_texture_float"),Kt.get("OES_texture_float_linear"),Kt.get("OES_texture_half_float"),Kt.get("OES_texture_half_float_linear"),Kt.get("OES_standard_derivatives"),Kt.get("ANGLE_instanced_arrays"),Kt.get("OES_element_index_uint")&&(Pt.MaxIndex=4294967296);var te=new oe(Qt,Kt,t),he=new re(Qt,Kt,B),ue=new ne,ce=new ie(Qt,Kt,he,ue,te,B,this.info),le=new ee(Qt,ue,this.info),fe=new $t(this,te),pe=new zt;this.info.programs=fe.programs;var de,me,ve,ge,ye=new Ft(Qt,Kt,Zt),xe=new Ut(Qt,Kt,Zt);i(),this.context=Qt,this.capabilities=te,this.extensions=Kt,this.properties=ue,this.state=he;var _e=new rt(this,Yt,le,te);this.shadowMap=_e;var be=new Z(this,ht),Me=new Y(this,ut);this.getContext=function(){return Qt},this.getContextAttributes=function(){return Qt.getContextAttributes()},this.forceContextLoss=function(){Kt.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return te.getMaxAnisotropy()},this.getPrecision=function(){return te.precision},this.getPixelRatio=function(){return Tt},this.setPixelRatio=function(t){void 0!==t&&(Tt=t,this.setSize(Ot.z,Ot.w,!1))},this.getSize=function(){return{width:Et,height:St}},this.setSize=function(t,e,i){Et=t,St=e,G.width=t*Tt,G.height=e*Tt,i!==!1&&(G.style.width=t+"px",G.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,i,n){he.viewport(Ot.set(t,e,i,n))},this.setScissor=function(t,e,i,n){he.scissor(At.set(t,e,i,n))},this.setScissorTest=function(t){he.setScissorTest(Rt=t)},this.getClearColor=function(){return Mt},this.setClearColor=function(t,e){Mt.set(t),wt=void 0!==e?e:1,he.buffers.color.setClear(Mt.r,Mt.g,Mt.b,wt,Q)},this.getClearAlpha=function(){return wt},this.setClearAlpha=function(t){wt=t,he.buffers.color.setClear(Mt.r,Mt.g,Mt.b,wt,Q)},this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=Qt.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=Qt.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=Qt.STENCIL_BUFFER_BIT),Qt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},this.resetGLState=n,this.dispose=function(){ot=[],at=-1,et=[],it=-1,G.removeEventListener("webglcontextlost",o,!1)},this.renderBufferImmediate=function(t,e,i){he.initAttributes();var n=ue.get(t);t.hasPositions&&!n.position&&(n.position=Qt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=Qt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=Qt.createBuffer()),t.hasColors&&!n.color&&(n.color=Qt.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(Qt.bindBuffer(Qt.ARRAY_BUFFER,n.position),Qt.bufferData(Qt.ARRAY_BUFFER,t.positionArray,Qt.DYNAMIC_DRAW),he.enableAttribute(r.position),Qt.vertexAttribPointer(r.position,3,Qt.FLOAT,!1,0,0)),t.hasNormals){if(Qt.bindBuffer(Qt.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&i.shading===so)for(var o=0,a=3*t.count;o<a;o+=9){var s=t.normalArray,h=(s[o+0]+s[o+3]+s[o+6])/3,u=(s[o+1]+s[o+4]+s[o+7])/3,c=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=h,s[o+1]=u,s[o+2]=c,s[o+3]=h,s[o+4]=u,s[o+5]=c,s[o+6]=h,s[o+7]=u,s[o+8]=c}Qt.bufferData(Qt.ARRAY_BUFFER,t.normalArray,Qt.DYNAMIC_DRAW),he.enableAttribute(r.normal),Qt.vertexAttribPointer(r.normal,3,Qt.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(Qt.bindBuffer(Qt.ARRAY_BUFFER,n.uv),Qt.bufferData(Qt.ARRAY_BUFFER,t.uvArray,Qt.DYNAMIC_DRAW),he.enableAttribute(r.uv),Qt.vertexAttribPointer(r.uv,2,Qt.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==uo&&(Qt.bindBuffer(Qt.ARRAY_BUFFER,n.color),Qt.bufferData(Qt.ARRAY_BUFFER,t.colorArray,Qt.DYNAMIC_DRAW),he.enableAttribute(r.color),Qt.vertexAttribPointer(r.color,3,Qt.FLOAT,!1,0,0)),he.disableUnusedAttributes(),Qt.drawArrays(Qt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,i,n,r,o,a){M(r);var s=w(t,i,r,o),h=!1,u=n.id+"_"+s.id+"_"+r.wireframe;u!==vt&&(vt=u,h=!0);var c=o.morphTargetInfluences;if(void 0!==c){for(var p=[],d=0,m=c.length;d<m;d++){var v=c[d];p.push([v,d])}p.sort(f),p.length>8&&(p.length=8);for(var g=n.morphAttributes,d=0,m=p.length;d<m;d++){var v=p[d];if(st[d]=v[0],0!==v[0]){var y=v[1];r.morphTargets===!0&&g.position&&n.addAttribute("morphTarget"+d,g.position[y]),r.morphNormals===!0&&g.normal&&n.addAttribute("morphNormal"+d,g.normal[y])}else r.morphTargets===!0&&n.removeAttribute("morphTarget"+d),r.morphNormals===!0&&n.removeAttribute("morphNormal"+d)}for(var d=p.length,x=st.length;d<x;d++)st[d]=0;s.getUniforms().setValue(Qt,"morphTargetInfluences",st),h=!0}var y=n.index,_=n.attributes.position,b=1;r.wireframe===!0&&(y=le.getWireframeAttribute(n),b=2);var E;null!==y?(E=xe,E.setIndex(y)):E=ye,h&&(l(r,s,n),null!==y&&Qt.bindBuffer(Qt.ELEMENT_ARRAY_BUFFER,le.getAttributeBuffer(y)));var S=0;null!==y?S=y.count:void 0!==_&&(S=_.count);var T=n.drawRange.start*b,P=n.drawRange.count*b,L=null!==a?a.start*b:0,A=null!==a?a.count*b:1/0,C=Math.max(T,L),R=Math.min(S,T+P,L+A)-1,I=Math.max(0,R-C+1);if(0!==I){if(o.isMesh)if(r.wireframe===!0)he.setLineWidth(r.wireframeLinewidth*e()),E.setMode(Qt.LINES);else switch(o.drawMode){case Ka:E.setMode(Qt.TRIANGLES);break;case $a:E.setMode(Qt.TRIANGLE_STRIP);break;case ts:E.setMode(Qt.TRIANGLE_FAN)}else if(o.isLine){var O=r.linewidth;void 0===O&&(O=1),he.setLineWidth(O*e()),o.isLineSegments?E.setMode(Qt.LINES):E.setMode(Qt.LINE_STRIP)}else o.isPoints&&E.setMode(Qt.POINTS);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&E.renderInstances(n,C,I):E.render(C,I)}},this.render=function(t,e,i,n){if(void 0!==e&&e.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");vt="",mt=-1,gt=null,t.autoUpdate===!0&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),
Ht.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Bt.setFromMatrix(Ht),$.length=0,it=-1,at=-1,ht.length=0,ut.length=0,kt=this.localClippingEnabled,jt=Gt.init(this.clippingPlanes,kt,e),x(t,e),et.length=it+1,ot.length=at+1,ct.sortObjects===!0&&(et.sort(p),ot.sort(d)),jt&&Gt.beginShadows(),U($),_e.render(t,e),F($,e),jt&&Gt.endShadows(),Zt.calls=0,Zt.vertices=0,Zt.faces=0,Zt.points=0,void 0===i&&(i=null),this.setRenderTarget(i);var r=t.background;if(null===r?he.buffers.color.setClear(Mt.r,Mt.g,Mt.b,wt,Q):r&&r.isColor&&(he.buffers.color.setClear(r.r,r.g,r.b,1,Q),n=!0),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),r&&r.isCubeTexture?(void 0===ve&&(ve=new Dt,ge=new Lt(new Ct(5,5,5),new J({uniforms:Mu.cube.uniforms,vertexShader:Mu.cube.vertexShader,fragmentShader:Mu.cube.fragmentShader,side:oo,depthTest:!1,depthWrite:!1,fog:!1}))),ve.projectionMatrix.copy(e.projectionMatrix),ve.matrixWorld.extractRotation(e.matrixWorld),ve.matrixWorldInverse.getInverse(ve.matrixWorld),ge.material.uniforms.tCube.value=r,ge.modelViewMatrix.multiplyMatrices(ve.matrixWorldInverse,ge.matrixWorld),le.update(ge),ct.renderBufferDirect(ve,null,ge.geometry,ge.material,ge,null)):r&&r.isTexture&&(void 0===de&&(de=new Nt(-1,1,1,-1,0,1),me=new Lt(new It(2,2),new ft({depthTest:!1,depthWrite:!1,fog:!1}))),me.material.map=r,le.update(me),ct.renderBufferDirect(de,null,me.geometry,me.material,me,null)),t.overrideMaterial){var o=t.overrideMaterial;_(et,t,e,o),_(ot,t,e,o)}else he.setBlending(fo),_(et,t,e),_(ot,t,e);be.render(t,e),Me.render(t,e,_t),i&&ce.updateRenderTargetMipmap(i),he.setDepthTest(!0),he.setDepthWrite(!0),he.setColorWrite(!0)},this.setFaceCulling=function(t,e){he.setCullFace(t),he.setFlipSided(e===$r)},this.allocTextureUnit=z,this.setTexture2D=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),ce.setTexture2D(e,i)}}(),this.setTexture=function(){var t=!1;return function(e,i){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),ce.setTexture2D(e,i)}}(),this.setTextureCube=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?ce.setTextureCube(e,i):ce.setTextureCubeDynamic(e,i)}}(),this.getCurrentRenderTarget=function(){return pt},this.setRenderTarget=function(t){pt=t,t&&void 0===ue.get(t).__webglFramebuffer&&ce.setupRenderTarget(t);var e,i=t&&t.isWebGLRenderTargetCube;if(t){var n=ue.get(t);e=i?n.__webglFramebuffer[t.activeCubeFace]:n.__webglFramebuffer,yt.copy(t.scissor),xt=t.scissorTest,_t.copy(t.viewport)}else e=null,yt.copy(At).multiplyScalar(Tt),xt=Rt,_t.copy(Ot).multiplyScalar(Tt);if(dt!==e&&(Qt.bindFramebuffer(Qt.FRAMEBUFFER,e),dt=e),he.scissor(yt),he.setScissorTest(xt),he.viewport(_t),i){var r=ue.get(t.texture);Qt.framebufferTexture2D(Qt.FRAMEBUFFER,Qt.COLOR_ATTACHMENT0,Qt.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,n,r,o){if((t&&t.isWebGLRenderTarget)===!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var a=ue.get(t).__webglFramebuffer;if(a){var s=!1;a!==dt&&(Qt.bindFramebuffer(Qt.FRAMEBUFFER,a),s=!0);try{var h=t.texture,u=h.format,c=h.type;if(u!==La&&B(u)!==Qt.getParameter(Qt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===da||B(c)===Qt.getParameter(Qt.IMPLEMENTATION_COLOR_READ_TYPE)||c===_a&&(Kt.get("OES_texture_float")||Kt.get("WEBGL_color_buffer_float"))||c===ba&&Kt.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Qt.checkFramebufferStatus(Qt.FRAMEBUFFER)===Qt.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&Qt.readPixels(e,i,n,r,B(u),B(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Qt.bindFramebuffer(Qt.FRAMEBUFFER,dt)}}}}function ue(t,e){this.name="",this.color=new W(t),this.density=void 0!==e?e:25e-5}function ce(t,e,i){this.name="",this.color=new W(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function le(){ht.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function fe(t,e,i,n,r){ht.call(this),this.lensFlares=[],this.positionScreen=new h,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,i,n,r)}function pe(t){Q.call(this),this.type="SpriteMaterial",this.color=new W(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function de(t){ht.call(this),this.type="Sprite",this.material=void 0!==t?t:new pe}function me(){ht.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ve(t,e,i){if(this.useVertexTexture=void 0===i||i,this.identityMatrix=new u,t=t||[],this.bones=t.slice(0),this.useVertexTexture){var n=Math.sqrt(4*this.bones.length);n=ls.nextPowerOfTwo(Math.ceil(n)),n=Math.max(n,4),this.boneTextureWidth=n,this.boneTextureHeight=n,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new q(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,La,_a)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new u)}}function ge(){ht.call(this),this.type="Bone"}function ye(t,e,i){Lt.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new u,this.bindMatrixInverse=new u;var n=[];if(this.geometry&&void 0!==this.geometry.bones){for(var r,o,a=0,s=this.geometry.bones.length;a<s;++a)o=this.geometry.bones[a],r=new ge,n.push(r),r.name=o.name,r.position.fromArray(o.pos),r.quaternion.fromArray(o.rotq),void 0!==o.scl&&r.scale.fromArray(o.scl);for(var a=0,s=this.geometry.bones.length;a<s;++a)o=this.geometry.bones[a],o.parent!==-1&&null!==o.parent&&void 0!==n[o.parent]?n[o.parent].add(n[a]):this.add(n[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new ve(n,void 0,i),this.matrixWorld)}function xe(t){Q.call(this),this.type="LineBasicMaterial",this.color=new W(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function _e(t,e,i){return 1===i?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new be(t,e)):(ht.call(this),this.type="Line",this.geometry=void 0!==t?t:new Pt,void(this.material=void 0!==e?e:new xe({color:16777215*Math.random()})))}function be(t,e){_e.call(this,t,e),this.type="LineSegments"}function Me(t){Q.call(this),this.type="PointsMaterial",this.color=new W(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function we(t,e){ht.call(this),this.type="Points",this.geometry=void 0!==t?t:new Pt,this.material=void 0!==e?e:new Me({color:16777215*Math.random()})}function Ee(){ht.call(this),this.type="Group"}function Se(t,e,i,r,o,a,s,h,u){function c(){requestAnimationFrame(c),t.readyState>=t.HAVE_CURRENT_DATA&&(l.needsUpdate=!0)}n.call(this,t,e,i,r,o,a,s,h,u),this.generateMipmaps=!1;var l=this;c()}function Te(t,e,i,r,o,a,s,h,u,c,l,f){n.call(this,null,a,s,h,u,c,r,o,l,f),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Pe(t,e,i,r,o,a,s,h,u){n.call(this,t,e,i,r,o,a,s,h,u),this.needsUpdate=!0}function Le(t,e,i,r,o,a,s,h,u,c){if(c=void 0!==c?c:Ia,c!==Ia&&c!==Oa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ia&&(i=ga),void 0===i&&c===Oa&&(i=Sa),n.call(this,null,r,o,a,s,h,c,i,u),this.image={width:t,height:e},this.magFilter=void 0!==s?s:ha,this.minFilter=void 0!==h?h:ha,this.flipY=!1,this.generateMipmaps=!1}function Ae(t){function e(t,e){return t-e}Pt.call(this),this.type="WireframeGeometry";var i,n,r,o,a,s,u,c,l=[],f=[0,0],p={},d=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(i=0,r=m.length;i<r;i++){var v=m[i];for(n=0;n<3;n++)f[0]=v[d[n]],f[1]=v[d[(n+1)%3]],f.sort(e),u=f.toString(),void 0===p[u]&&(p[u]={index1:f[0],index2:f[1]})}for(u in p)s=p[u],c=t.vertices[s.index1],l.push(c.x,c.y,c.z),c=t.vertices[s.index2],l.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var g,y,x,_,b,M,w,E;if(c=new h,null!==t.index){for(g=t.attributes.position,y=t.index,x=t.groups,0===x.length&&t.addGroup(0,y.count),o=0,a=x.length;o<a;++o)for(_=x[o],b=_.start,M=_.count,i=b,r=b+M;i<r;i+=3)for(n=0;n<3;n++)f[0]=y.getX(i+n),f[1]=y.getX(i+(n+1)%3),f.sort(e),u=f.toString(),void 0===p[u]&&(p[u]={index1:f[0],index2:f[1]});for(u in p)s=p[u],c.fromBufferAttribute(g,s.index1),l.push(c.x,c.y,c.z),c.fromBufferAttribute(g,s.index2),l.push(c.x,c.y,c.z)}else for(g=t.attributes.position,i=0,r=g.count/3;i<r;i++)for(n=0;n<3;n++)w=3*i+n,c.fromBufferAttribute(g,w),l.push(c.x,c.y,c.z),E=3*i+(n+1)%3,c.fromBufferAttribute(g,E),l.push(c.x,c.y,c.z)}this.addAttribute("position",new bt(l,3))}function Ce(t,e,i){Tt.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new Re(t,e,i)),this.mergeVertices()}function Re(t,e,i){Pt.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n,r,o=[],a=[],s=[],h=e+1;for(n=0;n<=i;n++){var u=n/i;for(r=0;r<=e;r++){var c=r/e,l=t(c,u);a.push(l.x,l.y,l.z),s.push(c,u)}}for(n=0;n<i;n++)for(r=0;r<e;r++){var f=n*h+r,p=n*h+r+1,d=(n+1)*h+r+1,m=(n+1)*h+r;o.push(f,p,m),o.push(p,d,m)}this.setIndex(o),this.addAttribute("position",new bt(a,3)),this.addAttribute("uv",new bt(s,2)),this.computeVertexNormals()}function Ie(t,e,i,n){Tt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new Oe(t,e,i,n)),this.mergeVertices()}function Oe(t,e,n,r){function o(t){for(var i=new h,n=new h,r=new h,o=0;o<e.length;o+=3)f(e[o+0],i),f(e[o+1],n),f(e[o+2],r),a(i,n,r,t)}function a(t,e,i,n){var r,o,a=Math.pow(2,n),s=[];for(r=0;r<=a;r++){s[r]=[];var h=t.clone().lerp(i,r/a),u=e.clone().lerp(i,r/a),c=a-r;for(o=0;o<=c;o++)0===o&&r===a?s[r][o]=h:s[r][o]=h.clone().lerp(u,o/c)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var f=Math.floor(o/2);o%2===0?(l(s[r][f+1]),l(s[r+1][f]),l(s[r][f])):(l(s[r][f+1]),l(s[r+1][f+1]),l(s[r+1][f]))}}function s(t){for(var e=new h,i=0;i<g.length;i+=3)e.x=g[i+0],e.y=g[i+1],e.z=g[i+2],e.normalize().multiplyScalar(t),g[i+0]=e.x,g[i+1]=e.y,g[i+2]=e.z}function u(){for(var t=new h,e=0;e<g.length;e+=3){t.x=g[e+0],t.y=g[e+1],t.z=g[e+2];var i=m(t)/2/Math.PI+.5,n=v(t)/Math.PI+.5;y.push(i,1-n)}p(),c()}function c(){for(var t=0;t<y.length;t+=6){var e=y[t+0],i=y[t+2],n=y[t+4],r=Math.max(e,i,n),o=Math.min(e,i,n);r>.9&&o<.1&&(e<.2&&(y[t+0]+=1),i<.2&&(y[t+2]+=1),n<.2&&(y[t+4]+=1))}}function l(t){g.push(t.x,t.y,t.z)}function f(e,i){var n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function p(){for(var t=new h,e=new h,n=new h,r=new h,o=new i,a=new i,s=new i,u=0,c=0;u<g.length;u+=9,c+=6){t.set(g[u+0],g[u+1],g[u+2]),e.set(g[u+3],g[u+4],g[u+5]),n.set(g[u+6],g[u+7],g[u+8]),o.set(y[c+0],y[c+1]),a.set(y[c+2],y[c+3]),s.set(y[c+4],y[c+5]),r.copy(t).add(e).add(n).divideScalar(3);var l=m(r);d(o,c+0,t,l),d(a,c+2,e,l),d(s,c+4,n,l)}}function d(t,e,i,n){n<0&&1===t.x&&(y[e]=t.x-1),0===i.x&&0===i.z&&(y[e]=n/2/Math.PI+.5)}function m(t){return Math.atan2(t.z,-t.x)}function v(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}Pt.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1,r=r||0;var g=[],y=[];o(r),s(n),u(),this.addAttribute("position",new bt(g,3)),this.addAttribute("normal",new bt(g.slice(),3)),this.addAttribute("uv",new bt(y,2)),this.normalizeNormals()}function De(t,e){Tt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ne(t,e)),this.mergeVertices()}function Ne(t,e){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];Oe.call(this,i,n,t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ue(t,e){Tt.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Fe(t,e)),this.mergeVertices()}function Fe(t,e){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Oe.call(this,i,n,t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ze(t,e){Tt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Be(t,e)),this.mergeVertices()}function Be(t,e){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Oe.call(this,n,r,t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ge(t,e){Tt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new je(t,e)),this.mergeVertices()}function je(t,e){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Oe.call(this,r,o,t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ke(t,e,i,n,r,o){Tt.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Ve(t,e,i,n,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Ve(t,e,n,r,o){function a(){for(f=0;f<e;f++)s(f);s(o===!1?e:0),c(),u()}function s(i){var o=t.getPointAt(i/e),a=l.normals[i],s=l.binormals[i];for(p=0;p<=r;p++){var h=p/r*Math.PI*2,u=Math.sin(h),c=-Math.cos(h);m.x=c*a.x+u*s.x,m.y=c*a.y+u*s.y,m.z=c*a.z+u*s.z,m.normalize(),y.push(m.x,m.y,m.z),d.x=o.x+n*m.x,d.y=o.y+n*m.y,d.z=o.z+n*m.z,g.push(d.x,d.y,d.z)}}function u(){for(p=1;p<=e;p++)for(f=1;f<=r;f++){var t=(r+1)*(p-1)+(f-1),i=(r+1)*p+(f-1),n=(r+1)*p+f,o=(r+1)*(p-1)+f;_.push(t,i,o),_.push(i,n,o)}}function c(){for(f=0;f<=e;f++)for(p=0;p<=r;p++)v.x=f/e,v.y=p/r,x.push(v.x,v.y)}Pt.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:o},e=e||64,n=n||1,r=r||8,o=o||!1;var l=t.computeFrenetFrames(e,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;var f,p,d=new h,m=new h,v=new i,g=[],y=[],x=[],_=[];a(),this.setIndex(_),this.addAttribute("position",new bt(g,3)),this.addAttribute("normal",new bt(y,3)),this.addAttribute("uv",new bt(x,2))}function He(t,e,i,n,r,o,a){Tt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new We(t,e,i,n,r,o)),this.mergeVertices()}function We(t,e,n,r,o,a){function s(t,e,i,n,r){var o=Math.cos(t),a=Math.sin(t),s=i/e*t,h=Math.cos(s);r.x=n*(2+h)*.5*o,r.y=n*(2+h)*a*.5,r.z=n*Math.sin(s)*.5}Pt.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:o,q:a},t=t||100,e=e||40,n=Math.floor(n)||64,r=Math.floor(r)||8,o=o||2,a=a||3;var u,c,l=[],f=[],p=[],d=[],m=new h,v=new h,g=(new i,new h),y=new h,x=new h,_=new h,b=new h;for(u=0;u<=n;++u){var M=u/n*o*Math.PI*2;for(s(M,o,a,t,g),s(M+.01,o,a,t,y),_.subVectors(y,g),b.addVectors(y,g),x.crossVectors(_,b),b.crossVectors(x,_),x.normalize(),b.normalize(),c=0;c<=r;++c){var w=c/r*Math.PI*2,E=-e*Math.cos(w),S=e*Math.sin(w);m.x=g.x+(E*b.x+S*x.x),m.y=g.y+(E*b.y+S*x.y),m.z=g.z+(E*b.z+S*x.z),f.push(m.x,m.y,m.z),v.subVectors(m,g).normalize(),p.push(v.x,v.y,v.z),d.push(u/n),d.push(c/r)}}for(c=1;c<=n;c++)for(u=1;u<=r;u++){var T=(r+1)*(c-1)+(u-1),P=(r+1)*c+(u-1),L=(r+1)*c+u,A=(r+1)*(c-1)+u;l.push(T,P,A),l.push(P,L,A)}this.setIndex(l),this.addAttribute("position",new bt(f,3)),this.addAttribute("normal",new bt(p,3)),this.addAttribute("uv",new bt(d,2))}function qe(t,e,i,n,r){Tt.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new Xe(t,e,i,n,r))}function Xe(t,e,i,n,r){Pt.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||100,e=e||40,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var o,a,s=[],u=[],c=[],l=[],f=new h,p=new h,d=new h;for(o=0;o<=i;o++)for(a=0;a<=n;a++){var m=a/n*r,v=o/i*Math.PI*2;p.x=(t+e*Math.cos(v))*Math.cos(m),p.y=(t+e*Math.cos(v))*Math.sin(m),p.z=e*Math.sin(v),u.push(p.x,p.y,p.z),f.x=t*Math.cos(m),f.y=t*Math.sin(m),d.subVectors(p,f).normalize(),c.push(d.x,d.y,d.z),l.push(a/n),l.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=n;a++){var g=(n+1)*o+a-1,y=(n+1)*(o-1)+a-1,x=(n+1)*(o-1)+a,_=(n+1)*o+a;s.push(g,y,_),s.push(y,x,_)}this.setIndex(s),this.addAttribute("position",new bt(u,3)),this.addAttribute("normal",new bt(c,3)),this.addAttribute("uv",new bt(l,2))}function Ye(t,e){return"undefined"==typeof t?void(t=[]):(Tt.call(this),this.type="ExtrudeGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),void this.computeFaceNormals())}function Ze(t,e){e=e||{};var i=e.font;if((i&&i.isFont)===!1)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Tt;var n=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Ye.call(this,n,e),this.type="TextGeometry"}function Qe(t,e,i,n,r,o,a){Tt.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Je(t,e,i,n,r,o,a))}function Je(t,e,i,n,r,o,a){Pt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,u,c=o+a,l=0,f=[],p=new h,d=new h,m=[],v=[],g=[],y=[];for(u=0;u<=i;u++){var x=[],_=u/i;for(s=0;s<=e;s++){var b=s/e;p.x=-t*Math.cos(n+b*r)*Math.sin(o+_*a),p.y=t*Math.cos(o+_*a),p.z=t*Math.sin(n+b*r)*Math.sin(o+_*a),v.push(p.x,p.y,p.z),d.set(p.x,p.y,p.z).normalize(),g.push(d.x,d.y,d.z),y.push(b,1-_),x.push(l++)}f.push(x)}for(u=0;u<i;u++)for(s=0;s<e;s++){var M=f[u][s+1],w=f[u][s],E=f[u+1][s],S=f[u+1][s+1];(0!==u||o>0)&&m.push(M,w,S),(u!==i-1||c<Math.PI)&&m.push(w,E,S)}this.setIndex(m),this.addAttribute("position",new bt(v,3)),this.addAttribute("normal",new bt(g,3)),this.addAttribute("uv",new bt(y,2))}function Ke(t,e,i,n,r,o){Tt.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new $e(t,e,i,n,r,o))}function $e(t,e,n,r,o,a){Pt.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:o,thetaLength:a},t=t||20,e=e||50,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(1,r):1;var s,u,c,l=[],f=[],p=[],d=[],m=t,v=(e-t)/r,g=new h,y=new i;for(u=0;u<=r;u++){for(c=0;c<=n;c++)s=o+c/n*a,g.x=m*Math.cos(s),g.y=m*Math.sin(s),f.push(g.x,g.y,g.z),p.push(0,0,1),y.x=(g.x/e+1)/2,y.y=(g.y/e+1)/2,d.push(y.x,y.y);m+=v}for(u=0;u<r;u++){var x=u*(n+1);for(c=0;c<n;c++){s=c+x;var _=s,b=s+n+1,M=s+n+2,w=s+1;l.push(_,b,w),l.push(b,M,w)}}this.setIndex(l),this.addAttribute("position",new bt(f,3)),this.addAttribute("normal",new bt(p,3)),this.addAttribute("uv",new bt(d,2))}function ti(t,e,i,n){Tt.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new ei(t,e,i,n)),this.mergeVertices()}function ei(t,e,n,r){Pt.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||2*Math.PI,r=ls.clamp(r,0,2*Math.PI);var o,a,s,u=[],c=[],l=[],f=1/e,p=new h,d=new i;for(a=0;a<=e;a++){var m=n+a*f*r,v=Math.sin(m),g=Math.cos(m);for(s=0;s<=t.length-1;s++)p.x=t[s].x*v,p.y=t[s].y,p.z=t[s].x*g,c.push(p.x,p.y,p.z),d.x=a/e,d.y=s/(t.length-1),l.push(d.x,d.y)}for(a=0;a<e;a++)for(s=0;s<t.length-1;s++){o=s+a*t.length;var y=o,x=o+t.length,_=o+t.length+1,b=o+1;u.push(y,x,b),u.push(x,_,b)}if(this.setIndex(u),this.addAttribute("position",new bt(c,3)),this.addAttribute("uv",new bt(l,2)),this.computeVertexNormals(),r===2*Math.PI){var M=this.attributes.normal.array,w=new h,E=new h,S=new h;for(o=e*t.length*3,a=0,s=0;a<t.length;a++,s+=3)w.x=M[s+0],w.y=M[s+1],w.z=M[s+2],E.x=M[o+s+0],E.y=M[o+s+1],E.z=M[o+s+2],S.addVectors(w,E).normalize(),M[s+0]=M[o+s+0]=S.x,M[s+1]=M[o+s+1]=S.y,M[s+2]=M[o+s+2]=S.z}}function ii(t,e){Tt.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ni(t,e)),this.mergeVertices()}function ni(t,e){function i(t){var i,s,u,c=r.length/3,l=t.extractPoints(e),f=l.shape,p=l.holes;if(Pu.isClockWise(f)===!1)for(f=f.reverse(),i=0,s=p.length;i<s;i++)u=p[i],Pu.isClockWise(u)===!0&&(p[i]=u.reverse());var d=Pu.triangulateShape(f,p);for(i=0,s=p.length;i<s;i++)u=p[i],f=f.concat(u);for(i=0,s=f.length;i<s;i++){var m=f[i];r.push(m.x,m.y,0),o.push(0,0,1),a.push(m.x,m.y)}for(i=0,s=d.length;i<s;i++){var v=d[i],g=v[0]+c,y=v[1]+c,x=v[2]+c;n.push(g,y,x),h+=3}}Pt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],o=[],a=[],s=0,h=0;if(Array.isArray(t)===!1)i(t);else for(var u=0;u<t.length;u++)i(t[u]),this.addGroup(s,h,u),s+=h,h=0;this.setIndex(n),this.addAttribute("position",new bt(r,3)),this.addAttribute("normal",new bt(o,3)),this.addAttribute("uv",new bt(a,2))}function ri(t,e){function i(t,e){return t-e}Pt.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var n,r,o=[],a=Math.cos(ls.DEG2RAD*e),s=[0,0],h={},u=["a","b","c"];t.isBufferGeometry?(r=new Tt,r.fromBufferGeometry(t)):r=t.clone(),r.mergeVertices(),r.computeFaceNormals();for(var c=r.vertices,l=r.faces,f=0,p=l.length;f<p;f++)for(var d=l[f],m=0;m<3;m++)s[0]=d[u[m]],s[1]=d[u[(m+1)%3]],s.sort(i),n=s.toString(),void 0===h[n]?h[n]={index1:s[0],index2:s[1],face1:f,face2:void 0}:h[n].face2=f;for(n in h){var v=h[n];if(void 0===v.face2||l[v.face1].normal.dot(l[v.face2].normal)<=a){var g=c[v.index1];o.push(g.x,g.y,g.z),g=c[v.index2],o.push(g.x,g.y,g.z)}}this.addAttribute("position",new bt(o,3))}function oi(t,e,i,n,r,o,a,s){Tt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ai(t,e,i,n,r,o,a,s)),this.mergeVertices()}function ai(t,e,n,r,o,a,s,u){function c(){var i,a,c=new h,l=new h,b=0,M=(e-t)/n;for(a=0;a<=o;a++){var w=[],E=a/o,S=E*(e-t)+t;for(i=0;i<=r;i++){var T=i/r,P=T*u+s,L=Math.sin(P),A=Math.cos(P);l.x=S*L,l.y=-E*n+x,l.z=S*A,d.push(l.x,l.y,l.z),c.set(L,M,A).normalize(),m.push(c.x,c.y,c.z),v.push(T,1-E),w.push(g++)}y.push(w)}for(i=0;i<r;i++)for(a=0;a<o;a++){var C=y[a][i],R=y[a+1][i],I=y[a+1][i+1],O=y[a][i+1];p.push(C,R,O),p.push(R,I,O),b+=6}f.addGroup(_,b,0),_+=b}function l(n){var o,a,c,l=new i,y=new h,b=0,M=n===!0?t:e,w=n===!0?1:-1;for(a=g,o=1;o<=r;o++)d.push(0,x*w,0),m.push(0,w,0),v.push(.5,.5),g++;for(c=g,o=0;o<=r;o++){var E=o/r,S=E*u+s,T=Math.cos(S),P=Math.sin(S);y.x=M*P,y.y=x*w,y.z=M*T,d.push(y.x,y.y,y.z),m.push(0,w,0),l.x=.5*T+.5,l.y=.5*P*w+.5,v.push(l.x,l.y),g++}for(o=0;o<r;o++){var L=a+o,A=c+o;n===!0?p.push(A,A+1,L):p.push(A+1,A,L),b+=3}f.addGroup(_,b,n===!0?1:2),_+=b}Pt.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:u};var f=this;t=void 0!==t?t:20,e=void 0!==e?e:20,n=void 0!==n?n:100,r=Math.floor(r)||8,o=Math.floor(o)||1,a=void 0!==a&&a,s=void 0!==s?s:0,u=void 0!==u?u:2*Math.PI;var p=[],d=[],m=[],v=[],g=0,y=[],x=n/2,_=0;c(),a===!1&&(t>0&&l(!0),e>0&&l(!1)),this.setIndex(p),this.addAttribute("position",new bt(d,3)),this.addAttribute("normal",new bt(m,3)),this.addAttribute("uv",new bt(v,2))}function si(t,e,i,n,r,o,a){oi.call(this,0,t,e,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function hi(t,e,i,n,r,o,a){ai.call(this,0,t,e,i,n,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function ui(t,e,i,n){Tt.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new ci(t,e,i,n))}function ci(t,e,n,r){Pt.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||50,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var o,a,s=[],u=[],c=[],l=[],f=new h,p=new i;for(u.push(0,0,0),c.push(0,0,1),l.push(.5,.5),a=0,o=3;a<=e;a++,o+=3){var d=n+a/e*r;f.x=t*Math.cos(d),f.y=t*Math.sin(d),u.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(u[o]/t+1)/2,p.y=(u[o+1]/t+1)/2,l.push(p.x,p.y)}for(o=1;o<=e;o++)s.push(o,o+1,0);this.setIndex(s),this.addAttribute("position",new bt(u,3)),this.addAttribute("normal",new bt(c,3)),this.addAttribute("uv",new bt(l,2))}function li(){J.call(this,{uniforms:ys.merge([bu.lights,{opacity:{value:1}}]),vertexShader:xu.shadow_vert,fragmentShader:xu.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}})}function fi(t){J.call(this,t),this.type="RawShaderMaterial"}function pi(t){this.uuid=ls.generateUUID(),this.type="MultiMaterial",this.materials=Array.isArray(t)?t:[],this.visible=!0}function di(t){Q.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new W(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mi(t){di.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function vi(t){Q.call(this),this.type="MeshPhongMaterial",this.color=new W(16777215),this.specular=new W(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function gi(t){vi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function yi(t){Q.call(this,t),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function xi(t){Q.call(this),this.type="MeshLambertMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function _i(t){Q.call(this),this.type="LineDashedMaterial",this.color=new W(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(t)}function bi(t,e,i){var n=this,r=!1,o=0,a=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,r===!1&&void 0!==n.onStart&&n.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)}}function Mi(t){this.manager=void 0!==t?t:Ru}function wi(t){this.manager=void 0!==t?t:Ru,this._parser=null}function Ei(t){this.manager=void 0!==t?t:Ru,this._parser=null}function Si(t){this.manager=void 0!==t?t:Ru}function Ti(t){this.manager=void 0!==t?t:Ru}function Pi(t){this.manager=void 0!==t?t:Ru}function Li(t,e){ht.call(this),this.type="Light",this.color=new W(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Ai(t,e,i){Li.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ht.DefaultUp),this.updateMatrix(),this.groundColor=new W(e)}function Ci(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.map=null,this.matrix=new u}function Ri(){Ci.call(this,new Dt(50,1,.5,500))}function Ii(t,e,i,n,r,o){Li.call(this,t,e),this.type="SpotLight",this.position.copy(ht.DefaultUp),this.updateMatrix(),this.target=new ht,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Ri}function Oi(t,e,i,n){Li.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,
this.shadow=new Ci(new Dt(90,1,.5,500))}function Di(){Ci.call(this,new Nt(-5,5,5,-5,.5,500))}function Ni(t,e){Li.call(this,t,e),this.type="DirectionalLight",this.position.copy(ht.DefaultUp),this.updateMatrix(),this.target=new ht,this.shadow=new Di}function Ui(t,e){Li.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Fi(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function zi(t,e,i,n){Fi.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Bi(t,e,i,n){Fi.call(this,t,e,i,n)}function Gi(t,e,i,n){Fi.call(this,t,e,i,n)}function ji(t,e,i,n){if(void 0===t)throw new Error("track name is undefined");if(void 0===e||0===e.length)throw new Error("no keyframes in track named "+t);this.name=t,this.times=Iu.convertArray(e,this.TimeBufferType),this.values=Iu.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function ki(t,e,i,n){ji.call(this,t,e,i,n)}function Vi(t,e,i,n){Fi.call(this,t,e,i,n)}function Hi(t,e,i,n){ji.call(this,t,e,i,n)}function Wi(t,e,i,n){ji.call(this,t,e,i,n)}function qi(t,e,i,n){ji.call(this,t,e,i,n)}function Xi(t,e,i){ji.call(this,t,e,i)}function Yi(t,e,i,n){ji.call(this,t,e,i,n)}function Zi(t,e,i,n){ji.apply(this,arguments)}function Qi(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=ls.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Ji(t){this.manager=void 0!==t?t:Ru,this.textures={}}function Ki(t){this.manager=void 0!==t?t:Ru}function $i(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function tn(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Ru,this.withCredentials=!1}function en(t){this.manager=void 0!==t?t:Ru,this.texturePath=""}function nn(t,e,i,n,r){var o=.5*(n-e),a=.5*(r-i),s=t*t,h=t*s;return(2*i-2*n+o+a)*h+(-3*i+3*n-2*o-a)*s+o*t+i}function rn(t,e){var i=1-t;return i*i*e}function on(t,e){return 2*(1-t)*t*e}function an(t,e){return t*t*e}function sn(t,e,i,n){return rn(t,e)+on(t,i)+an(t,n)}function hn(t,e){var i=1-t;return i*i*i*e}function un(t,e){var i=1-t;return 3*i*i*t*e}function cn(t,e){return 3*(1-t)*t*t*e}function ln(t,e){return t*t*t*e}function fn(t,e,i,n,r){return hn(t,e)+un(t,i)+cn(t,n)+ln(t,r)}function pn(){}function dn(t,e){this.v1=t,this.v2=e}function mn(){this.curves=[],this.autoClose=!1}function vn(t,e,i,n,r,o,a,s){this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0}function gn(t){this.points=void 0===t?[]:t}function yn(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n}function xn(t,e,i){this.v0=t,this.v1=e,this.v2=i}function _n(t){mn.call(this),this.currentPoint=new i,t&&this.fromPoints(t)}function bn(){_n.apply(this,arguments),this.holes=[]}function Mn(){this.subPaths=[],this.currentPath=null}function wn(t){this.data=t}function En(t){this.manager=void 0!==t?t:Ru}function Sn(t){this.manager=void 0!==t?t:Ru}function Tn(t,e,i,n){Li.call(this,t,e),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function Pn(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Dt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Dt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Ln(t,e,i){ht.call(this),this.type="CubeCamera";var n=90,r=1,o=new Dt(n,r,t,e);o.up.set(0,-1,0),o.lookAt(new h(1,0,0)),this.add(o);var s=new Dt(n,r,t,e);s.up.set(0,-1,0),s.lookAt(new h(-1,0,0)),this.add(s);var u=new Dt(n,r,t,e);u.up.set(0,0,1),u.lookAt(new h(0,1,0)),this.add(u);var c=new Dt(n,r,t,e);c.up.set(0,0,-1),c.lookAt(new h(0,-1,0)),this.add(c);var l=new Dt(n,r,t,e);l.up.set(0,-1,0),l.lookAt(new h(0,0,1)),this.add(l);var f=new Dt(n,r,t,e);f.up.set(0,-1,0),f.lookAt(new h(0,0,-1)),this.add(f);var p={format:Pa,magFilter:la,minFilter:la};this.renderTarget=new a(i,i,p),this.updateCubeMap=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,t.render(e,o,i),i.activeCubeFace=1,t.render(e,s,i),i.activeCubeFace=2,t.render(e,u,i),i.activeCubeFace=3,t.render(e,c,i),i.activeCubeFace=4,t.render(e,l,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,t.render(e,f,i),t.setRenderTarget(null)}}function An(){ht.call(this),this.type="AudioListener",this.context=Uu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Cn(t){ht.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Rn(t){Cn.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function In(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function On(t,e,i){this.binding=t,this.valueSize=i;var n,r=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Dn(t,e,i){this.path=e,this.parsedPath=i||Dn.parseTrackName(e),this.node=Dn.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Nn(t){this.uuid=ls.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Un(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,o=new Array(r),a={endingStart:Za,endingEnd:Za},s=0;s!==r;++s){var h=n[s].createInterpolant(null);o[s]=h,h.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ha,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Fn(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function zn(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Bn(){Pt.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Gn(t,e,i,n){this.uuid=ls.generateUUID(),this.data=t,this.itemSize=e,this.offset=i,this.normalized=n===!0}function jn(t,e){this.uuid=ls.generateUUID(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function kn(t,e,i){jn.call(this,t,e),this.meshPerAttribute=i||1}function Vn(t,e,i){pt.call(this,t,e),this.meshPerAttribute=i||1}function Hn(t,e,i,n){this.ray=new ot(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Wn(t,e){return t.distance-e.distance}function qn(t,e,i,n){if(t.visible!==!1&&(t.raycast(e,i),n===!0))for(var r=t.children,o=0,a=r.length;o<a;o++)qn(r[o],e,i,!0)}function Xn(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Yn(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function Zn(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}function Qn(t,e){Lt.call(this,t,e),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n="__default",r=0,o=i-1,a=i/1;this.createAnimation(n,r,o,a),this.setAnimationWeight(n,1)}function Jn(t){ht.call(this),this.material=t,this.render=function(t){}}function Kn(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var h=new Pt,u=new bt(2*a*3,3);h.addAttribute("position",u),be.call(this,h,new xe({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function $n(t){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;for(var e=new Pt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,r=1,o=32;n<o;n++,r++){var a=n/o*Math.PI*2,s=r/o*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}e.addAttribute("position",new bt(i,3));var h=new xe({fog:!1});this.cone=new be(e,h),this.add(this.cone),this.update()}function tr(t){this.bones=this.getBoneList(t);for(var e=new Pt,i=[],n=[],r=new W(0,0,1),o=new W(0,1,0),a=0;a<this.bones.length;a++){var s=this.bones[a];s.parent&&s.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(r.r,r.g,r.b),n.push(o.r,o.g,o.b))}e.addAttribute("position",new bt(i,3)),e.addAttribute("color",new bt(n,3));var h=new xe({vertexColors:lo,depthTest:!1,depthWrite:!1,transparent:!0});be.call(this,e,h),this.root=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function er(t,e){this.light=t,this.light.updateMatrixWorld();var i=new Je(e,4,2),n=new ft({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),Lt.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function ir(t){ht.call(this),this.light=t,this.light.updateMatrixWorld();var e=new ft({color:t.color,fog:!1}),i=new ft({color:t.color,fog:!1,wireframe:!0}),n=new Pt;n.addAttribute("position",new pt(new Float32Array(18),3)),this.add(new Lt(n,e)),this.add(new Lt(n,i)),this.update()}function nr(t,e){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;var i=new Fe(e);i.rotateY(.5*Math.PI);var n=new ft({vertexColors:lo,wireframe:!0}),r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.addAttribute("color",new pt(o,3)),this.add(new Lt(i,n)),this.update()}function rr(t,e,i,n){t=t||10,e=e||10,i=new W(void 0!==i?i:4473924),n=new W(void 0!==n?n:8947848);for(var r=e/2,o=t/e,a=t/2,s=[],h=[],u=0,c=0,l=-a;u<=e;u++,l+=o){s.push(-a,0,l,a,0,l),s.push(l,0,-a,l,0,a);var f=u===r?i:n;f.toArray(h,c),c+=3,f.toArray(h,c),c+=3,f.toArray(h,c),c+=3,f.toArray(h,c),c+=3}var p=new Pt;p.addAttribute("position",new bt(s,3)),p.addAttribute("color",new bt(h,3));var d=new xe({vertexColors:lo});be.call(this,p,d)}function or(t,e,i,n,r,o){t=t||10,e=e||16,i=i||8,n=n||64,r=new W(void 0!==r?r:4473924),o=new W(void 0!==o?o:8947848);var a,s,h,u,c,l,f,p=[],d=[];for(u=0;u<=e;u++)h=u/e*(2*Math.PI),a=Math.sin(h)*t,s=Math.cos(h)*t,p.push(0,0,0),p.push(a,0,s),f=1&u?r:o,d.push(f.r,f.g,f.b),d.push(f.r,f.g,f.b);for(u=0;u<=i;u++)for(f=1&u?r:o,l=t-t/i*u,c=0;c<n;c++)h=c/n*(2*Math.PI),a=Math.sin(h)*l,s=Math.cos(h)*l,p.push(a,0,s),d.push(f.r,f.g,f.b),h=(c+1)/n*(2*Math.PI),a=Math.sin(h)*l,s=Math.cos(h)*l,p.push(a,0,s),d.push(f.r,f.g,f.b);var m=new Pt;m.addAttribute("position",new bt(p,3)),m.addAttribute("color",new bt(d,3));var v=new xe({vertexColors:lo});be.call(this,m,v)}function ar(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new Pt,u=new bt(2*a*3,3);h.addAttribute("position",u),be.call(this,h,new xe({color:r,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function sr(t,e){ht.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,void 0===e&&(e=1);var i=new Pt;i.addAttribute("position",new bt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var n=new xe({fog:!1});this.add(new _e(i,n)),i=new Pt,i.addAttribute("position",new bt([0,0,0,0,0,1],3)),this.add(new _e(i,n)),this.update()}function hr(t){function e(t,e,n){i(t,n),i(e,n)}function i(t,e){o.push(0,0,0),a.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}var n=new Pt,r=new xe({color:16777215,vertexColors:co}),o=[],a=[],s={},h=new W(16755200),u=new W(16711680),c=new W(43775),l=new W(16777215),f=new W(3355443);e("n1","n2",h),e("n2","n4",h),e("n4","n3",h),e("n3","n1",h),e("f1","f2",h),e("f2","f4",h),e("f4","f3",h),e("f3","f1",h),e("n1","f1",h),e("n2","f2",h),e("n3","f3",h),e("n4","f4",h),e("p","n1",u),e("p","n2",u),e("p","n3",u),e("p","n4",u),e("u1","u2",c),e("u2","u3",c),e("u3","u1",c),e("c","t",l),e("p","c",f),e("cn1","cn2",f),e("cn3","cn4",f),e("cf1","cf2",f),e("cf3","cf4",f),n.addAttribute("position",new bt(o,3)),n.addAttribute("color",new bt(a,3)),be.call(this,n,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function ur(t,e){void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Pt;r.setIndex(new pt(i,1)),r.addAttribute("position",new pt(n,3)),be.call(this,r,new xe({color:e})),void 0!==t&&this.update(t)}function cr(t,e,i,n,r,o){ht.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===Fu&&(Fu=new Pt,Fu.addAttribute("position",new bt([0,0,0,0,1,0],3)),zu=new ai(0,.5,1,5,1),zu.translate(0,-.5,0)),this.position.copy(e),this.line=new _e(Fu,new xe({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Lt(zu,new ft({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,o)}function lr(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new Pt;n.addAttribute("position",new bt(e,3)),n.addAttribute("color",new bt(i,3));var r=new xe({vertexColors:lo});be.call(this,n,r)}function fr(){function t(t,o,a,s){e=t,i=a,n=-3*t+3*o-2*a-s,r=2*t-2*o+a+s}var e=0,i=0,n=0,r=0;return{initCatmullRom:function(e,i,n,r,o){t(i,n,o*(n-e),o*(r-i))},initNonuniformCatmullRom:function(e,i,n,r,o,a,s){var h=(i-e)/o-(n-e)/(o+a)+(n-i)/a,u=(n-i)/a-(r-i)/(a+s)+(r-n)/s;h*=a,u*=a,t(i,n,h,u)},calc:function(t){var o=t*t,a=o*t;return e+i*t+n*o+r*a}}}function pr(t){this.points=t||[],this.closed=!1}function dr(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n}function mr(t,e,i){this.v0=t,this.v1=e,this.v2=i}function vr(t,e){this.v1=t,this.v2=e}function gr(t,e,i,n,r,o){vn.call(this,t,e,i,i,n,r,o)}function yr(t,e,i,n,r,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new lt(t,e,i,r,o,a)}function xr(t){return console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial."),new pi(t)}function _r(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new we(t,e)}function br(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new de(t)}function Mr(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new we(t,e)}function wr(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Me(t)}function Er(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Me(t)}function Sr(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Me(t)}function Tr(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new h(t,e,i)}function Pr(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new pt(t,e).setDynamic(!0)}function Lr(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new dt(t,e)}function Ar(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new mt(t,e)}function Cr(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new vt(t,e)}function Rr(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new gt(t,e)}function Ir(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new yt(t,e)}function Or(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new xt(t,e)}function Dr(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new _t(t,e)}function Nr(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new bt(t,e)}function Ur(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Mt(t,e)}function Fr(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pr.call(this,t),this.type="catmullrom",this.closed=!0}function zr(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pr.call(this,t),this.type="catmullrom"}function Br(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),pr.call(this,t),this.type="catmullrom"}function Gr(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ur(t,e)}function jr(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new be(new ri(t.geometry),new xe({color:void 0!==e?e:16777215}))}function kr(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new be(new Ae(t.geometry),new xe({color:void 0!==e?e:16777215}))}function Vr(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Mi(t)}function Hr(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Ei(t)}function Wr(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function qr(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&!function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}}(),e.prototype={addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&i[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners,n=i[t];if(void 0!==n){var r=n.indexOf(e);r!==-1&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;var n=[],r=0,o=i.length;for(r=0;r<o;r++)n[r]=i[r];for(r=0;r<o;r++)n[r].call(this,t)}}}};var Xr="84",Yr={LEFT:0,MIDDLE:1,RIGHT:2},Zr=0,Qr=1,Jr=2,Kr=3,$r=0,to=1,eo=0,io=1,no=2,ro=0,oo=1,ao=2,so=1,ho=2,uo=0,co=1,lo=2,fo=0,po=1,mo=2,vo=3,go=4,yo=5,xo=100,_o=101,bo=102,Mo=103,wo=104,Eo=200,So=201,To=202,Po=203,Lo=204,Ao=205,Co=206,Ro=207,Io=208,Oo=209,Do=210,No=0,Uo=1,Fo=2,zo=3,Bo=4,Go=5,jo=6,ko=7,Vo=0,Ho=1,Wo=2,qo=0,Xo=1,Yo=2,Zo=3,Qo=4,Jo=300,Ko=301,$o=302,ta=303,ea=304,ia=305,na=306,ra=307,oa=1e3,aa=1001,sa=1002,ha=1003,ua=1004,ca=1005,la=1006,fa=1007,pa=1008,da=1009,ma=1010,va=1011,ga=1012,ya=1013,xa=1014,_a=1015,ba=1016,Ma=1017,wa=1018,Ea=1019,Sa=1020,Ta=1021,Pa=1022,La=1023,Aa=1024,Ca=1025,Ra=La,Ia=1026,Oa=1027,Da=2001,Na=2002,Ua=2003,Fa=2004,za=2100,Ba=2101,Ga=2102,ja=2103,ka=2151,Va=2200,Ha=2201,Wa=2202,qa=2300,Xa=2301,Ya=2302,Za=2400,Qa=2401,Ja=2402,Ka=0,$a=1,ts=2,es=3e3,is=3001,ns=3007,rs=3002,os=3003,as=3004,ss=3005,hs=3006,us=3200,cs=3201,ls={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[r]=e[19===r?3&t|8:t]);return i.join("")}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(6*t-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*ls.DEG2RAD},radToDeg:function(t){return t*ls.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t}};i.prototype={constructor:i,isVector2:!0,get width(){return this.x},set width(t){this.x=t},get height(){return this.y},set height(t){this.y=t},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t,e;return function(n,r){return void 0===t&&(t=new i,e=new i),t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*n+t.x,this.y=r*n+o*i+t.y,this}};var fs=0;n.DEFAULT_IMAGE=void 0,n.DEFAULT_MAPPING=Jo,n.prototype={constructor:n,isTexture:!0,set needsUpdate(t){t===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){function e(t){var e;return void 0!==t.toDataURL?e=t:(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)),e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var i={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=ls.generateUUID()),void 0===t.images[n.uuid]&&(t.images[n.uuid]={uuid:n.uuid,url:e(n)}),i.image=n.uuid}return t.textures[this.uuid]=i,i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===Jo){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case oa:t.x=t.x-Math.floor(t.x);break;case aa:t.x=t.x<0?0:1;break;case sa:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case oa:t.y=t.y-Math.floor(t.y);break;case aa:t.y=t.y<0?0:1;break;case sa:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}},Object.assign(n.prototype,e.prototype),r.prototype={constructor:r,isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,o=.01,a=.1,s=t.elements,h=s[0],u=s[4],c=s[8],l=s[1],f=s[5],p=s[9],d=s[2],m=s[6],v=s[10];if(Math.abs(u-l)<o&&Math.abs(c-d)<o&&Math.abs(p-m)<o){if(Math.abs(u+l)<a&&Math.abs(c+d)<a&&Math.abs(p+m)<a&&Math.abs(h+f+v-3)<a)return this.set(1,0,0,0),
this;e=Math.PI;var g=(h+1)/2,y=(f+1)/2,x=(v+1)/2,_=(u+l)/4,b=(c+d)/4,M=(p+m)/4;return g>y&&g>x?g<o?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(g),n=_/i,r=b/i):y>x?y<o?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(y),i=_/n,r=M/n):x<o?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(x),i=b/r,n=M/r),this.set(i,n,r,e),this}var w=Math.sqrt((m-p)*(m-p)+(c-d)*(c-d)+(l-u)*(l-u));return Math.abs(w)<.001&&(w=1),this.x=(m-p)/w,this.y=(c-d)/w,this.z=(l-u)/w,this.w=Math.acos((h+f+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(i,n){return void 0===t&&(t=new r,e=new r),t.set(i,i,i,i),e.set(n,n,n,n),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}},o.prototype={constructor:o,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(o.prototype,e.prototype),a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.isWebGLRenderTargetCube=!0,s.prototype={constructor:s,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if((t&&t.isEuler)===!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),o=Math.sin(t._x/2),a=Math.sin(t._y/2),s=Math.sin(t._z/2),h=t.order;return"XYZ"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"YXZ"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"ZXY"===h?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"ZYX"===h?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"YZX"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r-o*a*s):"XZY"===h&&(this._x=o*n*r-i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r+o*a*s),e!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],h=i[9],u=i[2],c=i[6],l=i[10],f=n+s+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(c-h)*e,this._y=(o-u)*e,this._z=(a-r)*e):n>s&&n>l?(e=2*Math.sqrt(1+n-s-l),this._w=(c-h)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+u)/e):s>l?(e=2*Math.sqrt(1+s-n-l),this._w=(o-u)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+l-n-s),this._w=(a-r)/e,this._x=(o+u)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e,i=1e-6;return function(n,r){return void 0===t&&(t=new h),e=n.dot(r)+1,e<i?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,o=t._w,a=e._x,s=e._y,h=e._z,u=e._w;return this._x=i*u+o*a+n*h-r*s,this._y=n*u+o*s+r*a-i*h,this._z=r*u+o*h+i*s-n*a,this._w=o*u-i*a-n*s-r*h,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var h=Math.atan2(s,a),u=Math.sin((1-e)*h)/s,c=Math.sin(e*h)/s;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},Object.assign(s,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,o,a){var s=i[n+0],h=i[n+1],u=i[n+2],c=i[n+3],l=r[o+0],f=r[o+1],p=r[o+2],d=r[o+3];if(c!==d||s!==l||h!==f||u!==p){var m=1-a,v=s*l+h*f+u*p+c*d,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),_=Math.atan2(x,v*g);m=Math.sin(m*_)/x,a=Math.sin(a*_)/x}var b=a*g;if(s=s*m+l*b,h=h*m+f*b,u=u*m+p*b,c=c*m+d*b,m===1-a){var M=1/Math.sqrt(s*s+h*h+u*u+c*c);s*=M,h*=M,u*=M,c*=M}}t[e]=s,t[e+1]=h,t[e+2]=u,t[e+3]=c}}),h.prototype={constructor:h,isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t;return function(e){return(e&&e.isEuler)===!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new s),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t;return function(e,i){return void 0===t&&(t=new s),this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14];var o=r[3]*e+r[7]*i+r[11]*n+r[15];return this.divideScalar(o)},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,a=t.z,s=t.w,h=s*e+o*n-a*i,u=s*i+a*e-r*n,c=s*n+r*i-o*e,l=-r*e-o*i-a*n;return this.x=h*s+l*-r+u*-a-c*-o,this.y=u*s+l*-o+c*-r-h*-a,this.z=c*s+l*-a+h*-o-u*-r,this},project:function(){var t;return function(e){return void 0===t&&(t=new u),t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t;return function(e){return void 0===t&&(t=new u),t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t,e;return function(i,n){return void 0===t&&(t=new h,e=new h),t.set(i,i,i),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t;return function(e){return void 0===t&&(t=new h),t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t;return function(e){return void 0===t&&(t=new h),this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(ls.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){if("number"==typeof t){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var i=t;t=e,e=i}return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},u.prototype={constructor:u,isMatrix4:!0,set:function(t,e,i,n,r,o,a,s,h,u,c,l,f,p,d,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=n,v[1]=r,v[5]=o,v[9]=a,v[13]=s,v[2]=h,v[6]=u,v[10]=c,v[14]=l,v[3]=f,v[7]=p,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new u).fromArray(this.elements)},copy:function(t){return this.elements.set(t.elements),this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t;return function(e){void 0===t&&(t=new h);var i=this.elements,n=e.elements,r=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),a=1/t.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*a,i[9]=n[9]*a,i[10]=n[10]*a,this}}(),makeRotationFromEuler:function(t){(t&&t.isEuler)===!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(n),h=Math.sin(n),u=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var l=o*u,f=o*c,p=a*u,d=a*c;e[0]=s*u,e[4]=-s*c,e[8]=h,e[1]=f+p*h,e[5]=l-d*h,e[9]=-a*s,e[2]=d-l*h,e[6]=p+f*h,e[10]=o*s}else if("YXZ"===t.order){var m=s*u,v=s*c,g=h*u,y=h*c;e[0]=m+y*a,e[4]=g*a-v,e[8]=o*h,e[1]=o*c,e[5]=o*u,e[9]=-a,e[2]=v*a-g,e[6]=y+m*a,e[10]=o*s}else if("ZXY"===t.order){var m=s*u,v=s*c,g=h*u,y=h*c;e[0]=m-y*a,e[4]=-o*c,e[8]=g+v*a,e[1]=v+g*a,e[5]=o*u,e[9]=y-m*a,e[2]=-o*h,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){var l=o*u,f=o*c,p=a*u,d=a*c;e[0]=s*u,e[4]=p*h-f,e[8]=l*h+d,e[1]=s*c,e[5]=d*h+l,e[9]=f*h-p,e[2]=-h,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var x=o*s,_=o*h,b=a*s,M=a*h;e[0]=s*u,e[4]=M-x*c,e[8]=b*c+_,e[1]=c,e[5]=o*u,e[9]=-a*u,e[2]=-h*u,e[6]=_*c+b,e[10]=x-M*c}else if("XZY"===t.order){var x=o*s,_=o*h,b=a*s,M=a*h;e[0]=s*u,e[4]=-c,e[8]=h*u,e[1]=x*c+M,e[5]=o*u,e[9]=_*c-b,e[2]=b*c-_,e[6]=a*u,e[10]=M*c+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,o=t.w,a=i+i,s=n+n,h=r+r,u=i*a,c=i*s,l=i*h,f=n*s,p=n*h,d=r*h,m=o*a,v=o*s,g=o*h;return e[0]=1-(f+d),e[4]=c-g,e[8]=l+v,e[1]=c+g,e[5]=1-(u+d),e[9]=p-m,e[2]=l-v,e[6]=p+m,e[10]=1-(u+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t,e,i;return function(n,r,o){void 0===t&&(t=new h,e=new h,i=new h);var a=this.elements;return i.subVectors(n,r).normalize(),0===i.lengthSq()&&(i.z=1),t.crossVectors(o,i).normalize(),0===t.lengthSq()&&(i.z+=1e-4,t.crossVectors(o,i).normalize()),e.crossVectors(i,t),a[0]=t.x,a[4]=e.x,a[8]=i.x,a[1]=t.y,a[5]=e.y,a[9]=i.y,a[2]=t.z,a[6]=e.z,a[10]=i.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,o=i[0],a=i[4],s=i[8],h=i[12],u=i[1],c=i[5],l=i[9],f=i[13],p=i[2],d=i[6],m=i[10],v=i[14],g=i[3],y=i[7],x=i[11],_=i[15],b=n[0],M=n[4],w=n[8],E=n[12],S=n[1],T=n[5],P=n[9],L=n[13],A=n[2],C=n[6],R=n[10],I=n[14],O=n[3],D=n[7],N=n[11],U=n[15];return r[0]=o*b+a*S+s*A+h*O,r[4]=o*M+a*T+s*C+h*D,r[8]=o*w+a*P+s*R+h*N,r[12]=o*E+a*L+s*I+h*U,r[1]=u*b+c*S+l*A+f*O,r[5]=u*M+c*T+l*C+f*D,r[9]=u*w+c*P+l*R+f*N,r[13]=u*E+c*L+l*I+f*U,r[2]=p*b+d*S+m*A+v*O,r[6]=p*M+d*T+m*C+v*D,r[10]=p*w+d*P+m*R+v*N,r[14]=p*E+d*L+m*I+v*U,r[3]=g*b+y*S+x*A+_*O,r[7]=g*M+y*T+x*C+_*D,r[11]=g*w+y*P+x*R+_*N,r[15]=g*E+y*L+x*I+_*U,this},multiplyToArray:function(t,e,i){var n=this.elements;return this.multiplyMatrices(t,e),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t;return function(e){void 0===t&&(t=new h);for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],o=t[1],a=t[5],s=t[9],h=t[13],u=t[2],c=t[6],l=t[10],f=t[14],p=t[3],d=t[7],m=t[11],v=t[15];return p*(+r*s*c-n*h*c-r*a*l+i*h*l+n*a*f-i*s*f)+d*(+e*s*f-e*h*l+r*o*l-n*o*f+n*h*u-r*s*u)+m*(+e*h*c-e*a*f-r*o*c+i*o*f+r*a*u-i*h*u)+v*(-n*a*u-e*s*c+e*a*l+n*o*c-i*o*l+i*s*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],o=n[1],a=n[2],s=n[3],h=n[4],u=n[5],c=n[6],l=n[7],f=n[8],p=n[9],d=n[10],m=n[11],v=n[12],g=n[13],y=n[14],x=n[15],_=p*y*l-g*d*l+g*c*m-u*y*m-p*c*x+u*d*x,b=v*d*l-f*y*l-v*c*m+h*y*m+f*c*x-h*d*x,M=f*g*l-v*p*l+v*u*m-h*g*m-f*u*x+h*p*x,w=v*p*c-f*g*c-v*u*d+h*g*d+f*u*y-h*p*y,E=r*_+o*b+a*M+s*w;if(0===E){var S="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e===!0)throw new Error(S);return console.warn(S),this.identity()}var T=1/E;return i[0]=_*T,i[1]=(g*d*s-p*y*s-g*a*m+o*y*m+p*a*x-o*d*x)*T,i[2]=(u*y*s-g*c*s+g*a*l-o*y*l-u*a*x+o*c*x)*T,i[3]=(p*c*s-u*d*s-p*a*l+o*d*l+u*a*m-o*c*m)*T,i[4]=b*T,i[5]=(f*y*s-v*d*s+v*a*m-r*y*m-f*a*x+r*d*x)*T,i[6]=(v*c*s-h*y*s-v*a*l+r*y*l+h*a*x-r*c*x)*T,i[7]=(h*d*s-f*c*s+f*a*l-r*d*l-h*a*m+r*c*m)*T,i[8]=M*T,i[9]=(v*p*s-f*g*s-v*o*m+r*g*m+f*o*x-r*p*x)*T,i[10]=(h*g*s-v*u*s+v*o*l-r*g*l-h*o*x+r*u*x)*T,i[11]=(f*u*s-h*p*s-f*o*l+r*p*l+h*o*m-r*u*m)*T,i[12]=w*T,i[13]=(f*g*a-v*p*a+v*o*d-r*g*d-f*o*y+r*p*y)*T,i[14]=(v*u*a-h*g*a-v*o*c+r*g*c+h*o*y-r*u*y)*T,i[15]=(h*p*a-f*u*a+f*o*c-r*p*c-h*o*d+r*u*d)*T,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,a=t.y,s=t.z,h=r*o,u=r*a;return this.set(h*o+i,h*a-n*s,h*s+n*a,0,h*a+n*s,u*a+i,u*s-n*o,0,h*s-n*a,u*s+n*o,r*s*s+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(){var t,e;return function(i,n,r){void 0===t&&(t=new h,e=new u);var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),c=t.set(o[8],o[9],o[10]).length(),l=this.determinant();l<0&&(a=-a),i.x=o[12],i.y=o[13],i.z=o[14],e.elements.set(this.elements);var f=1/a,p=1/s,d=1/c;return e.elements[0]*=f,e.elements[1]*=f,e.elements[2]*=f,e.elements[4]*=p,e.elements[5]*=p,e.elements[6]*=p,e.elements[8]*=d,e.elements[9]*=d,e.elements[10]*=d,n.setFromRotationMatrix(e),r.x=a,r.y=s,r.z=c,this}}(),makePerspective:function(t,e,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(e-t),h=2*r/(i-n),u=(e+t)/(e-t),c=(i+n)/(i-n),l=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,i,n,r,o){var a=this.elements,s=1/(e-t),h=1/(i-n),u=1/(o-r),c=(e+t)*s,l=(i+n)*h,f=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},c.prototype=Object.create(n.prototype),c.prototype.constructor=c,c.prototype.isCubeTexture=!0,Object.defineProperty(c.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ps=new n,ds=new c,ms=[],vs=[];j.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var o=i[n];o.setValue(t,e[o.id])}};var gs=/([\w\d_]+)(\])?(\[|\.)?/g;H.prototype.setValue=function(t,e,i){var n=this.map[e];void 0!==n&&n.setValue(t,i,this.renderer)},H.prototype.set=function(t,e,i){var n=this.map[i];void 0!==n&&n.setValue(t,e[i],this.renderer)},H.prototype.setOptional=function(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)},H.upload=function(t,e,i,n){for(var r=0,o=e.length;r!==o;++r){var a=e[r],s=i[a.id];s.needsUpdate!==!1&&a.setValue(t,s.value,n)}},H.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var o=t[n];o.id in e&&i.push(o)}return i};var ys={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t){e[i]={};for(var n in t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}},xs="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",_s="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",bs="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",Ms="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",ws="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Es="\nvec3 transformed = vec3( position );\n",Ss="\nvec3 objectNormal = vec3( normal );\n",Ts="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",Ps="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",Ls="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",As="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",Cs="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",Rs="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",Is="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",Os="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",Ds="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Ns="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",Us="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",Fs="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",zs="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",Bs="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",Gs="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",js="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",ks="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",Vs="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",Hs="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",Ws="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",qs="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",Xs="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",Ys="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",Zs="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",Qs="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",Js="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",Ks="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",$s="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",th="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",eh="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",ih="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",nh="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",rh="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",oh="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",ah="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",sh="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",hh="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",uh="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",ch="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",lh="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",fh="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",ph="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",dh="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",mh="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",vh="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",gh="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",yh="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",xh="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",_h="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",bh="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",Mh="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",wh="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",Eh="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",Sh="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",Th="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",Ph="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",Lh="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",Ah="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",Ch="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",Rh="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",Ih="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",Oh="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",Dh="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",Nh="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",Uh="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",Fh="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",zh="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",Bh="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",Gh="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",jh="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",kh="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",Vh="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",Hh="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",Wh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",qh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",Xh="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",Yh="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",Zh="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",Qh="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",Jh="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",Kh="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",$h="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",tu="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",eu="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",iu="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",nu="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",ru="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",ou="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",au="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",su="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",hu="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",uu="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",cu="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",lu="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",fu="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",pu="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",du="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",mu="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",vu="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",gu="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",yu="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",xu={
alphamap_fragment:xs,alphamap_pars_fragment:_s,alphatest_fragment:bs,aomap_fragment:Ms,aomap_pars_fragment:ws,begin_vertex:Es,beginnormal_vertex:Ss,bsdfs:Ts,bumpmap_pars_fragment:Ps,clipping_planes_fragment:Ls,clipping_planes_pars_fragment:As,clipping_planes_pars_vertex:Cs,clipping_planes_vertex:Rs,color_fragment:Is,color_pars_fragment:Os,color_pars_vertex:Ds,color_vertex:Ns,common:Us,cube_uv_reflection_fragment:Fs,defaultnormal_vertex:zs,displacementmap_pars_vertex:Bs,displacementmap_vertex:Gs,emissivemap_fragment:js,emissivemap_pars_fragment:ks,encodings_fragment:Vs,encodings_pars_fragment:Hs,envmap_fragment:Ws,envmap_pars_fragment:qs,envmap_pars_vertex:Xs,envmap_vertex:Ys,fog_vertex:Zs,fog_pars_vertex:Qs,fog_fragment:Js,fog_pars_fragment:Ks,gradientmap_pars_fragment:$s,lightmap_fragment:th,lightmap_pars_fragment:eh,lights_lambert_vertex:ih,lights_pars:nh,lights_phong_fragment:rh,lights_phong_pars_fragment:oh,lights_physical_fragment:ah,lights_physical_pars_fragment:sh,lights_template:hh,logdepthbuf_fragment:uh,logdepthbuf_pars_fragment:ch,logdepthbuf_pars_vertex:lh,logdepthbuf_vertex:fh,map_fragment:ph,map_pars_fragment:dh,map_particle_fragment:mh,map_particle_pars_fragment:vh,metalnessmap_fragment:gh,metalnessmap_pars_fragment:yh,morphnormal_vertex:xh,morphtarget_pars_vertex:_h,morphtarget_vertex:bh,normal_flip:Mh,normal_fragment:wh,normalmap_pars_fragment:Eh,packing:Sh,premultiplied_alpha_fragment:Th,project_vertex:Ph,roughnessmap_fragment:Lh,roughnessmap_pars_fragment:Ah,shadowmap_pars_fragment:Ch,shadowmap_pars_vertex:Rh,shadowmap_vertex:Ih,shadowmask_pars_fragment:Oh,skinbase_vertex:Dh,skinning_pars_vertex:Nh,skinning_vertex:Uh,skinnormal_vertex:Fh,specularmap_fragment:zh,specularmap_pars_fragment:Bh,tonemapping_fragment:Gh,tonemapping_pars_fragment:jh,uv_pars_fragment:kh,uv_pars_vertex:Vh,uv_vertex:Hh,uv2_pars_fragment:Wh,uv2_pars_vertex:qh,uv2_vertex:Xh,worldpos_vertex:Yh,cube_frag:Zh,cube_vert:Qh,depth_frag:Jh,depth_vert:Kh,distanceRGBA_frag:$h,distanceRGBA_vert:tu,equirect_frag:eu,equirect_vert:iu,linedashed_frag:nu,linedashed_vert:ru,meshbasic_frag:ou,meshbasic_vert:au,meshlambert_frag:su,meshlambert_vert:hu,meshphong_frag:uu,meshphong_vert:cu,meshphysical_frag:lu,meshphysical_vert:fu,normal_frag:pu,normal_vert:du,points_frag:mu,points_vert:vu,shadow_frag:gu,shadow_vert:yu};W.prototype={constructor:W,isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){if(e=ls.euclideanModulo(e,1),i=ls.clamp(i,0,1),n=ls.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,o=2*n-r;this.r=t(o,r,e+1/3),this.g=t(o,r,e),this.b=t(o,r,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,h=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,s,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=i[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(t&&t.length>0){var u=_u[t];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+t)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,n=t||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),h=Math.min(r,o,a),u=(h+s)/2;if(h===s)e=0,i=0;else{var c=s-h;switch(i=u<=.5?c/(s+h):c/(2-s-h),s){case r:e=(o-a)/c+(o<a?6:0);break;case o:e=(a-r)/c+2;break;case a:e=(r-o)/c+4}e/=6}return n.h=e,n.s=i,n.l=u,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}};var _u={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};q.prototype=Object.create(n.prototype),q.prototype.constructor=q,q.prototype.isDataTexture=!0;var bu={common:{diffuse:{value:new W(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new r(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new W(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new W(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new r(0,0,1,1)}}},Mu={basic:{uniforms:ys.merge([bu.common,bu.aomap,bu.lightmap,bu.fog]),vertexShader:xu.meshbasic_vert,fragmentShader:xu.meshbasic_frag},lambert:{uniforms:ys.merge([bu.common,bu.aomap,bu.lightmap,bu.emissivemap,bu.fog,bu.lights,{emissive:{value:new W(0)}}]),vertexShader:xu.meshlambert_vert,fragmentShader:xu.meshlambert_frag},phong:{uniforms:ys.merge([bu.common,bu.aomap,bu.lightmap,bu.emissivemap,bu.bumpmap,bu.normalmap,bu.displacementmap,bu.gradientmap,bu.fog,bu.lights,{emissive:{value:new W(0)},specular:{value:new W(1118481)},shininess:{value:30}}]),vertexShader:xu.meshphong_vert,fragmentShader:xu.meshphong_frag},standard:{uniforms:ys.merge([bu.common,bu.aomap,bu.lightmap,bu.emissivemap,bu.bumpmap,bu.normalmap,bu.displacementmap,bu.roughnessmap,bu.metalnessmap,bu.fog,bu.lights,{emissive:{value:new W(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xu.meshphysical_vert,fragmentShader:xu.meshphysical_frag},points:{uniforms:ys.merge([bu.points,bu.fog]),vertexShader:xu.points_vert,fragmentShader:xu.points_frag},dashed:{uniforms:ys.merge([bu.common,bu.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xu.linedashed_vert,fragmentShader:xu.linedashed_frag},depth:{uniforms:ys.merge([bu.common,bu.displacementmap]),vertexShader:xu.depth_vert,fragmentShader:xu.depth_frag},normal:{uniforms:ys.merge([bu.common,bu.bumpmap,bu.normalmap,bu.displacementmap,{opacity:{value:1}}]),vertexShader:xu.normal_vert,fragmentShader:xu.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xu.cube_vert,fragmentShader:xu.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:xu.equirect_vert,fragmentShader:xu.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new h}},vertexShader:xu.distanceRGBA_vert,fragmentShader:xu.distanceRGBA_frag}};Mu.physical={uniforms:ys.merge([Mu.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:xu.meshphysical_vert,fragmentShader:xu.meshphysical_frag},X.prototype={constructor:X,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new i;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=+(1/0),this.max.x=this.max.y=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new i;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new i;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){var n=e||new i;return n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){var n=e||new i;return n.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new i;return function(e){var i=t.copy(e).clamp(this.min,this.max);return i.sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}};var wu=0;Q.prototype={constructor:Q,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(t){t===!0&&this.update(),this._needsUpdate=t},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i){var n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):"overdraw"===e?this[e]=Number(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){function e(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}var i=void 0===t;i&&(t={textures:{},images:{}});var n={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==po&&(n.blending=this.blending),this.shading!==ho&&(n.shading=this.shading),this.side!==ro&&(n.side=this.side),this.vertexColors!==uo&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),n.skinning=this.skinning,n.morphTargets=this.morphTargets,i){var r=e(t.textures),o=e(t.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.shading=t.shading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(Q.prototype,e.prototype),J.prototype=Object.create(Q.prototype),J.prototype.constructor=J,J.prototype.isShaderMaterial=!0,J.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ys.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},J.prototype.toJSON=function(t){var e=Q.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},K.prototype=Object.create(Q.prototype),K.prototype.constructor=K,K.prototype.isMeshDepthMaterial=!0,K.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},$.prototype={constructor:$,isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=+(1/0),i=+(1/0),n=+(1/0),r=-(1/0),o=-(1/0),a=-(1/0),s=0,h=t.length;s<h;s+=3){var u=t[s],c=t[s+1],l=t[s+2];u<e&&(e=u),c<i&&(i=c),l<n&&(n=l),u>r&&(r=u),c>o&&(o=c),l>a&&(a=l)}return this.min.set(e,i,n),this.max.set(r,o,a),this},setFromBufferAttribute:function(t){for(var e=+(1/0),i=+(1/0),n=+(1/0),r=-(1/0),o=-(1/0),a=-(1/0),s=0,h=t.count;s<h;s++){var u=t.getX(s),c=t.getY(s),l=t.getZ(s);u<e&&(e=u),c<i&&(i=c),l<n&&(n=l),u>r&&(r=u),c>o&&(o=c),l>a&&(a=l)}return this.min.set(e,i,n),this.max.set(r,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new h;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new h;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new h;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t=new h;return function(e){var i=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var n,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(n=0,r=a.length;n<r;n++)t.copy(a[n]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(n=0,r=s.count;n<r;n++)t.fromBufferAttribute(s,n).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}}),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){var i=e||new h;return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t;return function(e){return void 0===t&&(t=new h),this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){var i=e||new h;return i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new h;return function(e){var i=t.copy(e).clamp(this.min,this.max);return i.sub(e).length()}}(),getBoundingSphere:function(){var t=new h;return function(e){var i=e||new tt;return this.getCenter(i.center),i.radius=.5*this.getSize(t).length(),i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new h,new h,new h,new h,new h,new h,new h,new h];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},tt.prototype={constructor:tt,set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t;return function(e,i){void 0===t&&(t=new $);var n=this.center;void 0!==i?n.copy(i):t.setFromPoints(e).getCenter(n);for(var r=0,o=0,a=e.length;o<a;o++)r=Math.max(r,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new h;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new $;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},et.prototype={constructor:et,isMatrix3:!0,set:function(t,e,i,n,r,o,a,s,h){var u=this.elements;return u[0]=t,u[1]=n,u[2]=a,u[3]=e,u[4]=r,u[5]=s,u[6]=i,u[7]=o,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t;return function(e){void 0===t&&(t=new h);for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],h=t[7],u=t[8];return e*o*u-e*a*h-i*r*u+i*a*s+n*r*h-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],o=i[1],a=i[2],s=i[3],h=i[4],u=i[5],c=i[6],l=i[7],f=i[8],p=f*h-u*l,d=u*c-f*s,m=l*s-h*c,v=r*p+o*d+a*m;if(0===v){var g="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e===!0)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(a*l-f*o)*y,n[2]=(u*o-a*h)*y,n[3]=d*y,n[4]=(f*r-a*c)*y,n[5]=(a*s-u*r)*y,n[6]=m*y,n[7]=(o*c-l*r)*y,n[8]=(h*r-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}},it.prototype={constructor:it,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new h,e=new h;return function(i,n,r){var o=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t),n=e||new h;return n.copy(this.normal).multiplyScalar(i)},intersectLine:function(){var t=new h;return function(e,i){var n=i||new h,r=e.delta(t),o=this.normal.dot(r);if(0!==o){var a=-(e.start.dot(this.normal)+this.constant)/o;if(!(a<0||a>1))return n.copy(r).multiplyScalar(a).add(e.start)}else if(0===this.distanceToPoint(e.start))return n.copy(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){var e=t||new h;return e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new h,e=new et;return function(i,n){var r=this.coplanarPoint(t).applyMatrix4(i),o=n||e.getNormalMatrix(i),a=this.normal.applyMatrix3(o).normalize();return this.constant=-r.dot(a),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),
this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},nt.prototype={constructor:nt,set:function(t,e,i,n,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],h=i[5],u=i[6],c=i[7],l=i[8],f=i[9],p=i[10],d=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return e[0].setComponents(a-n,c-s,d-l,y-m).normalize(),e[1].setComponents(a+n,c+s,d+l,y+m).normalize(),e[2].setComponents(a+r,c+h,d+f,y+v).normalize(),e[3].setComponents(a-r,c-h,d-f,y-v).normalize(),e[4].setComponents(a-o,c-u,d-p,y-g).normalize(),e[5].setComponents(a+o,c+u,d+p,y+g).normalize(),this},intersectsObject:function(){var t=new tt;return function(e){var i=e.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),t.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new tt;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){var o=e[r].distanceToPoint(i);if(o<n)return!1}return!0},intersectsBox:function(){var t=new h,e=new h;return function(i){for(var n=this.planes,r=0;r<6;r++){var o=n[r];t.x=o.normal.x>0?i.min.x:i.max.x,e.x=o.normal.x>0?i.max.x:i.min.x,t.y=o.normal.y>0?i.min.y:i.max.y,e.y=o.normal.y>0?i.max.y:i.min.y,t.z=o.normal.z>0?i.min.z:i.max.z,e.z=o.normal.z>0?i.max.z:i.min.z;var a=o.distanceToPoint(t),s=o.distanceToPoint(e);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}},ot.prototype={constructor:ot,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var i=e||new h;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new h;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new h;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new h;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new h,e=new h,i=new h;return function(n,r,o,a){t.copy(n).add(r).multiplyScalar(.5),e.copy(r).sub(n).normalize(),i.copy(this.origin).sub(t);var s,h,u,c,l=.5*n.distanceTo(r),f=-this.direction.dot(e),p=i.dot(this.direction),d=-i.dot(e),m=i.lengthSq(),v=Math.abs(1-f*f);if(v>0)if(s=f*d-p,h=f*p-d,c=l*v,s>=0)if(h>=-c)if(h<=c){var g=1/v;s*=g,h*=g,u=s*(s+f*h+2*p)+h*(f*s+h+2*d)+m}else h=l,s=Math.max(0,-(f*h+p)),u=-s*s+h*(h+2*d)+m;else h=-l,s=Math.max(0,-(f*h+p)),u=-s*s+h*(h+2*d)+m;else h<=-c?(s=Math.max(0,-(-f*l+p)),h=s>0?-l:Math.min(Math.max(-l,-d),l),u=-s*s+h*(h+2*d)+m):h<=c?(s=0,h=Math.min(Math.max(-l,-d),l),u=h*(h+2*d)+m):(s=Math.max(0,-(f*l+p)),h=s>0?l:Math.min(Math.max(-l,-d),l),u=-s*s+h*(h+2*d)+m);else h=f>0?-l:l,s=Math.max(0,-(f*h+p)),u=-s*s+h*(h+2*d)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(e).multiplyScalar(h).add(t),u}}(),intersectSphere:function(){var t=new h;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,o=e.radius*e.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=n-a,h=n+a;return s<0&&h<0?null:s<0?this.at(h,i):this.at(s,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(0===e)return!0;var i=t.normal.dot(this.direction);return i*e<0},intersectBox:function(t,e){var i,n,r,o,a,s,h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,l=this.origin;return h>=0?(i=(t.min.x-l.x)*h,n=(t.max.x-l.x)*h):(i=(t.max.x-l.x)*h,n=(t.min.x-l.x)*h),u>=0?(r=(t.min.y-l.y)*u,o=(t.max.y-l.y)*u):(r=(t.max.y-l.y)*u,o=(t.min.y-l.y)*u),i>o||r>n?null:((r>i||i!==i)&&(i=r),(o<n||n!==n)&&(n=o),c>=0?(a=(t.min.z-l.z)*c,s=(t.max.z-l.z)*c):(a=(t.max.z-l.z)*c,s=(t.min.z-l.z)*c),i>s||a>n?null:((a>i||i!==i)&&(i=a),(s<n||n!==n)&&(n=s),n<0?null:this.at(i>=0?i:n,e)))},intersectsBox:function(){var t=new h;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new h,e=new h,i=new h,n=new h;return function(r,o,a,s,h){e.subVectors(o,r),i.subVectors(a,r),n.crossVectors(e,i);var u,c=this.direction.dot(n);if(c>0){if(s)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}t.subVectors(this.origin,r);var l=u*this.direction.dot(i.crossVectors(t,i));if(l<0)return null;var f=u*this.direction.dot(e.cross(t));if(f<0)return null;if(l+f>c)return null;var p=-u*t.dot(n);return p<0?null:this.at(p/c,h)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},at.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],at.DefaultOrder="XYZ",at.prototype={constructor:at,isEuler:!0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=ls.clamp,r=t.elements,o=r[0],a=r[4],s=r[8],h=r[1],u=r[5],c=r[9],l=r[2],f=r[6],p=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-l,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===e?(this._y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(f,p),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===e?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(f,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,i!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(e,i,n){return void 0===t&&(t=new u),t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new s;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new h(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}},st.prototype={constructor:st,set:function(t){this.mask=1<<t},enable:function(t){this.mask|=1<<t},toggle:function(t){this.mask^=1<<t},disable:function(t){this.mask&=~(1<<t)},test:function(t){return 0!==(this.mask&t.mask)}};var Eu=0;ht.DefaultUp=new h(0,1,0),ht.DefaultMatrixAutoUpdate=!0,ht.prototype={constructor:ht,isObject3D:!0,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new s;return function(e,i){return t.setFromAxisAngle(e,i),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new h(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new h(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new h(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new h;return function(e,i){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translateX:function(){var t=new h(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new h(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new h(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new u;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new u;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var i=this.children.indexOf(t);i!==-1&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],o=r.getObjectByProperty(t,e);if(void 0!==o)return o}},getWorldPosition:function(t){var e=t||new h;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new h,e=new h;return function(i){var n=i||new s;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,n,e),n}}(),getWorldRotation:function(){var t=new s;return function(e){var i=e||new at;return this.getWorldQuaternion(t),i.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new h,e=new s;return function(i){var n=i||new h;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new s;return function(e){var i=e||new h;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&t!==!0||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){function e(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}var i=void 0===t||""===t,n={};i&&(t={geometries:{},materials:{},textures:{},images:{}},n.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var r={};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),r.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===t.geometries[this.geometry.uuid]&&(t.geometries[this.geometry.uuid]=this.geometry.toJSON(t)),r.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===t.materials[this.material.uuid]&&(t.materials[this.material.uuid]=this.material.toJSON(t)),r.material=this.material.uuid),this.children.length>0){r.children=[];for(var o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(i){var a=e(t.geometries),s=e(t.materials),h=e(t.textures),u=e(t.images);a.length>0&&(n.geometries=a),s.length>0&&(n.materials=s),h.length>0&&(n.textures=h),u.length>0&&(n.images=u)}return n.object=r,n},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}},Object.assign(ht.prototype,e.prototype),ut.prototype={constructor:ut,set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){var e=t||new h;return e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){var e=t||new h;return e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new h;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new h,e=new h;return function(i,n){t.subVectors(i,this.start),e.subVectors(this.end,this.start);var r=e.dot(e),o=e.dot(t),a=o/r;return n&&(a=ls.clamp(a,0,1)),a}}(),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new h;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}},ct.normal=function(){var t=new h;return function(e,i,n,r){var o=r||new h;o.subVectors(n,i),t.subVectors(e,i),o.cross(t);var a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}}(),ct.barycoordFromPoint=function(){var t=new h,e=new h,i=new h;return function(n,r,o,a,s){t.subVectors(a,r),e.subVectors(o,r),i.subVectors(n,r);var u=t.dot(t),c=t.dot(e),l=t.dot(i),f=e.dot(e),p=e.dot(i),d=u*f-c*c,m=s||new h;if(0===d)return m.set(-2,-1,-1);var v=1/d,g=(f*l-c*p)*v,y=(u*p-c*l)*v;return m.set(1-g-y,y,g)}}(),ct.containsPoint=function(){var t=new h;return function(e,i,n,r){var o=ct.barycoordFromPoint(e,i,n,r,t);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),ct.prototype={constructor:ct,set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new h,e=new h;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){var e=t||new h;return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return ct.normal(this.a,this.b,this.c,t)},plane:function(t){var e=t||new it;return e.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return ct.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return ct.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var t,e,i,n;return function(r,o){void 0===t&&(t=new it,e=[new ut,new ut,new ut],i=new h,n=new h);var a=o||new h,s=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(r,i),this.containsPoint(i)===!0)a.copy(i);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var u=0;u<e.length;u++){e[u].closestPointToPoint(i,!0,n);var c=i.distanceToSquared(n);c<s&&(s=c,a.copy(n))}}return a}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},lt.prototype={constructor:lt,clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}},ft.prototype=Object.create(Q.prototype),ft.prototype.constructor=ft,ft.prototype.isMeshBasicMaterial=!0,ft.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},pt.prototype={constructor:pt,isBufferAttribute:!0,set needsUpdate(t){t===!0&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new W),e[i++]=o.r,e[i++]=o.g,e[i++]=o.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];e[i++]=o.a,e[i++]=o.b,e[i++]=o.c}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,o=t.length;r<o;r++){var a=t[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new i),e[n++]=a.x,e[n++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new h),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,o=t.length;n<o;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new r),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},dt.prototype=Object.create(pt.prototype),dt.prototype.constructor=dt,mt.prototype=Object.create(pt.prototype),mt.prototype.constructor=mt,vt.prototype=Object.create(pt.prototype),vt.prototype.constructor=vt,gt.prototype=Object.create(pt.prototype),gt.prototype.constructor=gt,yt.prototype=Object.create(pt.prototype),yt.prototype.constructor=yt,xt.prototype=Object.create(pt.prototype),xt.prototype.constructor=xt,_t.prototype=Object.create(pt.prototype),_t.prototype.constructor=_t,bt.prototype=Object.create(pt.prototype),bt.prototype.constructor=bt,Mt.prototype=Object.create(pt.prototype),Mt.prototype.constructor=Mt,Object.assign(wt.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,i.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,n=t.faces,r=t.vertices,o=t.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,h=t.morphTargets,u=h.length;if(u>0){e=[];for(var c=0;c<u;c++)e[c]=[];this.morphTargets.position=e}var l,f=t.morphNormals,p=f.length;if(p>0){l=[];for(var c=0;c<p;c++)l[c]=[];this.morphTargets.normal=l}for(var d=t.skinIndices,m=t.skinWeights,v=d.length===r.length,g=m.length===r.length,c=0;c<n.length;c++){var y=n[c];this.vertices.push(r[y.a],r[y.b],r[y.c]);var x=y.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var _=y.normal;this.normals.push(_,_,_)}var b=y.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var M=y.color;this.colors.push(M,M,M)}if(a===!0){var w=o[0][c];void 0!==w?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new i,new i,new i))}if(s===!0){var w=o[1][c];void 0!==w?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new i,new i,new i))}for(var E=0;E<u;E++){var S=h[E].vertices;e[E].push(S[y.a],S[y.b],S[y.c])}for(var E=0;E<p;E++){var T=f[E].vertexNormals[c];l[E].push(T.a,T.b,T.c)}v&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),g&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Su=0;Tt.prototype={constructor:Tt,isGeometry:!0,applyMatrix:function(t){for(var e=(new et).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){var r=this.vertices[i];r.applyMatrix4(t)}for(var i=0,n=this.faces.length;i<n;i++){var o=this.faces[i];o.normal.applyMatrix3(e).normalize();for(var a=0,s=o.vertexNormals.length;a<s;a++)o.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,i,n){return void 0===t&&(t=new u),t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,i,n){return void 0===t&&(t=new u),t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new ht),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,i,r){var o=void 0!==s?[f[t].clone(),f[e].clone(),f[i].clone()]:[],a=void 0!==u?[n.colors[t].clone(),n.colors[e].clone(),n.colors[i].clone()]:[],h=new lt(t,e,i,o,a,r);n.faces.push(h),void 0!==c&&n.faceVertexUvs[0].push([p[t].clone(),p[e].clone(),p[i].clone()]),void 0!==l&&n.faceVertexUvs[1].push([d[t].clone(),d[e].clone(),d[i].clone()])}var n=this,r=null!==t.index?t.index.array:void 0,o=t.attributes,a=o.position.array,s=void 0!==o.normal?o.normal.array:void 0,u=void 0!==o.color?o.color.array:void 0,c=void 0!==o.uv?o.uv.array:void 0,l=void 0!==o.uv2?o.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var f=[],p=[],d=[],m=0,v=0;m<a.length;m+=3,v+=2)n.vertices.push(new h(a[m],a[m+1],a[m+2])),void 0!==s&&f.push(new h(s[m],s[m+1],s[m+2])),void 0!==u&&n.colors.push(new W(u[m],u[m+1],u[m+2])),void 0!==c&&p.push(new i(c[v],c[v+1])),void 0!==l&&d.push(new i(l[v],l[v+1]));if(void 0!==r){var g=t.groups;if(g.length>0)for(var m=0;m<g.length;m++)for(var y=g[m],x=y.start,_=y.count,v=x,b=x+_;v<b;v+=3)e(r[v],r[v+1],r[v+2],y.materialIndex);else for(var m=0;m<r.length;m+=3)e(r[m],r[m+1],r[m+2])}else for(var m=0;m<a.length/3;m+=3)e(m,m+1,m+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new u;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new h,e=new h,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,i,n,r,o,a;for(a=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)a[e]=new h;if(t){var s,u,c,l=new h,f=new h;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=this.vertices[o.a],u=this.vertices[o.b],c=this.vertices[o.c],l.subVectors(c,u),f.subVectors(s,u),l.cross(f),a[o.a].add(l),a[o.b].add(l),a[o.c].add(l)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,i=this.vertices.length;e<i;e++)a[e].normalize();for(n=0,r=this.faces.length;n<r;n++){o=this.faces[n];var p=o.vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){i=this.faces[t];var n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var o=new Tt;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a,s,u=this.morphNormals[t].faceNormals,c=this.morphNormals[t].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)a=new h,s={a:new h,b:new h,c:new h},u.push(a),c.push(s)}var l=this.morphNormals[t];o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals();var a,s;for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],a=l.faceNormals[i],s=l.vertexNormals[i],a.copy(r.normal),s.a.copy(r.vertexNormals[0]),s.b.copy(r.vertexNormals[1]),s.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)i>0&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new tt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if((t&&t.isGeometry)===!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);var n,r=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,h=t.faces,u=this.faceVertexUvs[0],c=t.faceVertexUvs[0],l=this.colors,f=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new et).getNormalMatrix(e));for(var p=0,d=a.length;p<d;p++){var m=a[p],v=m.clone();void 0!==e&&v.applyMatrix4(e),o.push(v)}for(var p=0,d=f.length;p<d;p++)l.push(f[p].clone());for(p=0,d=h.length;p<d;p++){var g,y,x,_=h[p],b=_.vertexNormals,M=_.vertexColors;g=new lt(_.a+r,_.b+r,_.c+r),g.normal.copy(_.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var w=0,E=b.length;w<E;w++)y=b[w].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),g.vertexNormals.push(y);g.color.copy(_.color);for(var w=0,E=M.length;w<E;w++)x=M[w],g.vertexColors.push(x.clone());g.materialIndex=_.materialIndex+i,s.push(g)}for(p=0,d=c.length;p<d;p++){var S=c[p],T=[];if(void 0!==S){for(var w=0,E=S.length;w<E;w++)T.push(S[w].clone());u.push(T)}}},mergeMesh:function(t){return(t&&t.isMesh)===!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t):(t.matrixAutoUpdate&&t.updateMatrix(),
void this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,i,n,r,o,a,s,h={},u=[],c=[],l=4,f=Math.pow(10,l);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],e=Math.round(t.x*f)+"_"+Math.round(t.y*f)+"_"+Math.round(t.z*f),void 0===h[e]?(h[e]=i,u.push(this.vertices[i]),c[i]=u.length-1):c[i]=c[h[e]];var p=[];for(i=0,n=this.faces.length;i<n;i++){r=this.faces[i],r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(i);break}}for(i=p.length-1;i>=0;i--){var m=p[i];for(this.faces.splice(m,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(m,1)}var v=this.vertices.length-u.length;return this.vertices=u,v},sortFacesByMaterialIndex:function(){function t(t,e){return t.materialIndex-e.materialIndex}for(var e=this.faces,i=e.length,n=0;n<i;n++)e[n]._id=n;e.sort(t);var r,o,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===i&&(r=[]),s&&s.length===i&&(o=[]);for(var n=0;n<i;n++){var h=e[n]._id;r&&r.push(a[h]),o&&o.push(s[h])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function t(t,e,i){return i?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==f[e]?f[e]:(f[e]=l.length/3,l.push(t.x,t.y,t.z),f[e])}function i(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==d[e]?d[e]:(d[e]=p.length,p.push(t.getHex()),d[e])}function n(t){var e=t.x.toString()+t.y.toString();return void 0!==v[e]?v[e]:(v[e]=m.length/2,m.push(t.x,t.y),v[e])}var r={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(r[a]=o[a]);return r}for(var s=[],h=0;h<this.vertices.length;h++){var u=this.vertices[h];s.push(u.x,u.y,u.z)}for(var c=[],l=[],f={},p=[],d={},m=[],v={},h=0;h<this.faces.length;h++){var g=this.faces[h],y=!0,x=!1,_=void 0!==this.faceVertexUvs[0][h],b=g.normal.length()>0,M=g.vertexNormals.length>0,w=1!==g.color.r||1!==g.color.g||1!==g.color.b,E=g.vertexColors.length>0,S=0;if(S=t(S,0,0),S=t(S,1,y),S=t(S,2,x),S=t(S,3,_),S=t(S,4,b),S=t(S,5,M),S=t(S,6,w),S=t(S,7,E),c.push(S),c.push(g.a,g.b,g.c),c.push(g.materialIndex),_){var T=this.faceVertexUvs[0][h];c.push(n(T[0]),n(T[1]),n(T[2]))}if(b&&c.push(e(g.normal)),M){var P=g.vertexNormals;c.push(e(P[0]),e(P[1]),e(P[2]))}if(w&&c.push(i(g.color)),E){var L=g.vertexColors;c.push(i(L[0]),i(L[1]),i(L[2]))}}return r.data={},r.data.vertices=s,r.data.normals=l,p.length>0&&(r.data.colors=p),m.length>0&&(r.data.uvs=[m]),r.data.faces=c,r},clone:function(){return(new Tt).copy(this)},copy:function(t){var e,i,n,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,i=s.length;e<i;e++)this.vertices.push(s[e].clone());var h=t.colors;for(e=0,i=h.length;e<i;e++)this.colors.push(h[e].clone());var u=t.faces;for(e=0,i=u.length;e<i;e++)this.faces.push(u[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=c.length;n<r;n++){var l=c[n],f=[];for(o=0,a=l.length;o<a;o++){var p=l[o];f.push(p.clone())}this.faceVertexUvs[e].push(f)}}var d=t.morphTargets;for(e=0,i=d.length;e<i;e++){var m={};if(m.name=d[e].name,void 0!==d[e].vertices)for(m.vertices=[],n=0,r=d[e].vertices.length;n<r;n++)m.vertices.push(d[e].vertices[n].clone());if(void 0!==d[e].normals)for(m.normals=[],n=0,r=d[e].normals.length;n<r;n++)m.normals.push(d[e].normals[n].clone());this.morphTargets.push(m)}var v=t.morphNormals;for(e=0,i=v.length;e<i;e++){var g={};if(void 0!==v[e].vertexNormals)for(g.vertexNormals=[],n=0,r=v[e].vertexNormals.length;n<r;n++){var y=v[e].vertexNormals[n],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[e].faceNormals)for(g.faceNormals=[],n=0,r=v[e].faceNormals.length;n<r;n++)g.faceNormals.push(v[e].faceNormals[n].clone());this.morphNormals.push(g)}var _=t.skinWeights;for(e=0,i=_.length;e<i;e++)this.skinWeights.push(_[e].clone());var b=t.skinIndices;for(e=0,i=b.length;e<i;e++)this.skinIndices.push(b[e].clone());var M=t.lineDistances;for(e=0,i=M.length;e<i;e++)this.lineDistances.push(M[e]);var w=t.boundingBox;null!==w&&(this.boundingBox=w.clone());var E=t.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(Tt.prototype,e.prototype),Pt.prototype={constructor:Pt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Et(t)>65535?_t:yt)(t,1):this.index=t},addAttribute:function(t,e){return(e&&e.isBufferAttribute)===!1&&(e&&e.isInterleavedBufferAttribute)===!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new pt(arguments[1],arguments[2]))):"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var n=(new et).getNormalMatrix(t);n.applyToBufferAttribute(i),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t;return function(e){return void 0===t&&(t=new u),t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t;return function(e,i,n){return void 0===t&&(t=new u),t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t;return function(e,i,n){return void 0===t&&(t=new u),t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:function(){var t;return function(e){void 0===t&&(t=new ht),t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new bt(3*e.vertices.length,3),n=new bt(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new bt(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(i=void 0,e.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}var n;return e.verticesNeedUpdate===!0&&(n=this.attributes.position,void 0!==n&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),e.normalsNeedUpdate===!0&&(n=this.attributes.normal,void 0!==n&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),e.colorsNeedUpdate===!0&&(n=this.attributes.color,void 0!==n&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(n=this.attributes.uv,void 0!==n&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(n=this.attributes.lineDistance,void 0!==n&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new wt).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new pt(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new pt(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new pt(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new pt(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new pt(o,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var a=Et(t.indices)>65535?Uint32Array:Uint16Array,s=new a(3*t.indices.length);this.setIndex(new pt(s,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var h in t.morphTargets){for(var u=[],c=t.morphTargets[h],l=0,f=c.length;l<f;l++){var p=c[l],d=new bt(3*p.length,3);u.push(d.copyVector3sArray(p))}this.morphAttributes[h]=u}if(t.skinIndices.length>0){var m=new bt(4*t.skinIndices.length,4);this.addAttribute("skinIndex",m.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var v=new bt(4*t.skinWeights.length,4);this.addAttribute("skinWeight",v.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new $);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new $,e=new h;return function(){null===this.boundingSphere&&(this.boundingSphere=new tt);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;t.setFromBufferAttribute(i),t.getCenter(n);for(var r=0,o=0,a=i.count;o<a;o++)e.x=i.getX(o),e.y=i.getY(o),e.z=i.getZ(o),r=Math.max(r,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new pt(new Float32Array(n.length),3));else for(var r=e.normal.array,o=0,a=r.length;o<a;o++)r[o]=0;var s,u,c,l=e.normal.array,f=new h,p=new h,d=new h,m=new h,v=new h;if(t){var g=t.array;0===i.length&&this.addGroup(0,g.length);for(var y=0,x=i.length;y<x;++y)for(var _=i[y],b=_.start,M=_.count,o=b,a=b+M;o<a;o+=3)s=3*g[o+0],u=3*g[o+1],c=3*g[o+2],f.fromArray(n,s),p.fromArray(n,u),d.fromArray(n,c),m.subVectors(d,p),v.subVectors(f,p),m.cross(v),l[s]+=m.x,l[s+1]+=m.y,l[s+2]+=m.z,l[u]+=m.x,l[u+1]+=m.y,l[u+2]+=m.z,l[c]+=m.x,l[c+1]+=m.y,l[c+2]+=m.z}else for(var o=0,a=n.length;o<a;o+=9)f.fromArray(n,o),p.fromArray(n,o+3),d.fromArray(n,o+6),m.subVectors(d,p),v.subVectors(f,p),m.cross(v),l[o]=m.x,l[o+1]=m.y,l[o+2]=m.z,l[o+3]=m.x,l[o+4]=m.y,l[o+5]=m.z,l[o+6]=m.x,l[o+7]=m.y,l[o+8]=m.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if((t&&t.isBufferGeometry)===!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0);var i=this.attributes;for(var n in i)if(void 0!==t.attributes[n])for(var r=i[n],o=r.array,a=t.attributes[n],s=a.array,h=a.itemSize,u=0,c=h*e;u<s.length;u++,c++)o[c]=s[u];return this},normalizeNormals:function(){for(var t,e,i,n,r=this.attributes.normal.array,o=0,a=r.length;o<a;o+=3)t=r[o],e=r[o+1],i=r[o+2],n=1/Math.sqrt(t*t+e*e+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Pt,e=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],o=r.array,a=r.itemSize,s=new o.constructor(e.length*a),h=0,u=0,c=0,l=e.length;c<l;c++){h=e[c]*a;for(var f=0;f<a;f++)s[u++]=o[h++]}t.addAttribute(n,new pt(s,a))}return t},toJSON:function(){var t={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:r}}var o=this.attributes;for(var i in o){var a=o[i],r=Array.prototype.slice.call(a.array);t.data.attributes[i]={itemSize:a.itemSize,type:a.array.constructor.name,array:r,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new Pt).copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var o=t.attributes;for(e in o){var a=o[e];this.addAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var h=[],u=s[e];for(i=0,n=u.length;i<n;i++)h.push(u[i].clone());this.morphAttributes[e]=h}var c=t.groups;for(i=0,n=c.length;i<n;i++){var l=c[i];this.addGroup(l.start,l.count,l.materialIndex)}var f=t.boundingBox;null!==f&&(this.boundingBox=f.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},Pt.MaxIndex=65535,Object.assign(Pt.prototype,e.prototype),Lt.prototype=Object.assign(Object.create(ht.prototype),{constructor:Lt,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ht.prototype.copy.call(this,t),this.drawMode=t.drawMode,this},updateMorphTargets:function(){var t=this.geometry.morphTargets;if(void 0!==t&&t.length>0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,i=t.length;e<i;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[t[e].name]=e}},raycast:function(){function t(t,e,i,n,r,o,a){return ct.barycoordFromPoint(t,e,i,n,y),r.multiplyScalar(y.x),o.multiplyScalar(y.y),a.multiplyScalar(y.z),r.add(o).add(a),r.clone()}function e(t,e,i,n,r,o,a){var s,h=t.material;if(s=h.side===oo?i.intersectTriangle(o,r,n,!0,a):i.intersectTriangle(n,r,o,h.side!==ao,a),null===s)return null;_.copy(a),_.applyMatrix4(t.matrixWorld);var u=e.ray.origin.distanceTo(_);return u<e.near||u>e.far?null:{distance:u,point:_.clone(),object:t}}function n(i,n,r,o,a,h,u,f){s.fromBufferAttribute(o,h),c.fromBufferAttribute(o,u),l.fromBufferAttribute(o,f);var p=e(i,n,r,s,c,l,x);return p&&(a&&(m.fromBufferAttribute(a,h),v.fromBufferAttribute(a,u),g.fromBufferAttribute(a,f),p.uv=t(x,s,c,l,m,v,g)),p.face=new lt(h,u,f,ct.normal(s,c,l)),p.faceIndex=h),p}var r=new u,o=new ot,a=new tt,s=new h,c=new h,l=new h,f=new h,p=new h,d=new h,m=new i,v=new i,g=new i,y=new h,x=new h,_=new h;return function(i,h){var u=this.geometry,y=this.material,_=this.matrixWorld;if(void 0!==y&&(null===u.boundingSphere&&u.computeBoundingSphere(),a.copy(u.boundingSphere),a.applyMatrix4(_),i.ray.intersectsSphere(a)!==!1&&(r.getInverse(_),o.copy(i.ray).applyMatrix4(r),null===u.boundingBox||o.intersectsBox(u.boundingBox)!==!1))){var b;if(u.isBufferGeometry){var M,w,E,S,T,P=u.index,L=u.attributes.position,A=u.attributes.uv;if(null!==P)for(S=0,T=P.count;S<T;S+=3)M=P.getX(S),w=P.getX(S+1),E=P.getX(S+2),b=n(this,i,o,L,A,M,w,E),b&&(b.faceIndex=Math.floor(S/3),h.push(b));else for(S=0,T=L.count;S<T;S+=3)M=S,w=S+1,E=S+2,b=n(this,i,o,L,A,M,w,E),b&&(b.index=M,h.push(b))}else if(u.isGeometry){var C,R,I,O,D=y&&y.isMultiMaterial,N=D===!0?y.materials:null,U=u.vertices,F=u.faces,z=u.faceVertexUvs[0];z.length>0&&(O=z);for(var B=0,G=F.length;B<G;B++){var j=F[B],k=D===!0?N[j.materialIndex]:y;if(void 0!==k){if(C=U[j.a],R=U[j.b],I=U[j.c],k.morphTargets===!0){var V=u.morphTargets,H=this.morphTargetInfluences;s.set(0,0,0),c.set(0,0,0),l.set(0,0,0);for(var W=0,q=V.length;W<q;W++){var X=H[W];if(0!==X){var Y=V[W].vertices;s.addScaledVector(f.subVectors(Y[j.a],C),X),c.addScaledVector(p.subVectors(Y[j.b],R),X),l.addScaledVector(d.subVectors(Y[j.c],I),X)}}s.add(C),c.add(R),l.add(I),C=s,R=c,I=l}if(b=e(this,i,o,C,R,I,x)){if(O){var Z=O[B];m.copy(Z[0]),v.copy(Z[1]),g.copy(Z[2]),b.uv=t(x,C,R,I,m,v,g)}b.face=j,b.faceIndex=B,h.push(b)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),At.prototype=Object.create(Tt.prototype),At.prototype.constructor=At,Ct.prototype=Object.create(Pt.prototype),Ct.prototype.constructor=Ct,Rt.prototype=Object.create(Tt.prototype),Rt.prototype.constructor=Rt,It.prototype=Object.create(Pt.prototype),It.prototype.constructor=It,Ot.prototype=Object.create(ht.prototype),Ot.prototype.constructor=Ot,Ot.prototype.isCamera=!0,Ot.prototype.getWorldDirection=function(){var t=new s;return function(e){var i=e||new h;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),Ot.prototype.lookAt=function(){var t=new u;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),Ot.prototype.clone=function(){return(new this.constructor).copy(this)},Ot.prototype.copy=function(t){return ht.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},Dt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Dt,isPerspectiveCamera:!0,copy:function(t){return Ot.prototype.copy.call(this,t),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*ls.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*ls.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*ls.RAD2DEG*Math.atan(Math.tan(.5*ls.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,o){this.aspect=t/e,this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*ls.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==o){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/a,e-=o.offsetY*i/s,n*=o.width/a,i*=o.height/s}var h=this.filmOffset;0!==h&&(r+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Nt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Nt,isOrthographicCamera:!0,copy:function(t){return Ot.prototype.copy.call(this,t),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,o){this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,o=i+t,a=n+e,s=n-e;if(null!==this.view){var h=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,l=(this.top-this.bottom)/this.view.height;r+=c*(this.view.offsetX/h),o=r+c*(this.view.width/h),a-=l*(this.view.offsetY/u),s=a-l*(this.view.height/u)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far)},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}});var Tu=0;ue.prototype.isFogExp2=!0,ue.prototype.clone=function(){return new ue(this.color.getHex(),this.density)},ue.prototype.toJSON=function(t){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},ce.prototype.isFog=!0,ce.prototype.clone=function(){return new ce(this.color.getHex(),this.near,this.far)},ce.prototype.toJSON=function(t){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},le.prototype=Object.create(ht.prototype),le.prototype.constructor=le,le.prototype.copy=function(t,e){return ht.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},le.prototype.toJSON=function(t){var e=ht.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},fe.prototype=Object.assign(Object.create(ht.prototype),{constructor:fe,isLensFlare:!0,copy:function(t){ht.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,o){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new W(16777215)),void 0===n&&(n=po),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:r,blending:n})},updateLensFlares:function(){var t,e,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<i;t++)e=this.lensFlares[t],e.x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+r*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)}}),pe.prototype=Object.create(Q.prototype),pe.prototype.constructor=pe,pe.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},de.prototype=Object.assign(Object.create(ht.prototype),{constructor:de,isSprite:!0,raycast:function(){var t=new h;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.distanceSqToPoint(t),r=this.scale.x*this.scale.y/4;n>r||i.push({distance:Math.sqrt(n),point:this.position,face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),me.prototype=Object.assign(Object.create(ht.prototype),{constructor:me,copy:function(t){ht.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:function(){var t=new h;return function(e,i){t.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(t);this.getObjectForDistance(n).raycast(e,i)}}(),update:function(){var t=new h,e=new h;return function(i){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(i.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var r=t.distanceTo(e);n[0].object.visible=!0;for(var o=1,a=n.length;o<a&&r>=n[o].distance;o++)n[o-1].object.visible=!1,n[o].object.visible=!0;for(;o<a;o++)n[o].object.visible=!1}}}(),toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var o=i[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign(ve.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new u;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var t,e=0,i=this.bones.length;e<i;e++)t=this.bones[e],t&&t.matrixWorld.getInverse(this.boneInverses[e]);for(var e=0,i=this.bones.length;e<i;e++)t=this.bones[e],t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new u;return function(){for(var e=0,i=this.bones.length;e<i;e++){var n=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;t.multiplyMatrices(n,this.boneInverses[e]),t.toArray(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new ve(this.bones,this.boneInverses,this.useVertexTexture)}}),ge.prototype=Object.assign(Object.create(ht.prototype),{constructor:ge,isBone:!0}),ye.prototype=Object.assign(Object.create(Lt.prototype),{constructor:ye,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t],i=1/e.lengthManhattan();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var n=new r,o=this.geometry.attributes.skinWeight,t=0;t<o.count;t++){n.x=o.getX(t),n.y=o.getY(t),n.z=o.getZ(t),n.w=o.getW(t);var i=1/n.lengthManhattan();i!==1/0?n.multiplyScalar(i):n.set(1,0,0,0),o.setXYZW(t,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){Lt.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),xe.prototype=Object.create(Q.prototype),xe.prototype.constructor=xe,xe.prototype.isLineBasicMaterial=!0,xe.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},_e.prototype=Object.assign(Object.create(ht.prototype),{constructor:_e,isLine:!0,raycast:function(){var t=new u,e=new ot,i=new tt;return function(n,r){var o=n.linePrecision,a=o*o,s=this.geometry,u=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(u),n.ray.intersectsSphere(i)!==!1){t.getInverse(u),e.copy(n.ray).applyMatrix4(t);var c=new h,l=new h,f=new h,p=new h,d=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var m=s.index,v=s.attributes,g=v.position.array;if(null!==m)for(var y=m.array,x=0,_=y.length-1;x<_;x+=d){var b=y[x],M=y[x+1];c.fromArray(g,3*b),l.fromArray(g,3*M);var w=e.distanceSqToSegment(c,l,p,f);if(!(w>a)){p.applyMatrix4(this.matrixWorld);var E=n.ray.origin.distanceTo(p);E<n.near||E>n.far||r.push({distance:E,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else for(var x=0,_=g.length/3-1;x<_;x+=d){c.fromArray(g,3*x),l.fromArray(g,3*x+3);var w=e.distanceSqToSegment(c,l,p,f);if(!(w>a)){p.applyMatrix4(this.matrixWorld);var E=n.ray.origin.distanceTo(p);E<n.near||E>n.far||r.push({distance:E,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(s.isGeometry)for(var S=s.vertices,T=S.length,x=0;x<T-1;x+=d){var w=e.distanceSqToSegment(S[x],S[x+1],p,f);if(!(w>a)){p.applyMatrix4(this.matrixWorld);var E=n.ray.origin.distanceTo(p);E<n.near||E>n.far||r.push({distance:E,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),be.prototype=Object.assign(Object.create(_e.prototype),{constructor:be,isLineSegments:!0}),Me.prototype=Object.create(Q.prototype),Me.prototype.constructor=Me,Me.prototype.isPointsMaterial=!0,Me.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},we.prototype=Object.assign(Object.create(ht.prototype),{constructor:we,isPoints:!0,raycast:function(){var t=new u,e=new ot,i=new tt;return function(n,r){function o(t,i){var o=e.distanceSqToPoint(t);if(o<f){var s=e.closestPointToPoint(t);s.applyMatrix4(u);var h=n.ray.origin.distanceTo(s);if(h<n.near||h>n.far)return;r.push({distance:h,distanceToRay:Math.sqrt(o),point:s.clone(),index:i,face:null,object:a})}}var a=this,s=this.geometry,u=this.matrixWorld,c=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(u),n.ray.intersectsSphere(i)!==!1){t.getInverse(u),e.copy(n.ray).applyMatrix4(t);var l=c/((this.scale.x+this.scale.y+this.scale.z)/3),f=l*l,p=new h;if(s.isBufferGeometry){var d=s.index,m=s.attributes,v=m.position.array;if(null!==d)for(var g=d.array,y=0,x=g.length;y<x;y++){var _=g[y];p.fromArray(v,3*_),o(p,_)}else for(var y=0,b=v.length/3;y<b;y++)p.fromArray(v,3*y),o(p,y)}else for(var M=s.vertices,y=0,b=M.length;y<b;y++)o(M[y],y)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ee.prototype=Object.assign(Object.create(ht.prototype),{constructor:Ee}),Se.prototype=Object.create(n.prototype),Se.prototype.constructor=Se,Te.prototype=Object.create(n.prototype),Te.prototype.constructor=Te,Te.prototype.isCompressedTexture=!0,Pe.prototype=Object.create(n.prototype),Pe.prototype.constructor=Pe,
Le.prototype=Object.create(n.prototype),Le.prototype.constructor=Le,Le.prototype.isDepthTexture=!0,Ae.prototype=Object.create(Pt.prototype),Ae.prototype.constructor=Ae,Ce.prototype=Object.create(Tt.prototype),Ce.prototype.constructor=Ce,Re.prototype=Object.create(Pt.prototype),Re.prototype.constructor=Re,Ie.prototype=Object.create(Tt.prototype),Ie.prototype.constructor=Ie,Oe.prototype=Object.create(Pt.prototype),Oe.prototype.constructor=Oe,De.prototype=Object.create(Tt.prototype),De.prototype.constructor=De,Ne.prototype=Object.create(Oe.prototype),Ne.prototype.constructor=Ne,Ue.prototype=Object.create(Tt.prototype),Ue.prototype.constructor=Ue,Fe.prototype=Object.create(Oe.prototype),Fe.prototype.constructor=Fe,ze.prototype=Object.create(Tt.prototype),ze.prototype.constructor=ze,Be.prototype=Object.create(Oe.prototype),Be.prototype.constructor=Be,Ge.prototype=Object.create(Tt.prototype),Ge.prototype.constructor=Ge,je.prototype=Object.create(Oe.prototype),je.prototype.constructor=je,ke.prototype=Object.create(Tt.prototype),ke.prototype.constructor=ke,Ve.prototype=Object.create(Pt.prototype),Ve.prototype.constructor=Ve,He.prototype=Object.create(Tt.prototype),He.prototype.constructor=He,We.prototype=Object.create(Pt.prototype),We.prototype.constructor=We,qe.prototype=Object.create(Tt.prototype),qe.prototype.constructor=qe,Xe.prototype=Object.create(Pt.prototype),Xe.prototype.constructor=Xe;var Pu={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},triangulate:function(){function t(t,e,i,n,r,o){var a,s,h,u,c,l,f,p,d;if(s=t[o[e]].x,h=t[o[e]].y,u=t[o[i]].x,c=t[o[i]].y,l=t[o[n]].x,f=t[o[n]].y,(u-s)*(f-h)-(c-h)*(l-s)<=0)return!1;var m,v,g,y,x,_,b,M,w,E,S,T,P,L,A;for(m=l-u,v=f-c,g=s-l,y=h-f,x=u-s,_=c-h,a=0;a<r;a++)if(p=t[o[a]].x,d=t[o[a]].y,!(p===s&&d===h||p===u&&d===c||p===l&&d===f)&&(b=p-s,M=d-h,w=p-u,E=d-c,S=p-l,T=d-f,A=m*E-v*w,P=x*M-_*b,L=g*T-y*S,A>=-Number.EPSILON&&L>=-Number.EPSILON&&P>=-Number.EPSILON))return!1;return!0}return function(e,i){var n=e.length;if(n<3)return null;var r,o,a,s=[],h=[],u=[];if(Pu.area(e)>0)for(o=0;o<n;o++)h[o]=o;else for(o=0;o<n;o++)h[o]=n-1-o;var c=n,l=2*c;for(o=c-1;c>2;){if(l--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?u:s;if(r=o,c<=r&&(r=0),o=r+1,c<=o&&(o=0),a=o+1,c<=a&&(a=0),t(e,r,o,a,c,h)){var f,p,d,m,v;for(f=h[r],p=h[o],d=h[a],s.push([e[f],e[p],e[d]]),u.push([h[r],h[o],h[a]]),m=o,v=o+1;v<c;m++,v++)h[m]=h[v];c--,l=2*c}}return i?u:s}}(),triangulateShape:function(t,e){function i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function n(t,e,i){return t.x!==e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function r(t,e,i,r,o){var a=e.x-t.x,s=e.y-t.y,h=r.x-i.x,u=r.y-i.y,c=t.x-i.x,l=t.y-i.y,f=s*h-a*u,p=s*c-a*l;if(Math.abs(f)>Number.EPSILON){var d;if(f>0){if(p<0||p>f)return[];if(d=u*c-h*l,d<0||d>f)return[]}else{if(p>0||p<f)return[];if(d=u*c-h*l,d>0||d<f)return[]}if(0===d)return!o||0!==p&&p!==f?[t]:[];if(d===f)return!o||0!==p&&p!==f?[e]:[];if(0===p)return[i];if(p===f)return[r];var m=d/f;return[{x:t.x+m*a,y:t.y+m*s}]}if(0!==p||u*c!==h*l)return[];var v=0===a&&0===s,g=0===h&&0===u;if(v&&g)return t.x!==i.x||t.y!==i.y?[]:[t];if(v)return n(i,r,t)?[t]:[];if(g)return n(t,e,i)?[i]:[];var y,x,_,b,M,w,E,S;return 0!==a?(t.x<e.x?(y=t,_=t.x,x=e,b=e.x):(y=e,_=e.x,x=t,b=t.x),i.x<r.x?(M=i,E=i.x,w=r,S=r.x):(M=r,E=r.x,w=i,S=i.x)):(t.y<e.y?(y=t,_=t.y,x=e,b=e.y):(y=e,_=e.y,x=t,b=t.y),i.y<r.y?(M=i,E=i.y,w=r,S=r.y):(M=r,E=r.y,w=i,S=i.y)),_<=E?b<E?[]:b===E?o?[]:[M]:b<=S?[M,x]:[M,w]:_>S?[]:_===S?o?[]:[y]:b<=S?[y,x]:[y,w]}function o(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,a=i.x-t.x,s=i.y-t.y,h=n.x-t.x,u=n.y-t.y,c=r*s-o*a,l=r*u-o*h;if(Math.abs(c)>Number.EPSILON){var f=h*s-u*a;return c>0?l>=0&&f>=0:l>=0||f>=0}return l>0}function a(t,e){function i(t,e){var i=y.length-1,n=t-1;n<0&&(n=i);var r=t+1;r>i&&(r=0);var a=o(y[t],y[n],y[r],s[e]);if(!a)return!1;var h=s.length-1,u=e-1;u<0&&(u=h);var c=e+1;return c>h&&(c=0),a=o(s[e],s[u],s[c],y[t]),!!a}function n(t,e){var i,n,o;for(i=0;i<y.length;i++)if(n=i+1,n%=y.length,o=r(t,e,y[i],y[n],!0),o.length>0)return!0;return!1}function a(t,i){var n,o,a,s,h;for(n=0;n<x.length;n++)for(o=e[x[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,h=r(t,i,o[a],o[s],!0),h.length>0)return!0;return!1}for(var s,h,u,c,l,f,p,d,m,v,g,y=t.concat(),x=[],_=[],b=0,M=e.length;b<M;b++)x.push(b);for(var w=0,E=2*x.length;x.length>0;){if(E--,E<0){console.log("Infinite Loop! Holes left:"+x.length+", Probably Hole outside Shape!");break}for(u=w;u<y.length;u++){c=y[u],h=-1;for(var b=0;b<x.length;b++)if(f=x[b],p=c.x+":"+c.y+":"+f,void 0===_[p]){s=e[f];for(var S=0;S<s.length;S++)if(l=s[S],i(u,S)&&!n(c,l)&&!a(c,l)){h=S,x.splice(b,1),d=y.slice(0,u+1),m=y.slice(u),v=s.slice(h),g=s.slice(0,h+1),y=d.concat(v).concat(g).concat(m),w=u;break}if(h>=0)break;_[p]=!0}if(h>=0)break}}return y}i(t),e.forEach(i);for(var s,h,u,c,l,f,p={},d=t.concat(),m=0,v=e.length;m<v;m++)Array.prototype.push.apply(d,e[m]);for(s=0,h=d.length;s<h;s++)l=d[s].x+":"+d[s].y,void 0!==p[l]&&console.warn("THREE.ShapeUtils: Duplicate point",l,s),p[l]=s;var g=a(t,e),y=Pu.triangulate(g,!1);for(s=0,h=y.length;s<h;s++)for(c=y[s],u=0;u<3;u++)l=c[u].x+":"+c[u].y,f=p[l],void 0!==f&&(c[u]=f);return y.concat()},isClockWise:function(t){return Pu.area(t)<0}};Ye.prototype=Object.create(Tt.prototype),Ye.prototype.constructor=Ye,Ye.prototype.addShapeList=function(t,e){for(var i=t.length,n=0;n<i;n++){var r=t[n];this.addShape(r,e)}},Ye.prototype.addShape=function(t,e){function n(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}function r(t,e,n){var r,o,a=1,s=t.x-e.x,h=t.y-e.y,u=n.x-t.x,c=n.y-t.y,l=s*s+h*h,f=s*c-h*u;if(Math.abs(f)>Number.EPSILON){var p=Math.sqrt(l),d=Math.sqrt(u*u+c*c),m=e.x-h/p,v=e.y+s/p,g=n.x-c/d,y=n.y+u/d,x=((g-m)*c-(y-v)*u)/(s*c-h*u);r=m+s*x-t.x,o=v+h*x-t.y;var _=r*r+o*o;if(_<=2)return new i(r,o);a=Math.sqrt(_/2)}else{var b=!1;s>Number.EPSILON?u>Number.EPSILON&&(b=!0):s<-Number.EPSILON?u<-Number.EPSILON&&(b=!0):Math.sign(h)===Math.sign(c)&&(b=!0),b?(r=-h,o=s,a=Math.sqrt(l)):(r=s,o=h,a=Math.sqrt(l/2))}return new i(r/a,o/a)}function o(){if(b){var t=0,e=H*t;for(X=0;X<W;X++)V=U[X],c(V[2]+e,V[1]+e,V[0]+e);for(t=w+2*_,e=H*t,X=0;X<W;X++)V=U[X],c(V[0]+e,V[1]+e,V[2]+e)}else{for(X=0;X<W;X++)V=U[X],c(V[2],V[1],V[0]);for(X=0;X<W;X++)V=U[X],c(V[0]+H*w,V[1]+H*w,V[2]+H*w)}}function a(){var t=0;for(s(F,t),t+=F.length,L=0,A=D.length;L<A;L++)P=D[L],s(P,t),t+=P.length}function s(t,e){var i,n;for(X=t.length;--X>=0;){i=X,n=X-1,n<0&&(n=t.length-1);var r=0,o=w+2*_;for(r=0;r<o;r++){var a=H*r,s=H*(r+1),h=e+i+a,u=e+n+a,c=e+n+s,f=e+i+s;l(h,u,c,f,t,r,o,i,n)}}}function u(t,e,i){C.vertices.push(new h(t,e,i))}function c(t,e,i){t+=R,e+=R,i+=R,C.faces.push(new lt(t,e,i,null,null,0));var n=T.generateTopUV(C,t,e,i);C.faceVertexUvs[0].push(n)}function l(t,e,i,n,r,o,a,s,h){t+=R,e+=R,i+=R,n+=R,C.faces.push(new lt(t,e,n,null,null,1)),C.faces.push(new lt(e,i,n,null,null,1));var u=T.generateSideWallUV(C,t,e,i,n);C.faceVertexUvs[0].push([u[0],u[1],u[3]]),C.faceVertexUvs[0].push([u[1],u[2],u[3]])}var f,p,d,m,v,g=void 0!==e.amount?e.amount:100,y=void 0!==e.bevelThickness?e.bevelThickness:6,x=void 0!==e.bevelSize?e.bevelSize:y-2,_=void 0!==e.bevelSegments?e.bevelSegments:3,b=void 0===e.bevelEnabled||e.bevelEnabled,M=void 0!==e.curveSegments?e.curveSegments:12,w=void 0!==e.steps?e.steps:1,E=e.extrudePath,S=!1,T=void 0!==e.UVGenerator?e.UVGenerator:Ye.WorldUVGenerator;E&&(f=E.getSpacedPoints(w),S=!0,b=!1,p=void 0!==e.frames?e.frames:E.computeFrenetFrames(w,!1),d=new h,m=new h,v=new h),b||(_=0,y=0,x=0);var P,L,A,C=this,R=this.vertices.length,I=t.extractPoints(M),O=I.shape,D=I.holes,N=!Pu.isClockWise(O);if(N){for(O=O.reverse(),L=0,A=D.length;L<A;L++)P=D[L],Pu.isClockWise(P)&&(D[L]=P.reverse());N=!1}var U=Pu.triangulateShape(O,D),F=O;for(L=0,A=D.length;L<A;L++)P=D[L],O=O.concat(P);for(var z,B,G,j,k,V,H=O.length,W=U.length,q=[],X=0,Y=F.length,Z=Y-1,Q=X+1;X<Y;X++,Z++,Q++)Z===Y&&(Z=0),Q===Y&&(Q=0),q[X]=r(F[X],F[Z],F[Q]);var J,K=[],$=q.concat();for(L=0,A=D.length;L<A;L++){for(P=D[L],J=[],X=0,Y=P.length,Z=Y-1,Q=X+1;X<Y;X++,Z++,Q++)Z===Y&&(Z=0),Q===Y&&(Q=0),J[X]=r(P[X],P[Z],P[Q]);K.push(J),$=$.concat(J)}for(z=0;z<_;z++){for(G=z/_,j=y*Math.cos(G*Math.PI/2),B=x*Math.sin(G*Math.PI/2),X=0,Y=F.length;X<Y;X++)k=n(F[X],q[X],B),u(k.x,k.y,-j);for(L=0,A=D.length;L<A;L++)for(P=D[L],J=K[L],X=0,Y=P.length;X<Y;X++)k=n(P[X],J[X],B),u(k.x,k.y,-j)}for(B=x,X=0;X<H;X++)k=b?n(O[X],$[X],B):O[X],S?(m.copy(p.normals[0]).multiplyScalar(k.x),d.copy(p.binormals[0]).multiplyScalar(k.y),v.copy(f[0]).add(m).add(d),u(v.x,v.y,v.z)):u(k.x,k.y,0);var tt;for(tt=1;tt<=w;tt++)for(X=0;X<H;X++)k=b?n(O[X],$[X],B):O[X],S?(m.copy(p.normals[tt]).multiplyScalar(k.x),d.copy(p.binormals[tt]).multiplyScalar(k.y),v.copy(f[tt]).add(m).add(d),u(v.x,v.y,v.z)):u(k.x,k.y,g/w*tt);for(z=_-1;z>=0;z--){for(G=z/_,j=y*Math.cos(G*Math.PI/2),B=x*Math.sin(G*Math.PI/2),X=0,Y=F.length;X<Y;X++)k=n(F[X],q[X],B),u(k.x,k.y,g+j);for(L=0,A=D.length;L<A;L++)for(P=D[L],J=K[L],X=0,Y=P.length;X<Y;X++)k=n(P[X],J[X],B),S?u(k.x,k.y+f[w-1].y,f[w-1].x+j):u(k.x,k.y,g+j)}o(),a()},Ye.WorldUVGenerator={generateTopUV:function(t,e,n,r){var o=t.vertices,a=o[e],s=o[n],h=o[r];return[new i(a.x,a.y),new i(s.x,s.y),new i(h.x,h.y)]},generateSideWallUV:function(t,e,n,r,o){var a=t.vertices,s=a[e],h=a[n],u=a[r],c=a[o];return Math.abs(s.y-h.y)<.01?[new i(s.x,1-s.z),new i(h.x,1-h.z),new i(u.x,1-u.z),new i(c.x,1-c.z)]:[new i(s.y,1-s.z),new i(h.y,1-h.z),new i(u.y,1-u.z),new i(c.y,1-c.z)]}},Ze.prototype=Object.create(Ye.prototype),Ze.prototype.constructor=Ze,Qe.prototype=Object.create(Tt.prototype),Qe.prototype.constructor=Qe,Je.prototype=Object.create(Pt.prototype),Je.prototype.constructor=Je,Ke.prototype=Object.create(Tt.prototype),Ke.prototype.constructor=Ke,$e.prototype=Object.create(Pt.prototype),$e.prototype.constructor=$e,ti.prototype=Object.create(Tt.prototype),ti.prototype.constructor=ti,ei.prototype=Object.create(Pt.prototype),ei.prototype.constructor=ei,ii.prototype=Object.create(Tt.prototype),ii.prototype.constructor=ii,ni.prototype=Object.create(Pt.prototype),ni.prototype.constructor=ni,ri.prototype=Object.create(Pt.prototype),ri.prototype.constructor=ri,oi.prototype=Object.create(Tt.prototype),oi.prototype.constructor=oi,ai.prototype=Object.create(Pt.prototype),ai.prototype.constructor=ai,si.prototype=Object.create(oi.prototype),si.prototype.constructor=si,hi.prototype=Object.create(ai.prototype),hi.prototype.constructor=hi,ui.prototype=Object.create(Tt.prototype),ui.prototype.constructor=ui,ci.prototype=Object.create(Pt.prototype),ci.prototype.constructor=ci;var Lu=Object.freeze({WireframeGeometry:Ae,ParametricGeometry:Ce,ParametricBufferGeometry:Re,TetrahedronGeometry:De,TetrahedronBufferGeometry:Ne,OctahedronGeometry:Ue,OctahedronBufferGeometry:Fe,IcosahedronGeometry:ze,IcosahedronBufferGeometry:Be,DodecahedronGeometry:Ge,DodecahedronBufferGeometry:je,PolyhedronGeometry:Ie,PolyhedronBufferGeometry:Oe,TubeGeometry:ke,TubeBufferGeometry:Ve,TorusKnotGeometry:He,TorusKnotBufferGeometry:We,TorusGeometry:qe,TorusBufferGeometry:Xe,TextGeometry:Ze,SphereGeometry:Qe,SphereBufferGeometry:Je,RingGeometry:Ke,RingBufferGeometry:$e,PlaneGeometry:Rt,PlaneBufferGeometry:It,LatheGeometry:ti,LatheBufferGeometry:ei,ShapeGeometry:ii,ShapeBufferGeometry:ni,ExtrudeGeometry:Ye,EdgesGeometry:ri,ConeGeometry:si,ConeBufferGeometry:hi,CylinderGeometry:oi,CylinderBufferGeometry:ai,CircleGeometry:ui,CircleBufferGeometry:ci,BoxGeometry:At,BoxBufferGeometry:Ct});li.prototype=Object.create(J.prototype),li.prototype.constructor=li,li.prototype.isShadowMaterial=!0,fi.prototype=Object.create(J.prototype),fi.prototype.constructor=fi,fi.prototype.isRawShaderMaterial=!0,pi.prototype={constructor:pi,isMultiMaterial:!0,toJSON:function(t){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},i=this.materials,n=0,r=i.length;n<r;n++){var o=i[n].toJSON(t);delete o.metadata,e.materials.push(o)}return e.visible=this.visible,e},clone:function(){for(var t=new this.constructor,e=0;e<this.materials.length;e++)t.materials.push(this.materials[e].clone());return t.visible=this.visible,t}},di.prototype=Object.create(Q.prototype),di.prototype.constructor=di,di.prototype.isMeshStandardMaterial=!0,di.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},mi.prototype=Object.create(di.prototype),mi.prototype.constructor=mi,mi.prototype.isMeshPhysicalMaterial=!0,mi.prototype.copy=function(t){return di.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},vi.prototype=Object.create(Q.prototype),vi.prototype.constructor=vi,vi.prototype.isMeshPhongMaterial=!0,vi.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},gi.prototype=Object.create(vi.prototype),gi.prototype.constructor=gi,gi.prototype.isMeshToonMaterial=!0,gi.prototype.copy=function(t){return vi.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},yi.prototype=Object.create(Q.prototype),yi.prototype.constructor=yi,yi.prototype.isMeshNormalMaterial=!0,yi.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},xi.prototype=Object.create(Q.prototype),xi.prototype.constructor=xi,xi.prototype.isMeshLambertMaterial=!0,xi.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},_i.prototype=Object.create(Q.prototype),_i.prototype.constructor=_i,_i.prototype.isLineDashedMaterial=!0,_i.prototype.copy=function(t){return Q.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Au=Object.freeze({ShadowMaterial:li,SpriteMaterial:pe,RawShaderMaterial:fi,ShaderMaterial:J,PointsMaterial:Me,MultiMaterial:pi,MeshPhysicalMaterial:mi,MeshStandardMaterial:di,MeshPhongMaterial:vi,MeshToonMaterial:gi,MeshNormalMaterial:yi,MeshLambertMaterial:xi,MeshDepthMaterial:K,MeshBasicMaterial:ft,LineDashedMaterial:_i,LineBasicMaterial:xe,Material:Q}),Cu={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Ru=new bi;Object.assign(Mi.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=Cu.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var a=/^data:(.*?)(;base64)?,(.*)$/,s=t.match(a);if(s){var h=s[1],u=!!s[2],c=s[3];c=window.decodeURIComponent(c),u&&(c=window.atob(c));try{var l,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":l=new ArrayBuffer(c.length);for(var p=new Uint8Array(l),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);"blob"===f&&(l=new Blob([l],{type:h}));break;case"document":var m=new DOMParser;l=m.parseFromString(c,h);break;case"json":l=JSON.parse(c);break;default:l=c}window.setTimeout(function(){e&&e(l),r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),r.manager.itemError(t)},0)}}else{var v=new XMLHttpRequest;v.open("GET",t,!0),v.addEventListener("load",function(i){var o=i.target.response;Cu.add(t,o),200===this.status?(e&&e(o),r.manager.itemEnd(t)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(o),r.manager.itemEnd(t)):(n&&n(i),r.manager.itemError(t))},!1),void 0!==i&&v.addEventListener("progress",function(t){i(t)},!1),v.addEventListener("error",function(e){n&&n(e),r.manager.itemError(t)},!1),void 0!==this.responseType&&(v.responseType=this.responseType),void 0!==this.withCredentials&&(v.withCredentials=this.withCredentials),v.overrideMimeType&&v.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),v.send(null)}return r.manager.itemStart(t),v},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Object.assign(wi.prototype,{load:function(t,e,i,n){function r(r){h.load(t[r],function(t){var i=o._parser(t,!0);a[r]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},u+=1,6===u&&(1===i.mipmapCount&&(s.minFilter=la),s.format=i.format,s.needsUpdate=!0,e&&e(s))},i,n)}var o=this,a=[],s=new Te;s.image=a;var h=new Mi(this.manager);if(h.setPath(this.path),h.setResponseType("arraybuffer"),Array.isArray(t))for(var u=0,c=0,l=t.length;c<l;++c)r(c);else h.load(t,function(t){var i=o._parser(t,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,r=0;r<n;r++){a[r]={mipmaps:[]};for(var h=0;h<i.mipmapCount;h++)a[r].mipmaps.push(i.mipmaps[r*i.mipmapCount+h]),a[r].format=i.format,a[r].width=i.width,a[r].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=la),s.format=i.format,s.needsUpdate=!0,e&&e(s)},i,n);return s},setPath:function(t){return this.path=t,this}}),Object.assign(Ei.prototype,{load:function(t,e,i,n){var r=this,o=new q,a=new Mi(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){var i=r._parser(t);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:aa,o.wrapT=void 0!==i.wrapT?i.wrapT:aa,o.magFilter=void 0!==i.magFilter?i.magFilter:la,o.minFilter=void 0!==i.minFilter?i.minFilter:pa,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=la),o.needsUpdate=!0,e&&e(o,i))},i,n),o}}),Object.assign(Si.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=Cu.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){Cu.add(t,this),e&&e(this),r.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){n&&n(e),r.manager.itemError(t)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Ti.prototype,{load:function(t,e,i,n){function r(i){a.load(t[i],function(t){o.images[i]=t,s++,6===s&&(o.needsUpdate=!0,e&&e(o))},void 0,n)}var o=new c,a=new Si(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);for(var s=0,h=0;h<t.length;++h)r(h);return o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Pi.prototype,{load:function(t,e,i,r){var o=new n,a=new Si(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(i){var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);o.format=n?Pa:La,o.image=i,o.needsUpdate=!0,void 0!==e&&e(o)},i,r),o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Li.prototype=Object.assign(Object.create(ht.prototype),{constructor:Li,isLight:!0,copy:function(t){return ht.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ht.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Ai.prototype=Object.assign(Object.create(Li.prototype),{constructor:Ai,isHemisphereLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Ci.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ri.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Ri,isSpotLightShadow:!0,update:function(t){var e=2*ls.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,n=t.distance||500,r=this.camera;e===r.fov&&i===r.aspect&&n===r.far||(r.fov=e,r.aspect=i,r.far=n,r.updateProjectionMatrix())}}),Ii.prototype=Object.assign(Object.create(Li.prototype),{constructor:Ii,isSpotLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Oi.prototype=Object.assign(Object.create(Li.prototype),{constructor:Oi,isPointLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Di.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Di}),Ni.prototype=Object.assign(Object.create(Li.prototype),{constructor:Ni,isDirectionalLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Ui.prototype=Object.assign(Object.create(Li.prototype),{constructor:Ui,isAmbientLight:!0});var Iu={arraySlice:function(t,e,i){return Iu.isTypedArray(t)?new t.constructor(t.subarray(e,i)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(e,i){return t[e]-t[i]}for(var i=t.length,n=new Array(i),r=0;r!==i;++r)n[r]=r;return n.sort(e),n},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=i[o]*e,h=0;h!==e;++h)r[a++]=t[s+h];return r},flattenJSON:function(t,e,i,n){for(var r=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[r++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a)){do a=o[n],void 0!==a&&(e.push(o.time),i.push.apply(i,a)),o=t[r++];while(void 0!==o)}else if(void 0!==a.toArray){do a=o[n],void 0!==a&&(e.push(o.time),a.toArray(i,i.length)),o=t[r++];while(void 0!==o)}else do a=o[n],void 0!==a&&(e.push(o.time),i.push(a)),o=t[r++];while(void 0!==o)}}};Fi.prototype={constructor:Fi,evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{var o;i:{n:if(!(t<n)){for(var a=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===a)break;if(r=n,n=e[++i],t<n)break e}o=e.length;break i}{if(t>=r)break t;var s=e[1];t<s&&(i=2,r=s);for(var a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;if(n=r,r=e[--i-1],t>=r)break e}o=i,i=0}}for(;i<o;){var h=i+o>>>1;t<e[h]?o=h:i=h+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,o=0;o!==n;++o)e[o]=i[r+o];return e},interpolate_:function(t,e,i,n){throw new Error("call to abstract method")},intervalChanged_:function(t,e,i){}},Object.assign(Fi.prototype,{beforeStart_:Fi.prototype.copySampleValue_,afterEnd_:Fi.prototype.copySampleValue_}),zi.prototype=Object.assign(Object.create(Fi.prototype),{constructor:zi,DefaultSettings_:{endingStart:Za,endingEnd:Za},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,o=t+1,a=n[r],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case Qa:r=t,a=2*e-i;break;case Ja:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case Qa:o=t,s=2*i-e;break;case Ja:o=1,s=i+n[1]-n[0];break;default:o=t-1,s=e}var h=.5*(i-e),u=this.valueSize;this._weightPrev=h/(e-a),this._weightNext=h/(s-i),this._offsetPrev=r*u,this._offsetNext=o*u},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,h=s-a,u=this._offsetPrev,c=this._offsetNext,l=this._weightPrev,f=this._weightNext,p=(i-e)/(n-e),d=p*p,m=d*p,v=-l*m+2*l*d-l*p,g=(1+l)*m+(-1.5-2*l)*d+(-.5+l)*p+1,y=(-1-f)*m+(1.5+f)*d+.5*p,x=f*m-f*d,_=0;_!==a;++_)r[_]=v*o[u+_]+g*o[h+_]+y*o[s+_]+x*o[c+_];return r}}),Bi.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Bi,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,h=s-a,u=(i-e)/(n-e),c=1-u,l=0;l!==a;++l)r[l]=o[h+l]*c+o[s+l]*u;return r}}),Gi.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Gi,interpolate_:function(t,e,i,n){return this.copySampleValue_(t-1)}});var Ou;Ou={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Xa,InterpolantFactoryMethodDiscrete:function(t){return new Gi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Bi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new zi(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case qa:e=this.InterpolantFactoryMethodDiscrete;break;case Xa:e=this.InterpolantFactoryMethodLinear;break;case Ya:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return void console.warn(i)}this.createInterpolant=e},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qa;case this.InterpolantFactoryMethodLinear:return Xa;case this.InterpolantFactoryMethodSmooth:return Ya}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<t;)++r;for(;o!==-1&&i[o]>e;)--o;if(++o,0!==r||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);var a=this.getValueSize();this.times=Iu.arraySlice(i,r,o),this.values=Iu.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("invalid value size in track",this),t=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("track is empty",this),t=!1);for(var o=null,a=0;a!==r;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("time is not a valid number",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("out of order keys",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&Iu.isTypedArray(n))for(var a=0,h=n.length;a!==h;++a){var u=n[a];if(isNaN(u)){console.error("value is not a valid number",this,a,u),t=!1;break}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=this.getInterpolation()===Ya,r=1,o=t.length-1,a=1;a<o;++a){var s=!1,h=t[a],u=t[a+1];if(h!==u&&(1!==a||h!==h[0]))if(n)s=!0;else for(var c=a*i,l=c-i,f=c+i,p=0;p!==i;++p){var d=e[c+p];if(d!==e[l+p]||d!==e[f+p]){s=!0;break}}if(s){if(a!==r){t[r]=t[a];for(var m=a*i,v=r*i,p=0;p!==i;++p)e[v+p]=e[m+p]}++r}}if(o>0){t[r]=t[o];for(var m=o*i,v=r*i,p=0;p!==i;++p)e[v+p]=e[m+p];++r}return r!==t.length&&(this.times=Iu.arraySlice(t,0,r),this.values=Iu.arraySlice(e,0,r*i)),this}},ki.prototype=Object.assign(Object.create(Ou),{constructor:ki,ValueTypeName:"vector"}),Vi.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Vi,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,h=t*a,u=(i-e)/(n-e),c=h+a;h!==c;h+=4)s.slerpFlat(r,0,o,h-a,o,h,u);return r}}),Hi.prototype=Object.assign(Object.create(Ou),{constructor:Hi,ValueTypeName:"quaternion",DefaultInterpolation:Xa,InterpolantFactoryMethodLinear:function(t){return new Vi(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Wi.prototype=Object.assign(Object.create(Ou),{
constructor:Wi,ValueTypeName:"number"}),qi.prototype=Object.assign(Object.create(Ou),{constructor:qi,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:qa,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Xi.prototype=Object.assign(Object.create(Ou),{constructor:Xi,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:qa,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Yi.prototype=Object.assign(Object.create(Ou),{constructor:Yi,ValueTypeName:"color"}),Zi.prototype=Ou,Ou.constructor=Zi,Object.assign(Zi,{parse:function(t){if(void 0===t.type)throw new Error("track type undefined, can not parse");var e=Zi._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];Iu.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,i=t.constructor;if(void 0!==i.toJSON)e=i.toJSON(t);else{e={name:t.name,times:Iu.convertArray(t.times,Array),values:Iu.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wi;case"vector":case"vector2":case"vector3":case"vector4":return ki;case"color":return Yi;case"quaternion":return Hi;case"bool":case"boolean":return Xi;case"string":return qi}throw new Error("Unsupported typeName: "+t)}}),Qi.prototype={constructor:Qi,resetDuration:function(){for(var t=this.tracks,e=0,i=0,n=t.length;i!==n;++i){var r=this.tracks[i];e=Math.max(e,r.times[r.times.length-1])}this.duration=e},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}},Object.assign(Qi,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,o=i.length;r!==o;++r)e.push(Zi.parse(i[r]).scale(n));return new Qi(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e},r=0,o=i.length;r!==o;++r)e.push(Zi.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,o=[],a=0;a<r;a++){var s=[],h=[];s.push((a+r-1)%r,a,(a+1)%r),h.push(0,1,0);var u=Iu.getKeyframeOrder(s);s=Iu.sortedArray(s,1,u),h=Iu.sortedArray(h,1,u),n||0!==s[0]||(s.push(r),h.push(h[0])),o.push(new Wi(".morphTargetInfluences["+e[a].name+"]",s,h).scale(1/i))}return new Qi(t,-1,o)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],h=s.name.match(r);if(h&&h.length>1){var u=h[1],c=n[u];c||(n[u]=c=[]),c.push(s)}}var l=[];for(var u in n)l.push(Qi.CreateFromMorphTargetSequence(u,n[u],e,i));return l},parseAnimation:function(t,e){if(!t)return console.error("  no animation in JSONLoader data"),null;for(var i=function(t,e,i,n,r){if(0!==i.length){var o=[],a=[];Iu.flattenJSON(i,o,a,n),0!==o.length&&r.push(new t(e,o,a))}},n=[],r=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],h=0;h<s.length;h++){var u=s[h].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},l=0;l<u.length;l++)if(u[l].morphTargets)for(var f=0;f<u[l].morphTargets.length;f++)c[u[l].morphTargets[f]]=-1;for(var p in c){for(var d=[],m=[],f=0;f!==u[l].morphTargets.length;++f){var v=u[l];d.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new Wi(".morphTargetInfluence["+p+"]",d,m))}o=c.length*(a||1)}else{var g=".bones["+e[h].name+"]";i(ki,g+".position",u,"pos",n),i(Hi,g+".quaternion",u,"rot",n),i(ki,g+".scale",u,"scl",n)}}if(0===n.length)return null;var y=new Qi(r,o,n);return y}}),Object.assign(Ji.prototype,{load:function(t,e,i,n){var r=this,o=new Mi(r.manager);o.load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){function e(t){return void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),n[t]}var n=this.textures,r=new Au[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearCoat&&(r.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(r.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(r.uniforms=t.uniforms),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(r.vertexColors=t.vertexColors),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.shading&&(r.shading=t.shading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=e(t.map)),void 0!==t.alphaMap&&(r.alphaMap=e(t.alphaMap),r.transparent=!0),void 0!==t.bumpMap&&(r.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=e(t.normalMap)),void 0!==t.normalScale){var o=t.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=(new i).fromArray(o)}if(void 0!==t.displacementMap&&(r.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=e(t.specularMap)),void 0!==t.envMap&&(r.envMap=e(t.envMap)),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.lightMap&&(r.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=e(t.gradientMap)),void 0!==t.materials)for(var a=0,s=t.materials.length;a<s;a++)r.materials.push(this.parse(t.materials[a]));return r}}),Object.assign(Ki.prototype,{load:function(t,e,i,n){var r=this,o=new Mi(r.manager);o.load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new Pt,i=t.data.index,n={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==i){var r=new n[i.type](i.array);e.setIndex(new pt(r,1))}var o=t.data.attributes;for(var a in o){var s=o[a],r=new n[s.type](s.array);e.addAttribute(a,new pt(r,s.itemSize,s.normalized))}var u=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==u)for(var c=0,l=u.length;c!==l;++c){var f=u[c];e.addGroup(f.start,f.count,f.materialIndex)}var p=t.data.boundingSphere;if(void 0!==p){var d=new h;void 0!==p.center&&d.fromArray(p.center),e.boundingSphere=new tt(d,p.radius)}return e}}),$i.prototype={constructor:$i,crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:function(){var t,e,i,n={NoBlending:fo,NormalBlending:po,AdditiveBlending:mo,SubtractiveBlending:vo,MultiplyBlending:go,CustomBlending:yo};return function(r,o,a){function s(t,i,n,r,s){var u,c=o+t,l=$i.Handlers.get(c);null!==l?u=l.load(c):(e.setCrossOrigin(a),u=e.load(c)),void 0!==i&&(u.repeat.fromArray(i),1!==i[0]&&(u.wrapS=oa),1!==i[1]&&(u.wrapT=oa)),void 0!==n&&u.offset.fromArray(n),void 0!==r&&("repeat"===r[0]&&(u.wrapS=oa),"mirror"===r[0]&&(u.wrapS=sa),"repeat"===r[1]&&(u.wrapT=oa),"mirror"===r[1]&&(u.wrapT=sa)),void 0!==s&&(u.anisotropy=s);var f=ls.generateUUID();return h[f]=u,f}void 0===t&&(t=new W),void 0===e&&(e=new Pi),void 0===i&&(i=new Ji);var h={},u={uuid:ls.generateUUID(),type:"MeshLambertMaterial"};for(var c in r){var l=r[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=l;break;case"blending":u.blending=n[l];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":u.color=t.fromArray(l).getHex();break;case"colorSpecular":u.specular=t.fromArray(l).getHex();break;case"colorEmissive":u.emissive=t.fromArray(l).getHex();break;case"specularCoef":u.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(u.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(u.type="MeshPhongMaterial"),"standard"===l.toLowerCase()&&(u.type="MeshStandardMaterial");break;case"mapDiffuse":u.map=s(l,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":u.emissiveMap=s(l,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":u.lightMap=s(l,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=s(l,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=s(l,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=s(l,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=s(l,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":u.metalnessMap=s(l,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":u.roughnessMap=s(l,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":u.alphaMap=s(l,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=oo;break;case"doubleSided":u.side=ao;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),u.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":u[c]=l;break;case"vertexColors":l===!0&&(u.vertexColors=lo),"face"===l&&(u.vertexColors=co);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,l)}}return"MeshBasicMaterial"===u.type&&delete u.emissive,"MeshPhongMaterial"!==u.type&&delete u.specular,u.opacity<1&&(u.transparent=!0),i.setTextures(h),i.parse(u)}}()},$i.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],o=e[i+1];if(r.test(t))return o}return null}},Object.assign(tn.prototype,{load:function(t,e,i,n){var r=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:$i.prototype.extractUrlBase(t),a=new Mi(this.manager);a.setWithCredentials(this.withCredentials),a.load(t,function(i){var n=JSON.parse(i),a=n.metadata;if(void 0!==a){var s=a.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}}var h=r.parse(n,o);e(h.geometry,h.materials)},i,n)},setTexturePath:function(t){this.texturePath=t},parse:function(t,e){function n(e){function n(t,e){return t&1<<e}var r,o,a,s,c,l,f,p,d,m,v,g,y,x,_,b,M,w,E,S,T,P,L,A,C,R,I,O=t.faces,D=t.vertices,N=t.normals,U=t.colors,F=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&F++;for(r=0;r<F;r++)u.faceVertexUvs[r]=[]}for(s=0,c=D.length;s<c;)w=new h,w.x=D[s++]*e,w.y=D[s++]*e,w.z=D[s++]*e,u.vertices.push(w);for(s=0,c=O.length;s<c;)if(m=O[s++],v=n(m,0),g=n(m,1),y=n(m,3),x=n(m,4),_=n(m,5),b=n(m,6),M=n(m,7),v){if(S=new lt,S.a=O[s],S.b=O[s+1],S.c=O[s+3],T=new lt,T.a=O[s+1],T.b=O[s+2],T.c=O[s+3],s+=4,g&&(d=O[s++],S.materialIndex=d,T.materialIndex=d),a=u.faces.length,y)for(r=0;r<F;r++)for(A=t.uvs[r],u.faceVertexUvs[r][a]=[],u.faceVertexUvs[r][a+1]=[],o=0;o<4;o++)p=O[s++],R=A[2*p],I=A[2*p+1],C=new i(R,I),2!==o&&u.faceVertexUvs[r][a].push(C),0!==o&&u.faceVertexUvs[r][a+1].push(C);if(x&&(f=3*O[s++],S.normal.set(N[f++],N[f++],N[f]),T.normal.copy(S.normal)),_)for(r=0;r<4;r++)f=3*O[s++],L=new h(N[f++],N[f++],N[f]),2!==r&&S.vertexNormals.push(L),0!==r&&T.vertexNormals.push(L);if(b&&(l=O[s++],P=U[l],S.color.setHex(P),T.color.setHex(P)),M)for(r=0;r<4;r++)l=O[s++],P=U[l],2!==r&&S.vertexColors.push(new W(P)),0!==r&&T.vertexColors.push(new W(P));u.faces.push(S),u.faces.push(T)}else{if(E=new lt,E.a=O[s++],E.b=O[s++],E.c=O[s++],g&&(d=O[s++],E.materialIndex=d),a=u.faces.length,y)for(r=0;r<F;r++)for(A=t.uvs[r],u.faceVertexUvs[r][a]=[],o=0;o<3;o++)p=O[s++],R=A[2*p],I=A[2*p+1],C=new i(R,I),u.faceVertexUvs[r][a].push(C);if(x&&(f=3*O[s++],E.normal.set(N[f++],N[f++],N[f])),_)for(r=0;r<3;r++)f=3*O[s++],L=new h(N[f++],N[f++],N[f]),E.vertexNormals.push(L);if(b&&(l=O[s++],E.color.setHex(U[l])),M)for(r=0;r<3;r++)l=O[s++],E.vertexColors.push(new W(U[l]));u.faces.push(E)}}function o(){var e=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,n=t.skinWeights.length;i<n;i+=e){var o=t.skinWeights[i],a=e>1?t.skinWeights[i+1]:0,s=e>2?t.skinWeights[i+2]:0,h=e>3?t.skinWeights[i+3]:0;u.skinWeights.push(new r(o,a,s,h))}if(t.skinIndices)for(var i=0,n=t.skinIndices.length;i<n;i+=e){var c=t.skinIndices[i],l=e>1?t.skinIndices[i+1]:0,f=e>2?t.skinIndices[i+2]:0,p=e>3?t.skinIndices[i+3]:0;u.skinIndices.push(new r(c,l,f,p))}u.bones=t.bones,u.bones&&u.bones.length>0&&(u.skinWeights.length!==u.skinIndices.length||u.skinIndices.length!==u.vertices.length)&&console.warn("When skinning, number of vertices ("+u.vertices.length+"), skinIndices ("+u.skinIndices.length+"), and skinWeights ("+u.skinWeights.length+") should match.")}function a(e){if(void 0!==t.morphTargets)for(var i=0,n=t.morphTargets.length;i<n;i++){u.morphTargets[i]={},u.morphTargets[i].name=t.morphTargets[i].name,u.morphTargets[i].vertices=[];for(var r=u.morphTargets[i].vertices,o=t.morphTargets[i].vertices,a=0,s=o.length;a<s;a+=3){var c=new h;c.x=o[a]*e,c.y=o[a+1]*e,c.z=o[a+2]*e,r.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=u.faces,f=t.morphColors[0].colors,i=0,n=l.length;i<n;i++)l[i].color.fromArray(f,3*i)}}function s(){var e=[],i=[];void 0!==t.animation&&i.push(t.animation),void 0!==t.animations&&(t.animations.length?i=i.concat(t.animations):i.push(t.animations));for(var n=0;n<i.length;n++){var r=Qi.parseAnimation(i[n],u.bones);r&&e.push(r)}if(u.morphTargets){var o=Qi.CreateClipsFromMorphTargetSequences(u.morphTargets,10);e=e.concat(o)}e.length>0&&(u.animations=e)}var u=new Tt,c=void 0!==t.scale?1/t.scale:1;if(n(c),o(),a(c),s(),u.computeFaceNormals(),u.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:u};var l=$i.prototype.initMaterials(t.materials,e,this.crossOrigin);return{geometry:u,materials:l}}}),Object.assign(en.prototype,{load:function(t,e,i,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var r=this,o=new Mi(r.manager);o.load(t,function(i){var o=null;try{o=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;return void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase()?void console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead."):void r.parse(o,e)},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(a)}),r=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,r),a=this.parseObject(t.object,i,o);return t.animations&&(a.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(a),a},parseGeometries:function(t){var e={};if(void 0!==t)for(var i=new tn,n=new Ki,r=0,o=t.length;r<o;r++){var a,s=t[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Lu[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Lu[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Lu[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Lu[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Lu[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Lu[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":a=new Lu[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Lu[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Lu[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Lu[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Lu[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":a=n.parse(s);break;case"Geometry":a=i.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),e[s.uuid]=a}return e},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new Ji;n.setTextures(e);for(var r=0,o=t.length;r<o;r++){var a=n.parse(t[r]);i[a.uuid]=a}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=Qi.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){function i(t){return n.manager.itemStart(t),a.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t)})}var n=this,r={};if(void 0!==t&&t.length>0){var o=new bi(e),a=new Si(o);a.setCrossOrigin(this.crossOrigin);for(var s=0,h=t.length;s<h;s++){var u=t[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:n.texturePath+u.url;r[u.uuid]=i(c)}}return r},parseTextures:function(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={UVMapping:Jo,CubeReflectionMapping:Ko,CubeRefractionMapping:$o,EquirectangularReflectionMapping:ta,EquirectangularRefractionMapping:ea,SphericalReflectionMapping:ia,CubeUVReflectionMapping:na,CubeUVRefractionMapping:ra},o={RepeatWrapping:oa,ClampToEdgeWrapping:aa,MirroredRepeatWrapping:sa},a={NearestFilter:ha,NearestMipMapNearestFilter:ua,NearestMipMapLinearFilter:ca,LinearFilter:la,LinearMipMapNearestFilter:fa,LinearMipMapLinearFilter:pa},s={};if(void 0!==t)for(var h=0,u=t.length;h<u;h++){var c=t[h];void 0===c.image&&console.warn('THREE.ObjectLoader: No "image" specified for',c.uuid),void 0===e[c.image]&&console.warn("THREE.ObjectLoader: Undefined image",c.image);var l=new n(e[c.image]);l.needsUpdate=!0,l.uuid=c.uuid,void 0!==c.name&&(l.name=c.name),void 0!==c.mapping&&(l.mapping=i(c.mapping,r)),void 0!==c.offset&&l.offset.fromArray(c.offset),void 0!==c.repeat&&l.repeat.fromArray(c.repeat),void 0!==c.wrap&&(l.wrapS=i(c.wrap[0],o),l.wrapT=i(c.wrap[1],o)),void 0!==c.minFilter&&(l.minFilter=i(c.minFilter,a)),void 0!==c.magFilter&&(l.magFilter=i(c.magFilter,a)),void 0!==c.anisotropy&&(l.anisotropy=c.anisotropy),void 0!==c.flipY&&(l.flipY=c.flipY),s[c.uuid]=l}return s},parseObject:function(){var t=new u;return function(e,i,n){function r(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),i[t]}function o(t){if(void 0!==t)return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}var a;switch(e.type){case"Scene":a=new le,void 0!==e.background&&Number.isInteger(e.background)&&(a.background=new W(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new ce(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new ue(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new Dt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Nt(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":a=new Ui(e.color,e.intensity);break;case"DirectionalLight":a=new Ni(e.color,e.intensity);break;case"PointLight":a=new Oi(e.color,e.intensity,e.distance,e.decay);break;case"SpotLight":a=new Ii(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new Ai(e.color,e.groundColor,e.intensity);break;case"Mesh":var s=r(e.geometry),h=o(e.material);a=s.bones&&s.bones.length>0?new ye(s,h):new Lt(s,h);break;case"LOD":a=new me;break;case"Line":a=new _e(r(e.geometry),o(e.material),e.mode);break;case"LineSegments":a=new be(r(e.geometry),o(e.material));break;case"PointCloud":case"Points":a=new we(r(e.geometry),o(e.material));break;case"Sprite":a=new de(o(e.material));break;case"Group":a=new Ee;break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:a=new ht}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.children)for(var u in e.children)a.add(this.parseObject(e.children[u],i,n));if("LOD"===e.type)for(var c=e.levels,l=0;l<c.length;l++){var f=c[l],u=a.getObjectByProperty("uuid",f.object);void 0!==u&&a.addLevel(u,f.distance)}return a}}()}),pn.prototype={constructor:pn,getPoint:function(t){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(isNaN(t)&&(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),o+=e.distanceTo(r),n.push(o),r=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e?e:t*n[o-1];for(var a,s=0,h=o-1;s<=h;)if(r=Math.floor(s+(h-s)/2),a=n[r]-i,a<0)s=r+1;else{if(!(a>0)){h=r;break}h=r-1}if(r=h,n[r]===i){var u=r/(o-1);return u}var c=n[r],l=n[r+1],f=l-c,p=(i-c)/f,u=(r+p)/(o-1);return u},getTangent:function(t){var e=1e-4,i=t-e,n=t+e;i<0&&(i=0),n>1&&(n=1);var r=this.getPoint(i),o=this.getPoint(n),a=o.clone().sub(r);return a.normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,n,r,o=new h,a=[],s=[],c=[],l=new h,f=new u;for(i=0;i<=t;i++)n=i/t,a[i]=this.getTangentAt(n),a[i].normalize();s[0]=new h,c[0]=new h;var p=Number.MAX_VALUE,d=Math.abs(a[0].x),m=Math.abs(a[0].y),v=Math.abs(a[0].z);for(d<=p&&(p=d,o.set(1,0,0)),m<=p&&(p=m,o.set(0,1,0)),v<=p&&o.set(0,0,1),l.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],l),c[0].crossVectors(a[0],s[0]),i=1;i<=t;i++)s[i]=s[i-1].clone(),c[i]=c[i-1].clone(),l.crossVectors(a[i-1],a[i]),l.length()>Number.EPSILON&&(l.normalize(),r=Math.acos(ls.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(f.makeRotationAxis(l,r))),c[i].crossVectors(a[i],s[i]);if(e===!0)for(r=Math.acos(ls.clamp(s[0].dot(s[t]),-1,1)),r/=t,a[0].dot(l.crossVectors(s[0],s[t]))>0&&(r=-r),i=1;i<=t;i++)s[i].applyMatrix4(f.makeRotationAxis(a[i],r*i)),c[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:c}}},dn.prototype=Object.create(pn.prototype),dn.prototype.constructor=dn,dn.prototype.isLineCurve=!0,dn.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},dn.prototype.getPointAt=function(t){return this.getPoint(t)},dn.prototype.getTangent=function(t){var e=this.v2.clone().sub(this.v1);return e.normalize()},mn.prototype=Object.assign(Object.create(pn.prototype),{constructor:mn,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new dn(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,o=this.curves[n],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){isNaN(t)&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],n=0,r=this.curves;n<r.length;n++)for(var o=r[n],a=o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),h=0;h<s.length;h++){var u=s[h];e&&e.equals(u)||(i.push(u),e=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new Tt,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new h(r.x,r.y,r.z||0))}return e}}),vn.prototype=Object.create(pn.prototype),vn.prototype.constructor=vn,vn.prototype.isEllipseCurve=!0,vn.prototype.getPoint=function(t){for(var e=2*Math.PI,n=this.aEndAngle-this.aStartAngle,r=Math.abs(n)<Number.EPSILON;n<0;)n+=e;for(;n>e;)n-=e;n<Number.EPSILON&&(n=r?0:e),this.aClockwise!==!0||r||(n===e?n=-e:n-=e);var o=this.aStartAngle+t*n,a=this.aX+this.xRadius*Math.cos(o),s=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),c=a-this.aX,l=s-this.aY;a=c*h-l*u+this.aX,s=c*u+l*h+this.aY}return new i(a,s)},gn.prototype=Object.create(pn.prototype),gn.prototype.constructor=gn,gn.prototype.isSplineCurve=!0,gn.prototype.getPoint=function(t){var e=this.points,n=(e.length-1)*t,r=Math.floor(n),o=n-r,a=e[0===r?r:r-1],s=e[r],h=e[r>e.length-2?e.length-1:r+1],u=e[r>e.length-3?e.length-1:r+2];return new i(nn(o,a.x,s.x,h.x,u.x),nn(o,a.y,s.y,h.y,u.y))},yn.prototype=Object.create(pn.prototype),yn.prototype.constructor=yn,yn.prototype.getPoint=function(t){var e=this.v0,n=this.v1,r=this.v2,o=this.v3;return new i(fn(t,e.x,n.x,r.x,o.x),fn(t,e.y,n.y,r.y,o.y))},xn.prototype=Object.create(pn.prototype),xn.prototype.constructor=xn,xn.prototype.getPoint=function(t){var e=this.v0,n=this.v1,r=this.v2;return new i(sn(t,e.x,n.x,r.x),sn(t,e.y,n.y,r.y))};var Du=Object.assign(Object.create(mn.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var n=new dn(this.currentPoint.clone(),new i(t,e));this.curves.push(n),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,n,r){var o=new xn(this.currentPoint.clone(),new i(t,e),new i(n,r));this.curves.push(o),this.currentPoint.set(n,r)},bezierCurveTo:function(t,e,n,r,o,a){var s=new yn(this.currentPoint.clone(),new i(t,e),new i(n,r),new i(o,a));this.curves.push(s),this.currentPoint.set(o,a)},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),i=new gn(e);this.curves.push(i),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(t+a,e+s,i,n,r,o)},absarc:function(t,e,i,n,r,o){this.absellipse(t,e,i,i,n,r,o)},ellipse:function(t,e,i,n,r,o,a,s){var h=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(t+h,e+u,i,n,r,o,a,s)},absellipse:function(t,e,i,n,r,o,a,s){var h=new vn(t,e,i,n,r,o,a,s);if(this.curves.length>0){var u=h.getPoint(0);
u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(h);var c=h.getPoint(1);this.currentPoint.copy(c)}});_n.prototype=Du,Du.constructor=_n,bn.prototype=Object.assign(Object.create(Du),{constructor:bn,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}}),Mn.prototype={moveTo:function(t,e){this.currentPath=new _n,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,o){this.currentPath.bezierCurveTo(t,e,i,n,r,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],o=new bn;o.curves=r.curves,e.push(o)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,o=0;o<i;r=o++){var a=e[r],s=e[o],h=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=e[o],h=-h,s=e[r],u=-u),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var c=u*(t.x-a.x)-h*(t.y-a.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var r=Pu.isClockWise,o=this.subPaths;if(0===o.length)return[];if(e===!0)return i(o);var a,s,h,u=[];if(1===o.length)return s=o[0],h=new bn,h.curves=s.curves,u.push(h),u;var c=!r(o[0].getPoints());c=t?!c:c;var l,f=[],p=[],d=[],m=0;p[m]=void 0,d[m]=[];for(var v=0,g=o.length;v<g;v++)s=o[v],l=s.getPoints(),a=r(l),a=t?!a:a,a?(!c&&p[m]&&m++,p[m]={s:new bn,p:l},p[m].s.curves=s.curves,c&&m++,d[m]=[]):d[m].push({h:s,p:l[0]});if(!p[0])return i(o);if(p.length>1){for(var y=!1,x=[],_=0,b=p.length;_<b;_++)f[_]=[];for(var _=0,b=p.length;_<b;_++)for(var M=d[_],w=0;w<M.length;w++){for(var E=M[w],S=!0,T=0;T<p.length;T++)n(E.p,p[T].p)&&(_!==T&&x.push({froms:_,tos:T,hole:w}),S?(S=!1,f[T].push(E)):y=!0);S&&f[_].push(E)}x.length>0&&(y||(d=f))}for(var P,v=0,L=p.length;v<L;v++){h=p[v].s,u.push(h),P=d[v];for(var A=0,C=P.length;A<C;A++)h.holes.push(P[A].h)}return u}},Object.assign(wn.prototype,{isFont:!0,generateShapes:function(t,e,i){function n(t){for(var i=String(t).split(""),n=e/o.resolution,a=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*n,s=0,h=0,u=[],c=0;c<i.length;c++){var l=i[c];if("\n"===l)s=0,h-=a;else{var f=r(l,n,s,h);s+=f.offsetX,u.push(f.path)}}return u}function r(t,e,n,r){var a=o.glyphs[t]||o.glyphs["?"];if(a){var s,h,u,c,l,f,p,d,m,v,g,y=new Mn,x=[];if(a.o)for(var _=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),b=0,M=_.length;b<M;){var w=_[b++];switch(w){case"m":s=_[b++]*e+n,h=_[b++]*e+r,y.moveTo(s,h);break;case"l":s=_[b++]*e+n,h=_[b++]*e+r,y.lineTo(s,h);break;case"q":if(u=_[b++]*e+n,c=_[b++]*e+r,p=_[b++]*e+n,d=_[b++]*e+r,y.quadraticCurveTo(p,d,u,c),g=x[x.length-1]){l=g.x,f=g.y;for(var E=1;E<=i;E++){var S=E/i;sn(S,l,p,u),sn(S,f,d,c)}}break;case"b":if(u=_[b++]*e+n,c=_[b++]*e+r,p=_[b++]*e+n,d=_[b++]*e+r,m=_[b++]*e+n,v=_[b++]*e+r,y.bezierCurveTo(p,d,m,v,u,c),g=x[x.length-1]){l=g.x,f=g.y;for(var E=1;E<=i;E++){var S=E/i;fn(S,l,p,m,u),fn(S,f,d,v,c)}}}}return{offsetX:a.ha*e,path:y}}}void 0===e&&(e=100),void 0===i&&(i=4);for(var o=this.data,a=n(t),s=[],h=0,u=a.length;h<u;h++)Array.prototype.push.apply(s,a[h].toShapes());return s}}),Object.assign(En.prototype,{load:function(t,e,i,n){var r=this,o=new Mi(this.manager);o.load(t,function(t){var i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}var n=r.parse(i);e&&e(n)},i,n)},parse:function(t){return new wn(t)}});var Nu,Uu={getContext:function(){return void 0===Nu&&(Nu=new(window.AudioContext||window.webkitAudioContext)),Nu},setContext:function(t){Nu=t}};Object.assign(Sn.prototype,{load:function(t,e,i,n){var r=new Mi(this.manager);r.setResponseType("arraybuffer"),r.load(t,function(t){var i=Uu.getContext();i.decodeAudioData(t,function(t){e(t)})},i,n)}}),Tn.prototype=Object.assign(Object.create(Li.prototype),{constructor:Tn,isRectAreaLight:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this}}),Object.assign(Pn.prototype,{update:function(){var t,e,i,n,r,o,a,s=new u,h=new u;return function(u){var c=t!==this||e!==u.focus||i!==u.fov||n!==u.aspect*this.aspect||r!==u.near||o!==u.far||a!==u.zoom;if(c){t=this,e=u.focus,i=u.fov,n=u.aspect*this.aspect,r=u.near,o=u.far,a=u.zoom;var l,f,p=u.projectionMatrix.clone(),d=this.eyeSep/2,m=d*r/e,v=r*Math.tan(ls.DEG2RAD*i*.5)/a;h.elements[12]=-d,s.elements[12]=d,l=-v*n+m,f=v*n+m,p.elements[0]=2*r/(f-l),p.elements[8]=(f+l)/(f-l),this.cameraL.projectionMatrix.copy(p),l=-v*n-m,f=v*n-m,p.elements[0]=2*r/(f-l),p.elements[8]=(f+l)/(f-l),this.cameraR.projectionMatrix.copy(p)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(h),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(s)}}()}),Ln.prototype=Object.create(ht.prototype),Ln.prototype.constructor=Ln,An.prototype=Object.assign(Object.create(ht.prototype),{constructor:An,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new h,e=new s,i=new h,n=new h;return function(r){ht.prototype.updateMatrixWorld.call(this,r);var o=this.context.listener,a=this.up;this.matrixWorld.decompose(t,e,i),n.set(0,0,-1).applyQuaternion(e),o.positionX?(o.positionX.setValueAtTime(t.x,this.context.currentTime),o.positionY.setValueAtTime(t.y,this.context.currentTime),o.positionZ.setValueAtTime(t.z,this.context.currentTime),o.forwardX.setValueAtTime(n.x,this.context.currentTime),o.forwardY.setValueAtTime(n.y,this.context.currentTime),o.forwardZ.setValueAtTime(n.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,a.x,a.y,a.z))}}()}),Cn.prototype=Object.assign(Object.create(ht.prototype),{constructor:Cn,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.isPlaying=!0,this.source=t,this.connect()},pause:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this)},stop:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0,this.isPlaying=!1,this)},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),this.isPlaying===!0?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),Rn.prototype=Object.assign(Object.create(Cn.prototype),{constructor:Rn,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new h;return function(e){ht.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(In.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),On.prototype={constructor:On,accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)i[r+a]=i[a];o=e}else{o+=e;var s=e/o;this._mixBufferRegion(i,r,0,s,n)}this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,r<1){var a=3*e;this._mixBufferRegion(i,n,a,1-r,e)}for(var s=e,h=e+e;s!==h;++s)if(i[s]!==i[s+e]){o.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=3*i;t.getValue(e,n);for(var r=i,o=n;r!==o;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(n>=.5)for(var o=0;o!==r;++o)t[e+o]=t[i+o]},_slerp:function(t,e,i,n,r){s.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var o=1-n,a=0;a!==r;++a){var s=e+a;t[s]=t[s]*o+t[i+a]*n}}},Dn.prototype={constructor:Dn,getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=Dn.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("  trying to update node for track: "+this.path+" but it wasn't found.");if(i){var o=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("  can not bind to material as node does not have a material",this);if(!t.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[i])return void console.error("  can not bind to objectName of node, undefined",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,t);t=t[o]}}var s=t[n];if(void 0===s){var h=e.nodeName;return void console.error("  trying to update property for track: "+h+"."+n+" but it wasn't found.",t)}var u=this.Versioning.None;void 0!==t.needsUpdate?(u=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var c=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!t.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===r){r=a;break}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):void 0!==s.length?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(Dn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:Dn.prototype.getValue,_setValue_unbound:Dn.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.node[this.propertyName]=t[e]},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),Dn.Composite=function(t,e,i){var n=i||Dn.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)},Dn.Composite.prototype={constructor:Dn.Composite,getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Dn.create=function(t,e,i){return t&&t.isAnimationObjectGroup?new Dn.Composite(t,e,i):new Dn(t,e,i)},Dn.parseTrackName=function(t){var e=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/,i=e.exec(t);if(!i)throw new Error("cannot parse trackName at all: "+t);var n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]};if(null===n.propertyName||0===n.propertyName.length)throw new Error("can not parse propertyName from trackName: "+t);return n},Dn.findNode=function(t,e){if(!e||""===e||"root"===e||"."===e||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=function(t){for(var i=0;i<t.bones.length;i++){var n=t.bones[i];if(n.name===e)return n}return null},n=i(t.skeleton);if(n)return n}if(t.children){var r=function(t){for(var i=0;i<t.length;i++){var n=t[i];if(n.name===e||n.uuid===e)return n;var o=r(n.children);if(o)return o}return null},o=r(t.children);if(o)return o}return null},Nn.prototype={constructor:Nn,isAnimationObjectGroup:!0,add:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,h=s.length,u=0,c=arguments.length;u!==c;++u){var l=arguments[u],f=l.uuid,p=r[f],d=void 0;if(void 0===p){p=i++,r[f]=p,e.push(l);for(var m=0,v=h;m!==v;++m)s[m].push(new Dn(l,o[m],a[m]))}else if(p<n){d=e[p];var g=--n,y=e[g];r[y.uuid]=p,e[p]=y,r[f]=g,e[g]=l;for(var m=0,v=h;m!==v;++m){var x=s[m],_=x[g],b=x[p];x[p]=_,void 0===b&&(b=new Dn(l,o[m],a[m])),x[g]=b}}else e[p]!==d&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=n},remove:function(t){for(var e=this._objects,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var h=arguments[a],u=h.uuid,c=n[u];if(void 0!==c&&c>=i){var l=i++,f=e[l];n[f.uuid]=c,e[c]=f,n[u]=l,e[l]=h;for(var p=0,d=o;p!==d;++p){var m=r[p],v=m[l],g=m[c];m[c]=v,m[l]=g}}}this.nCachedObjects_=i},uncache:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,a=o.length,s=0,h=arguments.length;s!==h;++s){var u=arguments[s],c=u.uuid,l=r[c];if(void 0!==l)if(delete r[c],l<n){var f=--n,p=e[f],d=--i,m=e[d];r[p.uuid]=l,e[l]=p,r[m.uuid]=f,e[f]=m,e.pop();for(var v=0,g=a;v!==g;++v){var y=o[v],x=y[f],_=y[d];y[l]=x,y[f]=_,y.pop()}}else{var d=--i,m=e[d];r[m.uuid]=l,e[l]=m,e.pop();for(var v=0,g=a;v!==g;++v){var y=o[v];y[l]=y[d],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,a=this._parsedPaths,s=this._objects,h=s.length,u=this.nCachedObjects_,c=new Array(h);n=r.length,i[t]=n,o.push(t),a.push(e),r.push(c);for(var l=u,f=s.length;l!==f;++l){var p=s[l];c[l]=new Dn(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a],h=t[a];e[h]=i,o[i]=s,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}},Un.prototype={constructor:Un,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,o=r/n,a=n/r;t.warp(1,o,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,h=o.sampleValues;return s[0]=r,s[1]=r+i,h[0]=t/a,h[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){var r=this._startTime;if(null!==r){var o=(t-r)*i;if(o<0||0===i)return;this._startTime=null,e=i*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var h=this._interpolants,u=this._propertyBindings,c=0,l=h.length;c!==l;++c)h[c].evaluate(a),u[c].accumulate(n,s)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(n===Va){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=i)e=i;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var o=n===Wa;if(r===-1&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=i||e<0){var a=Math.floor(e/i);e-=i*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(0===s){var h=t<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1===(1&r))return this.time=e,i-e}return this.time=e,e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=Qa,n.endingEnd=Qa):(t?n.endingStart=this.zeroSlopeAtStart?Qa:Za:n.endingStart=Ja,e?n.endingEnd=this.zeroSlopeAtEnd?Qa:Za:n.endingEnd=Ja)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=e,a[1]=r+t,s[1]=i,this}},Fn.prototype={constructor:Fn,clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?Qi.findByName(i,t):t,o=null!==r?r.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var h=a.actionByRoot[n];if(void 0!==h)return h;s=a.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var u=new Un(this,r,e);return this._bindAction(u,s),this._addInactiveAction(u,o,n),u},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?Qi.findByName(i,t):t,o=r?r.uuid:t,a=this._actionsByClip[o];return void 0!==a?a.actionByRoot[n]||null:null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(var r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1,a=0;a!==i;++a){var s=e[a];s.enabled&&s._update(n,t,r,o)}for(var h=this._bindings,u=this._nActiveBindings,a=0;a!==u;++a)h[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var h=o[a];this._deactivateAction(h);var u=h._cacheIndex,c=e[e.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,c._cacheIndex=u,e[u]=c,e.pop(),this._removeInactiveBindingsForAction(h)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot,o=r[e];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var a=this._bindingsByRootAndName,s=a[e];if(void 0!==s)for(var h in s){var u=s[h];u.restoreOriginalState(),this._removeInactiveBinding(u)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Object.assign(Fn.prototype,{_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,o=t._propertyBindings,a=t._interpolants,s=i.uuid,h=this._bindingsByRootAndName,u=h[s];void 0===u&&(u={},h[s]=u);for(var c=0;c!==r;++c){var l=n[c],f=l.name,p=u[f];if(void 0!==p)o[c]=p;else{if(p=o[c],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,f));continue}var d=e&&e._propertyBindings[c].binding.parsedPath;p=new On(Dn.create(i,f,d),l.ValueTypeName,l.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,s,f),o[c]=p}a[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,h=s[s.length-1],u=t._byClipCacheIndex;h._byClipCacheIndex=u,s[u]=h,s.pop(),t._byClipCacheIndex=null;var c=a.actionByRoot,l=(e._localRoot||this._root).uuid;delete c[l],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],o=this._bindings;void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],h=t._cacheIndex;s._cacheIndex=h,e[h]=s,e.pop(),delete a[r];t:{for(var u in a)break t;delete o[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&(i=new Bi(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1)}),Object.assign(Fn.prototype,e.prototype),zn.prototype.clone=function(){return new zn(void 0===this.value.clone?this.value:this.value.clone())},Bn.prototype=Object.create(Pt.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isInstancedBufferGeometry=!0,Bn.prototype.addGroup=function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i})},Bn.prototype.copy=function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var o=t.groups,a=0,s=o.length;a<s;a++){var h=o[a];this.addGroup(h.start,h.count,h.materialIndex)}return this},Gn.prototype={constructor:Gn,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}},jn.prototype={constructor:jn,isInterleavedBuffer:!0,
set needsUpdate(t){t===!0&&this.version++},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}},kn.prototype=Object.create(jn.prototype),kn.prototype.constructor=kn,kn.prototype.isInstancedInterleavedBuffer=!0,kn.prototype.copy=function(t){return jn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},Vn.prototype=Object.create(pt.prototype),Vn.prototype.constructor=Vn,Vn.prototype.isInstancedBufferAttribute=!0,Vn.prototype.copy=function(t){return pt.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},Hn.prototype={constructor:Hn,linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var i=[];return qn(t,this,i,e),i.sort(Wn),i},intersectObjects:function(t,e){var i=[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)qn(t[n],this,i,e);return i.sort(Wn),i}},Xn.prototype={constructor:Xn,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=(performance||Date).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}},Yn.prototype={constructor:Yn,set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(ls.clamp(t.y/this.radius,-1,1))),this}},Zn.prototype={constructor:Zn,set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}},Qn.prototype=Object.create(Lt.prototype),Qn.prototype.constructor=Qn,Qn.prototype.createAnimation=function(t,e,i,n){var r={start:e,end:i,length:i-e+1,fps:n,duration:(i-e)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[t]=r,this.animationsList.push(r)},Qn.prototype.autoCreateAnimations=function(t){for(var e,i=/([a-z]+)_?(\d+)/i,n={},r=this.geometry,o=0,a=r.morphTargets.length;o<a;o++){var s=r.morphTargets[o],h=s.name.match(i);if(h&&h.length>1){var u=h[1];n[u]||(n[u]={start:1/0,end:-(1/0)});var c=n[u];o<c.start&&(c.start=o),o>c.end&&(c.end=o),e||(e=u)}}for(var u in n){var c=n[u];this.createAnimation(u,c.start,c.end,t)}this.firstAnimation=e},Qn.prototype.setAnimationDirectionForward=function(t){var e=this.animationsMap[t];e&&(e.direction=1,e.directionBackwards=!1)},Qn.prototype.setAnimationDirectionBackward=function(t){var e=this.animationsMap[t];e&&(e.direction=-1,e.directionBackwards=!0)},Qn.prototype.setAnimationFPS=function(t,e){var i=this.animationsMap[t];i&&(i.fps=e,i.duration=(i.end-i.start)/i.fps)},Qn.prototype.setAnimationDuration=function(t,e){var i=this.animationsMap[t];i&&(i.duration=e,i.fps=(i.end-i.start)/i.duration)},Qn.prototype.setAnimationWeight=function(t,e){var i=this.animationsMap[t];i&&(i.weight=e)},Qn.prototype.setAnimationTime=function(t,e){var i=this.animationsMap[t];i&&(i.time=e)},Qn.prototype.getAnimationTime=function(t){var e=0,i=this.animationsMap[t];return i&&(e=i.time),e},Qn.prototype.getAnimationDuration=function(t){var e=-1,i=this.animationsMap[t];return i&&(e=i.duration),e},Qn.prototype.playAnimation=function(t){var e=this.animationsMap[t];e?(e.time=0,e.active=!0):console.warn("THREE.MorphBlendMesh: animation["+t+"] undefined in .playAnimation()")},Qn.prototype.stopAnimation=function(t){var e=this.animationsMap[t];e&&(e.active=!1)},Qn.prototype.update=function(t){for(var e=0,i=this.animationsList.length;e<i;e++){var n=this.animationsList[e];if(n.active){var r=n.duration/n.length;n.time+=n.direction*t,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.start+ls.clamp(Math.floor(n.time/r),0,n.length-1),a=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var s=n.time%r/r;n.directionBackwards&&(s=1-s),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=s*a,this.morphTargetInfluences[n.lastFrame]=(1-s)*a):this.morphTargetInfluences[n.currentFrame]=a}}},Jn.prototype=Object.create(ht.prototype),Jn.prototype.constructor=Jn,Jn.prototype.isImmediateRenderObject=!0,Kn.prototype=Object.create(be.prototype),Kn.prototype.constructor=Kn,Kn.prototype.update=function(){var t=new h,e=new h,i=new et;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,h=a.faces,u=0,c=0,l=h.length;c<l;c++)for(var f=h[c],p=0,d=f.vertexNormals.length;p<d;p++){var m=s[f[n[p]]],v=f.vertexNormals[p];t.copy(m).applyMatrix4(r),e.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),u+=1,o.setXYZ(u,e.x,e.y,e.z),u+=1}else if(a&&a.isBufferGeometry)for(var g=a.attributes.position,y=a.attributes.normal,u=0,p=0,d=g.count;p<d;p++)t.set(g.getX(p),g.getY(p),g.getZ(p)).applyMatrix4(r),e.set(y.getX(p),y.getY(p),y.getZ(p)),e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),o.setXYZ(u,t.x,t.y,t.z),u+=1,o.setXYZ(u,e.x,e.y,e.z),u+=1;return o.needsUpdate=!0,this}}(),$n.prototype=Object.create(ht.prototype),$n.prototype.constructor=$n,$n.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},$n.prototype.update=function(){var t=new h,e=new h;return function(){var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),tr.prototype=Object.create(be.prototype),tr.prototype.constructor=tr,tr.prototype.getBoneList=function(t){var e=[];t&&t.isBone&&e.push(t);for(var i=0;i<t.children.length;i++)e.push.apply(e,this.getBoneList(t.children[i]));return e},tr.prototype.update=function(){var t=new h,e=new u,i=new u;return function(){var n=this.geometry,r=n.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var o=0,a=0;o<this.bones.length;o++){var s=this.bones[o];s.parent&&s.parent.isBone&&(e.multiplyMatrices(i,s.matrixWorld),t.setFromMatrixPosition(e),r.setXYZ(a,t.x,t.y,t.z),e.multiplyMatrices(i,s.parent.matrixWorld),t.setFromMatrixPosition(e),r.setXYZ(a+1,t.x,t.y,t.z),a+=2)}n.getAttribute("position").needsUpdate=!0}}(),er.prototype=Object.create(Lt.prototype),er.prototype.constructor=er,er.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},er.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},ir.prototype=Object.create(ht.prototype),ir.prototype.constructor=ir,ir.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},ir.prototype.update=function(){var t=new h,e=new h;return function(){var i=this.children[0],n=this.children[1];if(this.light.target){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld);var r=e.clone().sub(t);i.lookAt(r),n.lookAt(r)}i.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),n.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var o=.5*this.light.width,a=.5*this.light.height,s=i.geometry.getAttribute("position"),h=s.array;h[0]=o,h[1]=-a,h[2]=0,h[3]=o,h[4]=a,h[5]=0,h[6]=-o,h[7]=a,h[8]=0,h[9]=-o,h[10]=a,h[11]=0,h[12]=-o,h[13]=-a,h[14]=0,h[15]=o,h[16]=-a,h[17]=0,s.needsUpdate=!0}}(),nr.prototype=Object.create(ht.prototype),nr.prototype.constructor=nr,nr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},nr.prototype.update=function(){var t=new h,e=new W,i=new W;return function(){var n=this.children[0],r=n.geometry.getAttribute("color");e.copy(this.light.color).multiplyScalar(this.light.intensity),i.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var o=0,a=r.count;o<a;o++){var s=o<a/2?e:i;r.setXYZ(o,s.r,s.g,s.b)}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),r.needsUpdate=!0}}(),rr.prototype=Object.create(be.prototype),rr.prototype.constructor=rr,or.prototype=Object.create(be.prototype),or.prototype.constructor=or,ar.prototype=Object.create(be.prototype),ar.prototype.constructor=ar,ar.prototype.update=function(){var t=new h,e=new h,i=new et;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,h=0,u=0,c=s.length;u<c;u++){var l=s[u],f=l.normal;t.copy(a[l.a]).add(a[l.b]).add(a[l.c]).divideScalar(3).applyMatrix4(n),e.copy(f).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),r.setXYZ(h,t.x,t.y,t.z),h+=1,r.setXYZ(h,e.x,e.y,e.z),h+=1}return r.needsUpdate=!0,this}}(),sr.prototype=Object.create(ht.prototype),sr.prototype.constructor=sr,sr.prototype.dispose=function(){var t=this.children[0],e=this.children[1];t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()},sr.prototype.update=function(){var t=new h,e=new h,i=new h;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(e,t);var n=this.children[0],r=this.children[1];n.lookAt(i),n.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),r.lookAt(i),r.scale.z=i.length()}}(),hr.prototype=Object.create(be.prototype),hr.prototype.constructor=hr,hr.prototype.update=function(){function t(t,o,a,s){n.set(o,a,s).unproject(r);var h=i[t];if(void 0!==h)for(var u=e.getAttribute("position"),c=0,l=h.length;c<l;c++)u.setXYZ(h[c],n.x,n.y,n.z)}var e,i,n=new h,r=new Ot;return function(){e=this.geometry,i=this.pointMap;var n=1,o=1;r.projectionMatrix.copy(this.camera.projectionMatrix),t("c",0,0,-1),t("t",0,0,1),t("n1",-n,-o,-1),t("n2",n,-o,-1),t("n3",-n,o,-1),t("n4",n,o,-1),t("f1",-n,-o,1),t("f2",n,-o,1),t("f3",-n,o,1),t("f4",n,o,1),t("u1",.7*n,1.1*o,-1),t("u2",.7*-n,1.1*o,-1),t("u3",0,2*o,-1),t("cf1",-n,0,1),t("cf2",n,0,1),t("cf3",0,-o,1),t("cf4",0,o,1),t("cn1",-n,0,-1),t("cn2",n,0,-1),t("cn3",0,-o,-1),t("cn4",0,o,-1),e.getAttribute("position").needsUpdate=!0}}(),ur.prototype=Object.create(be.prototype),ur.prototype.constructor=ur,ur.prototype.update=function(){var t=new $;return function(e){if(e&&e.isBox3?t.copy(e):t.setFromObject(e),!t.isEmpty()){var i=t.min,n=t.max,r=this.geometry.attributes.position,o=r.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=i.x,o[4]=n.y,o[5]=n.z,o[6]=i.x,o[7]=i.y,o[8]=n.z,o[9]=n.x,o[10]=i.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=i.z,o[15]=i.x,o[16]=n.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=n.x,o[22]=i.y,o[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();var Fu,zu;cr.prototype=Object.create(ht.prototype),cr.prototype.constructor=cr,cr.prototype.setDirection=function(){var t,e=new h;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(i.z,0,-i.x).normalize(),t=Math.acos(i.y),this.quaternion.setFromAxisAngle(e,t))}}(),cr.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},cr.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},lr.prototype=Object.create(be.prototype),lr.prototype.constructor=lr;var Bu=new h,Gu=new fr,ju=new fr,ku=new fr;pr.prototype=Object.create(pn.prototype),pr.prototype.constructor=pr,pr.prototype.getPoint=function(t){var e=this.points,i=e.length;i<2&&console.log("duh, you need at least 2 points");var n=(i-(this.closed?0:1))*t,r=Math.floor(n),o=n-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/e.length)+1)*e.length:0===o&&r===i-1&&(r=i-2,o=1);var a,s,u,c;if(this.closed||r>0?a=e[(r-1)%i]:(Bu.subVectors(e[0],e[1]).add(e[0]),a=Bu),s=e[r%i],u=e[(r+1)%i],this.closed||r+2<i?c=e[(r+2)%i]:(Bu.subVectors(e[i-1],e[i-2]).add(e[i-1]),c=Bu),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var l="chordal"===this.type?.5:.25,f=Math.pow(a.distanceToSquared(s),l),p=Math.pow(s.distanceToSquared(u),l),d=Math.pow(u.distanceToSquared(c),l);p<1e-4&&(p=1),f<1e-4&&(f=p),d<1e-4&&(d=p),Gu.initNonuniformCatmullRom(a.x,s.x,u.x,c.x,f,p,d),ju.initNonuniformCatmullRom(a.y,s.y,u.y,c.y,f,p,d),ku.initNonuniformCatmullRom(a.z,s.z,u.z,c.z,f,p,d)}else if("catmullrom"===this.type){var m=void 0!==this.tension?this.tension:.5;Gu.initCatmullRom(a.x,s.x,u.x,c.x,m),ju.initCatmullRom(a.y,s.y,u.y,c.y,m),ku.initCatmullRom(a.z,s.z,u.z,c.z,m)}return new h(Gu.calc(o),ju.calc(o),ku.calc(o))},dr.prototype=Object.create(pn.prototype),dr.prototype.constructor=dr,dr.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new h(fn(t,e.x,i.x,n.x,r.x),fn(t,e.y,i.y,n.y,r.y),fn(t,e.z,i.z,n.z,r.z))},mr.prototype=Object.create(pn.prototype),mr.prototype.constructor=mr,mr.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new h(sn(t,e.x,i.x,n.x),sn(t,e.y,i.y,n.y),sn(t,e.z,i.z,n.z))},vr.prototype=Object.create(pn.prototype),vr.prototype.constructor=vr,vr.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new h;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e},gr.prototype=Object.create(vn.prototype),gr.prototype.constructor=gr;var Vu={createMultiMaterialObject:function(t,e){for(var i=new Ee,n=0,r=e.length;n<r;n++)i.add(new Lt(t,e[n]));return i},detach:function(t,e,i){t.applyMatrix(e.matrixWorld),e.remove(t),i.add(t)},attach:function(t,e,i){var n=new u;n.getInverse(i.matrixWorld),t.applyMatrix(n),e.remove(t),i.add(t)}},Hu=0,Wu=1;pn.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(pn.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Fr.prototype=Object.create(pr.prototype),zr.prototype=Object.create(pr.prototype),Br.prototype=Object.create(pr.prototype),Object.assign(Br.prototype,{initFromArray:function(t){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(t){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(t){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),rr.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(X.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign($.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),ut.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},ls.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(et.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(u.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new h),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(t)},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,o)}}),it.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},s.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(ot.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(bn.prototype,{extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ye(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ii(this,t)}}),Object.assign(i.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(h.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(r.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Tt.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(ht.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)}}),Object.defineProperties(ht.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(me.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Dt.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Li.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(pt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(Pt.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Pt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(zn.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Q.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new W}}}),Object.defineProperties(vi.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(J.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(he.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.");
}}),Object.defineProperties(he.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=t}}}),Object.defineProperties(rt.prototype,{cullFace:{get:function(){return this.renderReverseSided?Jr:Qr},set:function(t){var e=t!==Qr;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+e+"."),this.renderReverseSided=e}}}),Object.defineProperties(o.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Cn.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this,i=new Sn;return i.load(t,function(t){e.setBuffer(t)}),this},In.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var qu={merge:function(t,e,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var n;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},Xu={crossOrigin:void 0,loadTexture:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Pi;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadTextureCube:function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Ti;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,i,void 0,n);return e&&(o.mapping=e),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};t.WebGLRenderTargetCube=a,t.WebGLRenderTarget=o,t.WebGLRenderer=he,t.ShaderLib=Mu,t.UniformsLib=bu,t.UniformsUtils=ys,t.ShaderChunk=xu,t.FogExp2=ue,t.Fog=ce,t.Scene=le,t.LensFlare=fe,t.Sprite=de,t.LOD=me,t.SkinnedMesh=ye,t.Skeleton=ve,t.Bone=ge,t.Mesh=Lt,t.LineSegments=be,t.Line=_e,t.Points=we,t.Group=Ee,t.VideoTexture=Se,t.DataTexture=q,t.CompressedTexture=Te,t.CubeTexture=c,t.CanvasTexture=Pe,t.DepthTexture=Le,t.Texture=n,t.CompressedTextureLoader=wi,t.DataTextureLoader=Ei,t.CubeTextureLoader=Ti,t.TextureLoader=Pi,t.ObjectLoader=en,t.MaterialLoader=Ji,t.BufferGeometryLoader=Ki,t.DefaultLoadingManager=Ru,t.LoadingManager=bi,t.JSONLoader=tn,t.ImageLoader=Si,t.FontLoader=En,t.FileLoader=Mi,t.Loader=$i,t.Cache=Cu,t.AudioLoader=Sn,t.SpotLightShadow=Ri,t.SpotLight=Ii,t.PointLight=Oi,t.RectAreaLight=Tn,t.HemisphereLight=Ai,t.DirectionalLightShadow=Di,t.DirectionalLight=Ni,t.AmbientLight=Ui,t.LightShadow=Ci,t.Light=Li,t.StereoCamera=Pn,t.PerspectiveCamera=Dt,t.OrthographicCamera=Nt,t.CubeCamera=Ln,t.Camera=Ot,t.AudioListener=An,t.PositionalAudio=Rn,t.AudioContext=Uu,t.AudioAnalyser=In,t.Audio=Cn,t.VectorKeyframeTrack=ki,t.StringKeyframeTrack=qi,t.QuaternionKeyframeTrack=Hi,t.NumberKeyframeTrack=Wi,t.ColorKeyframeTrack=Yi,t.BooleanKeyframeTrack=Xi,t.PropertyMixer=On,t.PropertyBinding=Dn,t.KeyframeTrack=Zi,t.AnimationUtils=Iu,t.AnimationObjectGroup=Nn,t.AnimationMixer=Fn,t.AnimationClip=Qi,t.Uniform=zn,t.InstancedBufferGeometry=Bn,t.BufferGeometry=Pt,t.GeometryIdCount=St,t.Geometry=Tt,t.InterleavedBufferAttribute=Gn,t.InstancedInterleavedBuffer=kn,t.InterleavedBuffer=jn,t.InstancedBufferAttribute=Vn,t.Face3=lt,t.Object3D=ht,t.Raycaster=Hn,t.Layers=st,t.EventDispatcher=e,t.Clock=Xn,t.QuaternionLinearInterpolant=Vi,t.LinearInterpolant=Bi,t.DiscreteInterpolant=Gi,t.CubicInterpolant=zi,t.Interpolant=Fi,t.Triangle=ct,t.Math=ls,t.Spherical=Yn,t.Cylindrical=Zn,t.Plane=it,t.Frustum=nt,t.Sphere=tt,t.Ray=ot,t.Matrix4=u,t.Matrix3=et,t.Box3=$,t.Box2=X,t.Line3=ut,t.Euler=at,t.Vector4=r,t.Vector3=h,t.Vector2=i,t.Quaternion=s,t.Color=W,t.MorphBlendMesh=Qn,t.ImmediateRenderObject=Jn,t.VertexNormalsHelper=Kn,t.SpotLightHelper=$n,t.SkeletonHelper=tr,t.PointLightHelper=er,t.RectAreaLightHelper=ir,t.HemisphereLightHelper=nr,t.GridHelper=rr,t.PolarGridHelper=or,t.FaceNormalsHelper=ar,t.DirectionalLightHelper=sr,t.CameraHelper=hr,t.BoxHelper=ur,t.ArrowHelper=cr,t.AxisHelper=lr,t.CatmullRomCurve3=pr,t.CubicBezierCurve3=dr,t.QuadraticBezierCurve3=mr,t.LineCurve3=vr,t.ArcCurve=gr,t.EllipseCurve=vn,t.SplineCurve=gn,t.CubicBezierCurve=yn,t.QuadraticBezierCurve=xn,t.LineCurve=dn,t.Shape=bn,t.Path=_n,t.ShapePath=Mn,t.Font=wn,t.CurvePath=mn,t.Curve=pn,t.ShapeUtils=Pu,t.SceneUtils=Vu,t.WireframeGeometry=Ae,t.ParametricGeometry=Ce,t.ParametricBufferGeometry=Re,t.TetrahedronGeometry=De,t.TetrahedronBufferGeometry=Ne,t.OctahedronGeometry=Ue,t.OctahedronBufferGeometry=Fe,t.IcosahedronGeometry=ze,t.IcosahedronBufferGeometry=Be,t.DodecahedronGeometry=Ge,t.DodecahedronBufferGeometry=je,t.PolyhedronGeometry=Ie,t.PolyhedronBufferGeometry=Oe,t.TubeGeometry=ke,t.TubeBufferGeometry=Ve,t.TorusKnotGeometry=He,t.TorusKnotBufferGeometry=We,t.TorusGeometry=qe,t.TorusBufferGeometry=Xe,t.TextGeometry=Ze,t.SphereGeometry=Qe,t.SphereBufferGeometry=Je,t.RingGeometry=Ke,t.RingBufferGeometry=$e,t.PlaneGeometry=Rt,t.PlaneBufferGeometry=It,t.LatheGeometry=ti,t.LatheBufferGeometry=ei,t.ShapeGeometry=ii,t.ShapeBufferGeometry=ni,t.ExtrudeGeometry=Ye,t.EdgesGeometry=ri,t.ConeGeometry=si,t.ConeBufferGeometry=hi,t.CylinderGeometry=oi,t.CylinderBufferGeometry=ai,t.CircleGeometry=ui,t.CircleBufferGeometry=ci,t.BoxGeometry=At,t.BoxBufferGeometry=Ct,t.ShadowMaterial=li,t.SpriteMaterial=pe,t.RawShaderMaterial=fi,t.ShaderMaterial=J,t.PointsMaterial=Me,t.MultiMaterial=pi,t.MeshPhysicalMaterial=mi,t.MeshStandardMaterial=di,t.MeshPhongMaterial=vi,t.MeshToonMaterial=gi;t.MeshNormalMaterial=yi;t.MeshLambertMaterial=xi,t.MeshDepthMaterial=K,t.MeshBasicMaterial=ft,t.LineDashedMaterial=_i,t.LineBasicMaterial=xe,t.Material=Q,t.Float64BufferAttribute=Mt,t.Float32BufferAttribute=bt,t.Uint32BufferAttribute=_t,t.Int32BufferAttribute=xt,t.Uint16BufferAttribute=yt,t.Int16BufferAttribute=gt,t.Uint8ClampedBufferAttribute=vt,t.Uint8BufferAttribute=mt,t.Int8BufferAttribute=dt,t.BufferAttribute=pt,t.REVISION=Xr,t.MOUSE=Yr,t.CullFaceNone=Zr,t.CullFaceBack=Qr,t.CullFaceFront=Jr,t.CullFaceFrontBack=Kr,t.FrontFaceDirectionCW=$r,t.FrontFaceDirectionCCW=to,t.BasicShadowMap=eo,t.PCFShadowMap=io,t.PCFSoftShadowMap=no,t.FrontSide=ro,t.BackSide=oo,t.DoubleSide=ao,t.FlatShading=so,t.SmoothShading=ho,t.NoColors=uo,t.FaceColors=co,t.VertexColors=lo,t.NoBlending=fo,t.NormalBlending=po,t.AdditiveBlending=mo,t.SubtractiveBlending=vo,t.MultiplyBlending=go,t.CustomBlending=yo,t.AddEquation=xo,t.SubtractEquation=_o,t.ReverseSubtractEquation=bo,t.MinEquation=Mo,t.MaxEquation=wo,t.ZeroFactor=Eo,t.OneFactor=So,t.SrcColorFactor=To,t.OneMinusSrcColorFactor=Po,t.SrcAlphaFactor=Lo,t.OneMinusSrcAlphaFactor=Ao,t.DstAlphaFactor=Co,t.OneMinusDstAlphaFactor=Ro,t.DstColorFactor=Io,t.OneMinusDstColorFactor=Oo,t.SrcAlphaSaturateFactor=Do,t.NeverDepth=No,t.AlwaysDepth=Uo,t.LessDepth=Fo,t.LessEqualDepth=zo,t.EqualDepth=Bo,t.GreaterEqualDepth=Go,t.GreaterDepth=jo,t.NotEqualDepth=ko,t.MultiplyOperation=Vo,t.MixOperation=Ho,t.AddOperation=Wo,t.NoToneMapping=qo,t.LinearToneMapping=Xo,t.ReinhardToneMapping=Yo,t.Uncharted2ToneMapping=Zo,t.CineonToneMapping=Qo,t.UVMapping=Jo,t.CubeReflectionMapping=Ko,t.CubeRefractionMapping=$o,t.EquirectangularReflectionMapping=ta,t.EquirectangularRefractionMapping=ea,t.SphericalReflectionMapping=ia,t.CubeUVReflectionMapping=na,t.CubeUVRefractionMapping=ra,t.RepeatWrapping=oa,t.ClampToEdgeWrapping=aa,t.MirroredRepeatWrapping=sa,t.NearestFilter=ha,t.NearestMipMapNearestFilter=ua,t.NearestMipMapLinearFilter=ca,t.LinearFilter=la,t.LinearMipMapNearestFilter=fa,t.LinearMipMapLinearFilter=pa,t.UnsignedByteType=da,t.ByteType=ma,t.ShortType=va,t.UnsignedShortType=ga,t.IntType=ya,t.UnsignedIntType=xa,t.FloatType=_a,t.HalfFloatType=ba,t.UnsignedShort4444Type=Ma,t.UnsignedShort5551Type=wa,t.UnsignedShort565Type=Ea,t.UnsignedInt248Type=Sa,t.AlphaFormat=Ta,t.RGBFormat=Pa,t.RGBAFormat=La,t.LuminanceFormat=Aa,t.LuminanceAlphaFormat=Ca,t.RGBEFormat=Ra,t.DepthFormat=Ia,t.DepthStencilFormat=Oa,t.RGB_S3TC_DXT1_Format=Da,t.RGBA_S3TC_DXT1_Format=Na,t.RGBA_S3TC_DXT3_Format=Ua,t.RGBA_S3TC_DXT5_Format=Fa,t.RGB_PVRTC_4BPPV1_Format=za,t.RGB_PVRTC_2BPPV1_Format=Ba,t.RGBA_PVRTC_4BPPV1_Format=Ga,t.RGBA_PVRTC_2BPPV1_Format=ja,t.RGB_ETC1_Format=ka,t.LoopOnce=Va,t.LoopRepeat=Ha,t.LoopPingPong=Wa,t.InterpolateDiscrete=qa,t.InterpolateLinear=Xa,t.InterpolateSmooth=Ya,t.ZeroCurvatureEnding=Za,t.ZeroSlopeEnding=Qa,t.WrapAroundEnding=Ja,t.TrianglesDrawMode=Ka,t.TriangleStripDrawMode=$a,t.TriangleFanDrawMode=ts,t.LinearEncoding=es,t.sRGBEncoding=is,t.GammaEncoding=ns,t.RGBEEncoding=rs,t.LogLuvEncoding=os,t.RGBM7Encoding=as,t.RGBM16Encoding=ss,t.RGBDEncoding=hs,t.BasicDepthPacking=us,t.RGBADepthPacking=cs,t.CubeGeometry=At,t.Face4=yr,t.LineStrip=Hu,t.LinePieces=Wu,t.MeshFaceMaterial=xr,t.PointCloud=_r,t.Particle=br,t.ParticleSystem=Mr,t.PointCloudMaterial=wr,t.ParticleBasicMaterial=Er,t.ParticleSystemMaterial=Sr,t.Vertex=Tr,t.DynamicBufferAttribute=Pr,t.Int8Attribute=Lr,t.Uint8Attribute=Ar,t.Uint8ClampedAttribute=Cr,t.Int16Attribute=Rr,t.Uint16Attribute=Ir,t.Int32Attribute=Or,t.Uint32Attribute=Dr,t.Float32Attribute=Nr,t.Float64Attribute=Ur,t.ClosedSplineCurve3=Fr,t.SplineCurve3=zr,t.Spline=Br,t.BoundingBoxHelper=Gr,t.EdgesHelper=jr,t.WireframeHelper=kr,t.XHRLoader=Vr,t.BinaryTextureLoader=Hr,t.GeometryUtils=qu,t.ImageUtils=Xu,t.Projector=Wr,t.CanvasRenderer=qr,Object.defineProperty(t,"__esModule",{value:!0})})},function(t,e,i){t.exports={default:i(339),__esModule:!0}},function(t,e,i){var n=2*Math.PI,r=3.14159265359,o=i(38);t.exports=function(t){return Math.abs(t)<=r?t:t-o(t)*n}},function(t,e){var i=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=i)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){return{x:6378137,y:6356752.314245179,z:6378137}}function a(t){return"degrees"===t?L.DEGREE:"m"===t?L.METER:"radians"===t?L.RADIAN:void 0}function s(t){switch(t){case"EPSG:4326":return L.DEGREE;case"EPSG:4978":return L.METER;default:var e=M.default.defs(t);if(!e)return;return a(e.units)}}function h(t){var e=s(t);if(void 0===t||void 0===e)throw new Error("Invalid crs paramater value '"+t+"'");return e}function u(t){h(t)}function c(t){return h(t)!=L.METER}function l(t){return h(t)==L.METER}function f(t){if(!c(t))throw new Error("Can't query crs "+t+" long/lat")}function p(t){if(!l(t))throw new Error("Can't query crs "+t+" x/y/z")}function d(t,e){if(e!==t.crs){if("EPSG:4326"===t.crs&&"EPSG:4978"===e){var i=P.cartographicToCartesian(t);return new v(e,i.x,i.y,i.z)}if(t.crs in M.default.defs&&e in M.default.defs){var n=(0,M.default)(t.crs,e,[t._values[0],t._values[1]]);return new v(e,n[0],n[1],t._values[2])}throw new Error("Cannot convert from crs "+t.crs+" (unit="+t._internalStorageUnit+") to "+e)}var r=s(e);return t._internalStorageUnit==r?t:t._internalStorageUnit==L.DEGREE&&r==L.RADIAN?new(Function.prototype.bind.apply(v,[null].concat([e],(0,y.default)(t._values.map(function(t){return E.default.degToRad(t)}))))):t._internalStorageUnit==L.RADIAN&&r==L.DEGREE?new(Function.prototype.bind.apply(v,[null].concat([e],(0,y.default)(t._values.map(function(t){return E.default.radToDeg(t)}))))):void 0}function m(t,e,i){if(void 0==e||t==e)return i;if(t==L.DEGREE&&e==L.RADIAN)return E.default.degToRad(i);if(t==L.RADIAN&&e==L.DEGREE)return E.default.radToDeg(i);throw new Error("Cannot convert from unit "+t+" to "+e)}function v(t){h(t),this.crs=t,this._values=new Float64Array(3);for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var r=0;r<i.length&&r<3;r++)this._values[r]=i[r];for(var o=i.length;o<3;o++)this._values[o]=0;this._internalStorageUnit=s(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.C=e.UNIT=void 0;var g=i(287),y=r(g);e.ellipsoidSizes=o,e.crsToUnit=s,e.assertCrsIsValid=u,e.crsIsGeographic=c,e.crsIsGeocentric=l;var x=i(2),_=n(x),b=i(404),M=r(b),w=i(59),E=r(w),S=i(58),T=r(S),P=new T.default(o()),L=e.UNIT={RADIAN:0,DEGREE:1,METER:2};v.prototype.constructor=v,v.prototype.clone=function(){var t=new(Function.prototype.bind.apply(v,[null].concat([this.crs],(0,y.default)(this._values))));return t._internalStorageUnit=this._internalStorageUnit,t},v.prototype.longitude=function(t){return f(this.crs),m(this._internalStorageUnit,t,this._values[0])},v.prototype.latitude=function(t){return f(this.crs),m(this._internalStorageUnit,t,this._values[1])},v.prototype.altitude=function(){return f(this.crs),this._values[2]},v.prototype.x=function(){return p(this.crs),this._values[0]},v.prototype.y=function(){return p(this.crs),this._values[1]},v.prototype.z=function(){return p(this.crs),this._values[2]},v.prototype.xyz=function(){p(this.crs);var t=new _.Vector3;return t.fromArray(this._values),t},v.prototype.as=function(t){if(void 0===t||!s(t))throw new Error("Invalid crs paramater value '"+t+"'");return d(this,t)};e.C={EPSG_4326:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(v,[null].concat(["EPSG:4326"],e)))},EPSG_4326_Radians:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=new(Function.prototype.bind.apply(v,[null].concat(["EPSG:4326"],e)));return n._internalStorageUnit=L.RADIAN,n}};e.default=v},function(t,e,i){var n=i(75)("wks"),r=i(47),o=i(8).Symbol,a="function"==typeof o,s=t.exports=function(t){return n[t]||(n[t]=a&&o[t]||(a?o:r)("Symbol."+t))};s.store=n},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e,i){t.exports={default:i(344),__esModule:!0}},function(t,e,i){var n=i(8),r=i(5),o=i(16),a=i(17),s="prototype",h=function(t,e,i){var u,c,l,f=t&h.F,p=t&h.G,d=t&h.S,m=t&h.P,v=t&h.B,g=t&h.W,y=p?r:r[e]||(r[e]={}),x=y[s],_=p?n:d?n[e]:(n[e]||{})[s];p&&(i=e);for(u in i)c=!f&&_&&void 0!==_[u],c&&u in y||(l=c?_[u]:i[u],y[u]=p&&"function"!=typeof _[u]?i[u]:v&&c?o(l,n):g&&_[u]==l?function(t){var e=function(e,i,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,n)}return t.apply(this,arguments)};return e[s]=t[s],e}(l):m&&"function"==typeof l?o(Function.call,l):l,m&&((y.virtual||(y.virtual={}))[u]=l,t&h.R&&x&&!x[u]&&a(x,u,l)))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},function(t,e,i){var n=i(14),r=i(101),o=i(77),a=Object.defineProperty;e.f=i(12)?Object.defineProperty:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){t.exports=!i(21)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){t.exports={default:i(336),__esModule:!0}},function(t,e,i){var n=i(18);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(63),h=r(s),u=i(2),c=n(u),l=i(62),f=r(l),p=function(){f.default.call(this),c.Mesh.call(this),this.sse=0,this.pendingSubdivision=!1,this.content=new h.default,this.helper=void 0};p.prototype=(0,a.default)(c.Mesh.prototype),p.prototype.constructor=p,p.prototype.enableRTC=function(){},p.prototype.showHelper=function(t){void 0!==this.helper&&(this.helper.visible=t)},p.prototype.isVisible=function(){return this.visible},p.prototype.setVisibility=function(t){this.visible=t,this.showHelper(t),this.content.forEach(function(e){e.visible=t})},p.prototype.setDisplayed=function(t){this.material.visible=t,void 0!==this.helper&&this.helper.setMaterialVisibility(t),t&&this.content.forEach(function(t){t.visible=!0})},p.prototype.isDisplayed=function(){return this.material.visible},f.default.extend(p),e.default=p},function(t,e,i){var n=i(64);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var n=i(11),r=i(33);t.exports=i(12)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t.status<200||t.status>=300){var e=new Error("Error loading "+t.url+": status "+t.status);throw e.status=t.status,e}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(9),a=n(o),s=i(2),h=new s.TextureLoader;h.setCrossOrigin("anonymous"),e.default={json:function(t){return fetch(t).then(function(t){return r(t),t.json()})},xml:function(t){return fetch(t).then(function(t){return r(t),t.text()}).then(function(t){return(new window.DOMParser).parseFromString(t,"text/xml")})},texture:function t(e){var i=void 0,n=void 0,r=new a.default(function(t,e){i=t,n=e}),t=h.load(e,i,function(){},n);return{texture:t,promise:r}}}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){u.RawShaderMaterial.call(this),this.vertexShaderHeader="",this.fragmentShaderHeader="";var i=(0,l.default)().renderer.capabilities.logarithmicDepthBuffer;i&&(this.fragmentShaderHeader+="#extension GL_EXT_frag_depth : enable\n"),this.fragmentShaderHeader+="precision highp float;\n",this.fragmentShaderHeader+="precision highp int;\n",i&&(this.fragmentShaderHeader+="#define USE_LOGDEPTHBUF\n",this.fragmentShaderHeader+="#define USE_LOGDEPTHBUF_EXT\n",this.fragmentShaderHeader+=g.default),this.fragmentShaderHeader+="#define VERTEX_TEXTURES\n",this.vertexShaderHeader=this.fragmentShaderHeader,this.vertexShader=this.vertexShaderHeader+p.default,this.fragmentShader=this.fragmentShaderHeader+m.default,this.uniforms={diffuseColor:{value:t||new u.Color},useRTC:{value:!0},mVPMatRTC:{value:new u.Matrix4},distanceFog:{value:1e9},uuid:{value:0},debug:{value:!1},selected:{value:!1},lightingEnabled:{value:!0},opacity:{value:e||1},enabledCutColor:{value:!1}}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h),c=i(26),l=r(c),f=i(450),p=r(f),d=i(449),m=r(d),v=i(435),g=r(v);o.prototype=(0,s.default)(u.RawShaderMaterial.prototype),o.prototype.constructor=o,o.prototype.enableRTC=function(t){this.uniforms.useRTC.value=t},o.prototype.setDebug=function(t){this.uniforms.debug.value=t},o.prototype.setMatrixRTC=function(t){this.uniforms.mVPMatRTC.value=t},o.prototype.getMatrixRTC=function(){return this.uniforms.mVPMatRTC.value},o.prototype.setUuid=function(t){this.uniforms.uuid.value=t},o.prototype.getUuid=function(){return this.uniforms.uuid.value},o.prototype.setFogDistance=function(t){this.uniforms.distanceFog.value=t},o.prototype.setSelected=function(t){this.uniforms.selected.value=t},e.default=o},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var n=i(69),r=i(41);t.exports=function(t){return n(r(t))}},function(t,e){"use strict";function i(t){this.type=null,this._IoDriver=t}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.constructor=i,i.prototype.get=function(){},i.prototype.preprocessLayer=function(){},i.prototype.getInCache=function(){},e.default=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(){}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),s=r(a),h=i(90),u=n(h),c=i(59),l=n(c),f=i(6),p=n(f);o.prototype.WGS84ToY=function(t){return.5-Math.log(Math.tan(l.default.PI_OV_FOUR+.5*t))*l.default.INV_TWO_PI},o.prototype.WGS84ToOneSubY=function(t){return.5+Math.log(Math.tan(l.default.PI_OV_FOUR+.5*t))*l.default.INV_TWO_PI},o.prototype.WGS84LatitudeClamp=function(t){var e=-86/180*Math.PI,i=84/180*Math.PI;return t=Math.max(e,t),t=Math.min(i,t)},o.prototype.getCoordWMTS_WGS84=function(t,e,i){if("PM"===i)return this.WMTS_WGS84ToWMTS_PM(t,e);if("WGS84G"===i)return[t,t];throw new Error("Unsupported TileMatrixSet '"+i+"'")},o.prototype.getAllCoordsWMTS=function(t,e,i){var n=[];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=this.getCoordsWMTS(t,e,r));return n},o.prototype.getCoordsWMTS=function(t,e,i){for(var n=this.getCoordWMTS_WGS84(t,e,i),r=[],o=n[0].row;o<n[1].row+1;o++)r.push(new u.default(n[0].zoom,o,n[0].col));return r},o.prototype.WMTS_WGS84ToWMTS_PM=function(t,e){var i=[],n=t.zoom+1,r=Math.pow(2,n),o=1/r,a=this.WGS84ToY(this.WGS84LatitudeClamp(e.north(f.UNIT.RADIAN))),s=this.WGS84ToY(this.WGS84LatitudeClamp(e.south(f.UNIT.RADIAN))),h=void 0,c=a/o,l=s/o,p=Math.floor(c);h=Math.floor(l),l-h!==0&&h!==r||h--;var d=t.col,m=d;return i.push(new u.default(n,p,d)),i.push(new u.default(n,h,m)),i},o.prototype.WMTS_WGS84Parent=function(t,e,i){var n=t.zoom-e,r=Math.pow(2,n),o=1/r,a=(t.row-t.row%r)*o,s=(t.col-t.col%r)*o;return i.x=t.col*o-s,i.y=t.row*o-a,i.z=o,new u.default(e,a,s)},o.prototype.WMS_WGS84Parent=function(t,e){var i=t.dimensions(f.UNIT.RADIAN),n=e.dimensions(f.UNIT.RADIAN),r=i.x/n.x,o=Math.abs(t.west(f.UNIT.RADIAN)-e.west(f.UNIT.RADIAN))/n.x,a=Math.abs(t.south(f.UNIT.RADIAN)+i.y-(e.south(f.UNIT.RADIAN)+n.y))/n.y;return new s.Vector3(o,a,r)},o.prototype.WGS84toWMTS=function(t){var e=t.dimensions(f.UNIT.RADIAN),i=Math.floor(Math.log(l.default.PI/e.y)/l.default.LOG_TWO+.5),n=Math.pow(2,i),r=2*n,o=l.default.TWO_PI/r,a=l.default.PI/n,s=t.center(),h=Math.floor((l.default.PI+s.longitude(f.UNIT.RADIAN))%(2*Math.PI)/o),c=Math.floor(n-(l.default.PI_OV_TWO+s.latitude(f.UNIT.RADIAN))/a);return new u.default(i,c,h)},o.prototype.UnitaryToLongitudeWGS84=function(t,e){var i=e.dimensions(f.UNIT.RADIAN);return e.west(f.UNIT.RADIAN)+t*i.x},o.prototype.UnitaryToLatitudeWGS84=function(t,e){var i=e.dimensions(f.UNIT.RADIAN);return e.south(f.UNIT.RADIAN)+t*i.y},o.prototype.cartesianToGeo=function(t){var e=t.clone();e.x=t.x,e.y=t.z,e.z=t.y;var i=e.length(),n=6378137,r=6356752.314245179,o=Math.sqrt((n*n-r*r)/(n*n)),a=1-Math.sqrt(1-o*o),s=Math.sqrt(e.x*e.x+e.y*e.y),h=Math.atan2(e.y,e.x),u=Math.atan(e.z/s*(1-a+o*o*n/i)),c=Math.sin(u),l=Math.cos(u),f=Math.atan((e.z*(1-a)+o*o*n*c*c*c)/((1-a)*(s-o*o*n*l*l*l))),d=s*Math.cos(f)+e.z*Math.sin(f)-n*Math.sqrt(1-o*o*Math.sin(f)*Math.sin(f));return new p.default("EPSG:4326",-h,f,d)},o.prototype.wgs84_to_lambert93=function(t,e){var i=6378137,n=.08181919106,r=function(){},o=r(3),a=r(46.5),s=r(44),h=r(49),u=7e5,c=66e5,l=r(t),f=r(e),p=i/Math.sqrt(1-n*n*Math.sin(s)*Math.sin(s)),d=i/Math.sqrt(1-n*n*Math.sin(h)*Math.sin(h)),m=Math.log(Math.tan(Math.PI/4+s/2)*Math.pow((1-n*Math.sin(s))/(1+n*Math.sin(s)),n/2)),v=Math.log(Math.tan(Math.PI/4+h/2)*Math.pow((1-n*Math.sin(h))/(1+n*Math.sin(h)),n/2)),g=Math.log(Math.tan(Math.PI/4+a/2)*Math.pow((1-n*Math.sin(a))/(1+n*Math.sin(a)),n/2)),y=Math.log(Math.tan(Math.PI/4+l/2)*Math.pow((1-n*Math.sin(l))/(1+n*Math.sin(l)),n/2)),x=Math.log(d*Math.cos(h)/(p*Math.cos(s)))/(m-v),_=p*Math.cos(s)/x*Math.exp(x*m),b=c+_*Math.exp(-1*x*g),M=u+_*Math.exp(-1*x*y)*Math.sin(x*(f-o)),w=b-_*Math.exp(-1*x*y)*Math.cos(x*(f-o));return{x:M,y:w}},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t,e,i,n,r){var o=this;if(null!==y)throw new Error("Cannot instantiate more than one c3DEngine");var a=new m.default,h=!a.isInternetExplorer();if(this.gLDebug=r,this.viewerDiv=i,this.debug=n,this.scene3D=new s.Scene,this.scene3D.autoUpdate=!1,this.scene3D.sortObjects=!1,this.width=this.debug?.5*i.clientWidth:i.clientWidth,this.height=i.clientHeight,this.viewerDiv.size=new s.Vector2(this.width,this.height),this.camDebug=void 0,this.dnear=0,this.dfar=0,this.stateRender=g.default.FINAL,this.positionBuffer=null,this.camera=new l.default(this.width,this.height,this.debug),this.debug&&(this.camDebug=new s.PerspectiveCamera(30,this.camera.ratio)),this.pickingTexture=new s.WebGLRenderTarget(this.width,this.height),this.pickingTexture.texture.minFilter=s.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.renderScene=function(){if(this.camera.camHelper()&&(this.camera.camHelper().visible=!1),this.renderer.clear(),this.renderer.setViewport(0,0,this.width,this.height),this.renderer.render(this.scene3D,this.camera.camera3D),this.debug){this.enableRTC(!1),this.camera.camHelper().visible=!0;var t=this.controls.moveTarget(),e=this.camera.position(),i=(new s.Vector3).subVectors(e,t);i.setLength(2*i.length()),i.add(t),i.setLength(3*(i.length()-this.size)+this.size),this.camDebug.position.copy(i),this.camDebug.lookAt(t),this.camDebug.translateX(i.length()/2),this.camDebug.lookAt(t),this.renderer.setViewport(this.width,0,this.width,this.height),this.renderer.render(this.scene3D,this.camDebug),this.enableRTC(!0),this.camera.camHelper().visible=!1}}.bind(this),this.update=function(){this.camera.update(),this.updateControl(),this.scene.notifyChange(0,!0)}.bind(this),this.onWindowResize=function(){this.width=this.viewerDiv.clientWidth*(this.debug?.5:1),this.height=this.viewerDiv.clientHeight,this.viewerDiv.size.set(this.width,this.height),this.camera.resize(this.width,this.height),this.controls.updateCamera(this.camera),this.camDebug&&(this.camDebug.aspect=this.camera.ratio,this.camDebug.updateProjectionMatrix()),this.pickingTexture.setSize(this.width,this.height),this.renderer.setSize(this.viewerDiv.clientWidth,this.height),this.update()}.bind(this),this.scene=t,this.size=this.scene.size().x,this.camera.setPosition(e),this.camera.camera3D.near=2.333*this.size,this.camera.camera3D.far=10*this.size,this.camera.camera3D.updateProjectionMatrix(),this.camera.camera3D.updateMatrixWorld(!0),this.debug){this.camDebug.position.x=6*this.size,this.camDebug.lookAt(new s.Vector3(0,0,0)),this.camDebug.near=.1*this.size,this.camDebug.far=10*this.size,this.camDebug.updateProjectionMatrix(),this.camera.createCamHelper(),this.scene3D.add(this.camera.camHelper());var c=new s.AxisHelper(1.33*this.size);this.scene3D.add(c)}this.camera.camera3D.near=Math.max(15,2352e-9*this.size),this.camera.camera3D.updateProjectionMatrix();var f=document.createElement("canvas");f.id="canvasWebGL",this.renderer=new s.WebGLRenderer({canvas:f,antialias:!0,alpha:!0,logarithmicDepthBuffer:this.gLDebug||h}),this.renderer.setPixelRatio(i.devicePixelRatio),this.renderer.setSize(i.clientWidth,i.clientHeight),this.renderer.setClearColor(197896),this.renderer.autoClear=!1,i.appendChild(this.renderer.domElement),this.controls=new u.default(this.camera.camera3D,this.renderer.domElement,this),this.controls.rotateSpeed=.25,this.controls.zoomSpeed=2,this.controls.minDistance=30,this.controls.maxDistance=8*this.size,this.camera.update();var p=this.renderer.context,d=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS),v=p.getExtension("WEBGL_debug_renderer_info");if(null!==v){var x=p.getParameter(v.UNMASKED_VENDOR_WEBGL);(x.indexOf("mesa")>-1||x.indexOf("Mesa")>-1)&&(d=Math.min(16,d))}else d=Math.min(16,d);this.glParams={maxTexturesUnits:d},window.addEventListener("resize",this.onWindowResize,!1),this.controls.addEventListener("change",this.update),this.renderer.domElement.addEventListener("selectClick",function(t){o.selectNodeAt(t.mouse),o.update()},!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i,n,r){return y=y||new o(t,e,i,n,r)};var a=i(2),s=r(a),h=i(264),u=n(h),c=i(256),l=n(c),f=i(60),p=n(f),d=i(91),m=n(d),v=i(61),g=n(v),y=null;o.prototype.updateControl=function(){var t=this.camera.position().length(),e=1.1*this.size;if(t<e){var i=Math.pow(Math.cos((e-t)/(e-.9981*this.size)*Math.PI*.5),1.5),n=new s.Color(9688568);this.renderer.setClearColor(n.multiplyScalar(1-i))}else t>=e&&this.renderer.setClearColor(197896)},o.prototype.enableRTC=function(t){for(var e=0;e<this.scene3D.children.length;e++){var i=this.scene3D.children[e];i instanceof p.default?i.visible=t:i.enableRTC&&i.traverseVisible(t?this.rtcOn.bind(this):this.rtcOff.bind(this))}},o.prototype.changeStateNodesScene=function(t){
for(var e=function(){return function(e){e.changeState(t)}}(),i=t===g.default.FINAL,n=0;n<this.scene3D.children.length;n++){var r=this.scene3D.children[n];r.changeState?r.traverseVisible(e):r.layer&&(r.visible=!!i&&r.layer.visible)}},o.prototype.rtcOn=function(t){t.enableRTC(!0),t.matrixAutoUpdate=!1},o.prototype.rtcOff=function(t){t.enableRTC(!1),t.matrixWorldNeedsUpdate=!0,t.matrixAutoUpdate=!0},o.prototype.style2Engine=function(){},o.prototype.setTexture=function(t,e){t.material=new s.MeshBasicMaterial({color:16777215,map:e})},o.prototype.add3DScene=function(t){Array.isArray(t)?this.scene3D.add.apply(this.scene3D,t):this.scene3D.add(t)},o.prototype.removeAll=function(){this.scene3D.children=[]},o.prototype.precision=function(){},o.prototype.getWindowSize=function(){return new s.Vector2(this.width,this.height)},o.prototype.getRenderer=function(){return this.renderer},o.prototype.setStateRender=function(t){this.stateRender!==t&&(this.stateRender=t,this.changeStateNodesScene(t))},o.prototype.renderTobuffer=function(t,e,i,n,r){var o=this.stateRender;this.setStateRender(r),this.renderer.clear(),this.renderer.setViewport(t,e,i,n),this.renderer.render(this.scene3D,this.camera.camera3D,this.pickingTexture),this.setStateRender(o);var a=new Uint8Array(4);return this.renderer.readRenderTargetPixels(this.pickingTexture,t,e,i,n,a),a},o.prototype.bufferToImage=function(t,e,i){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=e,n.height=i;var o=r.getImageData(0,0,e,i);o.data.set(t),r.putImageData(o,0,0);var a=new Image;return a.src=n.toDataURL(),a},o.prototype.updatePositionBuffer=function(){this.camera.camera3D.updateMatrixWorld(),this.positionBuffer=this.renderTobuffer(0,0,this.width,this.height,g.default.DEPTH),this.renderScene()},o.prototype.pickingInPositionBuffer=function(t,e){null===this.positionBuffer&&this.updatePositionBuffer(),void 0===t&&(t=new s.Vector2(Math.floor(this.width/2),Math.floor(this.height/2)));var i=new s.Vector2(t.x,this.height-t.y),n=4*(i.y*this.width+i.x);e&&e.selectNodeId(this.positionBuffer[n+3]);var r=new s.Vector3(this.positionBuffer[n+0],this.positionBuffer[n+1],this.positionBuffer[n+2]),o=r.applyMatrix4(this.camera.camera3D.matrixWorld);return o},o.prototype.getPickingPosition=function(t,e){void 0===t&&(t=new s.Vector2(Math.floor(this.width/2),Math.floor(this.height/2)));var i=this.camera.camera3D;i.updateMatrixWorld();var n=this.renderTobuffer(t.x,this.height-t.y,1,1,g.default.DEPTH),r=(new s.Vector3).fromArray(n);e&&e.selectNodeId(n[3]);var o=r.applyMatrix4(i.matrixWorld);if(!(o.length()>1e7))return o};var x=function(t,e){var i=new s.Vector4(1/16777216,1/65536,1/256,1);return i.dot(t)*e};o.prototype.screenCoordsToNodeId=function(t){var e=this.camera.camera3D;e.updateMatrixWorld();var i=this.renderTobuffer(t.x,this.height-t.y,1,1,g.default.ID),n=(new s.Vector4).fromArray(i).divideScalar(255),r=x(n,1e4);return Math.round(r)},o.prototype.selectNodeAt=function(t){this.scene.selectNodeId(this.screenCoordsToNodeId(t))},o.prototype.getPickingPositionFromDepth=function(){var t=new s.Matrix4;t.elements=new Float64Array(16);var e=new s.Vector2,i=new s.Vector3,n=new s.Ray,r=new s.Vector3,o=new s.Vector4;return function(a){void 0===a&&(a=new s.Vector2(Math.floor(this.width/2),Math.floor(this.height/2)));var h=this.camera.camera3D;h.updateMatrixWorld();var u=this.renderTobuffer(a.x,this.height-a.y,1,1,g.default.DEPTH);e.x=a.x/this.width*2-1,e.y=2*-(a.y/this.height)+1,h.matrixWorld.setPosition(h.position),n.origin.copy(h.position),n.direction.set(e.x,e.y,.5),t.multiplyMatrices(h.matrixWorld,t.getInverse(h.projectionMatrix)),n.direction.applyMatrix4(t),n.direction.sub(n.origin),r.set(0,0,1),r.applyMatrix4(t),r.sub(n.origin);var c=r.angleTo(n.direction);o.fromArray(u).divideScalar(255);var l=x(o,1e8)/Math.cos(c);if(i.addVectors(h.position,n.direction.setLength(l)),!(i.length()>1e7))return i}}(),o.prototype.placeDummy=function(t,e){t.position.copy(e);var i=e.clone().sub(this.camera.position()).length()/200;t.scale.copy(new s.Vector3(i,i,i)),t.lookAt(new s.Vector3),t.quaternion.multiply((new s.Quaternion).setFromAxisAngle(new s.Vector3(1,0,0),-Math.PI/2)),t.translateY(i),t.updateMatrix(),t.updateMatrixWorld()},o.prototype.getRTCMatrixFromCenter=function(){var t=new s.Vector3,e=new s.Matrix4;return function(i,n){return t.subVectors(n.camera3D.position,i),e.copy(n.camera3D.matrixWorld),e.setPosition(t),e.getInverse(e),(new s.Matrix4).multiplyMatrices(n.camera3D.projectionMatrix,e)}}(),o.prototype.getRTCMatrixFromNode=function(t,e){var i=e.camera3D,n=(new s.Vector3).setFromMatrixPosition(t.matrixWorld),r=(new s.Vector3).subVectors(i.position,n),o=(new s.Quaternion).copy(i.quaternion),a=(new s.Matrix4).compose(r,o,new s.Vector3(1,1,1)),h=(new s.Matrix4).getInverse(a),u=t.matrixWorld.clone().setPosition(new s.Vector3);h.multiply(u);var c=(new s.Vector4).applyMatrix4(h),l=h.setPosition(c);return(new s.Matrix4).multiplyMatrices(i.projectionMatrix,l)};var _=new s.Vector2;o.prototype.getPickObject3d=function(t,e){_.x=t.x/this.width*2-1,_.y=2*-(t.y/this.height)+1;var i=new s.Raycaster,n=this.camera.camera3D;return i.setFromCamera(_,n),i.intersectObjects(e,!0)}},function(t,e,i){var n=i(110),r=i(68);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(41);t.exports=function(t){return Object(n(t))}},function(t,e){t.exports=function(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){l.default.call(this),this.descriManager=null,this.projection=new p.default,this.id=o.count++}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h),c=i(62),l=r(c),f=i(25),p=r(f),d=i(15),m=r(d);o.count=0,o.prototype=(0,s.default)(l.default.prototype),o.prototype.constructor=o,o.prototype.getMesh=function(){for(var t=[],e=0;e<this.children.length;e++){var i=this.children[e];i instanceof m.default||i instanceof u.Mesh||i instanceof u.Object3D?t.push(i):i instanceof o&&(t=t.concat(i.getMesh()))}return t},e.default=o},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e){t.exports={}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,i){var n=i(11).f,r=i(22),o=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e})}},function(t,e,i){"use strict";var n=i(367)(!0);i(70)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){var n=Math.PI/2,r=i(38);t.exports=function(t){return Math.abs(t)<n?t:t-r(t)*Math.PI}},function(t,e){t.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},function(t,e){t.exports=function(t){return t<0?-1:1}},function(t,e){"use strict";function i(){this.cacheObjects=[],this._maximumSize=null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return n=n||new i};var n=null;i.prototype.getRessource=function(t){return this.cacheObjects[t]},i.prototype.addRessource=function(t,e){this.cacheObjects[t]=e},i.prototype.getRessourceByID=function(){}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t,e,i,n,r,o,a){(0,h.assertCrsIsValid)(t),this.minCoordinate=new u.default(t,e,n,o||0),this.maxCoordinate=new u.default(t,i,r,a||0)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),s=r(a),h=i(6),u=n(h);o.prototype.as=function(t){var e=this.minCoordinate.as(t),i=this.maxCoordinate.as(t);return new o(t,e._values[0],i._values[0],e._values[1],i._values[1],e._values[2],i._values[2])},o.prototype.west=function(t){return(0,h.crsIsGeographic)(this.crs())?this.minCoordinate.longitude(t):this.minCoordinate.x()},o.prototype.east=function(t){return(0,h.crsIsGeographic)(this.crs())?this.maxCoordinate.longitude(t):this.maxCoordinate.x()},o.prototype.north=function(t){return(0,h.crsIsGeographic)(this.crs())?this.maxCoordinate.latitude(t):this.maxCoordinate.y()},o.prototype.south=function(t){return(0,h.crsIsGeographic)(this.crs())?this.minCoordinate.latitude(t):this.minCoordinate.y()},o.prototype.top=function(){return(0,h.crsIsGeographic)(this.crs())?this.maxCoordinate.altitude():this.maxCoordinate.z()},o.prototype.bottom=function(){return(0,h.crsIsGeographic)(this.crs())?this.minCoordinate.altitude():this.minCoordinate.z()},o.prototype.crs=function(){return this.minCoordinate.crs},o.prototype.center=function(){var t=this.minCoordinate.clone(),e=this.dimensions();return t._values[0]+=.5*e.x,t._values[1]+=.5*e.y,t._values[2]+=.5*e.z,t},o.prototype.dimensions=function(t){return{x:Math.abs(this.east(t)-this.west(t)),y:Math.abs(this.north(t)-this.south(t)),z:Math.abs(this.top()-this.bottom())}},o.prototype.isInside=function(t){var e=this.crs()==t.crs?t:t.as(this.crs());return(0,h.crsIsGeographic)(this.crs())?e.longitude()<=this.east()&&e.longitude()>=this.west()&&e.latitude()<=this.north()&&e.latitude()>=this.south():e.x()<=this.east()&&e.x()>=this.west()&&e.y()<=this.north()&&e.y()>=this.south()},o.prototype.BBoxIsInside=function(t){var e=(0,h.crsToUnit)(this.crs());return t.east(e)<=this.east()&&t.west(e)>=this.west()&&t.north(e)<=this.north()&&t.south(e)>=this.south()},o.prototype.offsetScale=function(t){if(t.crs()!=this.crs())throw new Error("unsupported offscale between 2 diff crs");var e=Math.abs(t.west()-this.west())/this._dimension.x,i=Math.abs(t.north()-this.north())/this._dimension.y,n=t._dimension.x/this._dimension.x;return new s.Vector3(e,i,n)},o.prototype.setBBoxZ=function(t,e){this.minCoordinate._values[2]=t,this.maxCoordinate._values[2]=e},o.prototype.intersect=function(t){var e=t.crs()==this.crs()?t:t.as(this.crs());return!(this.west()>=e.east()||this.east()<=e.west()||this.south()>=e.north()||this.north()<=e.south())},e.default=o},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var n=i(16),r=i(104),o=i(102),a=i(14),s=i(46),h=i(80),u={},c={},e=t.exports=function(t,e,i,l,f){var p,d,m,v,g=f?function(){return t}:h(t),y=n(i,l,e?2:1),x=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(p=s(t.length);p>x;x++)if(v=e?y(a(d=t[x])[0],d[1]):y(t[x]),v===u||v===c)return v}else for(m=g.call(t);!(d=m.next()).done;)if(v=r(m,y,d.value,e),v===u||v===c)return v};e.BREAK=u,e.RETURN=c},function(t,e){t.exports=!0},function(t,e,i){var n=i(14),r=i(363),o=i(68),a=i(74)("IE_PROTO"),s=function(){},h="prototype",u=function(){var t,e=i(67)("iframe"),n=o.length,r="<",a=">";for(e.style.display="none",i(100).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(r+"script"+a+"document.F=Object"+r+"/script"+a),t.close(),u=t.F;n--;)delete u[h][o[n]];return u()};t.exports=Object.create||function(t,e){var i;return null!==t?(s[h]=n(t),i=new s,s[h]=null,i[a]=t):i=u(),void 0===e?i:r(i,e)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var n=i(76),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e,i){i(371);for(var n=i(8),r=i(17),o=i(32),a=i(7)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],h=0;h<5;h++){var u=s[h],c=n[u],l=c&&c.prototype;l&&!l[a]&&r(l,a,u),o[u]=o.Array}},function(t,e){(function(e){function i(){try{var t=new n("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}return!1}var n=e.CustomEvent;t.exports=i()?n:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,e){var i=document.createEvent("CustomEvent");return e?i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):i.initCustomEvent(t,!1,!1,void 0),i}:function(t,e){var i=document.createEventObject();return i.type=t,e?(i.bubbles=Boolean(e.bubbles),i.cancelable=Boolean(e.cancelable),i.detail=e.detail):(i.bubbles=!1,i.cancelable=!1,i.detail=void 0),i}}).call(e,function(){return this}())},function(t,e){t.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},function(t,e){t.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},function(t,e){t.exports=function(t){return.05859375*t*t*(1+.75*t)}},function(t,e){t.exports=function(t){return t*t*t*(35/3072)}},function(t,e){t.exports=function(t,e,i,n,r){return t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)}},function(t,e){var i=Math.PI/2;t.exports=function(t,e){for(var n,r,o=.5*t,a=i-2*Math.atan(e),s=0;s<=15;s++)if(n=t*Math.sin(a),r=i-2*Math.atan(e*Math.pow((1-n)/(1+n),o))-a,a+=r,Math.abs(r)<=1e-10)return a;return-9999}},function(t,e){var i=Math.PI/2;t.exports=function(t,e,n){var r=t*n,o=.5*t;return r=Math.pow((1-r)/(1+r),o),Math.tan(.5*(i-e))/r}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){return{storage:new d.default({comparator:function(t,e){var i=e.priority-t.priority;return 0===i?e.timestamp-t.timestamp:i}}),counters:{executing:0,executed:0,failed:0,cancelled:0},execute:function(t,e,i){var n=this;i||this.counters.executing++;var r=e.executeCommand(t)||f.default.resolve();return r.then(function(e){n.counters.executing--,t.resolve(e),n.counters.executed++},function(e){n.counters.executing--,t.reject(e),n.counters.failed++})}}}function o(t){if(null!==g)throw new Error("Cannot instantiate more than one Scheduler");if(this.defaultQueue=r(),this.hostQueues=new c.default,this.providers={},this.eventsManager=new v.default,this.maxConcurrentCommands=16,this.maxCommandsPerHost=6,!t)throw new Error("Cannot instantiate Scheduler without scene");this.scene=t}function a(t){this.command=t}Object.defineProperty(e,"__esModule",{value:!0}),e.CancelledCommandException=void 0;var s=i(13),h=n(s),u=i(63),c=n(u),l=i(9),f=n(l);e.default=function(t){return g=g||new o(t)};var p=i(385),d=n(p),m=i(237),v=n(m),g=null;o.prototype.constructor=o,o.prototype.runCommand=function(t,e,i){var n=this,r=this.providers[t.layer.protocol];if(!r)throw new Error("No known provider for layer",t.layer.id);e.execute(t,r,i).then(function(){if(n.scene.notifyChange(100,!("redraw"in t)||t.redraw),e.counters.executing<n.maxCommandsPerHost){var i=n.deQueue(e);if(i)return n.runCommand(i,e)}})},o.prototype.execute=function(t){var e=t.layer,i=e.url?new URL(e.url).host:void 0;t.promise=new f.default(function(e,i){t.resolve=e,t.reject=i}),i&&!this.hostQueues.has(i)&&this.hostQueues.set(i,r());var n=i?this.hostQueues.get(i):this.defaultQueue;if(n.counters.executing<this.maxCommandsPerHost){n.counters.executing++;var o=function(){this.runCommand(t,n,!0)}.bind(this);window.setTimeout(o,0)}else t.timestamp=Date.now(),n.storage.queue(t);return t.promise},o.prototype.addProtocolProvider=function(t,e){this.providers[t]=e},o.prototype.getProtocolProvider=function(t){return this.providers[t]},o.prototype.commandsWaitingExecutionCount=function(){var t=this.defaultQueue.storage.length+this.defaultQueue.counters.executing,e=!0,i=!1,n=void 0;try{for(var r,o=(0,h.default)(this.hostQueues);!(e=(r=o.next()).done);e=!0){var a=r.value;t+=a[1].storage.length+a[1].counters.executing}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}return t},o.prototype.commandsRunningCount=function(){var t=this.defaultQueue.counters.executing,e=!0,i=!1,n=void 0;try{for(var r,o=(0,h.default)(this.hostQueues);!(e=(r=o.next()).done);e=!0){var a=r.value;t+=a[1].counters.executing}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}return t},o.prototype.resetCommandsCount=function(t){var e=this.defaultQueue.counters[t];this.defaultQueue.counters[t]=0;var i=!0,n=!1,r=void 0;try{for(var o,a=(0,h.default)(this.hostQueues);!(i=(o=a.next()).done);i=!0){var s=o.value;e+=s[1].counters[t],s[1].counters[t]=0}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e},o.prototype.getProviders=function(){return this.providers.slice()},a.prototype.toString=function(){return"Cancelled command "+this.command.requester.id+"/"+this.command.layer.id},o.prototype.deQueue=function(t){for(var e=t.storage;e.length>0;){var i=e.dequeue();if(!i.earlyDropFunction||!i.earlyDropFunction(i))return i;t.counters.cancelled++,i.reject(new a(i))}},o.prototype.wait=function(){this.eventsManager.wait()},e.CancelledCommandException=a},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){this.rayon_1=t.x,this.rayon_2=t.y,this.rayon_3=t.z,this.size=new a.Vector3(t.x,t.y,t.z),this._radiiSquared=new a.Vector3(t.x*t.x,t.y*t.y,t.z*t.z)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=n(o),s=i(6);r.prototype.geodeticSurfaceNormalCartographic=function(t){var e=2*Math.PI-t.longitude(s.UNIT.RADIAN),i=t.latitude(s.UNIT.RADIAN),n=Math.cos(i),r=n*Math.cos(e),o=n*Math.sin(e),h=Math.sin(i),u=new a.Vector3(r,h,o);return u.normalize()},r.prototype.setSize=function(t){this.rayon_1=t.x,this.rayon_2=t.y,this.rayon_3=t.z,this._radiiSquared=new a.Vector3(t.x*t.x,t.y*t.y,t.z*t.z)},r.prototype.cartographicToCartesian=function(t){var e=new a.Vector3,i=this.geodeticSurfaceNormalCartographic(t);e.multiplyVectors(this._radiiSquared,i);var n=Math.sqrt(i.dot(e));return e.divideScalar(n),i.multiplyScalar(t.altitude()),e.add(i)},r.prototype.cartographicToCartesianArray=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.cartographicToCartesian(t[i]));return e},r.prototype.intersection=function(t){var e=1e-4,i=t.origin,n=t.direction,r=n.x*n.x/(this.size.x*this.size.x)+n.y*n.y/(this.size.y*this.size.y)+n.z*n.z/(this.size.z*this.size.z),o=2*i.x*n.x/(this.size.x*this.size.x)+2*i.y*n.y/(this.size.y*this.size.y)+2*i.z*n.z/(this.size.z*this.size.z),s=i.x*i.x/(this.size.x*this.size.x)+i.y*i.y/(this.size.y*this.size.y)+i.z*i.z/(this.size.z*this.size.z)-1,h=o*o-4*r*s;if(h<0||0===r||0===o||0===s)return!1;h=Math.sqrt(h);var u=(-o+h)/(2*r),c=(-o-h)/(2*r);if(u<=e&&c<=e)return!1;var l=0;if(l=u<=e?c:c<=e?u:u<c?u:c,l<e)return!1;var f=new a.Vector3;return f.addVectors(t.origin,n.clone().setLength(l)),f},r.prototype.computeDistance=function(t,e){var i=t.longitude()*Math.PI/180,n=t.latitude()*Math.PI/180,r=e.longitude()*Math.PI/180,o=e.latitude()*Math.PI/180,a=Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(r-i)),s=this.rayon_1,h=this.rayon_2,u=Math.sqrt((s*s-h*h)/(s*s)),c=(n+o)/2,l=s*(1-u*u)/Math.sqrt(1-u*u*Math.sin(c)*Math.sin(c)),f=s/Math.sqrt(1-u*u*Math.sin(c)*Math.sin(c)),p=a*Math.sqrt(l*f);return p},e.default=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};i.PI=Math.PI,i.PI_OV_TWO=.5*Math.PI,i.PI_OV_FOUR=.25*Math.PI,i.TWO_PI=2*Math.PI,i.INV_TWO_PI=1/i.TWO_PI,i.LOG_TWO=Math.log(2),i.RADTODEG=180/i.PI,i.DEGTORAD=i.PI/180,i.radToDeg=function(t){return t*i.RADTODEG},i.degToRad=function(t){return t*i.DEGTORAD},i.arrayDegToRad=function(t){if(t)for(var e=0;e<t.length;e++)t[e]=i.degToRad(t[e])},i.arrayRadToDeg=function(t){if(t)for(var e=0;e<t.length;e++)t[e]=i.radToDeg(t[e])},i.step=function(t,e){return t<e?0:1},i.exp2=function(t){return Math.pow(2,t)},e.default=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){l.default.call(this),this.realistic=!1,this.sphereSun=null,this.uniformsOut={atmoIN:{type:"i",value:0},screenSize:{type:"v2",value:new u.Vector2(window.innerWidth,window.innerHeight)}};var t=new u.ShaderMaterial({uniforms:this.uniformsOut,vertexShader:S.default,fragmentShader:w.default,side:u.BackSide,blending:u.AdditiveBlending,transparent:!0,wireframe:!1}),e=(0,T.ellipsoidSizes)(),i=new u.SphereGeometry(1.14,128,128).scale(e.x,e.y,e.z);this.geometry=i,this.material=t,this.uniformsIn={atmoIN:{type:"i",value:1},screenSize:{type:"v2",value:new u.Vector2(window.innerWidth,window.innerHeight)}};var n=new u.ShaderMaterial({uniforms:this.uniformsIn,vertexShader:S.default,fragmentShader:w.default,side:u.FrontSide,blending:u.AdditiveBlending,transparent:!0});this.atmosphereIN=new u.Mesh(new u.SphereGeometry(1.002,64,64).scale(e.x,e.y,e.z),n),this.add(this.atmosphereIN);var r={Kr:.0025,Km:.001,ESun:20,g:-.95,innerRadius:64e5,outerRadius:67e5,wavelength:[.65,.57,.475],scaleDepth:.25,mieScaleDepth:.1},o={v3LightPosition:{value:P.clone().normalize()},v3InvWavelength:{value:new u.Vector3(1/Math.pow(r.wavelength[0],4),1/Math.pow(r.wavelength[1],4),1/Math.pow(r.wavelength[2],4))},fCameraHeight:{value:0},fCameraHeight2:{value:0},fInnerRadius:{value:r.innerRadius},fInnerRadius2:{value:r.innerRadius*r.innerRadius},fOuterRadius:{value:r.outerRadius},fOuterRadius2:{value:r.outerRadius*r.outerRadius},fKrESun:{value:r.Kr*r.ESun},fKmESun:{value:r.Km*r.ESun},fKr4PI:{value:4*r.Kr*Math.PI},fKm4PI:{value:4*r.Km*Math.PI},fScale:{value:1/(r.outerRadius-r.innerRadius)},fScaleDepth:{value:r.scaleDepth},fScaleOverScaleDepth:{value:1/(r.outerRadius-r.innerRadius)/r.scaleDepth},g:{value:r.g},g2:{value:r.g*r.g},nSamples:{value:3},fSamples:{value:3},tDisplacement:{value:new u.Texture},tSkyboxDiffuse:{value:new u.Texture},fNightScale:{value:1}};this.ground={geometry:new u.SphereGeometry(r.innerRadius,50,50),material:new u.ShaderMaterial({uniforms:o,vertexShader:b.default,fragmentShader:x.default,blending:u.AdditiveBlending,transparent:!0,depthTest:!1,depthWrite:!1})},this.ground.mesh=new u.Mesh(this.ground.geometry,this.ground.material),this.sky={geometry:new u.SphereGeometry(r.outerRadius,196,196),material:new u.ShaderMaterial({uniforms:o,vertexShader:g.default,fragmentShader:m.default})},this.sky.mesh=new u.Mesh(this.sky.geometry,this.sky.material),this.sky.material.side=u.BackSide,this.sky.material.transparent=!0,this.ground.mesh.visible=!1,this.sky.mesh.visible=!1,this.add(this.ground.mesh),this.add(this.sky.mesh),this.skyDome=new p.default,this.skyDome.mesh.frustumCulled=!1,this.skyDome.mesh.material.transparent=!0,this.skyDome.mesh.visible=!1,this.skyDome.mesh.material.depthWrite=!1,this.add(this.skyDome.mesh);var a={turbidity:10,reileigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.49,azimuth:.25,sun:!1},s=this.skyDome.uniforms;s.turbidity.value=a.turbidity,s.reileigh.value=a.reileigh,s.luminance.value=a.luminance,s.mieCoefficient.value=a.mieCoefficient,s.mieDirectionalG.value=a.mieDirectionalG,s.up.value=new u.Vector3}Object.defineProperty(e,"__esModule",{value:!0}),e.LIGHTING_POSITION=void 0;var a=i(3),s=r(a),h=i(2),u=n(h),c=i(15),l=r(c),f=i(248),p=r(f),d=i(453),m=r(d),v=i(454),g=r(v),y=i(451),x=r(y),_=i(452),b=r(_),M=i(442),w=r(M),E=i(443),S=r(E),T=i(6),P=e.LIGHTING_POSITION=new u.Vector3(1,0,0);o.prototype=(0,s.default)(l.default.prototype),o.prototype.constructor=o,o.prototype.setRealisticOn=function(t){this.realistic=t,this.material.visible=!this.realistic,this.atmosphereIN.visible=!this.realistic,this.ground.mesh.visible=this.realistic,this.sky.mesh.visible=this.realistic,this.skyDome.mesh.visible=this.realistic},o.prototype.updateLightingPos=function(t){this.ground.material.uniforms.v3LightPosition.value=t.clone().normalize(),this.sky.material.uniforms.v3LightPosition.value=t.clone().normalize(),this.skyDome.uniforms.sunPosition.value.copy(t)},e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={FINAL:0,DEPTH:1,ID:2}},function(t,e){"use strict";function i(){this.parent=null,this.children=[],this.bbox=null,this.url=null,this.link=null,this.id=null,this.level=0,this.screenSpaceError=0,this.loaded=!1,this.pendingSubdivision=!1,this.layerUpdateState={},this.visible=!0,this.layer=null}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.setVisibility=function(t){this.visible=t},i.prototype.setDisplayed=function(){},i.prototype.childrenCount=function(){return this.children.length},i.prototype.noChild=function(){return 0===this.children.length},i.prototype.childrenLoaded=function(){var t=4==this.children.length;if(!t)return!1;if(this.pendingSubdivision){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e].loaded===!1)return!1;this.pendingSubdivision=!1}return!0},i.prototype.update=function(){},i.prototype.getNodeAtLevel=function(t){if(t===this.level)return this;var e=this.parent.getNodeAtLevel;if(e&&("function"==typeof e||this.parent.level===t))return this.parent.level===t?this.parent:this.parent.getNodeAtLevel(t)},i.prototype.hydrate=function(){},i.prototype.dehydrate=function(){},i.prototype.add=function(t){this.children.push(t),t.parent=this,t.layer=this},i.prototype.remove=function(){},i.extend=function(t){var e=["add","remove","setVisibility","setDisplayed"];for(var n in i.prototype)Object.prototype.hasOwnProperty.call(i.prototype,n)&&!e.includes(n)&&(t.prototype[n]=i.prototype[n])},e.default=i},function(t,e,i){t.exports={default:i(337),__esModule:!0}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var n=i(31),r=i(7)("toStringTag"),o="Arguments"==n(function(){return arguments}()),a=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=a(e=Object(t),r))?i:o?n(e):"Object"==(s=n(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,i){var n=i(18),r=i(8).document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(31);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e,i){"use strict";var n=i(43),r=i(10),o=i(112),a=i(17),s=i(22),h=i(32),u=i(359),c=i(34),l=i(109),f=i(7)("iterator"),p=!([].keys&&"next"in[].keys()),d="@@iterator",m="keys",v="values",g=function(){return this};t.exports=function(t,e,i,y,x,_,b){u(i,e,y);var M,w,E,S=function(t){if(!p&&t in A)return A[t];switch(t){case m:return function(){return new i(this,t)};case v:return function(){return new i(this,t)}}return function(){return new i(this,t)}},T=e+" Iterator",P=x==v,L=!1,A=t.prototype,C=A[f]||A[d]||x&&A[x],R=C||S(x),I=x?P?S("entries"):R:void 0,O="Array"==e?A.entries||C:C;if(O&&(E=l(O.call(new t)),E!==Object.prototype&&(c(E,T,!0),n||s(E,f)||a(E,f,g))),P&&C&&C.name!==v&&(L=!0,R=function(){return C.call(this)}),n&&!b||!p&&!L&&A[f]||a(A,f,R),h[e]=R,h[T]=g,x)if(M={values:P?R:S(v),keys:_?R:S(m),entries:I},b)for(w in M)w in A||o(A,w,M[w]);else r(r.P+r.F*(p||L),e,M);return M}},function(t,e,i){var n=i(47)("meta"),r=i(18),o=i(22),a=i(11).f,s=0,h=Object.isExtensible||function(){return!0},u=!i(21)(function(){return h(Object.preventExtensions({}))}),c=function(t){a(t,n,{value:{i:"O"+ ++s,w:{}}})},l=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,n)){if(!h(t))return"F";if(!e)return"E";c(t)}return t[n].i},f=function(t,e){if(!o(t,n)){if(!h(t))return!0;if(!e)return!1;c(t)}return t[n].w},p=function(t){return u&&d.NEED&&h(t)&&!o(t,n)&&c(t),t},d=t.exports={KEY:n,NEED:!1,fastKey:l,getWeak:f,onFreeze:p}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(17);t.exports=function(t,e,i){for(var r in e)i&&t[r]?t[r]=e[r]:n(t,r,e[r]);return t}},function(t,e,i){var n=i(75)("keys"),r=i(47);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e,i){var n=i(8),r="__core-js_shared__",o=n[r]||(n[r]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e,i){var n=i(18);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){var n=i(8),r=i(5),o=i(43),a=i(79),s=i(11).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=o?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:a.f(t)})}},function(t,e,i){e.f=i(7)},function(t,e,i){var n=i(66),r=i(7)("iterator"),o=i(32);t.exports=i(5).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[n(t)]}},function(t,e){},function(t,e,i){function n(t,e){if(!(this instanceof n))return new n(t);e=e||function(t){if(t)throw t};var i=r(t);if("object"!=typeof i)return void e(t);var a=n.projections.get(i.projName);if(!a)return void e(t);if(i.datumCode&&"none"!==i.datumCode){var c=h[i.datumCode];c&&(i.datum_params=c.towgs84?c.towgs84.split(","):null,i.ellps=c.ellipse,i.datumName=c.datumName?c.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu";var l=s.sphere(i.a,i.b,i.rf,i.ellps,i.sphere),f=s.eccentricity(l.a,l.b,l.rf,i.R_A),p=i.datum||u(i.datumCode,i.datum_params,l.a,l.b,f.es,f.ep2);o(this,i),o(this,a),this.a=l.a,this.b=l.b,this.rf=l.rf,this.sphere=l.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=p,this.init(),e(null,this)}var r=i(405),o=i(229),a=i(406),s=i(401),h=i(393),u=i(398);n.projections=a,n.projections.start(),t.exports=n},function(t,e){t.exports=function(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)}},function(t,e){t.exports=function(t,e,i,n,r){var o,a;o=t/e;for(var s=0;s<15;s++)if(a=(t-(e*o-i*Math.sin(2*o)+n*Math.sin(4*o)-r*Math.sin(6*o)))/(e-2*i*Math.cos(2*o)+4*n*Math.cos(4*o)-6*r*Math.cos(6*o)),o+=a,Math.abs(a)<=1e-10)return o;return NaN}},function(t,e){t.exports=function(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}},function(t,e){t.exports=function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){h.default.call(this)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=n(o),s=i(240),h=n(s),u=function(t){this.floatArray=new Float32Array(t),this.max=void 0,this.min=void 0,this.texture=null};r.prototype=(0,a.default)(h.default.prototype),r.prototype.constructor=r,r.prototype.computeMinMaxElevation=function(t,e,i,n){for(var r=1e6,o=-1e6,a=n?Math.floor(n.z*e):t.length,s=n?Math.floor(n.z*i):1,h=n?Math.floor(n.x*e):0,u=n?Math.floor(n.y*i):0,c=n?Math.max(Math.floor(a/8),2):16,l=u;l<u+s;l+=c)for(var f=l*(e||0),p=h;p<h+a;p+=c){var d=t[f+p];d>-10&&void 0!==d&&(o=Math.max(o,d),r=Math.min(r,d))}return o===-1e6||1e6===r?{min:void 0,max:void 0}:{min:r,max:o}},r.prototype.parseXBil=function(t,e){if(!t)throw new Error("Error processing XBIL");var i=new u(t),n=this.computeMinMaxElevation(i.floatArray);return i.min=n.min,i.max=n.max,i.url=e,i},r.prototype.read=function(t){var e=this;return fetch(t).then(function(e){if(e.status<200||e.status>=300)throw new Error("Error loading "+t+": status "+e.status);return e.arrayBuffer()}).then(function(i){return e.parseXBil(i,t)})},e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){t=t||{},this.cache=(0,v.default)(),this.baseUrl=t.url||"",this.layer=t.layer||"",this.typename=t.typename||"",this.format=void 0===t.format?"json":t.format,this.epsgCode=t.epsgCode||4326,this.batiments=[],this.pointOrder=new c.default,this.featureToolBox=new _.default(t.ellipsoid)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(9),a=n(o),s=i(3),h=n(s),u=i(63),c=n(u),l=i(24),f=n(l),p=i(19),d=n(p),m=i(39),v=n(m),g=i(40),y=n(g),x=i(266),_=n(x),b=i(15),M=n(b),w=i(30),E=n(w),S=i(6);
r.prototype=(0,h.default)(f.default.prototype),r.prototype.constructor=r,r.prototype.url=function(t,e){var i=void 0;return i="ordered"==e.axisOrder?t.south(S.UNIT.DEGREE)+","+t.west(S.UNIT.DEGREE)+","+t.north(S.UNIT.DEGREE)+","+t.east(S.UNIT.DEGREE):t.west(S.UNIT.DEGREE)+","+t.south(S.UNIT.DEGREE)+","+t.east(S.UNIT.DEGREE)+","+t.north(S.UNIT.DEGREE),e.customUrl.replace("%bbox",i.toString())},r.prototype.preprocessDataLayer=function(t){if(!t.title)throw new Error("layerName is required.");t.projection=t.projection||"EPSG:4326",t.bbox=t.bbox||[-180,-90,90,180],t.bbox=new y.default(t.projection,t.bbox[0],t.bbox[2],t.bbox[1],t.bbox[3]),t.root=new M.default;var e=new E.default;e.add(t.root),"geojson"===t.protocol?t.format="geojson":t.format=t.options.mimetype||"json",t.crs=t.projection||"EPSG:4326",t.version=t.version||"1.3.0",t.customUrl=t.url+"SERVICE=WFS&REQUEST=GetFeature&typeName="+t.title+"&VERSION="+t.version+"&SRSNAME="+t.crs+"&outputFormat="+t.format+"&BBOX=%bbox,"+t.crs},r.prototype.tileInsideLimit=function(t,e){return 16===t.level&&e.bbox.intersect(t.bbox)},r.prototype.executeCommand=function(t){var e=t.layer,i=t.requester,n={json:this.getFeatures.bind(this),geojson:this.getFeatures.bind(this)},r=n[e.format];return r?r(i,e).then(function(e){return t.resolve(e)}):a.default.reject(new Error("Unsupported mimetype "+e.format))},r.prototype.getFeatures=function(t,e){var i=this;if(!this.tileInsideLimit(t,e)||null===t.material)return a.default.resolve();var n=t.bbox,r=this.url(n,e),o={};return o.feature=this.cache.getRessource(r),void 0!==o.feature?a.default.resolve(o):d.default.json(r).then(function(t){var a=t.crs||e.crs;if(a){var s=i.getPointOrder(a);if(void 0!==s){var h=t.features;if(h.style=h.style||e.style,"poly"==e.type)o.feature=i.featureToolBox.GeoJSON2Polygon(h,s);else if("bbox"==e.type){for(var u=h.length-1;u>=0;u--){var c=Number(h[u].properties.id.split("BATIMENT")[1]);void 0===i.batiments[c]?i.batiments[c]=!0:h.splice(u,1)}h.length&&(o.feature=i.featureToolBox.GeoJSON2Box(h,s))}else if("point"==e.type||"box"==e.type)o.feature=i.featureToolBox.GeoJSON2Point(h,n,e,s);else{if("line"!=e.type)return o;o.feature=i.featureToolBox.GeoJSON2Line(h,n,e,s)}return void 0!==o.feature&&(null==o.feature.layer&&(o.feature.layer=e),i.cache.addRessource(r,o.feature)),o}}}).catch(function(){return o.feature=null,o})},r.prototype.getPointOrder=function(t){if(this.pointOrder[t])return this.pointOrder[t];var e={lat:0,long:1};if("EPSG"==t.type&&"4326"==t.properties.code)return e.long=0,e.lat=1,e;if("name"==t.type&&t.properties.name){var i=new RegExp(/^urn:[x-]?ogc:def:crs:EPSG:(\d*.?\d*)?:\d{4}/);if(i.test(t.properties.name))return e;var n=new RegExp(/^urn:[x-]?ogc:def:crs:OGC:(\d*.?\d*)?:(CRS)?(WSG)?\d{0,2}/);if(n.test(t.properties.name))return e.long=0,e.lat=1,e}},e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){p.default.call(this,new m.default),this.cache=(0,b.default)(),this.projection=new x.default,this.getTextureFloat=function(t){var e=new l.DataTexture(t,256,256,l.AlphaFormat,l.FloatType);return e.needsUpdate=!0,e}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(9),s=r(a),h=i(3),u=r(h),c=i(2),l=n(c),f=i(24),p=r(f),d=i(87),m=r(d),v=i(19),g=r(v),y=i(25),x=r(y),_=i(39),b=r(_),M=i(40),w=r(M);o.prototype=(0,u.default)(p.default.prototype),o.prototype.constructor=o,o.prototype.url=function(t,e){var i=t.as(e.projection),n=[i.west(),i.south(),i.east(),i.north()],r="swne"===e.bbox_url?n[1]+","+n[0]+","+n[3]+","+n[2]:n[0]+","+n[1]+","+n[2]+","+n[3];return e.customUrl.replace("%bbox",r)},o.prototype.preprocessDataLayer=function(t){if(!t.name)throw new Error("layerName is required.");if(!t.bbox)throw new Error("bbox is required");t.bbox=new w.default(t.projection,t.bbox[0],t.bbox[1],t.bbox[2],t.bbox[3]),t.bbox_url=t.bbox_url||"swne",t.format=t.options.mimetype||"image/png",t.width=t.heightMapWidth||256,t.version=t.version||"1.3.0",t.style=t.style||"",t.transparent=t.transparent||!1,t.customUrl=t.url+"?SERVICE=WMS&REQUEST=GetMap&LAYERS="+t.name+"&VERSION="+t.version+"&STYLES="+t.style+"&FORMAT="+t.format+"&TRANSPARENT="+t.transparent+"&BBOX=%bbox"+("&CRS="+t.projection+"&WIDTH="+t.width+"&HEIGHT="+t.width)},o.prototype.tileInsideLimit=function(t,e){return t.level>2&&e.bbox.intersect(t.bbox)},o.prototype.getColorTexture=function(t,e,i,n){var r=this;if(!this.tileInsideLimit(t,e)||null===t.material)return s.default.resolve();var o=this.url(i.as("EPSG:4326"),e),a={pitch:n};if(a.texture=this.cache.getRessource(o),void 0!==a.texture)return s.default.resolve(a);var h=g.default.texture(o),u=h.texture,c=h.promise;return a.texture=u,a.texture.generateMipmaps=!1,a.texture.magFilter=l.LinearFilter,a.texture.minFilter=l.LinearFilter,a.texture.anisotropy=16,c.then(function(){return r.cache.addRessource(o,a.texture),a.texture.needsUpdate=!0,a})},o.prototype.getXbilTexture=function(t,e,i,n){var r=this,o=this.url(i,e),a=this.cache.getRessource(o);return void 0!==a?s.default.resolve({pitch:n,texture:a.texture,min:a.min,max:a.max}):this._IoDriver.read(o).then(function(t){return t.texture=r.getTextureFloat(t.floatArray),t.texture.generateMipmaps=!1,t.texture.magFilter=l.LinearFilter,t.texture.minFilter=l.LinearFilter,t.pitch=n,r.cache.addRessource(o,t),t})},o.prototype.executeCommand=function(t){var e=t.layer,i=t.requester,n=t.ancestor,r={"image/png":this.getColorTexture.bind(this),"image/jpg":this.getColorTexture.bind(this),"image/jpeg":this.getColorTexture.bind(this),"image/x-bil;bits=32":this.getXbilTexture.bind(this)},o=r[e.format];if(o){var a=n?this.projection.WMS_WGS84Parent(i.bbox,n.bbox):new l.Vector3(0,0,1),h=n?n.bbox:i.bbox;return o(i,e,h,a)}return s.default.reject(new Error("Unsupported mimetype "+e.format))},o.prototype.getTexture=function(t){var e=this;if(void 0===t)return s.default.resolve(-2);var i=this.url(t),n=this.cache.getRessource(i);return void 0!==n?s.default.resolve(n):this.ioDriverImage.read(i).then(function(t){var n={};return n.texture=new l.Texture(t),n.texture.generateMipmaps=!1,n.texture.magFilter=l.LinearFilter,n.texture.minFilter=l.LinearFilter,n.texture.anisotropy=16,e.cache.addRessource(i,n.texture),n.texture})},e.default=o},function(t,e){"use strict";function i(t,e,i){this.zoom=t||0,this.row=e||0,this.col=i||0}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.constructor=i,i.prototype.clone=function(){return new i(this.zoom,this.row,this.col)},i.prototype.isInside=function(t){return this.row>=t.minTileRow&&this.row<=t.maxTileRow&&this.col<=t.maxTileCol&&this.col>=t.minTileCol},e.default=i},function(t,e){"use strict";function i(){this._systemCap=null,this._gpuCap=null}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.getSystemCapabilities=function(){},i.prototype.getGpuCapabilities=function(){},i.prototype.ioFile=function(){},i.prototype.isInternetExplorer=function(){return!!document.documentMode},e.default=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){p.default.call(this);var i=new P.default;this.NOIE=!i.isInternetExplorer(),this.gLDebug=e,this.gpxTracks=new p.default;var n=new l.Object3D;this.gpxTracks.add(n),this.gpxTracks.visible=!0,n.visible=!0,this.tiles=new m.default(b.default,this.SchemeTileWMTS(D),null),this.layersConfiguration=new C.default,this.atmosphere=this.NOIE?new w.default(t):void 0,this.clouds=new S.default;var r=new l.Object3D;r.quaternion.multiply((new l.Quaternion).setFromAxisAngle(new l.Vector3(1,0,0),-Math.PI/2)),r.quaternion.multiply((new l.Quaternion).setFromAxisAngle(new l.Vector3(0,0,1),Math.PI)),this.layerWGS84Zup=new p.default,this.layerWGS84Zup.add(r),this.add(this.tiles),this.add(this.gpxTracks),void 0===this.atmosphere||this.gLDebug||(this.atmosphere.add(this.clouds),this.add(this.atmosphere))}Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),s=r(a),h=i(3),u=r(h),c=i(2),l=n(c),f=i(30),p=r(f),d=i(97),m=r(d),v=i(274),g=r(v),y=i(59),x=r(y),_=i(250),b=r(_),M=i(60),w=r(M),E=i(247),S=r(E),T=i(91),P=r(T),L=i(6),A=i(272),C=r(A),R=i(96),I=i(40),O=r(I),D=1;o.prototype=(0,u.default)(p.default.prototype),o.prototype.constructor=o,o.prototype.QuadTreeToMaterial=function(){},o.prototype.SchemeTileWMTS=function(t){var e=new g.default;0===t?(e.add(new O.default("EPSG:4326",0,x.default.PI,-x.default.PI_OV_TWO,x.default.PI_OV_TWO)),e.add(new O.default("EPSG:4326",x.default.PI,x.default.TWO_PI,-x.default.PI_OV_TWO,x.default.PI_OV_TWO))):1==t&&(e.add(new O.default("EPSG:4326",-x.default.PI,0,-x.default.PI_OV_TWO,x.default.PI_OV_TWO)),e.add(new O.default("EPSG:4326",0,x.default.PI,-x.default.PI_OV_TWO,x.default.PI_OV_TWO)));var i=!0,n=!1,r=void 0;try{for(var o,a=(0,s.default)(e.schemeBB);!(i=(o=a.next()).done);i=!0){var h=o.value;h.minCoordinate._internalStorageUnit=L.UNIT.RADIAN,h.maxCoordinate._internalStorageUnit=L.UNIT.RADIAN}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e},o.prototype.showAtmosphere=function(t){void 0!==this.atmosphere&&(this.atmosphere.visible=t)},o.prototype.showClouds=function(t,e){t&&this.clouds.generate(e),this.clouds.visible=t},o.prototype.updateLightingPos=function(t){this.atmosphere.updateLightingPos(t),this.clouds.updateLightingPos(t)},o.prototype.setLayerOpacity=function(t,e){this.layersConfiguration.setLayerOpacity(t,e);var i=function(i){i.material.setLayerOpacity&&i.material.setLayerOpacity(i.getIndexLayerColor(t),e)};this.tiles.children[0].traverse(i)},o.prototype.setLayerVisibility=function(t,e){this.layersConfiguration.setLayerVisibility(t,e);var i=this.layersConfiguration.getGeometryLayerById(t);if(void 0!=i)i.root.layer.visible=e,i.root.visible=e;else{var n=function(i){i.material.setLayerVisibility&&i.material.setLayerVisibility(i.getIndexLayerColor(t),e)};this.tiles.children[0].traverse(n)}},o.prototype.updateLayersOrdering=function(){var t=this.layersConfiguration.getColorLayersIdOrderedBySequence(),e=function(e){e.changeSequenceLayers&&e.changeSequenceLayers(t)};this.tiles.children[0].traverse(e)},o.prototype.removeColorLayer=function(t){var e=function(e){e.removeColorLayer&&e.removeColorLayer(t)};this.tiles.children[0].traverse(e)},o.prototype.getZoomLevel=function(){var t=function(){var t=0;return function(e){return e&&(t=Math.max(t,e.level)),t}}();return this.tiles.children[0].traverseVisible(t),t()},o.prototype.computeDistanceForZoomLevel=function(t,e){return e.preSSE*Math.pow(this.tiles.minLevel,this.tiles.maxLevel-t+1)/R.SSE_SUBDIVISION_THRESHOLD},o.prototype.getTile=function(t){return this.tiles.getTile(t)},o.prototype.setRealisticLightingOn=function(t){this.atmosphere.setRealisticOn(t),this.clouds.setLightingOn(t)},e.default=o},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.l_COLOR=e.l_ELEVATION=void 0;var o=i(3),a=r(o),s=i(2),h=n(s),u=i(20),c=r(u),l=i(26),f=r(l),p=i(441),d=r(p),m=i(440),v=r(m),g=i(436),y=r(g),x=-1,_=new h.Texture;_.level=x;var b,M=2,w=new h.Vector3(0,0,0),E=new h.Vector4(0,0,0,0),S=e.l_ELEVATION=0,T=e.l_COLOR=1,P=function(t){if(!b){b="vec4 colorAtIdUv(sampler2D dTextures[TEX_UNITS],vec3 offsetScale[TEX_UNITS],int id, vec2 uv){\n",b+=" if (id == 0) return texture2D(dTextures[0],  pitUV(uv,offsetScale[0]));\n";for(var e=1;e<t;e++){var i=e.toString();b+="    else if (id == "+i+") return texture2D(dTextures["+i+"],  pitUV(uv,offsetScale["+i+"]));\n"}b+="else return vec4(0.0,0.0,0.0,0.0);}\n"}return b},L=function(t,e){for(var i=0;i<t.length;i++)t[i]=e},A=function(t,e,i){t.splice(i,0,t.splice(e,1)[0])},C=function(t,e,i,n){n>e&&n<=e+i&&(n=e+i),t.splice.apply(t,[n,0].concat(t.splice(e,i)))},R=function(t){c.default.call(this);var e=(0,f.default)().glParams.maxTexturesUnits,i=Math.min(e-1,15);this.vertexShader=d.default,this.fragmentShaderHeader+="const int   TEX_UNITS   = "+i.toString()+";\n",this.fragmentShaderHeader+=y.default,this.fragmentShaderHeader+=P(i),this.fragmentShader=this.fragmentShaderHeader+v.default,this.vertexShader=this.vertexShaderHeader+d.default,this.textures=[],this.offsetScale=[],this.loadedTexturesCount=[0,0],this.offsetScale[T]=Array(i),this.offsetScale[S]=[w],L(this.offsetScale[T],w),this.textures[S]=[_],this.textures[T]=Array(i);var n=Array(8);this.layerTexturesCount=Array(8),L(this.textures[T],_),L(n,E),L(this.layerTexturesCount,0),this.uniforms.dTextures_00=new h.Uniform(this.textures[S]),this.uniforms.dTextures_01=new h.Uniform(this.textures[T]),this.uniforms.visibility=new h.Uniform([!0,!0,!0,!0,!0,!0,!0,!0]),this.uniforms.loadedTexturesCount=new h.Uniform(this.loadedTexturesCount),this.uniforms.colorLayersCount=new h.Uniform(1),this.uniforms.paramLayers=new h.Uniform(n),this.uniforms.offsetScale_L00=new h.Uniform(this.offsetScale[S]),this.uniforms.offsetScale_L01=new h.Uniform(this.offsetScale[T]),this.uniforms.lightPosition=new h.Uniform(new h.Vector3(-.5,0,1)),this.setUuid(t||0),this.wireframe=!1,this.colorLayersId=[]};R.prototype=(0,a.default)(c.default.prototype),R.prototype.constructor=R,R.prototype.dispose=function(){this.dispatchEvent({type:"dispose"});for(var t=0;t<M;t++)for(var e=0,i=this.textures[t].length;e<i;e++)this.textures[t][e]instanceof h.Texture&&this.textures[t][e].dispose()},R.prototype.setSequence=function(t){for(var e=0,i=0,n=0;n<t.length;n++){var r=t[n],o=this.indexOfColorLayer(r);if(o>-1){var a=n-e,s=this.layerTexturesCount[o];if(a!==o){A(this.colorLayersId,o,a),A(this.layerTexturesCount,o,a),A(this.uniforms.paramLayers.value,o,a),A(this.uniforms.visibility.value,o,a);var h=this.getTextureOffsetByLayerIndex(a);C(this.uniforms.offsetScale_L01.value,h,s,i),C(this.uniforms.dTextures_01.value,h,s,i)}this.setTextureOffsetByLayerIndex(a,i),i+=s}else e++}this.uniforms.colorLayersCount.value=this.getColorLayersCount()},R.prototype.removeColorLayer=function(t){var e=this.indexOfColorLayer(t);if(e!==-1){var i=this.getTextureOffsetByLayerIndex(e),n=this.getTextureCountByLayerIndex(e);this.colorLayersId.splice(e,1),this.uniforms.colorLayersCount.value=this.getColorLayersCount(),this.layerTexturesCount.splice(e,1),this.layerTexturesCount.push(0),this.uniforms.paramLayers.value.splice(e,1),this.uniforms.paramLayers.value.push(E),this.uniforms.visibility.value.splice(e,1),this.uniforms.visibility.value.push(!0);for(var r=i,o=i+n;r<o;r++)this.textures[T][r]instanceof h.Texture&&this.textures[T][r].dispose();var a=this.textures[T].splice(i,n);this.offsetScale[T].splice(i,n);for(var s=a.reduce(function(t,e){return t+(e.level>-1)},0),u=0,c=n;u<c;u++)this.textures[T].push(_),this.offsetScale[T].push(w);for(var l=e,f=this.getColorLayersCount();l<f;l++)this.uniforms.paramLayers.value[l].x-=n;this.loadedTexturesCount[T]-=s,this.uniforms.offsetScale_L01.value=this.offsetScale[T],this.uniforms.dTextures_01.value=this.textures[T]}},R.prototype.setTexturesLayer=function(t,e,i){for(var n=this.indexOfColorLayer(i),r=this.getTextureOffsetByLayerIndex(n),o=0,a=t.length;o<a;o++)if(t[o]){if(null===t[o].texture){this.setLayerVisibility(n,!1);break}this.setTexture(t[o].texture,e,o+(r||0),t[o].pitch)}},R.prototype.setTexture=function(t,e,i,n){void 0!==this.textures[e][i]&&void 0!==this.textures[e][i].image||(this.loadedTexturesCount[e]+=1),this.textures[e][i]=t||_,this.offsetScale[e][i]=n||new h.Vector3(0,0,1)},R.prototype.setColorLayerParameters=function(t){if(0===this.getColorLayersCount())for(var e=0;e<t.length;e++)this.pushLayer(t[e])},R.prototype.pushLayer=function(t){var e=this.getColorLayersCount(),i=0===e?0:this.getTextureOffsetByLayerIndex(e-1)+this.getTextureCountByLayerIndex(e-1);this.uniforms.paramLayers.value[e]=new h.Vector4,this.setTextureOffsetByLayerIndex(e,i),this.setLayerUV(e,"PM"===t.tileMT?1:0),this.setLayerFx(e,t.fx),this.setLayerOpacity(e,t.opacity),this.setLayerVisibility(e,t.visible),this.setLayerTexturesCount(e,t.texturesCount),this.colorLayersId.push(t.idLayer),this.uniforms.colorLayersCount.value=this.getColorLayersCount()},R.prototype.indexOfColorLayer=function(t){return this.colorLayersId.indexOf(t)},R.prototype.getColorLayersCount=function(){return this.colorLayersId.length},R.prototype.getTextureOffsetByLayerIndex=function(t){return this.uniforms.paramLayers.value[t].x},R.prototype.getTextureCountByLayerIndex=function(t){return this.layerTexturesCount[t]},R.prototype.getLayerTextureOffset=function(t){var e=this.indexOfColorLayer(t);return e>-1?this.getTextureOffsetByLayerIndex(e):-1},R.prototype.setLightingOn=function(t){this.uniforms.lightingEnabled.value=t},R.prototype.setLayerFx=function(t,e){this.uniforms.paramLayers.value[t].z=e},R.prototype.setTextureOffsetByLayerIndex=function(t,e){this.uniforms.paramLayers.value[t].x=e},R.prototype.setLayerUV=function(t,e){this.uniforms.paramLayers.value[t].y=e},R.prototype.setLayerOpacity=function(t,e){this.uniforms.paramLayers.value[t]&&(this.uniforms.paramLayers.value[t].w=e)},R.prototype.setLayerVisibility=function(t,e){this.uniforms.visibility.value[t]=e},R.prototype.setLayerTexturesCount=function(t,e){this.layerTexturesCount[t]=e},R.prototype.getLoadedTexturesCount=function(){return this.loadedTexturesCount[S]+this.loadedTexturesCount[T]},R.prototype.isColorLayerDownscaled=function(t,e){return this.textures[T][this.getLayerTextureOffset(t)].level<e},R.prototype.isLayerTypeDownscaled=function(t,e){if(t===S){var i=this.textures[S][0];return void 0===i||i.level!==x&&i.level<e}if(t===T)for(var n=0,r=this.colorLayersId.length;n<r;n++){var o=this.getTextureOffsetByLayerIndex(n);if(this.textures[T][o].level<e)return!0}return!1},R.prototype.getColorLayerLevelById=function(t){var e=this.indexOfColorLayer(t);e===-1&&(e=0);var i=this.getTextureOffsetByLayerIndex(e),n=this.textures[T][i];return n?n.level:x},R.prototype.getElevationLayerLevel=function(){return this.textures[S][0].level},R.prototype.getLayerLevel=function(t,e){return t==S?this.getElevationLayerLevel():this.getColorLayerLevelById(e)},e.default=R},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(2),h=n(s),u=i(258),c=r(u),l=function(t){h.Mesh.call(this),this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.geometry=new h.BufferGeometry,this.material=new c.default(t),this.widthCallback=null};l.prototype=(0,a.default)(h.Mesh.prototype),l.prototype.constructor=l,l.prototype.setGeometry=function(t,e){this.widthCallback=e,this.positions=[];var i;if(t instanceof h.Geometry)for(i=0;i<t.vertices.length;i++){var n=t.vertices[i];this.positions.push(n.x,n.y,n.z),this.positions.push(n.x,n.y,n.z)}if(t instanceof h.BufferGeometry,t instanceof Float32Array||t instanceof Array)for(i=0;i<t.length;i+=3)this.positions.push(t[i],t[i+1],t[i+2]),this.positions.push(t[i],t[i+1],t[i+2]);this.process()},l.prototype.addPoint=function(t){t instanceof h.Vector3&&(this.positions.push(t.x,t.y,t.z),this.positions.push(t.x,t.y,t.z))},l.prototype.compareV3=function(t,e){var i=6*t,n=6*e;return this.positions[i]===this.positions[n]&&this.positions[i+1]===this.positions[n+1]&&this.positions[i+2]===this.positions[n+2]},l.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},l.prototype.process=function(){var t=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];var e;for(e=0;e<t;e++)this.side.push(1),this.side.push(-1);var i;for(e=0;e<t;e++)i=this.widthCallback?this.widthCallback(e/(t-1)):1,this.width.push(i),this.width.push(i);for(e=0;e<t;e++)this.uvs.push(e/(t-1),0),this.uvs.push(e/(t-1),1);var n;for(n=this.compareV3(0,t-1)?this.copyV3(t-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]),e=0;e<t-1;e++)n=this.copyV3(e),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(e=1;e<t;e++)n=this.copyV3(e),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]);for(n=this.compareV3(t-1,0)?this.copyV3(1):this.copyV3(t-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),e=0;e<t-1;e++){var r=2*e;this.indices_array.push(r,r+1,r+2),this.indices_array.push(r+2,r+1,r+3)}this.geometry.addAttribute("position",new h.BufferAttribute(new Float32Array(this.positions),3)),this.geometry.addAttribute("previous",new h.BufferAttribute(new Float32Array(this.previous),3)),this.geometry.addAttribute("next",new h.BufferAttribute(new Float32Array(this.next),3)),this.geometry.addAttribute("side",new h.BufferAttribute(new Float32Array(this.side),1)),this.geometry.addAttribute("width",new h.BufferAttribute(new Float32Array(this.width),1)),this.geometry.addAttribute("uv",new h.BufferAttribute(new Float32Array(this.uvs),2)),this.geometry.setIndex(new h.BufferAttribute(new Uint16Array(this.indices_array),1))},l.prototype.createQuad=function(t,e){var i=new h.BufferGeometry,n=new Float32Array([t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z]),r=new Float32Array([e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z,t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z]);i.addAttribute("position",new h.BufferAttribute(n,3)),i.addAttribute("position2",new h.BufferAttribute(r,3));var o=new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]);return i.addAttribute("uv",new h.BufferAttribute(o,2)),i},l.prototype.createSegments=function(t,e,i){var n=new h.BufferGeometry,r=new Float32Array([t.x,t.y,t.z]),o=new Float32Array([e.x,e.y,e.z]),a=new Float32Array([i.x,i.y,i.z]);return n.addAttribute("previousPoint",new h.BufferAttribute(r,3)),n.addAttribute("position",new h.BufferAttribute(o,3)),n.addAttribute("nextPoint",new h.BufferAttribute(a,3)),n},e.default=l},function(t,e){"use strict";function i(t){return t}function n(t,e,i){var n=i.groups.filter(function(e){return e<=t});return n.length?n[n.length-1]:i.groups[0]}function r(t,e,i){return Math.min(t,e+(i.increment||1))}function o(t,e){return Math.min(t,Math.ceil((e+t)/2))}function a(t,e,a,l){switch(t){case h:return n(e,a,l);case u:return r(e,a,l);case c:return o(e,a,l);case s:default:return i(e,a,l)}}Object.defineProperty(e,"__esModule",{value:!0}),e.chooseNextLevelToFetch=a;var s=e.STRATEGY_MIN_NETWORK_TRAFFIC=0,h=e.STRATEGY_GROUP=1,u=e.STRATEGY_PROGRESSIVE=2,c=e.STRATEGY_DICHOTOMY=3},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t){this.scene=t,this.vhMagnitudeSquared=1,this.r=(0,S.ellipsoidSizes)(),this.cV=new g.Vector3}function a(t){return!t.requester.parent||!t.requester.material||t.requester.parent.childrenLoaded()&&t.requester.visible===!1&&t.requester.level>=2}function s(t,e,i){var n=t.parent;if(n&&n.material&&n.material.getLayerLevel){var r=n.material.getLayerLevel(e,i?i.id:void 0);return r>=0?t.getNodeAtLevel(r):s(n,e,i)}return null}function h(t){return t.loaded?t.isDisplayed()?100:10:1e3-t.level}function u(t,e,i,n){for(var r=n.getGeometryLayers(),o=[],s=Date.now(),u=function(n){var u=r[n],c=u.protocol;if("wfs"==c.toLowerCase()&&u.tileInsideLimit(i,u)&&!i.content.get(u.id)){if(void 0===i.layerUpdateState[u.id]&&(i.layerUpdateState[u.id]=new w.default),!i.layerUpdateState[u.id].canTryUpdate(s))return"continue";i.layerUpdateState[u.id].newTry();var l={layer:u,requester:i,priority:h(i),earlyDropFunction:a};o.push(e.scheduler.execute(l).then(function(t){t&&t.feature?(t.feature.layer.root.add(t.feature),i.content.set(u.id,t.feature)):i.content.set(u.id,P),i.layerUpdateState[u.id].success()},function(e){e instanceof E.CancelledCommandException?i.layerUpdateState[u.id].success():(i.layerUpdateState[u.id].failure(Date.now()),t.notifyChange(1e3*i.layerUpdateState[u.id].secondsUntilNextTry(),!1))}))}},c=0;c<r.length;c++){u(c)}return p.default.all(o).then(function(){return i})}function c(t,e,i,n,r){for(var o=[],u=Date.now(),c=n.getColorLayers(),l=function(l){var f=c[l];if(!f.tileInsideLimit(i,f))return"continue";if(void 0===i.layerUpdateState[f.id]&&(i.layerUpdateState[f.id]=new w.default),!i.layerUpdateState[f.id].canTryUpdate(u))return"continue";if(!r){if(!i.isColorLayerDownscaled(f.id))return"continue";if(!n.isColorLayerVisible(f.id)||n.isLayerFrozen(f.id))return"continue"}var p=null,m=i.materials[x.default.FINAL].getColorLayerLevelById(f.id);if(m===-1)p=s(i,b.l_COLOR,f);else{if(d=(0,_.chooseNextLevelToFetch)(f.updateStrategy.type,i.level,m,f.updateStrategy.options),d===m)return"continue";d<i.level&&(p=i.getNodeAtLevel(d))}i.layerUpdateState[f.id].newTry();var v={layer:f,requester:i,priority:h(i),earlyDropFunction:a,ancestor:p,redraw:null==p};o.push(e.scheduler.execute(v).then(function(t){var e=p?p.level:i.level;if(Array.isArray(t)){for(var n=0;n<t.length;n++)t[n].texture.level=e;i.setTexturesLayer(t,b.l_COLOR,f.id)}else t.texture&&(t.texture.level=e,i.setTexturesLayer([t],b.l_COLOR,f.id));return i.layerUpdateState[f.id].success(),t},function(e){e instanceof E.CancelledCommandException?i.layerUpdateState[f.id].success():(i.layerUpdateState[f.id].failure(Date.now()),t.notifyChange(1e3*i.layerUpdateState[f.id].secondsUntilNextTry(),!1))}))},f=0;f<c.length;f++){var d;l(f)}p.default.all(o).then(function(){i.parent&&i.loadingCheck()})}function l(t,e,i,n,r){var o=Date.now(),u=n.getElevationLayers(),c=null,l=null,f=i.materials[x.default.FINAL].getElevationLayerLevel();if(!(f==-1&&i.material.loadedTexturesCount[b.l_ELEVATION]>0)){f==-1&&(l=s(i,b.l_ELEVATION));for(var p=u.length-1;p>=0;p--){var d=u[p];if(d.tileInsideLimit(i,d)&&(!n.isLayerFrozen(d.id)||r)){if(void 0===i.layerUpdateState[d.id]&&(i.layerUpdateState[d.id]=new w.default),!i.layerUpdateState[d.id].canTryUpdate(o))break;var m=(0,_.chooseNextLevelToFetch)(d.updateStrategy.type,i.level,f,d.updateStrategy.options);if(!(m<=f)){null===l&&(l=i.getNodeAtLevel(m)),c=d;break}}}if(null!==c){i.layerUpdateState[c.id].newTry();var v={layer:c,requester:i,priority:h(i),earlyDropFunction:a,ancestor:l,redraw:null==l};e.scheduler.execute(v).then(function(t){i.layerUpdateState[c.id].success(),null!==i.material&&(t.texture&&(t.texture.level=(l||i).level),void 0===t.max&&(t.min=(l||i).bbox.bottom(),t.max=(l||i).bbox.top()),i.setTextureElevation(t))},function(e){e instanceof E.CancelledCommandException?i.layerUpdateState[c.id].success():(i.layerUpdateState[c.id].failure(Date.now()),t.notifyChange(1e3*i.layerUpdateState[c.id].secondsUntilNextTry(),!1))})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.SSE_SUBDIVISION_THRESHOLD=void 0;var f=i(9),p=r(f),d=i(13),m=r(d),v=i(2),g=n(v),y=i(61),x=r(y),_=i(95),b=i(93),M=i(271),w=r(M),E=i(57),S=i(6),T=e.SSE_SUBDIVISION_THRESHOLD=6;o.prototype.backFaceCulling=function(t,e){for(var i=e.direction,n=0;n<t.normals().length;n++){var r=i.dot(t.normals()[n]);if(r>0)return t.visible=!0,!0}return t.visible},o.prototype.isCulled=function(t,e){return!(this.frustumCullingOBB(t,e)&&this.horizonCulling(t,e))},o.prototype.frustumCulling=function(t,e){var i=e.frustum;return i.intersectsObject(t)},o.prototype.checkNodeSSE=function(t){return T<t.sse||t.level<=2},o.prototype.subdivideNode=function(t,e,i){var n=this;if(!t.pendingSubdivision&&t.noChild()){var r=i.tree.subdivideNode(t);t.pendingSubdivision=!0;for(var o=0;o<r.length;o++){var a=i.tree,s={requester:t,layer:i.layersConfig.getGeometryLayers()[0],priority:1e4,bbox:r[o],type:a.type,redraw:!1};a.scheduler.execute(s).then(function(t){var r=0,o=[],a=i.layersConfig.getColorLayers(),s=!0,h=!1,u=void 0;try{for(var c,l=(0,m.default)(a);!(s=(c=l.next()).done);s=!0){var f=c.value;if(f.tileInsideLimit(t,f)){var p=f.tileTextureCount?f.tileTextureCount(t,f):1;o.push({tileMT:f.options.tileMatrixSet,texturesCount:p,visible:i.layersConfig.isColorLayerVisible(f.id),opacity:i.layersConfig.getColorLayerOpacity(f.id),fx:f.fx,idLayer:f.id}),r+=p}}}catch(t){h=!0,u=t}finally{try{!s&&l.return&&l.return()}finally{if(h)throw u}}var d=i.layersConfig.getElevationLayers(),v=!1,g=!0,y=!1,x=void 0;try{for(var _,b=(0,m.default)(d);!(g=(_=b.next()).done);g=!0){var M=_.value;v|=M.tileInsideLimit(t,M)}}catch(t){y=!0,x=t}finally{try{!g&&b.return&&b.return()}finally{if(y)throw x}}t.setColorLayerParameters(o,i.layersConfig.lightingLayers[0]),t.texturesNeeded=r+v,n.refineNodeLayers(t,e,i),n.fetchContentLayers(t,e,i);return 0})}}},o.prototype.refineNodeLayers=function(t,e,i){for(var n=[l,c],r=0;r<2;r++)t.loaded&&!t.isLayerTypeDownscaled(r)||n[r](this.scene,i.tree,t,i.layersConfig,!t.loaded)},o.prototype.fetchContentLayers=function(t,e,i){t.content.size<i.layersConfig.getGeometryLayers().length&&u(this.scene,i.tree,t,i.layersConfig,!t.loaded)},o.prototype.hideNodeChildren=function(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];i.setDisplayed(!1)}};var P=new g.Mesh;o.prototype.processNode=function(t,e,i){t.setDisplayed(!1),t.setSelected(!1);var n=!this.isCulled(t,e);if(t.setVisibility(n),n){t.sse=e.computeNodeSSE(t);var r=this.checkNodeSSE(t),o=r&&t.childrenLoaded();r&&i.tree.canSubdivideNode(t)?this.subdivideNode(t,e,i):o||this.refineNodeLayers(t,e,i),this.fetchContentLayers(t,e,i),t.setDisplayed(!o)}return n};var L=new g.Frustum,A=new g.Matrix4;o.prototype.frustumCullingOBB=function(t,e){return A.multiplyMatrices(e.viewMatrix,t.OBB().matrixWorld),L.setFromMatrix(A),L.intersectsBox(t.OBB().box3D)},o.prototype.prepare=function(t){this.preHorizonCulling(t)},o.prototype.preHorizonCulling=function(t){this.cV.copy(t.position()).divide(this.r),this.vhMagnitudeSquared=this.cV.lengthSq()-1},o.prototype.pointHorizonCulling=function(t){var e=t.divide(this.r).sub(this.cV),i=e.lengthSq(),n=-e.dot(this.cV),r=this.vhMagnitudeSquared<n&&this.vhMagnitudeSquared<n*n/i;return r};var C=new g.Vector3;o.prototype.horizonCulling=function(t){for(var e=t.OBB().pointsWorld,i=!1,n=0,r=e.length;n<r;n++)if(C=e[n].clone(),!this.pointHorizonCulling(C)){i=!0;break}return i},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i){f.default.call(this),this.type=t,this.scheduler=(0,d.default)(),this.link=i,this.schemeTile=e,this.tileType=t,this.minLevel=2,this.maxLevel=17;var n=new v.default;n.frustumCulled=!1,n.material.visible=!1,n.link=this.link,n.changeState=function(){return!0},this.add(n)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(13),a=n(o),s=i(9),h=n(s),u=i(3),c=n(u),l=i(30),f=n(l),p=i(57),d=n(p),m=i(15),v=n(m),g=i(40),y=n(g);r.prototype=(0,c.default)(f.default.prototype),r.prototype.constructor=r,r.prototype.init=function(t,e){for(var i=this.children[0],n=[],r=0;r<this.schemeTile.rootCount();r++)n.push(this.requestNewTile(t,this.schemeTile.getRoot(r),i,e));return h.default.all(n)},r.prototype.northWest=function(t){return t.children[0]},r.prototype.northEast=function(t){return t.children[1]},r.prototype.southWest=function(t){return t.children[2]},r.prototype.southEast=function(t){return t.children[3]},r.prototype.requestNewTile=function(t,e,i,n){var r={requester:i,layer:t,priority:1e4,bbox:e,type:this.type,level:0,light:n};return this.scheduler.execute(r)},r.prototype.canSubdivideNode=function(t){return t.level<this.maxLevel},r.prototype.subdivideNode=function(t){if(t.pendingSubdivision||!this.canSubdivideNode(t))return[];var e=t.bbox,i=e.center(),n=new y.default(e.crs(),e.west(),i._values[0],i._values[1],e.north()),r=new y.default(e.crs(),i._values[0],e.east(),i._values[1],e.north()),o=new y.default(e.crs(),e.west(),i._values[0],e.south(),i._values[1]),s=new y.default(e.crs(),i._values[0],e.east(),e.south(),i._values[1]),h=[n,r,o,s],u=!0,c=!1,l=void 0;
try{for(var f,p=(0,a.default)(h);!(u=(f=p.next()).done);u=!0){var d=f.value;d.minCoordinate._internalStorageUnit=t.bbox.minCoordinate._internalStorageUnit,d.maxCoordinate._internalStorageUnit=t.bbox.minCoordinate._internalStorageUnit}}catch(t){c=!0,l=t}finally{try{!u&&p.return&&p.return()}finally{if(c)throw l}}return h},r.prototype.traverse=function(t,e){if(t(e))for(var i=0;i<e.children.length;i++)this.traverse(t,e.children[i])},r.prototype.getTile=function(t){var e={x:t.longitude(),y:t.latitude()},i=function(t){var i=!t.bbox||t.bbox.isInside(e);return 0===t.children.length&&i&&(e.tile=t),i&&(e.parent=t.parent),i};return this.traverse(i,this.children[0]),void 0===e.tile?e.parent:e.tile},e.default=r},function(t,e,i){t.exports={default:i(341),__esModule:!0}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(282),o=n(r),a=i(281),s=n(a),h="function"==typeof s.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":typeof t};e.default="function"==typeof s.default&&"symbol"===h(o.default)?function(t){return"undefined"==typeof t?"undefined":h(t)}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":"undefined"==typeof t?"undefined":h(t)}},function(t,e,i){t.exports=i(8).document&&document.documentElement},function(t,e,i){t.exports=!i(12)&&!i(21)(function(){return 7!=Object.defineProperty(i(67)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(32),r=i(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||o[r]===t)}},function(t,e,i){var n=i(31);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){var n=i(14);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(e){var o=t.return;throw void 0!==o&&n(o.call(t)),e}}},function(t,e,i){var n=i(7)("iterator"),r=!1;try{var o=[7][n]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:i=!0}},o[n]=function(){return a},t(o)}catch(t){}return i}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){var n=i(45),r=i(33),o=i(23),a=i(77),s=i(22),h=i(101),u=Object.getOwnPropertyDescriptor;e.f=i(12)?u:function(t,e){if(t=o(t),e=a(e,!0),h)try{return u(t,e)}catch(t){}if(s(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(110),r=i(68).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},function(t,e,i){var n=i(22),r=i(28),o=i(74)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,i){var n=i(22),r=i(23),o=i(349)(!1),a=i(74)("IE_PROTO");t.exports=function(t,e){var i,s=r(t),h=0,u=[];for(i in s)i!=a&&n(s,i)&&u.push(i);for(;e.length>h;)n(s,i=e[h++])&&(~o(u,i)||u.push(i));return u}},function(t,e,i){var n=i(10),r=i(5),o=i(21);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],a={};a[t]=e(i),n(n.S+n.F*o(function(){i(1)}),"Object",a)}},function(t,e,i){t.exports=i(17)},function(t,e,i){"use strict";var n=i(8),r=i(5),o=i(11),a=i(12),s=i(7)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:n[t];a&&e&&!e[s]&&o.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,i){var n,r,o,a=i(16),s=i(358),h=i(100),u=i(67),c=i(8),l=c.process,f=c.setImmediate,p=c.clearImmediate,d=c.MessageChannel,m=0,v={},g="onreadystatechange",y=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},x=function(t){y.call(t.data)};f&&p||(f=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return v[++m]=function(){s("function"==typeof t?t:Function(t),e)},n(m),m},p=function(t){delete v[t]},"process"==i(31)(l)?n=function(t){l.nextTick(a(y,t,1))}:d?(r=new d,o=r.port2,r.port1.onmessage=x,n=a(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(t){c.postMessage(t+"","*")},c.addEventListener("message",x,!1)):n=g in u("script")?function(t){h.appendChild(u("script"))[g]=function(){h.removeChild(this),y.call(t)}}:function(t){setTimeout(a(y,t,1),0)}),t.exports={set:f,clear:p}},function(t,e){"use strict";function i(t,e,i){i=i||2;var r=e&&e.length,a=r?e[0]*i:t.length,s=n(t,0,a,i,!0),h=[];if(!s)return h;var u,l,f,p,d,m,v;if(r&&(s=c(t,e,s,i)),t.length>80*i){u=f=t[0],l=p=t[1];for(var g=i;g<a;g+=i)d=t[g],m=t[g+1],d<u&&(u=d),m<l&&(l=m),d>f&&(f=d),m>p&&(p=m);v=Math.max(f-u,p-l)}return o(s,h,i,u,l,v),h}function n(t,e,i,n,r){var o,a;if(r===C(t,e,i,n)>0)for(o=e;o<i;o+=n)a=P(o,t[o],t[o+1],a);else for(o=i-n;o>=e;o-=n)a=P(o,t[o],t[o+1],a);return a&&b(a,a.next)&&(L(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!b(n,n.next)&&0!==_(n.prev,n,n.next))n=n.next;else{if(L(n),n=e=n.prev,n===n.next)return null;i=!0}while(i||n!==e);return e}function o(t,e,i,n,c,l,f){if(t){!f&&l&&d(t,n,c,l);for(var p,m,v=t;t.prev!==t.next;)if(p=t.prev,m=t.next,l?s(t,n,c,l):a(t))e.push(p.i/i),e.push(t.i/i),e.push(m.i/i),L(t),t=m.next,v=m.next;else if(t=m,t===v){f?1===f?(t=h(t,e,i),o(t,e,i,n,c,l,2)):2===f&&u(t,e,i,n,c,l):o(r(t),e,i,n,c,l,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(_(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(y(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&_(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(t,e,i,n){var r=t.prev,o=t,a=t.next;if(_(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,h=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,l=v(s,h,e,i,n),f=v(u,c,e,i,n),p=t.nextZ;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&y(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=l;){if(p!==t.prev&&p!==t.next&&y(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function h(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!b(r,o)&&M(r,n,n.next,o)&&E(r,o)&&E(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),L(n),L(n.next),n=t=o),n=n.next}while(n!==t);return n}function u(t,e,i,n,a,s){var h=t;do{for(var u=h.next.next;u!==h.prev;){if(h.i!==u.i&&x(h,u)){var c=T(h,u);return h=r(h,h.next),c=r(c,c.next),o(h,e,i,n,a,s),void o(c,e,i,n,a,s)}u=u.next}h=h.next}while(h!==t)}function c(t,e,i,o){var a,s,h,u,c,p=[];for(a=0,s=e.length;a<s;a++)h=e[a]*o,u=a<s-1?e[a+1]*o:t.length,c=n(t,h,u,o,!1),c===c.next&&(c.steiner=!0),p.push(g(c));for(p.sort(l),a=0;a<p.length;a++)f(p[a],i),i=r(i,i.next);return i}function l(t,e){return t.x-e.x}function f(t,e){if(e=p(t,e)){var i=T(e,t);r(i,i.next)}}function p(t,e){var i,n=e,r=t.x,o=t.y,a=-(1/0);do{if(o<=n.y&&o>=n.next.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if(a=s,s===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var h,u=i,c=i.x,l=i.y,f=1/0;for(n=i.next;n!==u;)r>=n.x&&n.x>=c&&y(o<l?r:a,o,c,l,o<l?a:r,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(r-n.x),(h<f||h===f&&n.x>i.x)&&E(n,t)&&(i=n,f=h)),n=n.next;return i}function d(t,e,i,n){var r=t;do null===r.z&&(r.z=v(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,m(r)}function m(t){var e,i,n,r,o,a,s,h,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,n=i,s=0,e=0;e<u&&(s++,n=n.nextZ,n);e++);for(h=u;s>0||h>0&&n;)0===s?(r=n,n=n.nextZ,h--):0!==h&&n?i.z<=n.z?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,h--):(r=i,i=i.nextZ,s--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(a>1);return t}function v(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function g(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function y(t,e,i,n,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(i-a)*(e-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!w(t,e)&&E(t,e)&&E(e,t)&&S(t,e)}function _(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,i,n){return!!(b(t,e)&&b(i,n)||b(t,n)&&b(i,e))||_(t,e,i)>0!=_(t,e,n)>0&&_(i,n,t)>0!=_(i,n,e)>0}function w(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&M(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function E(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function S(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function T(t,e){var i=new A(t.i,t.x,t.y),n=new A(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function P(t,e,i,n){var r=new A(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function L(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function A(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,i,n){for(var r=0,o=e,a=i-n;o<i;o+=n)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}t.exports=i,i.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,a=Math.abs(C(t,0,o,i));if(r)for(var s=0,h=e.length;s<h;s++){var u=e[s]*i,c=s<h-1?e[s+1]*i:t.length;a-=Math.abs(C(t,u,c,i))}var l=0;for(s=0;s<n.length;s+=3){var f=n[s]*i,p=n[s+1]*i,d=n[s+2]*i;l+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},i.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},function(t,e){function i(t){return t*(Math.PI/180)}function n(t){return 180*(t/Math.PI)}function r(t){var e,n,r,o,s,h,u,c,l,f=t.lat,p=t.lon,d=6378137,m=.00669438,v=.9996,g=i(f),y=i(p);l=Math.floor((p+180)/6)+1,180===p&&(l=60),f>=56&&f<64&&p>=3&&p<12&&(l=32),f>=72&&f<84&&(p>=0&&p<9?l=31:p>=9&&p<21?l=33:p>=21&&p<33?l=35:p>=33&&p<42&&(l=37)),e=6*(l-1)-180+3,c=i(e),n=m/(1-m),r=d/Math.sqrt(1-m*Math.sin(g)*Math.sin(g)),o=Math.tan(g)*Math.tan(g),s=n*Math.cos(g)*Math.cos(g),h=Math.cos(g)*(y-c),u=d*((1-m/4-3*m*m/64-5*m*m*m/256)*g-(3*m/8+3*m*m/32+45*m*m*m/1024)*Math.sin(2*g)+(15*m*m/256+45*m*m*m/1024)*Math.sin(4*g)-35*m*m*m/3072*Math.sin(6*g));var x=v*r*(h+(1-o+s)*h*h*h/6+(5-18*o+o*o+72*s-58*n)*h*h*h*h*h/120)+5e5,_=v*(u+r*Math.tan(g)*(h*h/2+(5-o+9*s+4*s*s)*h*h*h*h/24+(61-58*o+o*o+600*s-330*n)*h*h*h*h*h*h/720));return f<0&&(_+=1e7),{northing:Math.round(_),easting:Math.round(x),zoneNumber:l,zoneLetter:a(f)}}function o(t){var e=t.northing,i=t.easting,r=t.zoneLetter,a=t.zoneNumber;if(a<0||a>60)return null;var s,h,u,c,l,f,p,d,m,v,g=.9996,y=6378137,x=.00669438,_=(1-Math.sqrt(1-x))/(1+Math.sqrt(1-x)),b=i-5e5,M=e;r<"N"&&(M-=1e7),d=6*(a-1)-180+3,s=x/(1-x),p=M/g,m=p/(y*(1-x/4-3*x*x/64-5*x*x*x/256)),v=m+(3*_/2-27*_*_*_/32)*Math.sin(2*m)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*m)+151*_*_*_/96*Math.sin(6*m),h=y/Math.sqrt(1-x*Math.sin(v)*Math.sin(v)),u=Math.tan(v)*Math.tan(v),c=s*Math.cos(v)*Math.cos(v),l=y*(1-x)/Math.pow(1-x*Math.sin(v)*Math.sin(v),1.5),f=b/(h*g);var w=v-h*Math.tan(v)/l*(f*f/2-(5+3*u+10*c-4*c*c-9*s)*f*f*f*f/24+(61+90*u+298*c+45*u*u-252*s-3*c*c)*f*f*f*f*f*f/720);w=n(w);var E=(f-(1+2*u+c)*f*f*f/6+(5-2*c+28*u-3*c*c+8*s+24*u*u)*f*f*f*f*f/120)/Math.cos(v);E=d+n(E);var S;if(t.accuracy){var T=o({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});S={top:T.lat,right:T.lon,bottom:w,left:E}}else S={lat:w,lon:E};return S}function a(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function s(t,e){var i="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+h(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+n.substr(n.length-5,e)}function h(t,e,i){var n=u(i),r=Math.floor(t/1e5),o=Math.floor(e/1e5)%20;return c(r,o,n)}function u(t){var e=t%m;return 0===e&&(e=m),e}function c(t,e,i){var n=i-1,r=v.charCodeAt(n),o=g.charCodeAt(n),a=r+t-1,s=o+e,h=!1;a>M&&(a=a-M+y-1,h=!0),(a===x||r<x&&a>x||(a>x||r<x)&&h)&&a++,(a===_||r<_&&a>_||(a>_||r<_)&&h)&&(a++,a===x&&a++),a>M&&(a=a-M+y-1),s>b?(s=s-b+y-1,h=!0):h=!1,(s===x||o<x&&s>x||(s>x||o<x)&&h)&&s++,(s===_||o<_&&s>_||(s>_||o<_)&&h)&&(s++,s===x&&s++),s>b&&(s=s-b+y-1);var u=String.fromCharCode(a)+String.fromCharCode(s);return u}function l(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,r="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,o++}var a=parseInt(r,10);if(0===o||o+3>i)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(o,o+=2);for(var h=u(a),c=f(n.charAt(0),h),l=p(n.charAt(1),h);l<d(s);)l+=2e6;var m=i-o;if(m%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var v,g,y,x,_,b=m/2,M=0,w=0;return b>0&&(v=1e5/Math.pow(10,b),g=t.substring(o,o+b),M=parseFloat(g)*v,y=t.substring(o+b),w=parseFloat(y)*v),x=M+c,_=w+l,{easting:x,northing:_,zoneLetter:s,zoneNumber:a,accuracy:v}}function f(t,e){for(var i=v.charCodeAt(e-1),n=1e5,r=!1;i!==t.charCodeAt(0);){if(i++,i===x&&i++,i===_&&i++,i>M){if(r)throw"Bad character: "+t;i=y,r=!0}n+=1e5}return n}function p(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=g.charCodeAt(e-1),n=0,r=!1;i!==t.charCodeAt(0);){if(i++,i===x&&i++,i===_&&i++,i>b){if(r)throw"Bad character: "+t;i=y,r=!0}n+=1e5}return n}function d(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var m=6,v="AJSAJS",g="AFAFAF",y=65,x=73,_=79,b=86,M=90;e.forward=function(t,e){return e=e||5,s(r({lat:t[1],lon:t[0]}),e)},e.inverse=function(t){var e=o(l(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},e.toPoint=function(t){var e=o(l(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){var i=1,n=.25,r=.046875,o=.01953125,a=.01068115234375,s=.75,h=.46875,u=.013020833333333334,c=.007120768229166667,l=.3645833333333333,f=.005696614583333333,p=.3076171875;t.exports=function(t){var e=[];e[0]=i-t*(n+t*(r+t*(o+t*a))),e[1]=t*(s-t*(r+t*(o+t*a)));var d=t*t;return e[2]=d*(h-t*(u+t*c)),d*=t,e[3]=d*(l-t*f),e[4]=d*t*p,e}},function(t,e,i){var n=i(85),r=1e-10,o=20;t.exports=function(t,e,i){for(var a=1/(1-e),s=t,h=o;h;--h){var u=Math.sin(s),c=1-e*u*u;if(c=(n(s,u,Math.cos(s),i)-t)*(c*Math.sqrt(c))*a,s-=c,Math.abs(c)<r)return s}return s}},function(t,e){t.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},function(t,e,i){function n(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?n[t]=o(arguments[1]):n[t]=a(arguments[1]):n[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?n.apply(e,t):n(t)});if("string"==typeof t){if(t in n)return n[t]}else"EPSG"in t?n["EPSG:"+t.EPSG]=t:"ESRI"in t?n["ESRI:"+t.ESRI]=t:"IAU2000"in t?n["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var r=i(402),o=i(230),a=i(233);r(n),t.exports=n},function(t,e){t.exports=function(t,e){t=t||{};var i,n;if(!e)return t;for(n in e)i=e[n],void 0!==i&&(t[n]=i);return t}},function(t,e,i){var n=.017453292519943295,r=i(395),o=i(396);t.exports=function(t){var e,i,a,s={},h=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),u={proj:"projName",datum:"datumCode",rf:function(t){s.rf=parseFloat(t)},lat_0:function(t){s.lat0=t*n},lat_1:function(t){s.lat1=t*n},lat_2:function(t){s.lat2=t*n},lat_ts:function(t){s.lat_ts=t*n},lon_0:function(t){s.long0=t*n},lon_1:function(t){s.long1=t*n},lon_2:function(t){s.long2=t*n},alpha:function(t){s.alpha=parseFloat(t)*n},lonc:function(t){s.longc=t*n},x_0:function(t){s.x0=parseFloat(t)},y_0:function(t){s.y0=parseFloat(t)},k_0:function(t){s.k0=parseFloat(t)},k:function(t){s.k0=parseFloat(t)},a:function(t){s.a=parseFloat(t)},b:function(t){s.b=parseFloat(t)},r_a:function(){s.R_A=!0},zone:function(t){s.zone=parseInt(t,10)},south:function(){s.utmSouth=!0},towgs84:function(t){s.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){s.to_meter=parseFloat(t)},units:function(t){s.units=t,o[t]&&(s.to_meter=o[t].to_meter)},from_greenwich:function(t){s.from_greenwich=t*n},pm:function(t){s.from_greenwich=(r[t]?r[t]:parseFloat(t))*n},nadgrids:function(t){"@null"===t?s.datumCode="none":s.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&e.indexOf(t.substr(0,1))!==-1&&e.indexOf(t.substr(1,1))!==-1&&e.indexOf(t.substr(2,1))!==-1&&(s.axis=t)}};for(e in h)i=h[e],e in u?(a=u[e],"function"==typeof a?a(i):s[a]=i):s[e]=i;return"string"==typeof s.datumCode&&"WGS84"!==s.datumCode&&(s.datumCode=s.datumCode.toLowerCase()),s}},function(t,e,i){var n=i(225),r=i(85),o=i(226),a=i(4),s=Math.PI/2,h=1e-10,u=i(38);e.init=function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=n(this.es),this.ml0=r(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},e.forward=function(t){var e,i,n,o=t.x,s=t.y,u=a(o-this.long0),c=Math.sin(s),l=Math.cos(s);if(this.es){var f=l*u,p=Math.pow(f,2),d=this.ep2*Math.pow(l,2),m=Math.pow(d,2),v=Math.abs(l)>h?Math.tan(s):0,g=Math.pow(v,2),y=Math.pow(g,2);e=1-this.es*Math.pow(c,2),f/=Math.sqrt(e);var x=r(s,c,l,this.en);i=this.a*(this.k0*f*(1+p/6*(1-g+d+p/20*(5-18*g+y+14*d-58*g*d+p/42*(61+179*y-y*g-479*g)))))+this.x0,n=this.a*(this.k0*(x-this.ml0+c*u*f/2*(1+p/12*(5-g+9*d+4*m+p/30*(61+y-58*g+270*d-330*g*d+p/56*(1385+543*y-y*g-3111*g))))))+this.y0}else{var _=l*Math.sin(u);if(Math.abs(Math.abs(_)-1)<h)return 93;if(i=.5*this.a*this.k0*Math.log((1+_)/(1-_))+this.x0,n=l*Math.cos(u)/Math.sqrt(1-Math.pow(_,2)),_=Math.abs(n),_>=1){if(_-1>h)return 93;n=0}else n=Math.acos(n);s<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},e.inverse=function(t){var e,i,n,r,c=(t.x-this.x0)*(1/this.a),l=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+l/this.k0,i=o(e,this.es,this.en),Math.abs(i)<s){var f=Math.sin(i),p=Math.cos(i),d=Math.abs(p)>h?Math.tan(i):0,m=this.ep2*Math.pow(p,2),v=Math.pow(m,2),g=Math.pow(d,2),y=Math.pow(g,2);e=1-this.es*Math.pow(f,2);var x=c*Math.sqrt(e)/this.k0,_=Math.pow(x,2);e*=d,n=i-e*_/(1-this.es)*.5*(1-_/12*(5+3*g-9*m*g+m-4*v-_/30*(61+90*g-252*m*g+45*y+46*m-_/56*(1385+3633*g+4095*y+1574*y*g)))),r=a(this.long0+x*(1-_/6*(1+2*g+m-_/20*(5+28*g+24*y+8*m*g+6*m-_/42*(61+662*g+1320*y+720*y*g))))/p)}else n=s*u(l),r=0;else{var b=Math.exp(c/this.k0),M=.5*(b-1/b),w=this.lat0+l/this.k0,E=Math.cos(w);e=Math.sqrt((1-Math.pow(E,2))/(1+Math.pow(M,2))),n=Math.asin(e),l<0&&(n=-n),r=0===M&&0===E?0:a(Math.atan2(M,E)+this.long0)}return t.x=r,t.y=n,t},e.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},function(t,e,i){function n(t,e){return(t.datum.datum_type===a||t.datum.datum_type===s)&&"WGS84"!==e.datumCode||(e.datum.datum_type===a||e.datum.datum_type===s)&&"WGS84"!==t.datumCode}var r=.017453292519943295,o=57.29577951308232,a=1,s=2,h=i(400),u=i(389),c=i(82),l=i(227);t.exports=function t(e,i,a){var s;return Array.isArray(a)&&(a=l(a)),e.datum&&i.datum&&n(e,i)&&(s=new c("WGS84"),a=t(e,s,a),e=s),"enu"!==e.axis&&(a=u(e,!1,a)),"longlat"===e.projName?a={x:a.x*r,y:a.y*r}:(e.to_meter&&(a={x:a.x*e.to_meter,y:a.y*e.to_meter}),a=e.inverse(a)),e.from_greenwich&&(a.x+=e.from_greenwich),a=h(e.datum,i.datum,a),i.from_greenwich&&(a={x:a.x-i.grom_greenwich,y:a.y}),"longlat"===i.projName?a={x:a.x*o,y:a.y*o}:(a=i.forward(a),i.to_meter&&(a={x:a.x/i.to_meter,y:a.y/i.to_meter})),"enu"!==i.axis?u(i,!0,a):a}},function(t,e,i){function n(t,e,i){t[e]=i.map(function(t){var e={};return r(t,e),e}).reduce(function(t,e){return u(t,e)},{})}function r(t,e){var i;return Array.isArray(t)?(i=t.shift(),"PARAMETER"===i&&(i=t.shift()),1===t.length?Array.isArray(t[0])?(e[i]={},r(t[0],e[i])):e[i]=t[0]:t.length?"TOWGS84"===i?e[i]=t:(e[i]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(i)>-1?(e[i]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[i].auth=t[2])):"SPHEROID"===i?(e[i]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[i].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(i)>-1?(t[0]=["name",t[0]],n(e,i,t)):t.every(function(t){return Array.isArray(t)})?n(e,i,t):r(t,e[i])):e[i]=!0,void 0):void(e[t]=!0)}function o(t,e){var i=e[0],n=e[1];!(i in t)&&n in t&&(t[i]=t[n],3===e.length&&(t[i]=e[2](t[i])))}function a(t){return t*h}function s(t){function e(e){var i=t.to_meter||1;return parseFloat(e,10)*i}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=parseFloat(t.UNIT.convert,10)*t.DATUM.SPHEROID.a):t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.GEOGCS.DATUM?t.datumCode=t.GEOGCS.DATUM.name.toLowerCase():t.datumCode=t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var i=function(e){return o(t,e)},n=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",a],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",a],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",a],["lat0","latitude_of_origin",a],["lat0","standard_parallel_1",a],["lat1","standard_parallel_1",a],["lat2","standard_parallel_2",a],["alpha","azimuth",a],["srsCode","name"]];n.forEach(i),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=a(t.lat1>0?90:-90),t.lat_ts=t.lat1)}var h=.017453292519943295,u=i(229);t.exports=function(t,e){var i=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),n=i.shift(),o=i.shift();i.unshift(["name",o]),i.unshift(["type",n]),i.unshift("output");var a={};return r(i,a),s(a.output),u(e,a.output)}},function(t,e){t.exports="attribute vec2      uv_wgs84;\nattribute vec3      position;\nattribute vec3      normal;\n\nuniform sampler2D   dTextures_00[1];\nuniform vec3        offsetScale_L00[1];\nuniform int         texturesCount;\nuniform mat4        mVPMatRTC;\n\nvoid main() {\n\n        vec4 vPosition;\n\n        if(texturesCount > 0) {\n            vec2    vVv = vec2(uv_wgs84.x * offsetScale_L00[0].z + offsetScale_L00[0].x,(1.0 - uv_wgs84.y) * offsetScale_L00[0].z + offsetScale_L00[0].y);\n\n            float   dv  = max(texture2D( dTextures_00[0], vVv ).w, 0.);\n\n            vPosition   = vec4(position + normal * dv, 1.0 );\n        }\n        else {\n            vPosition = vec4(position, 1.0);\n        }\n\n        gl_Position = mVPMatRTC * vPosition;\n\n        #ifdef USE_LOGDEPTHBUF\n\n            gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n            #ifdef USE_LOGDEPTHBUF_EXT\n\n                vFragDepth = 1.0 + gl_Position.w;\n\n            #else\n\n                gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n            #endif\n\n        #endif\n\n}\n"},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){this.scene=null,this.commandsTree=null,this.projection=new C.default,this.viewerDiv=null,this.callback=null}function o(t,e){t.updateStrategy||(t.updateStrategy={type:O.STRATEGY_MIN_NETWORK_TRAFFIC}),e.tileInsideLimit&&(t.tileInsideLimit=e.tileInsideLimit.bind(e)),e.tileTextureCount&&(t.tileTextureCount=e.tileTextureCount.bind(e)),e.preprocessDataLayer&&e.preprocessDataLayer(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(277),s=n(a),h=i(13),u=n(h),c=i(9),l=n(c),f=i(49),p=n(f),d=i(273),m=n(d),v=i(92),g=n(v),y=i(243),x=n(y),_=i(89),b=n(_),M=i(242),w=n(M),E=i(88),S=n(E),T=i(239),P=n(T),L=i(6),A=i(25),C=n(A),R=i(19),I=n(R),O=i(95),D=!1,N=new p.default("globe-loaded"),U=new p.default("rangeChanged"),F=new p.default("centerchanged"),z=new p.default("orientationchanged"),B=new p.default("panchanged"),G=new p.default("layeradded"),j=new p.default("layerremoved"),k=new p.default("layerchanged"),V=new p.default("layerchanged:visible"),H=new p.default("layerchanged:opacity"),W=new p.default("layerchanged:index"),q=new p.default("error"),X=!1,Y=function(){var t={};return t.promise=new l.default(function(e,i){t.resolve=e,t.reject=i}),t};r.prototype.constructor=r,r.prototype.add=function(){},r.prototype.createCommand=function(){},r.prototype.execute=function(){},r.prototype.getProtocolProvider=function(t){return this.scene.scheduler.getProtocolProvider(t)},r.prototype.init=function(){var t=this.scene.getMap();t.tiles.init(t.layersConfiguration.getGeometryLayers()[0],t.layersConfiguration.lightingLayers[0])},r.prototype.addGeometryLayer=function(t){o(t,this.scene.scheduler.getProtocolProvider(t.protocol));var e=this.scene.getMap();e.layersConfiguration.addGeometryLayer(t)},r.prototype.addImageryLayer=function(t){o(t,this.scene.scheduler.getProtocolProvider(t.protocol));var e=this.scene.getMap();e.layersConfiguration.addColorLayer(t),this.viewerDiv.dispatchEvent(G)},r.prototype.addFeatureLayer=function(t){o(t,this.scene.scheduler.getProtocolProvider(t.protocol));var e=this.scene.getMap();e.layersConfiguration.addGeometryLayer(t),e.add(t.root.parent),this.scene.gfxEngine.add3DScene(t.root)},r.prototype.addImageryLayerFromJSON=function(t){var e=this;return I.default.json(t).then(function(t){e.addImageryLayer(t)})},r.prototype.addImageryLayersFromJSONArray=function(t){var e=this,i=[],n=!0,r=!1,o=void 0;try{for(var a,s=(0,u.default)(t);!(n=(a=s.next()).done);n=!0){var h=a.value;i.push(I.default.json(h).then(this.addImageryLayer.bind(this)))}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return l.default.all(i).then(function(){return e.scene.getMap().layersConfiguration.getColorLayers()})},r.prototype.addFeatureLayerFromJSON=function(t){var e=this;return I.default.json(t).then(function(t){e.addFeatureLayer(t)})},r.prototype.addFeatureLayersFromJSONArray=function(t){var e=this,i=[],n=!0,r=!1,o=void 0;try{for(var a,s=(0,u.default)(t);!(n=(a=s.next()).done);n=!0){var h=a.value;i.push(I.default.json(h))}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return l.default.all(i).then(function(t){var i=!0,n=!1,r=void 0;try{for(var o,a=(0,u.default)(t);!(i=(o=a.next()).done);i=!0){var s=o.value;e.addFeatureLayer(s)}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e.scene.getMap().layersConfiguration.getGeometryLayers()})},r.prototype.addFeatureFromJSON=function(t,e){var i=this;return I.default.json(t).then(function(t){(0,s.default)(t,e),i.addFeature(t)})},r.prototype.addFeaturesFromJSONArray=function(t){var e=this,i=[],n=!0,r=!1,o=void 0;try{for(var a,s=(0,u.default)(t);!(n=(a=s.next()).done);n=!0){var h=a.value;i.push(I.default.json(h))}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return l.default.all(i).then(function(t){var i=!0,n=!1,r=void 0;try{for(var o,a=(0,u.default)(t);!(i=(o=a.next()).done);i=!0){var s=o.value;e.addFeature(s)}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}})},r.prototype.moveLayerUp=function(t){this.scene.getMap().layersConfiguration.moveLayerUp(t),this.scene.getMap().updateLayersOrdering(),this.scene.renderScene3D()},r.prototype.moveLayerDown=function(t){this.scene.getMap().layersConfiguration.moveLayerDown(t),this.scene.getMap().updateLayersOrdering(),this.scene.renderScene3D()},r.prototype.moveLayerToIndex=function(t,e){this.scene.getMap().layersConfiguration.moveLayerToIndex(t,e),this.scene.getMap().updateLayersOrdering(),this.scene.renderScene3D(),W.layerIndex=e,W.layerId=t,this.viewerDiv.dispatchEvent(W)},r.prototype.removeImageryLayer=function(t){return!!this.scene.getMap().layersConfiguration.removeColorLayer(t)&&(this.scene.getMap().removeColorLayer(t),this.scene.renderScene3D(),j.layer=t,this.viewerDiv.dispatchEvent(j),!0)},r.prototype.addElevationLayer=function(t){o(t,this.scene.scheduler.getProtocolProvider(t.protocol));var e=this.scene.getMap();e.layersConfiguration.addElevationLayer(t),this.viewerDiv.dispatchEvent(G)},r.prototype.addElevationLayersFromJSON=function(t){var e=this;return I.default.json(t).then(function(t){e.addElevationLayer(t)})},r.prototype.addElevationLayersFromJSONArray=function(t){for(var e=this,i=[],n=0;n<t.length;n++)i.push(I.default.json(t[n]).then(this.addElevationLayer.bind(this)));return l.default.all(i).then(function(){return e.scene.getMap().layersConfiguration.getElevationLayers()})},r.prototype.getMinZoomLevel=function(t){var e=this.getImageryLayers()[t];if(e&&e.zoom)return e.zoom.min;for(var i=this.getImageryLayers(),n=1/0,r=i.length-1;r>=0;r--)i[r].zoom&&(n=Math.min(n,i[r].zoom.min));
return n},r.prototype.getMaxZoomLevel=function(t){var e=this.getImageryLayers()[t];if(e&&e.zoom)return e.zoom.max;for(var i=this.getImageryLayers(),n=0,r=i.length-1;r>=0;r--)i[r].zoom&&(n=Math.max(n,i[r].zoom.max));return n},r.prototype.getImageryLayers=function(){var t=this.scene.getMap();return t.layersConfiguration.getColorLayers()},r.prototype.createSceneGlobe=function(t,e){var i=this;this.viewerDiv=e,e.addEventListener("globe-built",function(){D===!1?(D=!0,i.scene.currentControls().updateCameraTransformation(),i.scene.updateScene3D(),e.dispatchEvent(N)):e.dispatchEvent(q)},!1);var n=!1,r=!1,o=new L.C.EPSG_4326(t.longitude,t.latitude,t.altitude);this.scene=(0,m.default)(o,e,r,n);var a=new g.default(n);this.scene.add(a);var s=new x.default({support:a.gLDebug});this.scene.scheduler.addProtocolProvider("wmts",s),this.scene.scheduler.addProtocolProvider("wmtsc",s),this.scene.scheduler.addProtocolProvider("tile",new w.default),this.scene.scheduler.addProtocolProvider("wms",new b.default({support:a.gLDebug}));var h=new S.default;return this.scene.scheduler.addProtocolProvider("wfs",h),this.scene.scheduler.addProtocolProvider("geojson",h),this.sceneLoadedDeferred=Y(),this.addEventListener("globe-loaded",function(){i.sceneLoadedDeferred.resolve(),i.sceneLoadedDeferred=Y()}),this.scene},r.prototype.update=function(){this.scene.notifyChange(0,!0)},r.prototype.showClouds=function(t,e){this.scene.getMap().showClouds(t,e),this.scene.renderScene3D()},r.prototype.setRealisticLightingOn=function(t){this.scene.setLightingPos(),this.scene.getMap().setRealisticLightingOn(t);var e=this.scene.getMap().layersConfiguration.lightingLayers[0];e.enable=t,e.position=this.scene.lightingPos,this.scene.browserScene.updateMaterialUniform("lightingEnabled",t),this.scene.renderScene3D()},r.prototype.setLayerVisibility=function(t,e){this.scene.getMap().setLayerVisibility(t,e),this.update(),V.layerId=t,V.visible=e,this.viewerDiv.dispatchEvent(V)},r.prototype.animateTime=function(t){this.scene.animateTime(t)},r.prototype.orbit=function(t){this.scene.orbit(t)},r.prototype.setLayerOpacity=function(t,e){this.scene.getMap().setLayerOpacity(t,e),this.scene.renderScene3D(),H.layerId=t,H.opacity=e,this.viewerDiv.dispatchEvent(H)},r.prototype.setStreetLevelImageryOn=function(t){this.scene.setStreetLevelImageryOn(t)},r.prototype.getCameraOrientation=function(){var t=this.scene.currentControls().getTilt(),e=this.scene.currentControls().getHeading();return[t,e]},r.prototype.getCameraLocation=function(){var t=this.scene.currentCamera().camera3D;return this.projection.cartesianToGeo(t.position)},r.prototype.getCenter=function(){var t=this.scene.currentControls();return this.projection.cartesianToGeo(t.getTargetCameraPosition())},r.prototype.setCameraOrientation=function(t,e){var i=this;return this.scene.currentControls().setOrbitalPosition(void 0,t.heading,t.tilt,e).then(function(){i.viewerDiv.dispatchEvent(z)})},r.prototype.pickPosition=function(t,e){t&&(t.clientX?(t.x=t.clientX,t.y=t.clientY):(t.x=t,t.y=e));var i=this.scene.getPickPosition(t);return this.scene.renderScene3D(),this.projection.cartesianToGeo(i)},r.prototype.getTilt=function(){var t=this.scene.currentControls().getTilt();return t},r.prototype.getHeading=function(){var t=this.scene.currentControls().getHeading();return t},r.prototype.getRange=function(){return this.scene.currentControls().getRange()},r.prototype.getRangeFromEllipsoid=function(){var t=this.scene.currentControls(),e=this.scene.getEllipsoid(),i=t.getRay(),n=e.intersection(i),r=this.scene.currentCamera().position(),o=n.distanceTo(r);return o},r.prototype.setAnimationEnabled=function(t){X=t},r.prototype.isAnimationEnabled=function(){return X},r.prototype.setTilt=function(t,e){var i=this;return e=e||this.isAnimationEnabled(),z.oldTilt=this.getTilt(),this.scene.currentControls().setTilt(t,e).then(function(){i.viewerDiv.dispatchEvent(z),i.scene.notifyChange(1)})},r.prototype.setHeading=function(t,e){var i=this;return e=e||this.isAnimationEnabled(),z.oldHeading=this.getHeading(),this.scene.currentControls().setHeading(t,e).then(function(){i.viewerDiv.dispatchEvent(z),i.scene.notifyChange(1)})},r.prototype.resetTilt=function(t){return t=t||this.isAnimationEnabled(),this.scene.currentControls().setTilt(0,t)},r.prototype.resetHeading=function(t){return t=t||this.isAnimationEnabled(),this.scene.currentControls().setHeading(0,t)},r.prototype.computeDistance=function(t,e){return this.scene.getEllipsoid().computeDistance(new L.C.EPSG_4326(t.lon,t.lat,t.alt),new L.C.EPSG_4326(e.lon,e.lat,e.alt))},r.prototype.setSceneLoaded=function(){return D=!1,this.sceneLoadedDeferred.promise},r.prototype.setCenter=function(t,e){var i=this;e=e||this.isAnimationEnabled(),F.oldCenter=this.getCenter();var n=new L.C.EPSG_4326(t.longitude,t.latitude,0).as("EPSG:4978").xyz();return n.range=t.range,this.scene.currentControls().setCenter(n,e).then(function(){return i.scene.notifyChange(1),i.setSceneLoaded().then(function(){i.scene.currentControls().updateCameraTransformation(),i.viewerDiv.dispatchEvent(F)})})},r.prototype.setCenterAdvanced=function(t,e){var i=this;return e=e||this.isAnimationEnabled(),this.setCenter(t,e).then(function(){var n=i.scene.currentControls().setOrbitalPosition(void 0,t.heading,t.tilt,e);return n})},r.prototype.setRange=function(t,e){var i=this;return e=e||this.isAnimationEnabled(),U.oldRange=this.getRange(),this.scene.currentControls().setRange(t,e).then(function(){i.scene.notifyChange(1),i.setSceneLoaded().then(function(){i.scene.currentControls().updateCameraTransformation(),i.viewerDiv.dispatchEvent(U)})})},r.prototype.pan=function(t){var e=this;this.scene.currentControls().pan(t.x,t.y),this.scene.notifyChange(1),this.setSceneLoaded().then(function(){e.scene.currentControls().updateCameraTransformation(),e.viewerDiv.dispatchEvent(B)})},r.prototype.getZoomLevel=function(){return this.scene.getMap().getZoomLevel()},r.prototype.setZoomLevel=function(t,e){t=Math.max(this.getMinZoomLevel(),t),t=Math.min(this.getMaxZoomLevel(),t);var i=this.scene.getMap().computeDistanceForZoomLevel(t,this.scene.currentCamera());return this.setRange(i,e)},r.prototype.getZoomScale=function(t){t=(t||.28)/1e3;var e=this.scene.currentCamera(),i=this.scene.currentControls().getTargetCameraPosition(),n=i.length(),r=i.distanceTo(e.camera3D.position),o=n+r,a=e.FOV/180*Math.PI*.5,s=Math.PI-Math.asin(o/n*Math.sin(a)),h=void 0;h=isNaN(s)?2*o*Math.tan(a):2*n*Math.sin(s+a);var u=e.height*t/h;return u},r.prototype.setZoomScale=function(t,e,i){e=(e||.28)/1e3;var n=this.scene.currentCamera(),r=n.height*e/t,o=this.scene.currentControls().getTargetCameraPosition().length(),a=n.FOV/180*Math.PI*.5,s=void 0,h=r/(2*o);if(h<1){var u=Math.asin(h);s=o*Math.sin(u+a)/Math.sin(a)}else s=o/Math.tan(a)*h;var c=s-o;return this.setRange(c,i)},r.prototype.addEventListener=function(t,e){"layerchanged"==t?(this.viewerDiv.addEventListener("layerchanged",e,!1),this.addEventListenerLayerChanged()):this.viewerDiv.addEventListener(t,e,!1)},r.prototype.addEventListenerLayerChanged=function(){this.viewerDiv.addEventListener("layerchanged:visible",this.callbackLayerChanged,!1),this.viewerDiv.addEventListener("layerchanged:opacity",this.callbackLayerChanged,!1),this.viewerDiv.addEventListener("layerchanged:index",this.callbackLayerChanged,!1)},r.prototype.callbackLayerChanged=function(){this.dispatchEvent(k)},r.prototype.removeEventListener=function(t,e){"layerchanged"==t?(this.viewerDiv.removeEventListener("layerchanged",e,!1),this.removeEventListenerLayerChanged()):this.viewerDiv.removeEventListener(t,e,!1)},r.prototype.removeEventListenerLayerChanged=function(){this.viewerDiv.removeEventListener("layerchanged:visible",this.callbackLayerChanged,!1),this.viewerDiv.removeEventListener("layerchanged:opacity",this.callbackLayerChanged,!1),this.viewerDiv.removeEventListener("layerchanged:index",this.callbackLayerChanged,!1)},r.prototype.selectNodeById=function(t){this.scene.selectNodeId(t),this.scene.update(),this.scene.renderScene3D()},r.prototype.loadGPX=function(t){var e=this;(0,P.default)(t).then(function(t){t&&e.scene.getMap().gpxTracks.children[0].add(t)}),this.scene.renderScene3D()},r.prototype.addFeature=function(t){if(void 0===t)throw new Error("options is required");var e=this.scene.getMap(),i=e.layersConfiguration.getGeometryLayerById(t.layerId);if(t.type&&i){var n=this.scene.scheduler.getProtocolProvider("wfs").featureToolBox,r=n.processingGeoJSON(t);i.root.add(r)}},r.prototype.pickFeature=function(t,e){if(void 0==t)throw new Error("position is required");var i=this.scene.getMap(),n=i.layersConfiguration.getGeometryLayerById(e);return this.scene.gfxEngine.getPickObject3d(t,n.root.children)},r.prototype.removeFeature=function(t){var e=t.featureId,i=t.layerId,n=this.scene.getMap(),r=n.layersConfiguration.getGeometryLayerById(i);r.root.children.splice(e,1)},e.default=r},function(t,e){"use strict";function i(){this.commands=null,this.events=null,this.timer=null}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.connect=function(){},i.prototype.command=function(){},i.prototype.wait=function(){var t=250;null===this.timer?this.timer=window.setTimeout(this.command,t):(window.clearInterval(this.timer),this.timer=window.setTimeout(this.command,t))},e.default=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t){this.WFS_Provider=new g.default(t),this.geometry=null,this.geometryRoof=null,this.pivot=null,this.roadOn=!0,this.rtcOn=!0}Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),s=r(a),h=i(3),u=r(h),c=i(2),l=n(c),f=i(115),p=r(f),d=i(24),m=r(d),v=i(88),g=r(v),y=i(6),x=r(y);o.prototype=(0,u.default)(m.default.prototype),o.prototype.constructor=o,o.prototype.url=function t(e,i,n){var r="72hpsel8j8nhb5qgdh07gcyp",o="service=WFS&version=2.0.0&REQUEST=GetFeature&typeName=BDTOPO_BDD_WLD_WGS84G:bati_remarquable,BDTOPO_BDD_WLD_WGS84G:bati_indifferencie",a=new l.Vector2(e-n,i-n),s=new l.Vector2(e+n,i+n),t="http://wxs.ign.fr/"+r+"/geoportail/wfs?"+o+"&bbox="+a.x+","+a.y+","+s.x+","+s.y+",epsg:4326&outputFormat=json";return t},o.prototype.getData=function(t,e){var i=this;return this.WFS_Provider.getData(t).then(function(n){return i.generateMesh(n,t,e),i.geometry})},o.prototype.generateMesh=function(t,e,i){var n=new l.Geometry,r=new l.Geometry,o=new l.Geometry,a=10,h=t.features,u=i-1.5,c=!0,f=!1,d=void 0;try{for(var m,v=(0,s.default)(h);!(c=(m=v.next()).done);c=!0){var g=m.value,_=g.properties.hauteur+a||0,b=u,M=g.geometry.coordinates[0][0],w=[];if(M.length>2){for(var E=0;E<M.length-1;++E){var S=M[E],T=new l.Vector3(parseFloat(S[0]),0,parseFloat(S[1])),P=new x.default("EPSG:4326",T.x,T.z,b),L=new x.default("EPSG:4326",T.x,T.z,b+_),A=P.as("EPSG:4978").xyz(),C=L.as("EPSG:4978").xyz(),R=new l.Vector3(A.x,A.y,A.z),I=new l.Vector3(C.x,C.y,C.z);w.push(T.z,T.x),r.vertices.push(R,I)}for(var O=r.vertices.length-2*(M.length-1);O<r.vertices.length;O+=2){var D=O;D>r.vertices.length-4&&(D=r.vertices.length-2*(M.length-1)),r.faces.push(new l.Face3(D,D+1,D+3)),r.faces.push(new l.Face3(D,D+3,D+2))}var N=r.vertices.length-2*(M.length-1);r.faces.push(new l.Face3(N,N+1,r.vertices.length-1)),r.faces.push(new l.Face3(N,r.vertices.length-1,r.vertices.length-2))}for(var U=(0,p.default)(w),F=0;F<U.length;F+=3){var z=new l.Vector2(w[2*U[F]],w[2*U[F]+1]),B=new l.Vector2(w[2*U[F+1]],w[2*U[F+1]+1]),G=new l.Vector2(w[2*U[F+2]],w[2*U[F+2]+1]),j=new y.C.EPSG_4326(z.x,z.y,b+_),k=new y.C.EPSG_4326(B.x,B.y,b+_),V=new y.C.EPSG_4326(G.x,G.y,b+_);n.vertices.push(j.as("EPSG:4978").xyz()),n.vertices.push(k.as("EPSG:4978").xyz()),n.vertices.push(V.as("EPSG:4978").xyz());var H=new l.Face3(o.vertices.length-3,o.vertices.length-2,o.vertices.length-1);o.faces.push(H)}}}catch(t){f=!0,d=t}finally{try{!c&&v.return&&v.return()}finally{if(f)throw d}}this.roadOn&&this.addRoad(r,e,u),r.computeFaceNormals(),o.computeFaceNormals();var W=new l.Vector3;if(this.rtcOn){W=r.vertices[0].clone();var q=!0,X=!1,Y=void 0;try{for(var Z,Q=(0,s.default)(r.vertices);!(q=(Z=Q.next()).done);q=!0){var J=Z.value;J.sub(W)}}catch(t){X=!0,Y=t}finally{try{!q&&Q.return&&Q.return()}finally{if(X)throw Y}}var K=!0,$=!1,tt=void 0;try{for(var et,it=(0,s.default)(o.vertices);!(K=(et=it.next()).done);K=!0){var nt=et.value;nt.sub(W)}}catch(t){$=!0,tt=t}finally{try{!K&&it.return&&it.return()}finally{if($)throw tt}}}return this.geometry=r,this.pivot=W,this.geometryRoof=o,{geometry:r,pivot:W,geometryRoof:o}},o.prototype.addRoad=function(t,e,i){var n=.2,r=(e.east()-e.west())*n,o=(e.north()-e.south())*n,a=new l.Vector3((e.south()+e.north())/2,i,(e.west()+e.east())/2),s=new x.default("EPSG:4326",a.x-r,a.z-o,i),h=new x.default("EPSG:4326",a.x-r,a.z+o,i),u=new x.default("EPSG:4326",a.x+r,a.z+o,i),c=new x.default("EPSG:4326",a.x+r,a.z-o,i),f=s.as("EPSG:4978").xyz(),p=h.as("EPSG:4978").xyz(),d=u.as("EPSG:4978").xyz(),m=c.as("EPSG:4978").xyz();t.vertices.push(new l.Vector3(f.x,f.y,f.z)),t.vertices.push(new l.Vector3(p.x,p.y,p.z)),t.vertices.push(new l.Vector3(d.x,d.y,d.z)),t.vertices.push(new l.Vector3(m.x,m.y,m.z));var v=t.vertices.length;t.faces.push(new l.Face3(v-4,v-3,v-2)),t.faces.push(new l.Face3(v-4,v-2,v-1))},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t){return t.getElementsByTagName("wpt")}function a(t){return t.getElementsByTagName("trkpt")}function s(t){var e=Number(t.attributes.lon.nodeValue),i=Number(t.attributes.lat.nodeValue),n=Number(t.getElementsByTagName("ele")[0].childNodes[0].nodeValue);return new g.default("EPSG:4326",e,i,n).as("EPSG:4978").xyz()}function h(t){var e=o(t);if(e.length){for(var i=new p.Color("rgb(0, 255, 0)"),n=new b.default({useTexture:!1,color:[i.r,i.g,i.b],opacity:1}),r=0;r<e.length;r++)void 0===t.center&&(t.center=s(e[0])),n.addPoint(s(e[r]).sub(t.center),i,600);return n.process(),n}return null}function u(t){var e=a(t);if(e.length){for(var i=new p.Color("rgb(255, 0, 0)"),n=new x.default({linewidth:20,useTexture:!1,opacity:1,sizeAttenuation:!1,color:[i.r,i.g,i.b]}),r=0;r<e.length;r++)void 0===t.center&&(t.center=s(e[0])),n.addPoint(s(e[r]).sub(t.center));return n.process(),n}return null}function c(t){if(t){var e=new p.Object3D,i=u(t);i&&e.add(i);var n=h(t);return n&&e.add(n),e.matrixWorld.elements=new Float64Array(16),e.matrix.elements=new Float64Array(16),e.position.copy(t.center),e.updateMatrixWorld(),e.matrixAutoUpdate=!1,e.matrixWorldNeedsUpdate=!1,e}}function l(t){return m.default.xml(t).then(function(t){return c(t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var f=i(2),p=r(f),d=i(19),m=n(d),v=i(6),g=n(v),y=i(94),x=n(y),_=i(262),b=n(_)},function(t,e){"use strict";function i(){}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.constructor=i,i.prototype.load=function(){},i.prototype.write=function(){},i.prototype.readAsync=function(){},i.prototype.writeAsync=function(){},e.default=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t){t&&(M=t,w=t.pano,E=t.url,S=t.cam),this.panoInfo=null,this.geometry=null,this.material=null,this.absoluteCenter=null,this.geometryRoof=null,this.panoramicMesh=null,this.projectiveTexturedMesh=null}Object.defineProperty(e,"__esModule",{value:!0});var a=i(9),s=r(a),h=i(3),u=r(h),c=i(2),l=n(c),f=i(24),p=r(f),d=i(238),m=r(d),v=i(263),g=r(v),y=i(20),x=r(y),_=i(260),b=r(_),M=null,w="",E="",S="",T=void 0;o.prototype=(0,u.default)(p.default.prototype),o.prototype.constructor=o,o.prototype.init=function(t){w=t.pano,E=t.url,S=t.cam},o.prototype.getMetaDataFromPos=function(t,e){var i=this;if(null==T){var n=w;T=new s.default(function(t,e){var i=new XMLHttpRequest;i.open("GET",n),i.onload=function(){200===i.status?t(JSON.parse(i.response)):e(Error(i.statusText))},i.onerror=function(){e(Error("Network Error"))},i.send()})}return T.then(function(n){for(var r=0,o=99999,a=0;a<n.length;++a){var s=n[a],h=Math.sqrt((s.longitude-t)*(s.longitude-t)+(s.latitude-e)*(s.latitude-e));h<o&&(r=a,o=h)}return i.panoInfo=n[r],n[r]})},o.prototype.getTextureMaterial=function(t,e){return g.default.init(M,t,e)},o.prototype.updateTextureMaterial=function(t,e){g.default.updateUniforms(t,e)},o.prototype.getGeometry=function(t,e,i){var n=.003,r={minCarto:{longitude:t-n,latitude:e-n},maxCarto:{longitude:t+n,latitude:e+n}},o=o||{url:"http://wxs.ign.fr/72hpsel8j8nhb5qgdh07gcyp/geoportail/wfs?",typename:"BDTOPO_BDD_WLD_WGS84G:bati_remarquable,BDTOPO_BDD_WLD_WGS84G:bati_indifferencie",bbox:r,epsgCode:4326},a=new m.default(o);return a.getData(o.bbox,i).then(function(){return{geometry:a.geometry,pivot:a.pivot,roof:a.geometryRoof}})},o.prototype.getTextureProjectiveMesh=function(t,e,i){var n=this;return this.getMetaDataFromPos(t,e,i).then(function(t){return n.getGeometry(t.longitude,t.latitude,t.altitude)}).then(function(t){return n.geometry=t.geometry,n.absoluteCenter=t.pivot,n.geometryRoof=t.roof,n.getTextureMaterial(n.panoInfo,n.absoluteCenter)}).then(function(t){this.material=t,this.panoramicMesh=new b.default(this.geometry,this.material,this.absoluteCenter);var e=new b.default(this.geometryRoof,new x.default(new l.Color(14540253)),this.absoluteCenter);return e.material.side=l.DoubleSide,e.material.transparent=!0,e.setDisplayed(!0),e.material.uniforms.lightingEnabled.value=!1,this.panoramicMesh.add(e),this.panoramicMesh})},o.prototype.updateMaterialImages=function(t,e,i){var n=this;return this.getMetaDataFromPos(t,e,i).then(function(t){return n.updateTextureMaterial(t,n.absoluteCenter),t})},o.prototype.getUrlImageFile=function(){return E},o.prototype.getMetaDataSensorURL=function(){return S},o.prototype.getMetaDataSensor=function(){},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){c.default.call(this,null),this.projection=new f.default,this.builder=new d.default(this.projection),this.nNode=0}Object.defineProperty(e,"__esModule",{value:!0});var o=i(9),a=n(o),s=i(3),h=n(s),u=i(24),c=n(u),l=i(25),f=n(l),p=i(246),d=n(p),m=i(249),v=n(m);r.prototype=(0,h.default)(c.default.prototype),r.prototype.constructor=r,r.prototype.executeCommand=function(t){var e=t.bbox,i=t.requester,n={bbox:e,level:void 0===t.level?i.level+1:t.level,segment:16},r=new v.default(n,this.builder),o=new t.type(r,n);return o.setUuid(this.nNode++),o.link=i.link,o.geometricError=Math.pow(2,18-n.level),i.worldToLocal(n.center),o.position.copy(n.center),o.setVisibility(!1),i.add(o),o.updateMatrix(),o.updateMatrixWorld(),o.OBB().parent=o,o.OBB().update(),a.default.resolve(o)},e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t){v.default.call(this,new M.default),this.cache=(0,T.default)(),this.projection=new y.default,this.support=t.support||!1,this.getTextureFloat=null,this.support?this.getTextureFloat=function(){return new d.Texture}:this.getTextureFloat=function(t){var e=new d.DataTexture(t,P,P,d.AlphaFormat,d.FloatType);return e.needsUpdate=!0,e}}function a(t,e,i){t.wmtsCoords||(t.wmtsCoords={});var n=e.options.tileMatrixSet;if(!(n in t.wmtsCoords)){var r=i.WGS84toWMTS(t.bbox);t.wmtsCoords[n]=i.getCoordWMTS_WGS84(r,t.bbox,n)}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),h=r(s),u=i(279),c=r(u),l=i(3),f=r(l),p=i(2),d=n(p),m=i(24),v=r(m),g=i(25),y=r(g),x=i(90),_=r(x),b=i(87),M=r(b),w=i(19),E=r(w),S=i(39),T=r(S),P=256;o.prototype=(0,f.default)(v.default.prototype),o.prototype.constructor=o,o.prototype.customUrl=function(t,e,i,n,r){var o=Math.min(t.zoom.max,i),a=e.replace("%TILEMATRIX",o.toString());return a=a.replace("%ROW",n.toString()),a=a.replace("%COL",r.toString())},o.prototype.removeLayer=function(){},o.prototype.preprocessDataLayer=function(t){if(t.fx=t.fx||0,"wmtsc"===t.protocol)t.zoom={min:2,max:20};else{var e=t.options;e.version=e.version||"1.0.0",e.tileMatrixSet=e.tileMatrixSet||"WGS84",e.mimetype=e.mimetype||"image/png",e.style=e.style||"normal",e.projection=e.projection||"EPSG:3857";var i=t.url+"?LAYER="+e.name+"&FORMAT="+e.mimetype+"&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET="+e.tileMatrixSet;if(i+="&TILEMATRIX=%TILEMATRIX&TILEROW=%ROW&TILECOL=%COL",e.tileMatrixSetLimits){var n=(0,c.default)(e.tileMatrixSetLimits),r=n.length,o=Number(n[r-1]),a=o-r+1;t.zoom={min:a,max:o}}else t.zoom={min:2,max:20};t.customUrl=i}},o.prototype.url=function(t,e){return this.customUrl(e,e.customUrl,t.zoom,t.row,t.col)},o.prototype.getXbilTexture=function(t,e,i){var n=this,r=t.wmtsCoords[e.options.tileMatrixSet][0],o=new d.Vector3(0,0,1);if(i.ancestor){var a=r.zoom-t.level;r=this.projection.WMTS_WGS84Parent(r,this.computeLevelToDownload(t,i.ancestor,e)+a,o)}var s=this.url(r,e),u=this.cache.getRessource(s);if(void 0!==u){var c=this._IoDriver.computeMinMaxElevation(u.floatArray,P,P,o);return h.default.resolve({pitch:o,texture:u.texture,min:c.min,max:c.max})}return this._IoDriver.read(s).then(function(t){return t.pitch=o,t.texture=n.getTextureFloat(t.floatArray),t.texture.generateMipmaps=!1,t.texture.magFilter=d.LinearFilter,t.texture.minFilter=d.LinearFilter,n.cache.addRessource(s,{texture:t.texture,floatArray:t.floatArray}),t})},o.prototype.getColorTexture=function(t,e,i){var n=this,r={pitch:e},o=this.url(t,i);if(r.texture=this.cache.getRessource(o),void 0!==r.texture)return h.default.resolve(r);var a=E.default.texture(o),s=a.texture,u=a.promise;return r.texture=s,r.texture.generateMipmaps=!1,r.texture.magFilter=d.LinearFilter,r.texture.minFilter=d.LinearFilter,r.texture.anisotropy=16,u.then(function(){return n.cache.addRessource(o,r.texture),r.texture.needsUpdate=!0,r})},o.prototype.executeCommand=function(t){var e=t.layer,i=t.requester;a(i,e,this.projection);var n={"image/png":this.getColorTextures.bind(this),"image/jpg":this.getColorTextures.bind(this),"image/jpeg":this.getColorTextures.bind(this),"image/x-bil;bits=32":this.getXbilTexture.bind(this)},r=n[e.options.mimetype];return r?r(i,e,t):h.default.reject(new Error("Unsupported mimetype "+e.options.mimetype))},o.prototype.computeLevelToDownload=function(t,e,i){var n=e?e.level:t.level;return Math.min(i.zoom.max,Math.max(i.zoom.min,n))},o.prototype.tileTextureCount=function(t,e){a(t,e,this.projection);var i=e.options.tileMatrixSet;return t.wmtsCoords[i][1].row-t.wmtsCoords[i][0].row+1},o.prototype.tileInsideLimit=function(t,e){return e.zoom.min<=t.level},o.prototype.getColorTextures=function(t,e,i){var n=[];if(null===t.material)return h.default.resolve();if(this.tileInsideLimit(t,e))for(var r=t.wmtsCoords[e.options.tileMatrixSet],o=r[1].row;o>=r[0].row;o--){var a=new _.default(r[0].zoom,o,r[0].col),s=new d.Vector3(0,0,1);if(i.ancestor){var u=a.zoom-t.level;a=this.projection.WMTS_WGS84Parent(a,this.computeLevelToDownload(t,i.ancestor,e)+u,s)}n.push(this.getColorTexture(a,s,e))}return n.length?h.default.all(n):h.default.resolve()},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(6),o=n(r),a={getSunPosition:function(){function t(t){return t.valueOf()/y-.5+x}function e(e){return t(e)-_}function i(t,e){return v(f(t)*p(b)-d(e)*f(b),p(t))}function n(t,e){return m(f(e)*p(b)+p(e)*f(b)*f(t))}function r(t,e,i){return v(f(t),p(t)*f(e)-d(i)*p(e))}function o(t,e,i){return m(f(e)*f(i)+p(e)*p(i)*p(t))}function a(t,e){return g*(280.16+360.9856235*t)-e}function s(t){return g*(357.5291+.98560028*t)}function h(t){return g*(1.9148*f(t)+.02*f(2*t)+3e-4*f(3*t))}function u(t,e){var i=102.9372*g;return t+e+i+l}var c=Math,l=c.PI,f=c.sin,p=c.cos,d=c.tan,m=c.asin,v=c.atan2,g=l/180,y=864e5,x=2440588,_=2451545,b=23.4397*g;return function(t,c,f){var p=g*-f,d=g*c,m=e(t),v=s(m),y=h(v),x=u(v,y),_=n(x,0),b=i(x,0),M=a(m,p),w=M-b;return{EclipticLongitude:x,declinaison:_,ascension:b,H:w,SiderealTime:M,altitude:o(w,d,_),azimuth:r(w,d,_)+l/2}}},getSunPositionInScene:function(t,e,i){var n=a.getSunPosition()(t,e,i),r=864e5,s=n.ascension+t%r/r*-360+180,h=new o.default("EPSG:4326",s,e,5e7).as("EPSG:4978").xyz();return h}};e.default=a},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){this.center=t||new a.Vector3,this.radius=e||1}Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=n(o);r.prototype.constructor=r,r.prototype.setCenter=function(t){this.center.copy(t)},r.prototype.setRadius=function(t){this.radius=t};var s=new a.Vector3;r.prototype.intersectWithRayNoMiss=function(t){var e=t.closestPointToPoint(this.center),i=e.length(),n=void 0,r=void 0;if(i>this.radius){var o=e.clone().setLength(2*this.radius-i);return n=t.direction.subVectors(o,t.origin).normalize(),e=t.closestPointToPoint(this.center),i=e.length(),r=Math.sqrt(this.radius*this.radius-i*i),n.setLength(r),s.addVectors(e,n)}return n=t.direction.clone(),r=Math.sqrt(this.radius*this.radius-i*i),n.setLength(r),s.subVectors(e,n)},r.prototype.intersectWithRay=function(t){var e=t.closestPointToPoint(this.center),i=e.length();if(!(i>this.radius)){var n=t.direction.clone(),r=Math.sqrt(this.radius*this.radius-i*i);return n.setLength(r),s.subVectors(e,n)}},e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t){this.projector=t}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),s=r(a),h=i(6),u=i(265),c=n(u);o.prototype.constructor=o,o.prototype.Prepare=function(t){t.nbRow=Math.pow(2,t.level+1);var e=this.projector.WGS84ToOneSubY(t.bbox.south());isFinite(e)||(e=0);var i=1/t.nbRow,n=e%i;t.deltaUV1=(e-n)*t.nbRow,t.projected={longitudeRad:0,latitudeRad:0}},o.prototype.Center=function(t){return t.center=t.bbox.center().as("EPSG:4978").xyz(),t.center},o.prototype.VertexPosition=function(t){return t.cartesianPosition=new h.C.EPSG_4326_Radians(t.projected.longitudeRad,t.projected.latitudeRad).as("EPSG:4978"),t.cartesianPosition},o.prototype.VertexNormal=function(t){return t.cartesianPosition.xyz().normalize()},o.prototype.uProjecte=function(t,e){e.projected.longitudeRad=this.projector.UnitaryToLongitudeWGS84(t,e.bbox)},o.prototype.vProjecte=function(t,e){e.projected.latitudeRad=this.projector.UnitaryToLatitudeWGS84(t,e.bbox)},o.prototype.getUV_PM=function(t){var e=this.projector.WGS84ToOneSubY(t.projected.latitudeRad)*t.nbRow;return isFinite(e)||(e=0),e-t.deltaUV1},o.prototype.OBB=function(t){var e=[],i=t.center.clone().normalize(),n=t.bbox.dimensions(h.UNIT.RADIAN),r=t.bbox.west(),o=n.x,a=t.bbox.south(),u=n.y;e.push(new h.C.EPSG_4326_Radians(r,a)),e.push(new h.C.EPSG_4326_Radians(r+.5*n.x,a)),e.push(new h.C.EPSG_4326_Radians(r+o,a)),e.push(new h.C.EPSG_4326_Radians(r+o,a+.5*n.y)),e.push(new h.C.EPSG_4326_Radians(r+o,a+u)),e.push(new h.C.EPSG_4326_Radians(r+.5*n.x,a+u)),e.push(new h.C.EPSG_4326_Radians(r,a+u)),e.push(new h.C.EPSG_4326_Radians(r,a+.5*n.y));var l=[],f=[],p=new s.Vector3(-1e3,-1e3,-1e3),d=new s.Vector3(1e3,1e3,1e3),m=0,v=new s.Quaternion,g=new s.Quaternion,y=new s.Vector3,x=new s.Plane(i);v.setFromUnitVectors(i,new s.Vector3(0,1,0)),g.setFromAxisAngle(new s.Vector3(0,1,0),-t.bbox.center()._values[0]),g.multiply(v);for(var _=0;_<e.length;_++)l.push(e[_].as("EPSG:4978")),f.push(x.projectPoint(l[_].xyz())),y.subVectors(l[_].xyz(),t.center),m=Math.max(m,f[_].distanceTo(y)),f[_].applyQuaternion(g),p.max(f[_]),d.min(f[_]);m*=.5;var b=.5*Math.abs(p.z-d.z),M=.5*Math.abs(p.x-d.x),w=M-Math.abs(f[5].x),E=new s.Vector3(b,M,m),S=new s.Vector3(-b,-M,-m),T=new s.Vector3(0,w,-m),P=new c.default(S,E,i,T);return P},e.default=o},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){l.default.call(this),this.providerWMS=new p.default({}),this.loader=new u.TextureLoader,this.loader.crossOrigin="",this.live=!1,this.satelliteAnimation=!0,this.texture=null,this.geometry=new u.SphereGeometry(64e5,96,96),this.uniforms={diffuse:{type:"t",value:new u.Texture},time:{type:"f",value:0},lightingEnabled:{value:!1},lightPosition:{type:"v3",value:y.LIGHTING_POSITION.clone().normalize()}},this.material=new u.ShaderMaterial({uniforms:this.uniforms,vertexShader:g.default,fragmentShader:m.default,transparent:!0,wireframe:!1}),this.rotation.y+=Math.PI,this.visible=!1}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h),c=i(15),l=r(c),f=i(89),p=r(f),d=i(437),m=r(d),v=i(438),g=r(v),y=i(60);o.prototype=(0,s.default)(l.default.prototype),o.prototype.constructor=o,o.prototype.generate=function(t){var e=this;if(this.satelliteAnimation=t,t){this.live=!0;var i=document.getElementById("video");this.texture=new u.VideoTexture(i),this.texture.minFilter=u.LinearFilter,this.texture.magFilter=u.LinearFilter,this.texture.format=u.RGBFormat,this.material.blending=u.AdditiveBlending,this.material.uniforms.diffuse.value=this.texture,this.material.uniforms.diffuse.needsUpdate=!0,this.animate()}else{this.live=!0;var n={latBound:new u.Vector2(-85,85),longBound:new u.Vector2(-178,178),width:2048,height:1024},r=this.providerWMS.urlGlobalIR(n,0);this.loader.load(r,function(t){e.material.blending=u.NormalBlending,e.material.uniforms.diffuse.value=t,e.material.uniforms.diffuse.needsUpdate=!0,e.animate()})}},o.prototype.animate=function(){this.satelliteAnimation||(this.material.uniforms.time.value+=.01),requestAnimationFrame(this.animate.bind(this))},o.prototype.setLightingOn=function(t){this.material.uniforms.lightingEnabled.value=t},o.prototype.updateLightingPos=function(t){this.material.uniforms.lightPosition.value=t.clone().normalize()},e.default=o},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(){var t=a.UniformsUtils.clone(s.uniforms),e=new a.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:t,side:a.BackSide}),i=new a.SphereBufferGeometry(4e4,32,15),n=new a.Mesh(i,e);this.mesh=n,this.uniforms=t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=n(o),s={uniforms:{luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},sunPosition:{type:"v3",value:new a.Vector3},up:{type:"v3",value:new a.Vector3(0,1,0)}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix *  vec4( cameraPosition + position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( cameraPosition + position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","uniform vec3 up;","varying vec3 vWorldPosition;","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminance = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035; // depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{ ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","//     return log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","vec3 up2 = normalize(cameraPosition.xyz);","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up2));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up2, normalize(vWorldPosition - cameraPosition))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPosition), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up2, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPosition);","float theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPosition).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1. - ( (length(cameraPosition) - 6400000.) / 1000.);","}"].join("\n")
};r.prototype.constructor=r,e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){this.index=null,this.position=null,this.normal=null,this.uv={wgs84:null,pm:null}}function a(t,e){c.BufferGeometry.call(this),this.center=e.Center(t),this.OBB=e.OBB(t);var i=this.computeBuffers(t,e);this.setIndex(i.index),this.addAttribute("position",i.position),this.addAttribute("normal",i.normal),this.addAttribute("uv_wgs84",i.uv.wgs84),this.addAttribute("uv_pm",i.uv.pm),i.position=null,i.normal=null,i.uv.pm=null,p.getRessource(t.segment)||p.addRessource(t.segment,i),this.computeBoundingSphere()}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),h=r(s),u=i(2),c=n(u),l=i(39),f=r(l),p=(0,f.default)();a.prototype=(0,h.default)(c.BufferGeometry.prototype),a.prototype.constructor=a,a.prototype.computeBuffers=function(t,e){function i(t,e,i,n){return r.index[n+0]=t,r.index[n+1]=e,r.index[n+2]=i,n+3}var n=new o,r=new o,a=t.segment||32,s=(a+1)*(a+1)+8*(a-1),h=a*a+16*(a-1);r.position=new Float32Array(3*s),r.normal=new Float32Array(3*s),r.uv.pm=new Float32Array(s);var u=p.getRessource(t.segment);u?(n.index=u.index,n.uv.wgs84=u.uv.wgs84):(r.index=new Uint32Array(3*h*2),r.uv.wgs84=new Float32Array(2*s));var l=Math.max(2,Math.floor(a)||2),f=Math.max(2,Math.floor(a)||2),d=0,m=void 0,v=void 0,g=[],y=[],x=[],_=void 0,b=void 0;e.Prepare(t);var M=function(){},w=function(){};null===n.uv.wgs84&&(M=function(t,e,i,n){t.uv.wgs84[2*e+0]=i,t.uv.wgs84[2*e+1]=n}),null===n.uv.pm&&e.getUV_PM&&(w=function(t,e,i){t.uv.pm[e]=i});var E=void 0,S=void 0,T=void 0,P=void 0,L=void 0;for(v=0;v<=f;v++){var A=[];b=v/f,e.vProjecte(b,t);var C=e.getUV_PM?e.getUV_PM(t):void 0;for(m=0;m<=l;m++){_=m/l,e.uProjecte(_,t);var R=e.VertexPosition(t,t.projected);E=3*d,r.position[E+0]=R.x()-this.center.x,r.position[E+1]=R.y()-this.center.y,r.position[E+2]=R.z()-this.center.z;var I=e.VertexNormal(t);r.normal[E+0]=I.x,r.normal[E+1]=I.y,r.normal[E+2]=I.z,M(r,d,_,b),w(r,d,C),0!==v&&v!==f&&(m===l?y.push(d):0===m&&x.push(d)),A.push(d),d++}g.push(A),0===v?y=y.concat(A):v===f&&(y=y.concat(A.slice().reverse()))}y=y.concat(x.reverse());var O=0;if(null===n.index)for(v=0;v<f;v++)for(m=0;m<l;m++)S=g[v][m+1],T=g[v][m],P=g[v+1][m],L=g[v+1][m+1],O=i(L,T,S,O),O=i(L,P,T,O);var D=d,N=5*(20-t.level+10),U=function(){},F=function(){};null===n.index&&(U=function(t,e,n,r,o){return t=i(e,n,r,t),t=i(e,r,o,t)},F=function(t){r.uv.wgs84[2*d+0]=r.uv.wgs84[2*t+0],r.uv.wgs84[2*d+1]=r.uv.wgs84[2*t+1]});for(var z=0;z<y.length;z++){var B=y[z];E=3*d;var G=3*B;r.position[E+0]=r.position[G+0]-r.normal[G+0]*N,r.position[E+1]=r.position[G+1]-r.normal[G+1]*N,r.position[E+2]=r.position[G+2]-r.normal[G+2]*N,r.normal[E+0]=r.normal[G+0],r.normal[E+1]=r.normal[G+1],r.normal[E+2]=r.normal[G+2],F(B),r.uv.pm[d]=r.uv.pm[B];var j=(z+1)%y.length;S=B,T=d,P=d+1,L=y[j],0===j&&(P=D),O=U(O,S,T,P,L),d++}return null===n.index&&(n.index=new c.BufferAttribute(r.index,1)),n.position=new c.BufferAttribute(r.position,3),n.normal=new c.BufferAttribute(r.normal,3),null===n.uv.wgs84&&(n.uv.wgs84=new c.BufferAttribute(r.uv.wgs84,2)),n.uv.pm=new c.BufferAttribute(r.uv.pm,1),r.position=null,r.bufferIndex=null,r.normal=null,r.uv.wgs84=null,r.uv.pm=null,n},e.default=a},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(p.default.call(this),this.matrixAutoUpdate=!1,this.rotationAutoUpdate=!1,!e.bbox)throw new Error("params.bbox is mandatory to build a TileMesh");this.level=e.level,this.bbox=e.bbox,this.geometry=t,this.normal=e.center.clone().normalize(),this.centerSphere=(new l.Vector3).addVectors(this.geometry.boundingSphere.center,e.center),this.oSphere=new l.Sphere(this.centerSphere.clone(),this.geometry.boundingSphere.radius),this.texturesNeeded=0,this.materials=[],this.materials[b.default.FINAL]=new m.default,this.materials[b.default.DEPTH]=new g.default(this.materials[b.default.FINAL]),this.materials[b.default.ID]=new x.default(this.materials[b.default.FINAL]),this.material=this.materials[b.default.FINAL],this.frustumCulled=!1,this.setDisplayed(!1)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),s=r(a),h=i(3),u=r(h),c=i(2),l=n(c),f=i(15),p=r(f),d=i(93),m=r(d),v=i(257),g=r(v),y=i(259),x=r(y),_=i(61),b=r(_);o.prototype=(0,u.default)(p.default.prototype),o.prototype.constructor=o,o.prototype.dispose=function(){this.material.dispose(),this.geometry.dispose(),this.geometry=null,this.material=null},o.prototype.setUuid=function(t){this.id=t,this.materials[b.default.FINAL].setUuid(t),this.materials[b.default.ID].setUuid(t)},o.prototype.getUuid=function(t){return this.materials[b.default.ID].getUuid(t)},o.prototype.setColorLayerParameters=function(t,e){if(!this.loaded){var i=this.materials[b.default.FINAL];i.setLightingOn(e.enable),i.uniforms.lightPosition.value=e.position,i.setColorLayerParameters(t)}},o.prototype.disposeChildren=function(){for(this.pendingSubdivision=!1;this.children.length>0;){var t=this.children[0];if(this.remove(t),t.dispose(),t.content){var e=t.content;e.forEach(function(t){t.parent&&t.parent.remove(t);for(var e=t.children.length-1;e>=0;e--)t.children[e].geometry.dispose(),t.children[e].material.dispose()})}}},o.prototype.setDisplayed=function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=(0,s.default)(this.materials);!(e=(r=o.next()).done);e=!0){var a=r.value;a.visible=t}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}t&&this.content.forEach(function(t){t.visible=!0})},o.prototype.enableRTC=function(t){this.materials[b.default.FINAL].enableRTC(t)},o.prototype.changeState=function(t){t!==b.default.FINAL&&(this.materials[t].visible=this.materials[b.default.FINAL].visible),this.material=this.materials[t]},o.prototype.setFog=function(t){this.materials[b.default.FINAL].setFogDistance(t)},o.prototype.setMatrixRTC=function(t){var e=!0,i=!1,n=void 0;try{for(var r,o=(0,s.default)(this.materials);!(e=(r=o.next()).done);e=!0){var a=r.value;a.setMatrixRTC(t)}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}},o.prototype.setDebug=function(t){this.materials[b.default.FINAL].setDebug(t)},o.prototype.setSelected=function(t){this.materials[b.default.FINAL].setSelected(t)},o.prototype.setTextureElevation=function(t){if(null!==this.materials[b.default.FINAL]){var e=t.pitch||new l.Vector3(0,0,1);this.setBBoxZ(t.min,t.max),this.materials[b.default.FINAL].setTexture(t.texture,d.l_ELEVATION,0,e),this.materials[b.default.DEPTH].uniforms.texturesCount.value=this.materials[b.default.FINAL].loadedTexturesCount[0],this.materials[b.default.ID].uniforms.texturesCount.value=this.materials[b.default.FINAL].loadedTexturesCount[0],this.loadingCheck()}},o.prototype.setBBoxZ=function(t,e){if(Math.floor(t)!==Math.floor(this.bbox.bottom())||Math.floor(e)!==Math.floor(this.bbox.top())){this.bbox.setBBoxZ(t,e);var i=this.geometry.OBB.addHeight(this.bbox),n=this.normal.clone().setLength(i.y);this.geometry.boundingSphere.radius=Math.sqrt(i.x*i.x+this.oSphere.radius*this.oSphere.radius),this.centerSphere=(new l.Vector3).addVectors(this.oSphere.center,n)}},o.prototype.setTexturesLayer=function(t,e,i){null!==this.material&&(t&&this.material.setTexturesLayer(t,e,i),this.loadingCheck())},o.prototype.isColorLayerDownscaled=function(t){var e=this.materials[b.default.FINAL];return e.isColorLayerDownscaled(t,this.level)},o.prototype.isLayerTypeDownscaled=function(t){var e=this.materials[b.default.FINAL];return e.isLayerTypeDownscaled(t,this.level)},o.prototype.normals=function(){return this.geometry.normals},o.prototype.fourCorners=function(){return this.geometry.fourCorners},o.prototype.normal=function(){return this.geometry.normal},o.prototype.center=function(){return this.geometry.center},o.prototype.OBB=function(){return this.geometry.OBB},o.prototype.allTexturesAreLoaded=function(){return this.texturesNeeded===this.materials[b.default.FINAL].getLoadedTexturesCount()},o.prototype.loadingCheck=function(){this.allTexturesAreLoaded()&&(this.loaded=!0,this.parent.childrenLoaded())},o.prototype.getIndexLayerColor=function(t){return this.materials[b.default.FINAL].indexOfColorLayer(t)},o.prototype.removeColorLayer=function(t){var e=this.materials[b.default.FINAL].indexOfColorLayer(t),i=this.materials[b.default.FINAL].getTextureCountByLayerIndex(e);this.materials[b.default.FINAL].removeColorLayer(t),this.texturesNeeded-=i,this.loadingCheck()},o.prototype.changeSequenceLayers=function(t){var e=this.materials[b.default.FINAL].getColorLayersCount();e<2||this.materials[b.default.FINAL].setSequence(t)},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.viewer=void 0;var r=i(236),o=n(r),a="undefined"!=typeof window?window:{},s=a.itowns||{viewer:new o.default};a.itowns=s;e.viewer=s.viewer;e.default=a.itowns},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(){var t=this;l.default.call(this),this.panoramicMesh=null,this.name="MobileMappingLayer",this.mainMesh=new u.Object3D,this.add(this.mainMesh),this.panoramicProvider=null,this.domElement=document,window.addEventListener("mousedown",function(e){2===e.button&&t.updateData()},!1)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h),c=i(30),l=r(c),f=i(26),p=r(f),d=i(25),m=r(d),v=i(241),g=r(v),y=i(6),x=r(y);o.prototype=(0,s.default)(l.default.prototype),o.prototype.constructor=o,o.prototype.initiatePanoramic=function(t){var e=this,i=t||this.getDefaultOptions();this.panoramicProvider=new g.default(i),this.panoramicProvider.getTextureProjectiveMesh(2.3348138,48.850603,1e3).then(function(t){e.panoramicMesh=t,e.mainMesh.add(e.panoramicMesh),(0,p.default)().renderScene();var i=e.panoramicProvider.panoInfo,n=new x.default("EPSG:4326",i.longitude,i.latitude,i.altitude),r=n.as("EPSG:4978").xyz();e.moveCameraToScanPosition(r)})},o.prototype.updateData=function(){var t=this,e=(0,p.default)().controls.getPickingPosition(),i=(new m.default).cartesianToGeo(e),n=i.longitude/Math.PI*180,r=i.latitude/Math.PI*180;this.panoramicProvider.updateMaterialImages(n,r,1e3).then(function(e){var i=new x.default("EPSG:4326",e.longitude,e.latitude,e.altitude),n=i.as("EPSG:4978").xyz();t.moveCameraToScanPosition(n)})},o.prototype.moveCameraToScanPosition=function(t){var e=this,i=.1,n=(0,p.default)().camera.camera3D.position.clone(),r=n.x+(t.x-n.x)*i,o=n.y+(t.y-n.y)*i,a=n.z+(t.z-n.z)*i;(0,p.default)().camera.camera3D.position.set(r,o,a),(0,p.default)().update();var s=new u.Vector3(r,o,a);s.distanceTo(t)>.2&&setTimeout(function(){e.moveCameraToScanPosition(t,s)},20)},o.prototype.getDefaultOptions=function(){var t={url:"../{lod}/images/{YYMMDD2}/Paris-{YYMMDD2}_0740-{cam.cam}-00001_{splitIt}.jpg",lods:["itowns-sample-data"],cam:"../dist/itowns-sample-data/cameraCalibration.json",pano:"../dist/itowns-sample-data/panoramicsMetaData.json",buildings:"../dist/itowns-sample-data/buildingFootprint.json",DTM:"../dist/itowns-sample-data/dtm.json",YYMMDD2:function(){return this.pano.filename.match("-(.*?)_")[1]},splitIt:function(){return this.pano.filename.split("_")[2]},YYMMDD:function(){var t=new Date(this.pano.date);return(""+t.getUTCFullYear()).slice(-2)+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2)},UTCOffset:15,seconds:function(){var t=new Date(this.pano.date);return 60*(60*t.getUTCHours()+t.getUTCMinutes())+t.getUTCSeconds()-this.UTCOffset},visible:!0};return t},e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=r(o),s=i(254),h=n(s),u={initiated:!1,options:null,sensors:[],init:function(t){var e=this,i=t.cam;return fetch(i).then(function(t){if(t.status<200||t.status>=300)throw new Error("Error loading "+i+": status "+t.status);return t.json()}).then(function(t){return e.handleDBData(t),e.initiated})},handleDBData:function(t){for(var e=0;e<t.length;++e)this.sensors.push(new h.default(t[e]));this.initiated=!0},computeMatOriFromHeadingPitchRoll:function(t,e,i){t=(180-parseFloat(t))/180*Math.PI,e=parseFloat(e)/180*Math.PI,i=parseFloat(i)/180*Math.PI;var n=(new a.Quaternion).setFromEuler(new a.Euler(-e,t,-i,"YXZ"),!0);return(new a.Matrix3).makeRotationFromQuaternion(n)},getPosition:function(){for(var t=new a.Vector3(0,0,0),e=0;e<this.sensors.length;++e)t=t.add(this.sensors[e].position);return t.divideScalar(this.sensors.length)},getDistortion:function(t){return this.sensors[t].distortion},getSommet:function(t){return this.sensors[t].position},getProjection:function(t){return this.sensors[t].projection},getRotation:function(t){return this.sensors[t].rotation},getMask:function(t){return this.sensors[t].mask},getSize:function(t){return this.sensors[t].size},getPPS:function(t){return this.sensors[t].pps},getMatrix:function(t){return(new a.Matrix3).multiplyMatrices(this.getRotation(t),this.getProjection(t))}};e.default=u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),o=n(r),a=function(t){if(this.infos=t,this.position=(new o.Vector3).fromArray(t.position),this.rotation=(new o.Matrix3).fromArray(t.rotation),this.projection=(new o.Matrix3).fromArray(t.projection),this.size=(new o.Vector2).fromArray(t.size),t.distortion){this.pps=(new o.Vector2).fromArray(t.distortion.pps);var e=(new o.Vector3).fromArray(t.distortion.poly357),i=this.getDistortion_r2max(e);this.distortion=new o.Vector4(e.x,e.y,e.z,i)}this.mask=t.mask,this.orientation=t.orientation,this._itownsWay=(new o.Matrix3).set(0,-1,0,0,0,-1,1,0,0),this.Photogram_JMM=(new o.Matrix3).set(0,0,-1,-1,0,0,0,1,0),this.photgramme_image=(new o.Matrix3).set(1,0,0,0,-1,0,0,0,-1),this.rotation=this.getMatOrientationTotal(),this.position.applyMatrix3(this._itownsWay)};a.prototype.getDistortion_r2max=function(t){var e=this.cardan_cubic_roots(7*t.z,5*t.y,3*t.x,1),i=-1;for(var n in e)e[n]>0&&(i===-1||e[i]>e[n])&&(i=n);return i===-1?1/0:e[i]},a.prototype.getMatOrientationTotal=function(){var t=this.rotation.clone();return t=(new o.Matrix3).multiplyMatrices(t.clone(),this.Photogram_JMM.clone()),t=(new o.Matrix3).multiplyMatrices(t.clone(),this.getMatOrientationCapteur().clone()),t=(new o.Matrix3).multiplyMatrices(t.clone(),this.photgramme_image.clone()),t=(new o.Matrix3).multiplyMatrices(this._itownsWay,t.clone())},a.prototype.getMatOrientationCapteur=function(){var t=(new o.Matrix3).set(0,-1,0,1,0,0,0,0,1),e=(new o.Matrix3).set(0,1,0,-1,0,0,0,0,1),i=(new o.Matrix3).set(-1,0,0,0,-1,0,0,0,1),n=(new o.Matrix3).set(1,0,0,0,1,0,0,0,1);switch(this.orientation){case 0:return t;case 1:return e;case 2:return i;case 3:default:return n}},a.prototype.cardan_cubic_roots=function t(e,i,n,r){var t=function(t,e,i,n){if(0===t)return o(e,i,n);var r=-e/(3*t),a=t*t,h=e*e,u=t*a,c=e*h,l=i/t-h/(3*a),f=c/(13.5*u)+n/t-e*i/(3*a);if(0===l){var p=s(-f)+r;return[p,p,p]}var d=l*l*l*4/27,m=f*f+d;if(m>0){var v=Math.sqrt(m),g=s((-f+v)/2),y=s((-f-v)/2);return[g+y+r]}if(0===m){var x=3*f/l,_=r+x,b=r-.5*x;return[_,b,b]}var M=Math.acos(-f/Math.sqrt(d)),w=2*Math.sqrt(-l/3);return[w*Math.cos(M/3)+r,w*Math.cos((M+Math.PI)/3)+r,w*Math.cos((M+2*Math.PI)/3)+r]},o=function(t,e,i){var n=e*e-4*t*i;if(n<0)return[];var r=-e/(2*t);if(0===n)return[r];var o=Math.sqrt(n)/(2*t);return[r-o,r+o]},a=function(t){return(t>0)-(t<0)},s=function(t){return a(t)*Math.pow(Math.abs(t),1/3)};return t(e,i,n,r)},e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={shadersURL:null,shaderNum:null,shaders:{},loaded:!1,attributes:{displacementx:{type:"f",value:[]},displacementy:{type:"f",value:[]},displacementz:{type:"f",value:[]},colorattribute:{type:"v3",value:[]},uniqueid:{type:"i",value:[]}},uniformslaser:{indice_time_laser:{type:"f",value:1},currentidwork:{type:"f",value:100},point_size:{type:"f",value:1},alpha:{type:"f",value:.5},colortest:{type:"v3",value:{}},nb_time:{type:"i",value:0}},init:function(t){this.shadersURL=t,this.shaderNum=t.length},loadShaders:function(){function t(t,n){e++,i.shaders[n]=t,e===i.shaderNum&&(i.loaded=!0)}for(var e=0,i=this,n=function(e){var n=i.shadersURL[e],r=new XMLHttpRequest;r.open("GET",n,!0),r.onload=function(){r.status>=200&&r.status<400&&t(r.responseText,n.substr(n.lastIndexOf("/")+1))},r.onerror=function(){},r.send()},r=0;r<i.shaderNum;r++)n(r)},shaderTextureProjectiveVS:function(t){return["#ifdef GL_ES","precision  highp float;","#endif","#ifdef USE_LOGDEPTHBUF","#define EPSILON 1e-6","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;"," #endif","uniform float logDepthBufFC;","#endif","#define N "+t,"uniform int useRTC;","uniform mat4 mVPMatRTC;","uniform mat3 mvpp[N];","uniform vec3 translation[N];","varying vec3 v_texcoord[N];","vec4 pos;","void main() {","    pos =  vec4(position,1.);","    for(int i=0; i<N; ++i) v_texcoord[i] = mvpp[i] * (position-translation[i]);","    mat4 projModelViewMatrix = (useRTC == 0) ? projectionMatrix * modelViewMatrix : mVPMatRTC;","    gl_Position  =  projModelViewMatrix * pos;","#ifdef USE_LOGDEPTHBUF","    gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;","    #ifdef USE_LOGDEPTHBUF_EXT","       vFragDepth = 1.0 + gl_Position.w;","    #else","       gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;","     #endif","  #endif","}"].join("\n")},shaderTextureProjectiveFS:function(t,e,i){e=e||[],i=i||[];for(var n=0,r=0;r<e.length;++r)n<=e[r]&&(n=e[r]+1);for(var o=0,a=0;a<i.length;++a)o<=i[a]&&(o=i[a]+1);for(var s="",h=0;h<t;++h){var u=e[h],c=i[h];s+=["if(v_texcoord["+h+"].z>0.) {","  vec2 p =  v_texcoord["+h+"].xy/v_texcoord["+h+"].z;",c>=0?"  distort(p,distortion["+c+"],pps["+c+"]);":"","  float d = borderfadeoutinv * getUV(p,size["+h+"]);",u>=0?"  d = min(d,1.-texture2D(mask["+u+"],p).r);":"","  if(d>0.) { ","    vec4 c = d*texture2D(texture["+h+"],p);","    color0 += c;","    color  += c * alpha["+h+"];","    if(c.a>0.) ++blend;","  }","}",""].join("\n")}return["#ifdef GL_ES","precision  highp float;","#endif","#ifdef USE_LOGDEPTHBUF","#define EPSILON 1e-6","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;"," #endif","uniform float logDepthBufFC;","#endif","#define M "+n,"#define D "+o,"#define N "+t,"varying vec3      v_texcoord[N];",n>0?"uniform sampler2D mask[M];":"","uniform sampler2D texture[N];","uniform float     alpha[N];","uniform vec2      size[N];",o>0?"uniform vec2      pps[D];":"",o>0?"uniform vec4      distortion[D];":"","const float amin = 0.5;","const float borderfadeoutinv = 0.02;","void distort(inout vec2 p, vec4 dist, vec2 pps)","{ ","  vec2 v = p - pps;","  float v2 = dot(v,v);","  if(v2>dist.w) p = vec2(-1.);","  else p += (v2*(dist.x+v2*(dist.y+v2*dist.z)))*v;","}","float getUV(inout vec2 p, vec2 size)"," {  ","   vec2 d = min(p.xy,size-p.xy);","   p/=size;","   return min(d.x,d.y);"," }"," void main(void)"," { "," #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)","        gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;","      #endif","  vec4 color  = vec4(0.);","  vec4 color0 = vec4(0.);","  int blend = 0;",s,"  if(color0.a>1.) color0 /= color0.a;","  gl_FragColor = (blend>1 && color.a>amin) ? color/color.a : color/amin+(1.-color.a/amin)*color0; //vec4(1.,0.,0.,1.); ","} "].join("\n")},shaderLaserVS:["    #ifdef GL_ES ","    precision mediump float;","    #endif ","    attribute vec3 displacement; ","    attribute float uniqueid; ","    varying vec3 colorpoint;","    uniform float point_size;","    uniform float indice_time_laser;","    uniform float currentidwork;","    uniform float indice_time_laser_tab[160];","    uniform int movementLocked;","    float getSize(float id){","      return (0.5 -indice_time_laser_tab[int(id)]) * 15.;","    }","    void main()","    {","    vec3 newPosition = position;","    gl_PointSize = point_size;     //2.* clamp(6. - (position.y + 2.), 0., 6.); //getSize(uniqueid);//point_size;","    if(movementLocked!=1)","           newPosition = vec3(position.x+ displacement.x*indice_time_laser_tab[int(uniqueid)],","                              position.y+ displacement.y*indice_time_laser_tab[int(uniqueid)],","                              position.z+ displacement.z*indice_time_laser_tab[int(uniqueid)]);","           gl_Position  =  projectionMatrix *  modelViewMatrix * vec4(newPosition,1.);","          colorpoint = color;","      }"],shaderLaserFS:["      #ifdef GL_ES ","        precision mediump float;","      #endif","       varying vec3 colorpoint;","       uniform float alpha;","       uniform sampler2D texturePoint;","      void main() ","       {","         gl_FragColor = vec4(colorpoint,alpha);","      }"],shaderBati3DVS:["#ifdef GL_ES","precision mediump float;"," #endif"," uniform int textureJPG;"," attribute float materialindice;"," varying float matindice;"," varying vec2 vUv;"," varying vec3 vNormal;"," varying vec3 pos;","   void main() {"," vNormal = normal;"," vUv = vec2( uv.x, uv.y );"," if(textureJPG ==1) vUv = vec2(vUv.x, 1.- vUv.y);  "," matindice = materialindice;","     pos = position;","   gl_Position  =  projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"],shaderBati3DFS:[" #ifdef GL_ES "," precision highp float;"," #endif"," uniform sampler2D u_textures[16];","  uniform int textureJPG;","  uniform float alpha;"," uniform vec3 light;","  varying float matindice;","  varying vec2 vUv;"," varying vec3 vNormal;","  varying vec3 pos;","  vec4 color = vec4(1.,0.,0.,1.);","  void main(void)"," {","         vec2 uv = vUv;","         if (matindice<0.9)      color = texture2D(u_textures[0],uv);","         else if (matindice<1.9) color = texture2D(u_textures[1],uv);","         else if (matindice<2.9) color = texture2D(u_textures[2],uv);","         else if (matindice<3.9) color = texture2D(u_textures[3],uv);","         else if (matindice<4.9) color = texture2D(u_textures[4],uv);","         else if (matindice<5.9) color = texture2D(u_textures[5],uv);","         else if (matindice<6.9) color = texture2D(u_textures[6],uv);","         else if (matindice<7.9) color = texture2D(u_textures[7],uv);","         else if (matindice<8.9) color = texture2D(u_textures[8],uv);","         else if (matindice<9.9) color = texture2D(u_textures[9],uv);","         else if (matindice<10.9) color = texture2D(u_textures[10],uv);","         else if (matindice<11.9) color = texture2D(u_textures[11],uv);","         else if (matindice<12.9) color = texture2D(u_textures[12],uv);","         else if (matindice<13.9) color = texture2D(u_textures[13],uv);","         else if (matindice<14.9) color = texture2D(u_textures[14],uv);","         else if (matindice<15.9) color = texture2D(u_textures[15],uv);","         if(color.r == 0. && color.g ==0.) color =  vec4(vUv.x,vUv.x,vUv.x,0.5);","        else","               color.a = alpha;","    gl_FragColor = color; //vec4(1.,1.,0.,1.);//texture2D(u_textures[0],uv);"," }"]};e.default=i},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i){l.default.call(this),this.ratio=t/e,this.FOV=30,this.camera3D=new u.PerspectiveCamera(this.FOV,this.ratio),this.camera3D.matrixWorld.elements=new Float64Array(16),this.camera3D.matrixAutoUpdate=!1,this.camera3D.rotationAutoUpdate=!1,this.direction=new u.Vector3,this.frustum=new u.Frustum,this.viewMatrix=new u.Matrix4,this.width=t,this.height=e,this.updatePreSSE(),this.cameraHelper=i?new u.CameraHelper(this.camera3D):void 0}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h),c=i(62),l=r(c);o.prototype=(0,s.default)(l.default.prototype),o.prototype.constructor=o,o.prototype.position=function(){return this.camera3D.position},o.prototype.camHelper=function(){return this.cameraHelper},o.prototype.updatePreSSE=function(){this.Hypotenuse=Math.sqrt(this.width*this.width+this.height*this.height);var t=this.FOV*Math.PI/180;this.HFOV=2*Math.atan(Math.tan(.5*t)/this.ratio),this.HYFOV=2*Math.atan(Math.tan(.5*t)*this.Hypotenuse/this.width),this.preSSE=this.Hypotenuse*(2*Math.tan(.5*this.HYFOV))},o.prototype.createCamHelper=function(){this.cameraHelper=new u.CameraHelper(this.camera3D);var t=new u.Vector3(0,0,-1),e=new u.Quaternion;e.setFromAxisAngle(new u.Vector3(0,1,0),this.HFOV/2),t.applyQuaternion(e);var i=new u.Vector3,n=1e8,r=16776960;this.arrowHelper=new u.ArrowHelper(t,i,n,r),this.cameraHelper.add(this.arrowHelper)},o.prototype.matrixWorldInverse=function(){return this.camera3D.matrixWorldInverse},o.prototype.resize=function(t,e){if(this.width=t,this.height=e,this.ratio=t/e,this.updatePreSSE(),this.camera3D.aspect=this.ratio,this.camera3D.updateProjectionMatrix(),this.cameraHelper){var i=new u.Vector3(0,0,-1),n=new u.Quaternion;n.setFromAxisAngle(new u.Vector3(0,1,0),this.HFOV/2),i.applyQuaternion(n),this.arrowHelper.setDirection(i),this.cameraHelper.update()}},o.prototype.computeNodeSSE=function(t){var e=t.geometry.boundingSphere,i=Math.max(0,this.camera3D.position.distanceTo(t.centerSphere)-e.radius),n=this.preSSE*(t.geometricError/i);return n},o.prototype.update=function(){var t=new u.Vector3(0,0,1);this.direction=t.applyQuaternion(this.camera3D.quaternion),this.updateMatrixWorld(),this.viewMatrix.multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse),this.frustum.setFromMatrix(this.viewMatrix)},o.prototype.updateMatrixWorld=function(){this.camera3D.updateMatrix(),this.camera3D.updateMatrixWorld(!0),this.camera3D.matrixWorldInverse.getInverse(this.camera3D.matrixWorld)},o.prototype.getDistanceFromOrigin=function(){return this.camera3D.position.length()},o.prototype.setPosition=function(t){this.camera3D.position.copy(t)},o.prototype.setRotation=function(t){this.camera3D.quaternion.copy(t)},o.prototype.getFrustum=function(){return this.updateMatrixWorld(),this.frustum.setFromMatrix((new u.Matrix4).multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse)),this.frustum},o.prototype.getFrustumLocalSpace=function(t,e){var i=new u.Matrix4;i.makeRotationFromQuaternion(e.inverse()),i.setPosition(t.negate().applyQuaternion(e));var n=new u.Frustum;return n.setFromMatrix(i.premultiply(this.camera3D.projectionMatrix)),n},e.default=o},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(2),h=n(s),u=i(20),c=r(u),l=i(439),f=r(l),p=i(234),d=r(p),m=function(t){c.default.call(this),this.vertexShader=this.vertexShaderHeader+d.default,this.fragmentShader=this.fragmentShaderHeader+f.default,this.uniforms.dTextures_00=new h.Uniform(t.textures[0]),this.uniforms.texturesCount=new h.Uniform(t.loadedTexturesCount[0]),this.uniforms.offsetScale_L00=new h.Uniform(t.offsetScale[0])};m.prototype=(0,a.default)(c.default.prototype),m.prototype.constructor=m,e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),o=n(r),a=i(26),s=n(a),h=i(20),u=n(h),c=i(19),l=n(c),f=i(445),p=n(f),d=i(444),m=n(d),v=function(t){if(u.default.call(this),void 0===t)throw new Error("options is required");this.fragmentShader=this.fragmentShaderHeader+m.default,this.vertexShader=this.vertexShaderHeader+p.default,this.wireframe=!1;var e=t.texture?l.default.texture(t.texture):void 0;this.uniforms.THICKNESS={value:t.linewidth},this.uniforms.MITER_LIMIT={value:1},this.uniforms.WIN_SCALE={value:(0,s.default)().viewerDiv.size},e&&(this.uniforms.texture={value:e}),this.uniforms.useTexture={value:!!e&&t.useTexture},this.uniforms.opacity={value:t.opacity},this.uniforms.sizeAttenuation={value:t.sizeAttenuation},this.uniforms.color={value:t.color},this.transparent=!0};v.prototype=(0,o.default)(u.default.prototype),v.prototype.constructor=v,e.default=v},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(2),h=n(s),u=i(20),c=r(u),l=i(446),f=r(l),p=i(234),d=r(p),m=function(t){c.default.call(this),this.vertexShader=this.vertexShaderHeader+d.default,this.fragmentShader=this.fragmentShaderHeader+f.default,this.uniforms.uuid.value=t.uniforms.uuid.value,this.uniforms.diffuseColor.value=new h.Color(16777215*Math.random()),this.uniforms.dTextures_00=new h.Uniform(t.textures[0]),this.uniforms.texturesCount=new h.Uniform(t.loadedTexturesCount[0]),this.uniforms.offsetScale_L00=new h.Uniform(t.offsetScale[0])};m.prototype=(0,a.default)(c.default.prototype),m.prototype.constructor=m,m.prototype.setMatrixRTC=function(t){this.uniforms.mVPMatRTC.value=t},e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),o=n(r),a=i(15),s=n(a),h=function(t,e,i){s.default.call(this),this.matrixAutoUpdate=!1,this.rotationAutoUpdate=!1,this.geometry=t,this.material=e,this.absoluteCenter=i,this.position.copy(this.absoluteCenter),this.name="terrestrialMesh",this.frustumCulled=!1};h.prototype=(0,o.default)(s.default.prototype),h.prototype.constructor=h,h.prototype.setGeometry=function(t){this.geometry=t},h.prototype.setMaterial=function(t){this.material=t},h.prototype.setMatrixRTC=function(t){this.material.uniforms.mVPMatRTC.value=t},h.prototype.enableRTC=function(){},h.prototype.setFog=function(){},h.prototype.setSelected=function(){},e.default=h},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(2),h=n(s),u=i(20),c=r(u),l=i(19),f=r(l),p=i(448),d=r(p),m=i(447),v=r(m),g=function(t){if(c.default.call(this),void 0===t)throw new Error("options is required");this.vertexShader=d.default,this.fragmentShader=v.default;var e=t.texture?f.default.texture(t.texture):void 0;this.uniforms.time={value:t.time},this.uniforms.useTexture={value:t.useTexture},this.uniforms.texture={value:e},this.uniforms.color={value:t.color},this.uniforms.opacity={value:t.opacity},this.uniforms.resolution={value:new h.Vector2(window.innerWidth,window.innerHeight)},this.transparent=!0};g.prototype=(0,a.default)(c.default.prototype),g.prototype.constructor=g,e.default=g},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=r(o),s=i(2),h=n(s),u=i(261),c=r(u),l=function(t){if(h.Points.call(this),void 0===t)throw new Error("options is required");this.positions=[],this.colors=[],this.sizes=[],this.geometry=new h.BufferGeometry,this.material=new c.default(t)};l.prototype=(0,
a.default)(h.Points.prototype),l.prototype.constructor=l,l.prototype.addPoint=function(t,e,i){t instanceof h.Vector3&&(this.positions.push(t.x,t.y,t.z),e instanceof h.Color&&this.colors.push(e.r,e.g,e.b),this.sizes.push(i))},l.prototype.process=function(){this.geometry.addAttribute("position",new h.BufferAttribute(new Float32Array(this.positions),3)),this.geometry.addAttribute("customColor",new h.BufferAttribute(new Float32Array(this.colors),3)),this.geometry.addAttribute("size",new h.BufferAttribute(new Float32Array(this.sizes),1))},e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=r(o),s=i(456),h=n(s),u=i(26),c=n(u),l=i(253),f=n(l),p=i(255),d=n(p),m=i(58),v=n(m),g=i(6),y=n(g);window.requestAnimSelectionAlpha=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var x=null,_=null,b=1,M={},w=new v.default(new a.Vector3(6378137,6356752.314245179,6378137)),E={init:function(t,e,i){return null==_&&(_=f.default.init(t).then(function(){var t=this.getCameraFrameRotation(e);return this.createShaderMat(e,t,i),x})),_},isInitiated:function(){return null!=_},setGeneralOpacity:function(t){b=t},tweenGeneralOpacityUp:function(){b<1&&(b+=.04*(b+.01),b>1&&(b=1),window.requestAnimSelectionAlpha(this.tweenGeneralOpacityUp.bind(this)))},getCameraFrameRotation:function(t){var e=f.default.computeMatOriFromHeadingPitchRoll(t.heading,t.pitch,t.roll),i=new y.default("EPSG:4326",t.longitude,t.latitude,t.altitude),n=i.as("EPSG:4978").xyz(),r=w.geodeticSurfaceNormalCartographic(i),o=new a.Quaternion;o.setFromAxisAngle(new a.Vector3(1,0,0),Math.PI/2);var s=new a.Object3D,h=(new a.Vector3).addVectors(n.clone(),r);s.lookAt(h),s.quaternion.multiply(o),s.updateMatrix();var u=s.matrix,c=(new a.Matrix3).fromMatrix4(u),l=(new a.Matrix3).multiplyMatrices(e.clone(),c);return l},nbImages:function(){return f.default.sensors.length},nbMasks:function(){if(!M.noMask)return 0;for(var t=0,e=0;e<this.nbImages();++e)f.default.getMask(e)&&++t;return t},nbPanoramics:function(){var t=this.nbImages(),e=(0,c.default)().getRenderer().getContext(),i=this.nbMasks(),n=e.getParameter(e.MAX_VARYING_VECTORS),r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),o=Math.floor(Math.min(n,r-i)/t),a=Math.min(M.targetNbPanoramics,o);return a},loadTexture:function(t,e,i,n){t=t.format(e);var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=new a.Texture(this,a.UVMapping,a.RepeatWrapping,a.RepeatWrapping,a.LinearFilter,a.LinearFilter,a.RGBFormat);t.needsUpdate=!0,t.flipY=!1,i(t,n)};var o="../dist/itowns-sample-data/cameraCalibration.json";r.src=h.default.resolve(o,t)},createShaderMat:function(t,e,i){function n(t,e){x.uniforms.mask.value[e]=t}function r(t,e){x.uniforms.texture.value[e]=t}var o=new y.default("EPSG:4326",t.longitude,t.latitude,t.altitude),s=o.as("EPSG:4978").xyz(),h=new a.Mesh(new a.SphereGeometry(.5,12,12),new a.MeshBasicMaterial({side:a.DoubleSide,color:16711935}));h.position.copy(s),(0,c.default)().add3DScene(h);for(var u=s.clone().sub(i),l=new a.Vector4(u.x,u.y,u.z,1),p=this.nbImages(),m=this.nbPanoramics(),v={useRTC:{type:"i",value:1},mVPMatRTC:{type:"m4",value:new a.Matrix4},distortion:{type:"v4v",value:[]},pps:{type:"v2v",value:[]},size:{type:"v2v",value:[]},alpha:{type:"fv1",value:[]},mvpp:{type:"m3v",value:[]},translation:{type:"v3v",value:[]},texture:{type:"tv",value:[]},mask:{type:"tv",value:[]}},g=[],_=[],w=0;w<p;++w){var E=f.default.getMatrix(w).clone(),S=(new a.Matrix3).multiplyMatrices(e,E).transpose(),T=l.clone().add(f.default.getSommet(w).clone().applyMatrix3(e)),P=-1;!M.noMask&&f.default.getMask(w)&&(P=v.mask.value.length,v.mask.value[P]=null);var L=-1;!M.noDistortion&&f.default.getDistortion(w)&&(L=v.distortion.value.length,v.distortion.value[L]=f.default.getDistortion(w),v.pps.value[L]=f.default.getPPS(w));for(var A=0;A<m;++A){var C=w+p*A;v.size.value[C]=f.default.getSize(w),v.alpha.value[C]=b*(1-A),v.mvpp.value[C]=S,v.translation.value[C]=T,v.texture.value[C]=null,g[C]=P,_[C]=L}}x=new a.ShaderMaterial({uniforms:v,vertexShader:d.default.shaderTextureProjectiveVS(m*p),fragmentShader:d.default.shaderTextureProjectiveFS(m*p,g,_),side:a.DoubleSide,transparent:!0}),M.pano=t,M.lod=M.lods[0];for(var R=0;R<p;++R){M.cam=f.default.sensors[R].infos;var I=g[R];I>=0&&this.loadTexture(f.default.getMask(R),{},n,I),this.loadTexture(M.url,M,r,R)}return this.changePanoTextureAfterloading(t,l,e,1),x},updateUniforms:function(t,e){var i=this.getCameraFrameRotation(t),n=new y.default("EPSG:4326",t.longitude,t.latitude,t.altitude),r=n.as("EPSG:4978").xyz(),o=r.clone().sub(e),s=new a.Vector4(o.x,o.y,o.z,1);this.changePanoTextureAfterloading(t,s,i,0)},tweenIndiceTime:function(t){var e=x.uniforms.alpha.value[t];if((0,c.default)().renderScene(),e<1){var i=t+this.nbImages();e+=.03,e>1&&(e=1),x.uniforms.alpha.value[t]=b*e,x.uniforms.alpha.value[i]=b*(1-e);var n=this;window.requestAnimSelectionAlpha(function(){n.tweenIndiceTime(t)})}},changePanoTextureAfterloading:function(t,e,i,n){this.todo=[],M.pano=t,this.translation=e||new a.Vector3,this.rotation=i||new a.Matrix3;for(var r=n||0;r<M.lods.length;++r)for(var o=0;o<f.default.sensors.length;++o)this.todo.push({l:r,i:o});this.chargeOneImageCam()},chargeOneImageCam:function(){if(0!=this.todo.length){var t=this.todo.shift(),e=t.i,i=t.l,n=this;M.cam=f.default.sensors[t.i].infos,M.lod=M.lods[t.l],this.loadTexture(M.url,M,function(t){var r=f.default.getMatrix(e).clone(),o=(new a.Matrix3).multiplyMatrices(n.rotation,r).transpose(),s=f.default.getSommet(e).clone().applyMatrix3(n.rotation),h=e+n.nbImages();0===i&&h<x.uniforms.mvpp.value.length&&(x.uniforms.mvpp.value[h]=x.uniforms.mvpp.value[e],x.uniforms.translation.value[h]=x.uniforms.translation.value[e],x.uniforms.texture.value[h]=x.uniforms.texture.value[e],x.uniforms.alpha.value[h]=b,x.uniforms.alpha.value[e]=0,n.tweenIndiceTime(e)),x.uniforms.mvpp.value[e]=o,x.uniforms.translation.value[e]=n.translation.clone().add(s),x.uniforms.texture.value[e]=t,0==i?n.chargeOneImageCam():setTimeout(function(){n.chargeOneImageCam()},500)})}},getShaderMat:function(){return x}};e.default=E},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t){t.updateMatrixWorld(),this.matrixWorld=new f.Matrix4,this.projectionMatrix=new f.Matrix4,this.invProjectionMatrix=new f.Matrix4,this.position=new f.Vector3,this.matrixWorld.elements=new Float64Array(16),this.projectionMatrix.elements=new Float64Array(16),this.invProjectionMatrix.elements=new Float64Array(16),this.init=function(t){this.matrixWorld.elements.set(t.matrixWorld.elements),this.projectionMatrix.elements.set(t.projectionMatrix.elements),this.position.copy(t.position),this.invProjectionMatrix.getInverse(this.projectionMatrix)},this.init(t),this.shot=function(t){t.updateMatrixWorld(),this.matrixWorld.elements.set(t.matrixWorld.elements),this.position.copy(t.position)};var e=new f.Matrix4;e.elements=new Float64Array(16),this.updateRay=function(t,i){t.origin.copy(this.position),t.direction.set(i.x,i.y,.5),e.multiplyMatrices(this.matrixWorld,this.invProjectionMatrix),t.direction.applyMatrix4(e),t.direction.sub(t.origin).normalize()}}function a(t,e,i){W=new y.default(e);i.scene;this.camera=t,gt=new o(t),this.domElement=void 0!==e?e:document,this.enabled=!0,this.enableZoom=!0,this.zoomSpeed=1,this.minDistance=vt,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=.01,this.maxPolarAngle=.5*Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableKeys=!0,this.enableDamping=!0,mt&&(this.pickingHelper=new f.AxisHelper(5e5)),this.mouseButtons={PANORAMIC:f.MOUSE.LEFT,ZOOM:f.MOUSE.MIDDLE,PAN:f.MOUSE.RIGHT},ut.setRadius(i.size),L.radius=ut.radius,ht.set(i.width,i.height),this.changeEvent={type:"change"},this.startEvent={type:"start"},this.endEvent={type:"end"},this.updateCamera=function(t){gt.init(t.camera3D),ht.width=t.width,ht.height=t.height},this.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed},this.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},this.rotateLeft=function(t){void 0===t&&(t=this.getAutoRotationAngle()),A.theta-=t},this.rotateUp=function(t){void 0===t&&(t=this.getAutoRotationAngle()),A.phi-=t},this.panLeft=function(t){var e=this.camera.matrix.elements;N.set(e[0],e[1],e[2]),N.multiplyScalar(-t),nt.add(N)},this.panUp=function(t){var e=this.camera.matrix.elements;N.set(e[4],e[5],e[6]),N.multiplyScalar(t),nt.add(N)},this.mouseToPan=function(t,e){var i=this.domElement===document?this.domElement.body:this.domElement;if(this.camera instanceof f.PerspectiveCamera){var n=this.camera.position,r=n.clone().sub(this.getTargetCameraPosition()),o=r.length();o*=Math.tan(this.camera.fov/2*Math.PI/180),this.panLeft(2*t*o/i.clientHeight),this.panUp(2*e*o/i.clientHeight)}else this.camera instanceof f.OrthographicCamera&&(this.panLeft(t*(this.camera.right-this.camera.left)/i.clientWidth),this.panUp(e*(this.camera.top-this.camera.bottom)/i.clientHeight))},this.dollyIn=function(t){void 0===t&&(t=this.getZoomScale()),this.camera instanceof f.PerspectiveCamera?R.scale/=t:this.camera instanceof f.OrthographicCamera&&(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom*t)),this.camera.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent))},this.dollyOut=function(t){void 0===t&&(t=this.getZoomScale()),this.camera instanceof f.PerspectiveCamera?R.scale*=t:this.camera instanceof f.OrthographicCamera&&(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom/t)),this.camera.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent))};var n=function(){var t,e=i;return function(i){return t=e.getPickingPositionFromDepth(i),e.renderScene(),t}}(),r=new f.Quaternion,a=new f.Quaternion,s=new f.Vector3(1,0,0),h=function(){if(at===_.MOVE_GLOBE)k.copy(this.getTargetCameraPosition()).applyQuaternion(G),this.camera.position.copy(gt.position).applyQuaternion(G),H.progress>0&&this.camera.position.lerp(k,H.progress*V),this.camera.up.copy(k.clone().normalize());else if(at===_.PAN)this.camera.position.add(nt),k.add(nt);else if(at===_.PANORAMIC){this.camera.worldToLocal(k);var t=this.camera.position.clone().normalize().applyQuaternion(this.camera.quaternion.clone().inverse());r.setFromAxisAngle(t,A.theta).multiply(a.setFromAxisAngle(s,A.phi)),k.applyQuaternion(r),this.camera.localToWorld(k),this.camera.up.copy(k.clone().normalize())}else U.copy(this.camera.position).applyMatrix4(j.matrixWorldInverse),(A.theta||A.phi)&&L.setFromVector3(U),this.autoRotate&&at===_.NONE&&this.rotateLeft(this.getAutoRotationAngle()),L.theta+=A.theta,L.phi+=A.phi,L.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,L.theta)),L.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,L.phi)),L.radius=U.length()*R.scale,L.makeSafe(),L.radius=Math.max(this.minDistance,Math.min(this.maxDistance,L.radius)),U.setFromSpherical(L),this.camera.position.copy(j.localToWorld(U));this.camera.lookAt(k),this.enableDamping?(A.theta*=1-H.dampingFactor,A.phi*=1-H.dampingFactor):(A.theta=0,A.phi=0),R.scale=1,nt.set(0,0,0),(rt.distanceToSquared(this.camera.position)>E||8*(1-ot.dot(this.camera.quaternion))>E)&&(this.dispatchEvent(this.changeEvent),rt.copy(this.camera.position),ot.copy(this.camera.quaternion)),this.enableDamping&&at===_.ORBIT&&W.isStopped()&&(A.theta>E||A.phi>E)&&W.playLater($,2)}.bind(this);this.getSpace=function(){return w},this.getSphericalDelta=function(){return A};var u=function(){var t=(new f.Quaternion).setFromAxisAngle(new f.Vector3(1,0,0),Math.PI/2);return function(e,i){i.position.copy(e),i.lookAt(e.clone().multiplyScalar(1.1)),i.quaternion.multiply(t),i.updateMatrixWorld()}}(),c=function(t){u(t,j),j.matrixWorldInverse.getInverse(j.matrixWorld)},l=new f.Vector3,p=function(){var t=n();if(t){var e=t.distanceTo(this.camera.position);l.subVectors(k,this.camera.position),l.setLength(e),k.addVectors(this.camera.position,l),c(k),U.copy(this.camera.position),U.applyMatrix4(j.matrixWorldInverse),L.setFromVector3(U),at=_.NONE,q=[]}},d=mt?function(t,e){u(t,e),this.dispatchEvent(this.changeEvent)}:function(){};this.getPickingPositionOnSphere=function(){return ut.picking.position};var m=function(){var t=new f.Vector2,e=new f.Ray;return function(i,n){ut.setRadius(i.length()),t.x=n.x/ht.width*2-1,t.y=2*-(n.y/ht.height)+1,gt.updateRay(e,t),ut.picking.position.copy(ut.intersectWithRay(e)),ut.picking.normal=ut.picking.position.clone().normalize(),q.push(ut.picking.normal),d.bind(this)(ut.picking.position,this.pickingHelper)}}(),v=function(){var t=new f.Ray,e=new f.Vector2;return function(i){if(W.isPlaying()&&W.stop(),this.enabled!==!1){if(i.preventDefault(),at===_.ORBIT||at===_.PANORAMIC){if(this.enableRotate===!1)return;T.set(i.clientX-i.target.offsetLeft,i.clientY-i.target.offsetTop),P.subVectors(T,S),w?(this.rotateLeft(P.x),this.rotateUp(P.y)):(this.rotateLeft(2*Math.PI*P.x/ht.width*this.rotateSpeed),this.rotateUp(2*Math.PI*P.y/ht.height*this.rotateSpeed)),S.copy(T)}else if(at===_.DOLLY){if(this.enableZoom===!1)return;z.set(i.clientX-i.target.offsetLeft,i.clientY-i.target.offsetTop),B.subVectors(z,F),B.y>0?this.dollyIn():B.y<0&&this.dollyOut(),F.copy(z)}else if(at===_.PAN){if(this.enablePan===!1)return;O.set(i.clientX-i.target.offsetLeft,i.clientY-i.target.offsetTop),D.subVectors(O,I),this.mouseToPan(D.x,D.y),I.copy(O)}else if(at===_.MOVE_GLOBE){e.x=(i.clientX-i.target.offsetLeft)/ht.width*2-1,e.y=2*-((i.clientY-i.target.offsetTop)/ht.height)+1,gt.updateRay(t,e);var n=ut.intersectWithRay(t);if(n){var r=n.normalize();G.setFromUnitVectors(r,ut.picking.normal),q.push(r.clone()),q.length>2&&q.splice(0,1)}else C.bind(this)()}at!==_.NONE&&h()}}}(),g=function(t){var i=this;W.stop().then(function(){if(i.enabled!==!1){if(t.preventDefault(),t.button===i.mouseButtons.PANORAMIC){if(i.enableRotate===!1)return;if(ft)at=_.ORBIT;else if(pt)at=_.PANORAMIC;else if(dt)x.mouse=new f.Vector2(t.clientX-t.target.offsetLeft,t.clientY-t.target.offsetTop),e.dispatchEvent(x);else{gt.shot(i.camera),st.x=t.clientX-t.target.offsetLeft,st.y=t.clientY-t.target.offsetTop;var r=n(st);q=[],r&&(H.range=i.getRange(),m.bind(i)(r,st),at=_.MOVE_GLOBE)}S.set(t.clientX-t.target.offsetLeft,t.clientY-t.target.offsetTop)}else if(t.button===i.mouseButtons.ZOOM){if(i.enableZoom===!1)return;at=_.DOLLY,F.set(t.clientX-t.target.offsetLeft,t.clientY-t.target.offsetTop)}else if(t.button===i.mouseButtons.PAN){if(i.enablePan===!1)return;at=_.PAN,I.set(t.clientX-t.target.offsetLeft,t.clientY-t.target.offsetTop)}at!==_.NONE&&(i.domElement.addEventListener("mousemove",ct,!1),i.domElement.addEventListener("mouseup",lt,!1),i.domElement.addEventListener("mouseleave",lt,!1),i.dispatchEvent(i.startEvent))}})},M=function(t){if(this.enabled!==!1&&!ft&&!pt){st.x=t.clientX-t.target.offsetLeft,st.y=t.clientY-t.target.offsetTop;var e=n(st);e&&(V=.6,this.setCenter(e,!0))}},C=function(){var t=this;this.enabled!==!1&&(this.domElement.removeEventListener("mousemove",ct,!1),this.domElement.removeEventListener("mouseup",lt,!1),this.domElement.removeEventListener("mouseleave",lt,!1),this.dispatchEvent(this.endEvent),W.stop(),this.enableDamping?at===_.ORBIT&&(A.theta>E||A.phi>E)?W.play($).then(function(){return t.resetControls()}):at!==_.MOVE_GLOBE||2!==q.length||q[1].equals(q[0])?p.bind(this)():(H.qDelta.setFromUnitVectors(q[1],q[0]),W.play(Q).then(function(){return t.resetControls()})):p.bind(this)())},X=function(t){var e=this;W.stop().then(function(){if(e.enabled!==!1&&e.enableZoom!==!1){t.preventDefault(),t.stopPropagation();var i=0;void 0!==t.wheelDelta?i=t.wheelDelta:void 0!==t.detail&&(i=-t.detail),i>0?e.dollyOut():i<0&&e.dollyIn(),h(),e.dispatchEvent(e.startEvent),e.dispatchEvent(e.endEvent)}})},Y=function(){this.enabled!==!1&&this.enableKeys!==!1&&this.enablePan!==!1&&(at===_.PAN&&p.bind(this)(),ft=!1,pt=!1,dt=!1)},Z=function(t){var e=this;W.stop().then(function(){if(e.enabled!==!1&&e.enableKeys!==!1&&e.enablePan!==!1)switch(ft=!1,pt=!1,t.keyCode){case b.UP:e.mouseToPan(0,e.keyPanSpeed),at=_.PAN,h();break;case b.BOTTOM:e.mouseToPan(0,-e.keyPanSpeed),at=_.PAN,h();break;case b.LEFT:e.mouseToPan(e.keyPanSpeed,0),at=_.PAN,h();break;case b.RIGHT:e.mouseToPan(-e.keyPanSpeed,0),at=_.PAN,h();break;case b.SPACE:w=!w,h();break;case b.CTRL:ft=!0;break;case b.SHIFT:pt=!0;break;case b.S:dt=!0}})},J=function(t){if(this.enabled!==!1){switch(t.touches.length){case 1:if(this.enableRotate===!1)return;at=_.TOUCH_ROTATE,S.set(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(this.enableZoom===!1)return;at=_.TOUCH_DOLLY;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);F.set(0,n);break;case 3:if(this.enablePan===!1)return;at=_.TOUCH_PAN,I.set(t.touches[0].pageX,t.touches[0].pageY);break;default:at=_.NONE}at!==_.NONE&&this.dispatchEvent(this.startEvent)}},K=function(t){if(this.enabled!==!1){t.preventDefault(),t.stopPropagation();var e=this.domElement===document?this.domElement.body:this.domElement;switch(t.touches.length){case 1:if(this.enableRotate===!1)return;if(at!==_.TOUCH_ROTATE)return;T.set(t.touches[0].pageX,t.touches[0].pageY),P.subVectors(T,S),this.rotateLeft(2*Math.PI*P.x/e.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*P.y/e.clientHeight*this.rotateSpeed),S.copy(T),h();break;case 2:if(this.enableZoom===!1)return;if(at!==_.TOUCH_DOLLY)return;var i=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(i*i+n*n);z.set(0,r),B.subVectors(z,F),B.y>0?this.dollyOut():B.y<0&&this.dollyIn(),F.copy(z),h();break;case 3:if(this.enablePan===!1)return;if(at!==_.TOUCH_PAN)return;O.set(t.touches[0].pageX,t.touches[0].pageY),D.subVectors(O,I),this.mouseToPan(D.x,D.y),I.copy(O),h();break;default:at=_.NONE}}},yt=function(){this.enabled!==!1&&(this.dispatchEvent(this.endEvent),at=_.NONE,ft=!1,pt=!1,dt=!1)};this.resetControls=function(){q.splice(0),H.progress=0,p.bind(this)()},this.updateCameraTransformation=function(t){var e=this.enableDamping;this.enableDamping=!1,at=t||_.ORBIT,h(),p.bind(this)(),this.enableDamping=e},this.dispose=function(){this.domElement.removeEventListener("mousedown",g,!1),this.domElement.removeEventListener("mousewheel",X,!1),this.domElement.removeEventListener("DOMMouseScroll",X,!1),this.domElement.removeEventListener("touchstart",J,!1),this.domElement.removeEventListener("touchend",yt,!1),this.domElement.removeEventListener("touchmove",K,!1),this.domElement.removeEventListener("mousemove",v,!1),this.domElement.removeEventListener("mouseup",C,!1),window.removeEventListener("keydown",Z,!1)},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousedown",g.bind(this),!1),this.domElement.addEventListener("mousewheel",X.bind(this),!1),this.domElement.addEventListener("dblclick",M.bind(this),!1),this.domElement.addEventListener("DOMMouseScroll",X.bind(this),!1),this.domElement.addEventListener("touchstart",J.bind(this),!1),this.domElement.addEventListener("touchend",yt.bind(this),!1),this.domElement.addEventListener("touchmove",K.bind(this),!1),this.domElement.addEventListener("frameAnimation",h.bind(this),!1),window.addEventListener("keydown",Z.bind(this),!1),window.addEventListener("keyup",Y.bind(this),!1);var xt=(new f.Vector3).copy(t.position).setLength(ut.radius);c(xt),k.copy(xt),this.camera.up.copy(xt.normalize()),i.scene3D.add(j),L.radius=t.position.length(),h(),mt&&(j.add(new f.AxisHelper(5e5)),i.scene3D.add(this.pickingHelper)),tt=j.clone(),et=this.camera.position.clone(),it=this.camera.zoom,ct=v.bind(this),lt=C.bind(this)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),h=r(s),u=i(3),c=r(u),l=i(2),f=n(l),p=i(49),d=r(p),m=i(245),v=r(m),g=i(267),y=r(g),x=new d.default("selectClick"),_={NONE:-1,ORBIT:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,MOVE_GLOBE:6,PANORAMIC:7},b={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,SPACE:32,SHIFT:16,CTRL:17,S:83},M=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-a*a),h=Math.atan2(s,a),u=Math.sin((1-e)*h)/s,c=Math.sin(e*h)/s;return this._w=o*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this.onChangeCallback(),this},w=!1,E=1e-6,S=new f.Vector2,T=new f.Vector2,P=new f.Vector2,L=new f.Spherical(1,.01,0),A=new f.Spherical(1,0,0),C=new f.Spherical,R={spherical:L,sphericalDelta:A,sphericalTo:C,scale:1},I=new f.Vector2,O=new f.Vector2,D=new f.Vector2,N=new f.Vector3,U=new f.Vector3,F=new f.Vector2,z=new f.Vector2,B=new f.Vector2,G=new f.Quaternion,j=new f.Object3D,k=new f.Vector3,V=0,H={progress:0,quatGlobe:G,qDelta:new f.Quaternion,dampingFactor:.25};H.qDelta.presiceSlerp=M,G.presiceSlerp=M;var W=null,q=[],X=function(){var t=new f.Quaternion(0,0,0,1);return function(e){e.qDelta.presiceSlerp(t,.2*e.dampingFactor),e.quatGlobe.multiply(e.qDelta)}}(),Y=function(t,e){t.quatGlobe.set(0,0,0,1),t.progress=1-Math.pow(1-(.5*Math.sin((e-.5)*Math.PI)+.5),2),t.quatGlobe.presiceSlerp(t.qDelta,t.progress)},Z=function(t,e){t.scale=1-(1-t.sphericalTo.radius/t.spherical.radius)*e,t.sphericalDelta.theta=t.sphericalTo.theta,t.sphericalDelta.phi=t.sphericalTo.phi},Q=new g.AnimatedExpression({duration:120,root:H,expression:X,name:"Damping Move"}),J=new g.AnimatedExpression({duration:45,root:H,expression:Y,name:"Zoom Center"}),K=new g.AnimatedExpression({duration:30,root:R,expression:Z,name:"set Orbit"}),$=new g.Animation({duration:60,name:"orbit damping"});j.matrixWorld.elements=new Float64Array(16),j.matrixWorldInverse=new f.Matrix4,j.matrixWorldInverse.elements=new Float64Array(16);var tt,et,it,nt=new f.Vector3,rt=new f.Vector3,ot=new f.Quaternion,at=_.NONE,st=new f.Vector2,ht=new f.Vector2,ut=new v.default;ut.picking={position:new f.Vector3,normal:new f.Vector3};var ct,lt,ft=!1,pt=!1,dt=!1,mt=!1,vt=50,gt=null;a.prototype=(0,c.default)(f.EventDispatcher.prototype),a.prototype.constructor=a,a.prototype.setTilt=function(t,e){var i=t*Math.PI/180-this.getTiltRad();return this.moveOrbitalPosition(0,0,i,e)},a.prototype.setHeading=function(t,e){var i=t*Math.PI/180-this.getHeadingRad();return this.moveOrbitalPosition(0,i,0,e)},a.prototype.setRange=function(t,e){var i=t-this.getRange();return this.moveOrbitalPosition(i,0,0,e)},a.prototype.setOrbitalPosition=function(t,e,i,n){var r=i?i*Math.PI/180-this.getTiltRad():0,o=e?e*Math.PI/180-this.getHeadingRad():0,a=t?t-this.getRange():0;return this.moveOrbitalPosition(a,o,r,n)};var yt=new f.Spherical;a.prototype.moveOrbitalPosition=function(t,e,i,n){var r=this,o=t+this.getRange();return n?(yt.theta=e+L.theta,yt.phi=i+L.phi,C.radius=o,C.theta=e/(K.duration-1),C.phi=i/(K.duration-1),at=_.ORBIT,W.play(K).then(function(){W.isEnded()&&r.moveOrbitalPosition(0,yt.theta-L.theta,yt.phi-L.phi),r.resetControls()})):(A.theta=e,A.phi=i,R.scale=o/this.getRange(),this.updateCameraTransformation(),new h.default(function(t){t()}))},a.prototype.getTargetCameraPosition=function(){return j.position},a.prototype.setCenter=function(t,e){var i=this,n=this.getTargetCameraPosition();gt.shot(this.camera),st.x=this.domElement.width/2,st.y=this.domElement.height/2;var r=n.clone().normalize(),o=t.normalize();return e?(H.qDelta.setFromUnitVectors(r,o),t.range&&(V=1-t.range/this.getRange()),at=_.MOVE_GLOBE,W.play(J).then(function(){V=0,i.resetControls()})):(G.setFromUnitVectors(r,o),this.updateCameraTransformation(_.MOVE_GLOBE),new h.default(function(t){t()}))},a.prototype.getRange=function(){return this.getTargetCameraPosition().distanceTo(this.camera.position)},a.prototype.getRay=function(){var t=new f.Vector3(0,0,1);return this.camera.localToWorld(t),t.sub(this.camera.position).negate().normalize(),{origin:this.camera.position,direction:t}},a.prototype.getTilt=function(){return 180*L.phi/Math.PI},a.prototype.getHeading=function(){return 180*L.theta/Math.PI},a.prototype.getTiltRad=function(){return L.phi},a.prototype.getHeadingRad=function(){return L.theta},a.prototype.getPolarAngle=function(){return L.phi},a.prototype.getAzimuthalAngle=function(){return L.theta},a.prototype.moveTarget=function(){return k},a.prototype.pan=function(t,e){this.mouseToPan(t,e),this.updateCameraTransformation(_.PAN)},a.prototype.reset=function(){at=_.NONE,this.target.copy(tt),this.camera.position.copy(et),this.camera.zoom=it,this.camera.updateProjectionMatrix(),this.dispatchEvent(this.changeEvent),this.updateCameraTransformation()},e.default=a},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,n){u.Object3D.call(this),this.box3D=new u.Box3(t,e),this.natBox=this.box3D.clone(),this.quaInv=this.quaternion.clone().inverse(),i&&this.lookAt(i),n&&(this.translateX(n.x),this.translateY(n.y),this.translateZ(n.z)),this.oPosition=new u.Vector3,this.update(),this.oPosition=this.position.clone()}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),s=r(a),h=i(2),u=n(h);o.prototype=(0,s.default)(u.Object3D.prototype),o.prototype.constructor=o,o.prototype.update=function(){this.updateMatrix(),this.updateMatrixWorld(),this.quaInv=this.quaternion.clone().inverse(),this.pointsWorld=this.cPointsWorld(this.points())},o.prototype.inverseQuaternion=function(){return this.quaInv},o.prototype.addHeight=function(t){var e=Math.abs(this.natBox.min.z-this.natBox.max.z);this.box3D.min.z=this.natBox.min.z+t.bottom(),this.box3D.max.z=this.natBox.max.z+t.top();var i=.5*Math.abs(this.box3D.min.z-this.box3D.max.z),n=this.box3D.min.z+i;return this.box3D.min.z=-i,this.box3D.max.z=i,this.position.copy(this.oPosition),this.translateZ(n),this.update(),new u.Vector2(i-.5*e,n)},o.prototype.points=function t(){var t=[new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3,new u.Vector3];return t[0].set(this.box3D.min.x,this.box3D.min.y,this.box3D.min.z),t[1].set(this.box3D.min.x,this.box3D.min.y,this.box3D.max.z),t[2].set(this.box3D.min.x,this.box3D.max.y,this.box3D.min.z),t[3].set(this.box3D.min.x,this.box3D.max.y,this.box3D.max.z),t[4].set(this.box3D.max.x,this.box3D.min.y,this.box3D.min.z),t[5].set(this.box3D.max.x,this.box3D.min.y,this.box3D.max.z),t[6].set(this.box3D.max.x,this.box3D.max.y,this.box3D.min.z),t[7].set(this.box3D.max.x,this.box3D.max.y,this.box3D.max.z),t},o.prototype.cPointsWorld=function(t){for(var e=this.matrixWorld,i=0,n=t.length;i<n;i++)t[i].applyMatrix4(e);return t},e.default=o},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){t.matrixWorld.elements=new Float64Array(16),t.matrix.elements=new Float64Array(16),t.position.copy(e),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,t.matrixWorldNeedsUpdate=!1}function a(){this.ellipsoid=new m.default((0,p.ellipsoidSizes)())}Object.defineProperty(e,"__esModule",{value:!0});var s=i(13),h=r(s),u=i(2),c=n(u),l=i(115),f=r(l),p=i(6),d=i(58),m=r(d),v=i(20),g=r(v),y=i(94),x=r(y),_=i(15),b=r(_),M=new p.C.EPSG_4326(0,0,0);M.set=function(t,e,i){M._values[0]=t,M._values[1]=e,M._values[2]=i},a.prototype.geoArrayTo3D=function(t,e,i){return this.geoCoordTo3D(parseFloat(t[i.long]),parseFloat(t[i.lat]),e)},a.prototype.geoCoordTo3D=function(t,e,i){return M.set(t,e,i),M.as("EPSG:4978").xyz()},a.prototype.GeoJSON2Polygon=function(t,e){for(var i=new c.Object3D,n=0;n<t.length;n++){var r=[],o=t[n].geometry.coordinates[0][0],a=t[n].properties.z_min;if(o.length>2&&9999!=a){for(var s=0;s<o.length;++s){var h=this.geoArrayTo3D(o[s],a,e);r.push(h.x,h.y,h.z)}var u=new c.BufferGeometry,l=new c.LineBasicMaterial({color:16711680,transparent:!0,opacity:.9});u.addAttribute("position",new c.BufferAttribute(new Float32Array(r),3)),u.computeBoundingSphere();var f=new c.Line(u,l);f.frustumCulled=!1,i.add(f)}}return i},a.prototype.GeoJSON2Box=function(t,e){e=e||{long:0,lat:1};var i=new c.Object3D,n=new c.Geometry,r=new c.Geometry,a=!isNaN(t[0].geometry.coordinates[0][0][0][0]),s=a?t[0].geometry.coordinates[0][0][0]:t[0].geometry.coordinates[0][0],u=this.geoArrayTo3D(s,0,e),l=!0,p=!1,d=void 0;try{for(var m,v=(0,h.default)(t);!(l=(m=v.next()).done);l=!0){var y=m.value,x=y.height||y.properties.hauteur,_=0;y.properties&&(_=y.properties.z_min-x);var b=[],M=a?y.geometry.coordinates[0][0]:y.geometry.coordinates[0],w=void 0,E=void 0;if(isNaN(y.id)){var S=y.id.substr(0,y.id.indexOf("."));"bati_indifferencie"===S?(w=new c.Color(16777215),E=new c.Color(0)):"bati_remarquable"===S?(w=new c.Color(5592575),E=new c.Color(85)):"bati_industriel"===S&&(w=new c.Color(16733525),E=new c.Color(5570560))}else w=new c.Color(16777215),E=new c.Color(0);if(M.length>2){for(var T=0;T<M.length-1;++T){var P=this.geoArrayTo3D(M[T],_+x,e).sub(u),L=this.geoArrayTo3D(M[T],_,e).sub(u);b.push(parseFloat(M[T][e.long]),parseFloat(M[T][e.lat])),n.vertices.push(L,P)}for(var A=n.vertices.length-2*(M.length-1);A<n.vertices.length;A+=2){var C=A;C>n.vertices.length-4&&(C=n.vertices.length-2*(M.length-1));var R=new c.Face3(C+3,C+1,C),I=new c.Face3(C+2,C+3,C);R.vertexColors=[w,w,E],I.vertexColors=[E,w,E],n.faces.push(R),n.faces.push(I)}var O=n.vertices.length-2*(M.length-1),D=new c.Face3(O,O+1,n.vertices.length-1),N=new c.Face3(O,n.vertices.length-1,n.vertices.length-2);D.vertexColors=[E,w,w],N.vertexColors=[E,w,E],n.faces.push(D),n.faces.push(N)}n.computeFaceNormals();for(var U=(0,f.default)(b),F=0;F<U.length;F+=3){r.vertices.push(this.geoCoordTo3D(b[2*U[F]],b[2*U[F]+1],_+x).sub(u)),r.vertices.push(this.geoCoordTo3D(b[2*U[F+1]],b[2*U[F+1]+1],_+x).sub(u)),r.vertices.push(this.geoCoordTo3D(b[2*U[F+2]],b[2*U[F+2]+1],_+x).sub(u));var z=new c.Face3(r.vertices.length-3,r.vertices.length-2,r.vertices.length-1);z.vertexColors=[w,w,w],r.faces.push(z)}}}catch(t){p=!0,d=t}finally{try{!l&&v.return&&v.return()}finally{if(p)throw d}}r.computeFaceNormals();var B=new g.default(new c.Color(t.style.color||"#C6BCB0"),t.style.opacity||1),G=new g.default(new c.Color(t.style.colorRoof||"#839498"),t.style.opacity||1);B.uniforms.lightingEnabled.value=!0,G.uniforms.lightingEnabled.value=!1,B.uniforms.enabledCutColor.value=!1,G.uniforms.enabledCutColor.value=!1,B.transparent=!0,G.transparent=!0;var j=new c.Mesh(n,B);j.frustumCulled=!1;var k=new c.Mesh(r,G);return k.frustumCulled=!1,i.add(j),j.add(k),o(i,u),i},a.prototype.GeoJSON2Line=function(t,e,i,n){for(var r=new c.Object3D,a=new c.Vector3,s=i.params.altitude,h=0;h<t.length;h++){var u=t[h],l=u.geometry.coordinates;if(l.length){0===h&&a.copy(this.geoArrayTo3D(l[0],s,n));var f=new c.Color;this.manageColor(u.properties,f,i);for(var p=new x.default({linewidth:20,useTexture:!1,opacity:1,sizeAttenuation:!0,color:f}),d=0;d<l.length;d++){var m=this.geoArrayTo3D(l[d],s,n).sub(a);p.addPoint(m)}p.process(),r.add(p)}}return o(r,a),r},a.prototype.GeoJSON2Point=function(t,e,i,n){var r=new c.Object3D,a=new c.Vector3;r.geometry=new c.Geometry,r.material=new g.default,r.material.uniforms.lightingEnabled.value=!1;for(var s=0;s<t.length;s++){var h=new b.default,u=t[s],l=u.geometry.coordinates,f=new p.C.EPSG_4326(l[n.long],l[n.lat],(e.bottom()+e.top())/2+3),d=this.ellipsoid.geodeticSurfaceNormalCartographic(f),m=this.ellipsoid.cartographicToCartesian(f);
0===s&&a.copy(m),m.sub(a);var v=i.params;if("box"==i.type)h.geometry=new c.BoxGeometry(v.boxWidth||40,v.boxWidth||40,v.boxHeight||80);else{if("point"!=i.type)continue;h.geometry=new c.CircleGeometry(v.radius||10,v.nbSegment||3,v.thetaStart||0,v.thetaLength||2*Math.PI)}h.geometry.lookAt(d),h.position.copy(m);var y=new c.Color;this.manageColor(u.properties,y,i),h.material=new g.default(y),r.add(h)}return o(r,a),r},a.prototype.manageColor=function(t,e,i){var n=i.params.color||void 0;if(void 0!==n)for(var r=0;r<n.testTab.length;r++)if(t[n.property]===n.testTab[r])return void e.setHex(n.colorTab[r]);e.setHex(new c.Color(16777215))},a.prototype.createGeometryArray=function(t){var e=[];if("Feature"==t.type)e.push(t.geometry);else if("FeatureCollection"==t.type)for(var i=0;i<t.features.length;i++)e.push(t.features[i].geometry);else{if("GeometryCollection"!=t.type)throw new Error("The geoJSON is not valid.");for(var n=0;n<t.geometries.length;n++)e.push(t.geometries[n])}return e},a.prototype.needsInterpolation=function(t,e){var i=e[0],n=e[1],r=t[0],o=t[1],a=Math.abs(i-r),s=Math.abs(n-o);return a>5||s>5},a.prototype.interpolatePoints=function(t){for(var e=[],i=0;i<t.length-1;i++){var n=t[i],r=t[i+1];if(this.needsInterpolation(r,n)){e.push(n);var o=(n[0]+r[0])/2,a=(n[1]+r[1])/2,s=[o,a];e.push(s)}else e.push(n)}return e.push(t[t.length-1]),e.length>t.length?this.interpolatePoints(e):e},a.prototype.createCoordinateArray=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=t[i-1];if(i>0)if(this.needsInterpolation(r,n)){var o=[r,n];o=this.interpolatePoints(o);for(var a=0;a<o.length;a++)e.push(o[a])}else e.push(n);else e.push(n)}return e},a.prototype.processingGeoJSON=function(t){var e=this.createGeometryArray(t),i=new c.Geometry,n={long:0,lat:1},r=!1,a=[],s=function(t,e,r){a=this.createCoordinateArray(t);var o=!0,s=!1,u=void 0;try{for(var c,l=(0,h.default)(a);!(o=(c=l.next()).done);o=!0){var f=c.value,p=this.geoArrayTo3D(f,e,n);r?r.vertices.push(p):i.vertices.push(p)}}catch(t){s=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}}.bind(this),u=void 0,l=new c.Object3D,p=!0,d=!1,m=void 0;try{for(var v,y=(0,h.default)(e);!(p=(v=y.next()).done);p=!0){var _=v.value,b=_.altitude||t.altitude;if("Point"==_.type){var M=this.geoArrayTo3D(_.coordinates,b,n);i.vertices.push(M),r=!0}else if("MultiPoint"==_.type){for(var w=0;w<_.coordinates.length;w++){a=_.coordinates[w];var E=this.geoArrayTo3D(a,b,n);i.vertices.push(E)}r=!0}else if("LineString"==_.type)s(_.coordinates,b);else if("Polygon"==_.type){var S=!0,T=!1,P=void 0;try{for(var L,A=(0,h.default)(_.coordinates);!(S=(L=A.next()).done);S=!0){var C=L.value,R=new c.Color(t.stroke||16711680),I=new x.default({linewidth:t.strokeWidth||1,useTexture:!1,opacity:t.strokeOpacity||1,sizeAttenuation:!1,color:R}),O=!0,D=!1,N=void 0;try{for(var U,F=(0,h.default)(C);!(O=(U=F.next()).done);O=!0){var z=U.value;u||(u=this.geoArrayTo3D(z,b,n));var B=this.geoArrayTo3D(z,b,n);B.sub(u),I.addPoint(B)}}catch(t){D=!0,N=t}finally{try{!O&&F.return&&F.return()}finally{if(D)throw N}}I.process(),l.add(I)}}catch(t){T=!0,P=t}finally{try{!S&&A.return&&A.return()}finally{if(T)throw P}}}else{if("MultiLineString"!=_.type){if("MultiPolygon"==_.type){var G=new c.Geometry,j=new c.Object3D,k=new c.Vector3,V=new c.Vector3,H=!0,W=1e5,q=!0,X=!1,Y=void 0;try{for(var Z,Q=(0,h.default)(_.coordinates);!(q=(Z=Q.next()).done);q=!0){var J=Z.value,K=!0,$=!1,tt=void 0;try{for(var et,it=(0,h.default)(J);!(K=(et=it.next()).done);K=!0){var nt=et.value,rt=[],ot=!0,at=!1,st=void 0;try{for(var ht,ut=(0,h.default)(nt);!(ot=(ht=ut.next()).done);ot=!0){var ct=ht.value;W=Math.min(W,ct[2]);var lt=this.geoCoordTo3D(ct[0],ct[1],ct[2]);H&&(H=!1,V.copy(lt),k.copy(V).normalize(),j.quaternion.setFromUnitVectors(new c.Vector3(0,1,0),k),o(j,V)),j.worldToLocal(lt),rt=rt.concat(lt.toArray())}}catch(t){at=!0,st=t}finally{try{!ot&&ut.return&&ut.return()}finally{if(at)throw st}}for(var ft=(0,f.default)(rt,null,3),pt=0;pt<ft.length;pt+=3){var dt=new c.Vector3(rt[3*ft[pt]],rt[3*ft[pt]+1],rt[3*ft[pt]+2]),mt=new c.Vector3(rt[3*ft[pt+1]],rt[3*ft[pt+1]+1],rt[3*ft[pt+1]+2]),vt=new c.Vector3(rt[3*ft[pt+2]],rt[3*ft[pt+2]+1],rt[3*ft[pt+2]+2]);G.vertices.push(dt),G.vertices.push(mt),G.vertices.push(vt);var gt=new c.Face3(G.vertices.length-3,G.vertices.length-2,G.vertices.length-1);G.faces.push(gt)}}}catch(t){$=!0,tt=t}finally{try{!K&&it.return&&it.return()}finally{if($)throw tt}}}}catch(t){X=!0,Y=t}finally{try{!q&&Q.return&&Q.return()}finally{if(X)throw Y}}G.computeFaceNormals();var yt=new g.default(new c.Color(t.stroke),1);yt.side=c.DoubleSide,yt.uniforms.lightOn.value=!0,yt.uniforms.enabledCutColor.value=!0,yt.transparent=!0;var xt=new c.Mesh(G,yt);return xt.frustumCulled=!1,j.add(xt),W-=t.translate||0,j.translateOnAxis(new c.Vector3(0,1,0),-W),xt.translateOnAxis(new c.Vector3(0,1,0),-W),j.updateMatrixWorld(!0),j}throw new Error("The geoJSON is not valid.")}for(var _t=0;_t<_.coordinates.length;_t++)s(_.coordinates,b)}}}catch(t){d=!0,m=t}finally{try{!p&&y.return&&y.return()}finally{if(d)throw m}}if(l.children.length)return o(l,u),l;if(r){var bt=new c.PointsMaterial({color:16711680,size:100});return new c.Points(i,bt)}var Mt=new c.LineBasicMaterial({color:16711680,linewidth:1}),wt=new c.Line(i,Mt);return wt},e.default=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.AnimatedExpression=e.Animation=void 0;var r=i(98),o=n(r),a=i(286),s=n(a),h=i(285),u=n(h),c=i(9),l=n(c),f=i(283),p=n(f),d=i(284),m=n(d),v=60,g=1e3/v,y=!1,x={STOP:0,PLAY:1,END:2,PAUSE:3},_=["Stop","Play","End","Pause"],b=null;b=y?function(t,e){e&&console.info("Animation ",t," : ",e.name)}:function(){};var M=function(t){t.id&&(clearInterval(t.id),t.id=void 0),t.waitTimer&&(clearInterval(t.waitTimer),t.waitTimer=void 0),t.keyframe=0},w=function(t){M(t),t.animation=null,t.resolve&&(t.resolve(),t.resolve=null,t.promise=null)},E=function(t,e){t.state=e,b(_[e],t.animation)},S=new CustomEvent("frameAnimation"),T=new CustomEvent("stopAnimation"),P=new CustomEvent("endAnimation"),L=function(){function t(e){(0,p.default)(this,t),this.dom=e,this.id=null,this.keyframe=0,this.animation=null,this.resolve=null,this.promise=null,this.state=x.STOP,this.waitTimer=null}return(0,m.default)(t,[{key:"isPlaying",value:function(){return this.state===x.PLAY}},{key:"isStopped",value:function(){return this.state===x.STOP}},{key:"isEnded",value:function(){return this.state===x.END}},{key:"play",value:function(t){var e=this;return this.animation=t,E(this,x.PLAY),M(this),this.id=setInterval(this.frame.bind(this),g),this.promise=new l.default(function(t){e.resolve=t}),this.promise}},{key:"playLater",value:function(t,e){var i=this;this.resolveWait=null;var n=new l.default(function(t){i.resolveWait=t}),r=Math.floor(g*e);return window.clearInterval(this.waitTimer),this.waitTimer=window.setTimeout(function(){i.play(t).then(function(){return i.resolveWait()})},r),n}},{key:"stop",value:function(){return E(this,x.STOP),w(this),this.dom.dispatchEvent(T),l.default.resolve()}},{key:"frame",value:function(){this.keyframe<this.animation.duration?(this.animation.animate&&this.animation.animate(this.keyframe),this.keyframe++,this.dom.dispatchEvent(S)):(E(this,x.END),w(this),this.dom.dispatchEvent(P))}}]),t}(),A=function t(e){(0,p.default)(this,t),this.duration=e.duration||v,this.name=e.name},C=function(t){function e(t){(0,p.default)(this,e);var i=(0,s.default)(this,(e.__proto__||(0,o.default)(e)).call(this,t));return i.root=t.root,i.expression=t.expression,i}return(0,u.default)(e,t),(0,m.default)(e,[{key:"animate",value:function(t){this.expression(this.root,t/this.duration)}}]),e}(A);e.Animation=A,e.AnimatedExpression=C,e.default=L},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){this.oneNode=0,this.gfxEngine=t,this.nodeProcess=void 0,this.tree=void 0,this.fogDistance=1e9,this.mfogDistance=1e9,this.selectedNodeId=-1,this.selectedNode=null,this.selectNode=function(t){this._selectNode(t)}}function o(t,e){for(var i=0;i<e.children.length;i++)t(e.children[i])}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),s=n(a);r.prototype.addNodeProcess=function(t){this.nodeProcess=t},r.prototype.NodeProcess=function(){return this.nodeProcess},r.prototype.uniformsProcess=function(){var t=new s.Vector3;return function(e,i){e.setMatrixRTC(this.gfxEngine.getRTCMatrixFromCenter(t.setFromMatrixPosition(e.matrixWorld),i)),e.setFog(this.fogDistance),this.selectNode(e)}}(),r.prototype._selectNode=function(t){t.id===this.selectedNodeId&&(t.setSelected(t.visible&&t.material.visible),this.selectedNode!==t&&(this.selectedNode=t,console.info(t)))},r.prototype.browse=function(t,e,i,n){var r=this;this.tree=t,this.fogDistance=this.mfogDistance*Math.pow((e.getDistanceFromOrigin()-63e5)/25e6,1.6),i.prepare(e);var a={tree:this.tree,layersConfig:n},s=t.children[0];o(function(t){return r._browseDisplayableNode(t,e,i,a)},s)},r.prototype._browseDisplayableNode=function(t,e,i,n){var r=this;t.parent.isVisible()&&i.processNode(t,e,n)?t.isDisplayed()?(this.uniformsProcess(t,e),o(function(o){return r._browseNonDisplayableNode(o,t.level+2,i,e,n)},t)):o(function(t){return r._browseDisplayableNode(t,e,i,n)},t):(t.setVisibility(!1),t.setDisplayed(!1),o(function(o){return r._browseNonDisplayableNode(o,t.level+2,i,e,n)},t))},r.prototype._browseNonDisplayableNode=function(t,e,i,n,r){t.sse=n.computeNodeSSE(t),t.setDisplayed(!1),t.setVisibility(!1);var o=i.checkNodeSSE(t);if(t.loaded||i.refineNodeLayers(t,n,r),t.children.length>0){for(var a=0,s=0;s<t.children.length;s++)this._browseNonDisplayableNode(t.children[s],e,i,n,r)&&a++;if(a!==t.children.length||o)return!1;t.disposeChildren(),t.setDisplayed(!t.parent.isDisplayed()&&t.isVisible())}var h=t.level>=e&&!o;return h},r.prototype.updateMaterialUniform=function(t,e){for(var i=0;i<this.tree.children.length;++i)for(var n=this.tree.children[i],r=0;r<n.children.length;r++){var o=n.children[r],a=function(i){i.material.uniforms[t].value=e};o.traverse&&o.traverse(a)}},r.prototype.updateLayer=function(t,e){var i=this;if(t.visible)for(var n=t.children[0],r=function(t){var r=n.children[t];a=function(){var t=this.gfxEngine.getRTCMatrixFromNode(r,e);return function(e){e.setMatrixRTC?e.setMatrixRTC(t):e.material&&e.material.setMatrixRTC?e.material.setMatrixRTC(t):(e.updateMatrix(),null===e.parent?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix),e.matrixWorldNeedsUpdate=!1)}}.bind(i)(),r.traverse(a)},o=0;o<n.children.length;o++){var a;r(o)}},r.prototype.updateMobileMappingLayer=function(t,e){if(t.visible)for(var i=t.children[0],n=0;n<i.children.length;n++){var r=i.children[n];r.setMatrixRTC(this.gfxEngine.getRTCMatrixFromCenter(r.absoluteCenter,e))}},r.prototype.updateQuadtree=function(t,e,i){var n=t.node.tiles;this.browse(n,i,t.process,e)},e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){this.name=null,this.color=t,this.opacity=null,this.visible=!0,this.contentType=e,this.texture=null,this.position=null,this.scale=null,this.effects=[]}function o(t){r.call(this,t),this.width=1}function a(t){r.call(this,t),this.alignment=m.AL_Left}function s(){r.call(this)}function h(){s.call(this),this.pen=new o,this.extrusion=0,this.colorExtrusion=0}function u(){h.call(this),this.font=new a,this.alignement=m.AL_Left,this.framePadding=.25,this.borderEnabled=!1}function c(){this.name=null}function l(){c.call(this),this.color=null,this.amount=0}function f(t){this.name=t,this.iconStyle=new h,this.line=new o,this.surface=new h,this.surface.addEffect(new l),this.text=new u}Object.defineProperty(e,"__esModule",{value:!0});var p=i(3),d=n(p),m={ST_Active:0,ST_Selected:1,ST_Frozen:2,AL_Left:0,AL_Center:1,AL_Right:2};r.prototype=(0,d.default)(r.prototype),r.prototype.constructor=r,r.prototype.setTexture=function(t){this.texture=t},r.prototype.addEffect=function(t){this.effects.push(t)},o.prototype=(0,d.default)(r.prototype),o.prototype.constructor=o,a.prototype=(0,d.default)(r.prototype),a.prototype.constructor=a,s.prototype=(0,d.default)(r.prototype),s.prototype.constructor=s,h.prototype=(0,d.default)(s.prototype),h.prototype.constructor=h,u.prototype=(0,d.default)(h.prototype),u.prototype.constructor=u,c.prototype=(0,d.default)(c.prototype),c.prototype.constructor=c,l.prototype=(0,d.default)(c.prototype),l.prototype.constructor=l,f.prototype=(0,d.default)(f.prototype),f.prototype.constructor=f,f.prototype.applyPalette=function(t){this.line.color=t.colorLine,this.surface.color=t.colorLine,this.surface.pen.color=t.colorLineSurface,this.text.font.color=t.colorFont,this.surface.effects[0].color=t.colorExtrusion},e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){this.styles=[]}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),a=n(o),s=i(269);r.prototype=(0,a.default)(r.prototype),r.prototype.constructor=r,r.prototype.getStyles=function(){return this.styles},r.prototype.addStyle=function(t){t instanceof s.Style&&this.styles.push(t)},r.prototype.getStyle=function(t){return this.styles.filter(function(e){return e.name===t}).pop()},r.prototype.removeStyle=function(t){this.styles=this.styles.filter(function(e){return e.name===t})},r.prototype.updateStyle=function(){},e.default=r},function(t,e){"use strict";function i(){this.state=n.IDLE,this.lastErrorTimestamp=0,this.errorCount=0}Object.defineProperty(e,"__esModule",{value:!0});var n={IDLE:0,PENDING:1,ERROR:2},r=[1,3,7,60];i.prototype.canTryUpdate=function(t){switch(this.state){case n.IDLE:return!0;case n.PENDING:return!1;case n.ERROR:default:var e=1e3*this.secondsUntilNextTry();return e<=t-this.lastErrorTimestamp}},i.prototype.secondsUntilNextTry=function(){if(this.state!==n.ERROR)return 0;var t=Math.max(0,Math.min(this.errorCount,r.length)-1);return r[t]},i.prototype.newTry=function(){this.state=n.PENDING},i.prototype.success=function(){this.lastErrorTimestamp=0,this.state=n.IDLE},i.prototype.failure=function(t){this.lastErrorTimestamp=t,this.state=n.ERROR,this.errorCount++},e.default=i},function(t,e){"use strict";function i(){this.geometryLayers=[],this.colorLayers=[],this.elevationLayers=[],this.lightingLayers=[],this.lightingLayers[0]={enable:!1,position:{x:-.5,y:0,z:1}},this.layersState={}}function n(t){return{frozen:!1,visible:!0,opacity:1,sequence:t||0}}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.constructor=i,i.prototype.addElevationLayer=function(t){this.elevationLayers.push(t),this.layersState[t.id]=n()},i.prototype.addColorLayer=function(t){this.colorLayers.push(t),this.layersState[t.id]=n(this.colorLayers.length-1)},i.prototype.addGeometryLayer=function(t){this.geometryLayers.push(t),this.layersState[t.id]=n()},i.prototype.removeColorLayer=function(t){return!!this.layersState[t]&&(this.colorLayers=this.colorLayers.filter(function(e){return e.id!=t}),delete this.layersState[t],!0)},i.prototype.getColorLayers=function(){return this.colorLayers},i.prototype.getColorLayersId=function(){return this.colorLayers.map(function(t){return t.id})},i.prototype.getGeometryLayers=function(){return this.geometryLayers},i.prototype.getGeometryLayerById=function(t){return this.geometryLayers.filter(function(e){return e.id===t})[0]},i.prototype.getElevationLayers=function(){return this.elevationLayers},i.prototype.setLayerOpacity=function(t,e){this.layersState[t]&&(this.layersState[t].opacity=e)},i.prototype.setLayerVisibility=function(t,e){this.layersState[t]&&(this.layersState[t].visible=e)},i.prototype.isColorLayerVisible=function(t){return this.layersState[t].visible},i.prototype.getColorLayerOpacity=function(t){return this.layersState[t].opacity},i.prototype.setLayerFreeze=function(t,e){this.layersState[t]&&(this.layersState[t].frozen=e)},i.prototype.isLayerFrozen=function(t){return this.layersState[t].frozen},i.prototype.moveLayerToIndex=function(t,e){if(this.layersState[t]){var i=this.layersState[t].sequence;for(var n in this.layersState)if(Object.prototype.hasOwnProperty.call(this.layersState,n)){var r=this.layersState[n];if(r.sequence===e){r.sequence=i,this.layersState[t].sequence=e;break}}this.colorLayers.splice(e,0,this.colorLayers.splice(i,1)[0])}},i.prototype.moveLayerDown=function(t){this.layersState[t]&&this.layersState[t].sequence>0&&this.moveLayerToIndex(t,this.layersState[t].sequence-1)},i.prototype.moveLayerUp=function(t){this.layersState[t]&&this.layersState[t].sequence<this.colorLayers.length-1&&this.moveLayerToIndex(t,this.layersState[t].sequence+1)},i.prototype.getColorLayersIdOrderedBySequence=function(){var t=this,e=this.colorLayers.map(function(t){return t.id});return e.sort(function(e,i){return t.layersState[e].sequence-t.layersState[i].sequence}),e},e.default=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i,n){if(null!==L)throw new Error("Cannot instantiate more than one Scene");var r=t.as("EPSG:4978");this.layers=[],this.map=null,this.cameras=null,this.selectNodes=null,this.scheduler=(0,f.default)(this),this.orbitOn=!1,this.stylesManager=new P.default,this.gLDebug=n,this.gfxEngine=(0,h.default)(this,r.xyz(),e,i,n),this.browserScene=new d.default(this.gfxEngine),this.needsRedraw=!1,this.lastRenderTime=0,this.maxFramePerSec=60,this.time=0,this.orbitOn=!1,this.rAF=null,this.viewerDiv=e,this.renderingState=A}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i,n){return L=L||new r(t,e,i,n)};var o=i(49),a=n(o),s=i(26),h=n(s),u=i(92),c=n(u),l=i(57),f=n(l),p=i(268),d=n(p),m=i(96),v=n(m),g=i(97),y=n(g),x=i(244),_=n(x),b=i(6),M=i(30),w=n(M),E=i(252),S=n(E),T=i(270),P=n(T),L=null,A=0,C=1;r.prototype.constructor=r,r.prototype.updateCommand=function(){},r.prototype.currentCamera=function(){return this.gfxEngine.camera},r.prototype.currentControls=function(){return this.gfxEngine.controls},r.prototype.getPickPosition=function(t){return this.gfxEngine.getPickingPositionFromDepth(t)},r.prototype.getStyle=function(t){return this.stylesManager.getStyle(t)},r.prototype.removeStyle=function(t){return this.stylesManager.removeStyle(t)},r.prototype.getStyles=function(){return this.stylesManager.getStyles()},r.prototype.size=function(){return(0,b.ellipsoidSizes)()},r.prototype.updateScene3D=function(){this.gfxEngine.update()},r.prototype.notifyChange=function(t,e){var i=this;t?window.setTimeout(function(){i.scheduleUpdate(e)},t):this.scheduleUpdate(e)},r.prototype.scheduleUpdate=function(t){var e=this;this.needsRedraw|=t,this.renderingState!==C&&(this.renderingState=C,requestAnimationFrame(function(){e.step()}))},r.prototype.update=function(){for(var t=0;t<this.layers.length;t++)for(var e=this.layers[t].node,i=0;i<e.children.length;i++){var n=e.children[i];n instanceof y.default?this.browserScene.updateQuadtree(this.layers[t],this.map.layersConfiguration,this.currentCamera()):n instanceof S.default?this.browserScene.updateMobileMappingLayer(n,this.currentCamera()):n instanceof w.default&&this.browserScene.updateLayer(n,this.currentCamera())}},r.prototype.step=function(){var t=this;this.update();var e=this.scheduler.resetCommandsCount("executed");if(0==this.scheduler.commandsWaitingExecutionCount()&&0==e)this.viewerDiv.dispatchEvent(new a.default("globe-built")),this.renderScene3D(),this.renderingState=A;else{var i=Date.now();1e3/this.maxFramePerSec<i-this.lastRenderTime&&(this.needsRedraw||e>0)&&(this.renderScene3D(),this.lastRenderTime=i),requestAnimationFrame(function(){t.step()})}},r.prototype.renderScene3D=function(){this.gfxEngine.renderScene(),this.needsRedraw=!1},r.prototype.scene3D=function(){return this.gfxEngine.scene3D},r.prototype.add=function(t,e){t instanceof c.default&&(this.map=t,e=e||new v.default(this)),this.layers.push({node:t,process:e}),this.gfxEngine.add3DScene(t.getMesh())},r.prototype.getMap=function(){return this.map},r.prototype.remove=function(){},r.prototype.select=function(){},r.prototype.selectNodeId=function(t){this.browserScene.selectedNodeId=t},r.prototype.setStreetLevelImageryOn=function(t){if(t)if(this.layers[1])this.layers[1].node.visible=!0,this.layers[1].node.children[0].visible=!0;else{var e=new S.default;e.initiatePanoramic();var i=new w.default;i.add(e),this.add(i)}else this.layers[1].node.visible=!1,this.layers[1].node.children[0].visible=!1;this.updateScene3D()},r.prototype.setLightingPos=function(t){if(t)this.lightingPos=t;else{var e=_.default.getSunPositionInScene((new Date).getTime(),48.85,2.35);this.lightingPos=e.normalize()}this.browserScene.updateMaterialUniform("lightPosition",this.lightingPos.clone().normalize()),this.layers[0].node.updateLightingPos(this.lightingPos)},r.prototype.animateTime=function(t){if(t){if(this.time+=4e3,this.time){var e=this.time,i=_.default.getSunPositionInScene((new Date).getTime()+3.6*e,0,0);if(this.lightingPos=i,this.browserScene.updateMaterialUniform("lightPosition",this.lightingPos.clone().normalize()),this.layers[0].node.updateLightingPos(this.lightingPos),this.orbitOn){var n=this.gfxEngine.camera.camera3D.position,r=Math.sqrt(n.z*n.z+n.x*n.x),o=Math.atan2(n.z,n.x)+1e-4;n.x=r*Math.cos(o),n.z=r*Math.sin(o)}this.gfxEngine.update()}this.rAF=requestAnimationFrame(this.animateTime.bind(this))}else window.cancelAnimationFrame(this.rAF)},r.prototype.orbit=function(t){this.orbitOn=t}},function(t,e){"use strict";function i(){this.maximumChildren=4,this.schemeBB=[]}Object.defineProperty(e,"__esModule",{value:!0}),i.prototype.add=function(t){return this.schemeBB.push(t)},i.prototype.rootCount=function(){return this.schemeBB.length},i.prototype.getRoot=function(t){return this.schemeBB[t]},e.default=i},,function(t,e,i){t.exports={default:i(335),__esModule:!0}},function(t,e,i){t.exports={default:i(338),__esModule:!0}},function(t,e,i){t.exports={default:i(340),__esModule:!0}},function(t,e,i){t.exports={default:i(342),__esModule:!0}},function(t,e,i){t.exports={default:i(343),__esModule:!0}},function(t,e,i){t.exports={default:i(345),__esModule:!0}},function(t,e,i){t.exports={default:i(346),__esModule:!0}},function(t,e){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(278),o=n(r);e.default=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o.default)(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(280),o=n(r),a=i(3),s=n(a),h=i(99),u=n(h);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof e?"undefined":(0,u.default)(e)));t.prototype=(0,s.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(o.default?(0,o.default)(t,e):t.__proto__=e)}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(99),o=n(r);e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"==typeof e?"undefined":(0,o.default)(e))&&"function"!=typeof e?t:e}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(276),o=n(r);e.default=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return(0,o.default)(t)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){i(35),i(370),t.exports=i(5).Array.from},function(t,e,i){i(48),i(35),t.exports=i(369)},function(t,e,i){i(81),i(35),i(48),i(372),i(381),t.exports=i(5).Map},function(t,e,i){i(373),t.exports=i(5).Object.assign},function(t,e,i){i(374);var n=i(5).Object;t.exports=function(t,e){return n.create(t,e)}},function(t,e,i){i(375);var n=i(5).Object;t.exports=function(t,e,i){return n.defineProperty(t,e,i)}},function(t,e,i){i(376),t.exports=i(5).Object.getPrototypeOf},function(t,e,i){i(377),t.exports=i(5).Object.keys},function(t,e,i){i(378),t.exports=i(5).Object.setPrototypeOf},function(t,e,i){i(81),i(35),i(48),i(379),t.exports=i(5).Promise},function(t,e,i){i(380),i(81),i(382),i(383),t.exports=i(5).Symbol},function(t,e,i){i(35),i(48),t.exports=i(79).f("iterator")},function(t,e){t.exports=function(){}},function(t,e,i){var n=i(42);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e,i){var n=i(23),r=i(46),o=i(368);t.exports=function(t){return function(e,i,a){var s,h=n(e),u=r(h.length),c=o(a,u);if(t&&i!=i){for(;u>c;)if(s=h[c++],s!=s)return!0}else for(;u>c;c++)if((t||c in h)&&h[c]===i)return t||c||0;return!t&&-1}}},function(t,e,i){var n=i(16),r=i(69),o=i(28),a=i(46),s=i(352);t.exports=function(t,e){var i=1==t,h=2==t,u=3==t,c=4==t,l=6==t,f=5==t||l,p=e||s;return function(e,s,d){for(var m,v,g=o(e),y=r(g),x=n(s,d,3),_=a(y.length),b=0,M=i?p(e,_):h?p(e,0):void 0;_>b;b++)if((f||b in y)&&(m=y[b],v=x(m,b,g),t))if(i)M[b]=v;else if(v)switch(t){case 3:return!0;case 5:return m;case 6:return b;case 2:M.push(m)}else if(c)return!1;return l?-1:u||c?c:M}}},function(t,e,i){var n=i(18),r=i(103),o=i(7)("species");t.exports=function(t){var e;return r(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!r(e.prototype)||(e=void 0),n(e)&&(e=e[o],null===e&&(e=void 0))),void 0===e?Array:e}},function(t,e,i){var n=i(351);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var n=i(11).f,r=i(44),o=i(73),a=i(16),s=i(65),h=i(41),u=i(42),c=i(70),l=i(106),f=i(113),p=i(12),d=i(71).fastKey,m=p?"_s":"size",v=function(t,e){var i,n=d(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,c){var l=t(function(t,n){s(t,l,e,"_i"),t._i=r(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=n&&u(n,i,t[c],t)});return o(l.prototype,{clear:function(){for(var t=this,e=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete e[i.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var e=this,i=v(e,t);if(i){var n=i.n,r=i.p;delete e._i[i.i],i.r=!0,r&&(r.n=n),n&&(n.p=r),e._f==i&&(e._f=n),e._l==i&&(e._l=r),e[m]--}return!!i},forEach:function(t){s(this,l,"forEach");for(var e,i=a(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(i(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!v(this,t)}}),p&&n(l.prototype,"size",{get:function(){return h(this[m])}}),l},def:function(t,e,i){var n,r,o=v(t,e);return o?o.v=i:(t._l=o={i:r=d(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=o),n&&(n.n=o),t[m]++,"F"!==r&&(t._i[r]=o)),t},getEntry:v,setStrong:function(t,e,i){c(t,e,function(t,e){this._t=t,this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?"keys"==e?l(0,i.k):"values"==e?l(0,i.v):l(0,[i.k,i.v]):(t._t=void 0,l(1))},i?"entries":"values",!i,!0),f(e)}}},function(t,e,i){var n=i(66),r=i(348);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){"use strict";var n=i(8),r=i(10),o=i(71),a=i(21),s=i(17),h=i(73),u=i(42),c=i(65),l=i(18),f=i(34),p=i(11).f,d=i(350)(0),m=i(12);t.exports=function(t,e,i,v,g,y){var x=n[t],_=x,b=g?"set":"add",M=_&&_.prototype,w={};return m&&"function"==typeof _&&(y||M.forEach&&!a(function(){(new _).entries().next()}))?(_=e(function(e,i){c(e,_,t,"_c"),e._c=new x,void 0!=i&&u(i,g,e[b],e)}),d("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in M&&(!y||"clear"!=t)&&s(_.prototype,t,function(i,n){if(c(this,_,t),!e&&y&&!l(i))return"get"==t&&void 0;var r=this._c[t](0===i?0:i,n);return e?this:r})}),"size"in M&&p(_.prototype,"size",{get:function(){return this._c.size}})):(_=v.getConstructor(e,t,g,b),h(_.prototype,i),o.NEED=!0),f(_,t),w[t]=_,r(r.G+r.W+r.F,w),y||v.setStrong(_,t,g),_}},function(t,e,i){"use strict";var n=i(11),r=i(33);t.exports=function(t,e,i){e in t?n.f(t,e,r(0,i)):t[e]=i}},function(t,e,i){var n=i(27),r=i(72),o=i(45);t.exports=function(t){var e=n(t),i=r.f;if(i)for(var a,s=i(t),h=o.f,u=0;s.length>u;)h.call(t,a=s[u++])&&e.push(a);return e}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){"use strict";var n=i(44),r=i(33),o=i(34),a={};i(17)(a,i(7)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(a,{next:r(1,i)}),o(t,e+" Iterator")}},function(t,e,i){var n=i(27),r=i(23);t.exports=function(t,e){for(var i,o=r(t),a=n(o),s=a.length,h=0;s>h;)if(o[i=a[h++]]===e)return i}},function(t,e,i){var n=i(8),r=i(114).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,h="process"==i(31)(a);t.exports=function(){var t,e,i,u=function(){var n,r;for(h&&(n=a.domain)&&n.exit();t;){r=t.fn,t=t.next;try{r()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(h)i=function(){a.nextTick(u)};else if(o){var c=!0,l=document.createTextNode("");new o(u).observe(l,{characterData:!0}),i=function(){l.data=c=!c}}else if(s&&s.resolve){var f=s.resolve();i=function(){f.then(u)}}else i=function(){r.call(n,u)};return function(n){var r={fn:n,next:void 0};e&&(e.next=r),t||(t=r,i()),e=r}}},function(t,e,i){"use strict";var n=i(27),r=i(72),o=i(45),a=i(28),s=i(69),h=Object.assign;t.exports=!h||i(21)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=h({},t)[i]||Object.keys(h({},e)).join("")!=n})?function(t,e){for(var i=a(t),h=arguments.length,u=1,c=r.f,l=o.f;h>u;)for(var f,p=s(arguments[u++]),d=c?n(p).concat(c(p)):n(p),m=d.length,v=0;m>v;)l.call(p,f=d[v++])&&(i[f]=p[f]);return i}:h},function(t,e,i){var n=i(11),r=i(14),o=i(27);t.exports=i(12)?Object.defineProperties:function(t,e){r(t);for(var i,a=o(e),s=a.length,h=0;s>h;)n.f(t,i=a[h++],e[i]);return t}},function(t,e,i){var n=i(23),r=i(108).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return r(t)}catch(t){return a.slice()}};t.exports.f=function(t){return a&&"[object Window]"==o.call(t)?s(t):r(n(t))}},function(t,e,i){var n=i(18),r=i(14),o=function(t,e){if(r(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=i(16)(Function.call,i(107).f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return o(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:o}},function(t,e,i){var n=i(14),r=i(64),o=i(7)("species");t.exports=function(t,e){var i,a=n(t).constructor;return void 0===a||void 0==(i=n(a)[o])?e:r(i)}},function(t,e,i){var n=i(76),r=i(41);t.exports=function(t){return function(e,i){var o,a,s=String(r(e)),h=n(i),u=s.length;return h<0||h>=u?t?"":void 0:(o=s.charCodeAt(h),o<55296||o>56319||h+1===u||(a=s.charCodeAt(h+1))<56320||a>57343?t?s.charAt(h):o:t?s.slice(h,h+2):(o-55296<<10)+(a-56320)+65536)}}},function(t,e,i){var n=i(76),r=Math.max,o=Math.min;t.exports=function(t,e){return t=n(t),t<0?r(t+e,0):o(t,e)}},function(t,e,i){var n=i(14),r=i(80);t.exports=i(5).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},function(t,e,i){"use strict";var n=i(16),r=i(10),o=i(28),a=i(104),s=i(102),h=i(46),u=i(356),c=i(80);r(r.S+r.F*!i(105)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,r,l,f=o(t),p="function"==typeof this?this:Array,d=arguments.length,m=d>1?arguments[1]:void 0,v=void 0!==m,g=0,y=c(f);
if(v&&(m=n(m,d>2?arguments[2]:void 0,2)),void 0==y||p==Array&&s(y))for(e=h(f.length),i=new p(e);e>g;g++)u(i,g,v?m(f[g],g):f[g]);else for(l=y.call(f),i=new p;!(r=l.next()).done;g++)u(i,g,v?a(l,m,[r.value,g],!0):r.value);return i.length=g,i}})},function(t,e,i){"use strict";var n=i(347),r=i(106),o=i(32),a=i(23);t.exports=i(70)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):"keys"==e?r(0,i):"values"==e?r(0,t[i]):r(0,[i,t[i]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(t,e,i){"use strict";var n=i(353);t.exports=i(355)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(this,t);return e&&e.v},set:function(t,e){return n.def(this,0===t?0:t,e)}},n,!0)},function(t,e,i){var n=i(10);n(n.S+n.F,"Object",{assign:i(362)})},function(t,e,i){var n=i(10);n(n.S,"Object",{create:i(44)})},function(t,e,i){var n=i(10);n(n.S+n.F*!i(12),"Object",{defineProperty:i(11).f})},function(t,e,i){var n=i(28),r=i(109);i(111)("getPrototypeOf",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(28),r=i(27);i(111)("keys",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(10);n(n.S,"Object",{setPrototypeOf:i(365).set})},function(t,e,i){"use strict";var n,r,o,a=i(43),s=i(8),h=i(16),u=i(66),c=i(10),l=i(18),f=i(64),p=i(65),d=i(42),m=i(366),v=i(114).set,g=i(361)(),y="Promise",x=s.TypeError,_=s.process,b=s[y],_=s.process,M="process"==u(_),w=function(){},E=!!function(){try{var t=b.resolve(1),e=(t.constructor={})[i(7)("species")]=function(t){t(w,w)};return(M||"function"==typeof PromiseRejectionEvent)&&t.then(w)instanceof e}catch(t){}}(),S=function(t,e){return t===e||t===b&&e===o},T=function(t){var e;return!(!l(t)||"function"!=typeof(e=t.then))&&e},P=function(t){return S(b,t)?new L(t):new r(t)},L=r=function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw x("Bad Promise constructor");e=t,i=n}),this.resolve=f(e),this.reject=f(i)},A=function(t){try{t()}catch(t){return{error:t}}},C=function(t,e){if(!t._n){t._n=!0;var i=t._c;g(function(){for(var n=t._v,r=1==t._s,o=0,a=function(e){var i,o,a=r?e.ok:e.fail,s=e.resolve,h=e.reject,u=e.domain;try{a?(r||(2==t._h&&O(t),t._h=1),a===!0?i=n:(u&&u.enter(),i=a(n),u&&u.exit()),i===e.promise?h(x("Promise-chain cycle")):(o=T(i))?o.call(i,s,h):s(i)):h(n)}catch(t){h(t)}};i.length>o;)a(i[o++]);t._c=[],t._n=!1,e&&!t._h&&R(t)})}},R=function(t){v.call(s,function(){var e,i,n,r=t._v;if(I(t)&&(e=A(function(){M?_.emit("unhandledRejection",r,t):(i=s.onunhandledrejection)?i({promise:t,reason:r}):(n=s.console)&&n.error&&n.error("Unhandled promise rejection",r)}),t._h=M||I(t)?2:1),t._a=void 0,e)throw e.error})},I=function(t){if(1==t._h)return!1;for(var e,i=t._a||t._c,n=0;i.length>n;)if(e=i[n++],e.fail||!I(e.promise))return!1;return!0},O=function(t){v.call(s,function(){var e;M?_.emit("rejectionHandled",t):(e=s.onrejectionhandled)&&e({promise:t,reason:t._v})})},D=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),C(e,!0))},N=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw x("Promise can't be resolved itself");(e=T(t))?g(function(){var n={_w:i,_d:!1};try{e.call(t,h(N,n,1),h(D,n,1))}catch(t){D.call(n,t)}}):(i._v=t,i._s=1,C(i,!1))}catch(t){D.call({_w:i,_d:!1},t)}}};E||(b=function(t){p(this,b,y,"_h"),f(t),n.call(this);try{t(h(N,this,1),h(D,this,1))}catch(t){D.call(this,t)}},n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=i(73)(b.prototype,{then:function(t,e){var i=P(m(this,b));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=M?_.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&C(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),L=function(){var t=new n;this.promise=t,this.resolve=h(N,t,1),this.reject=h(D,t,1)}),c(c.G+c.W+c.F*!E,{Promise:b}),i(34)(b,y),i(113)(y),o=i(5)[y],c(c.S+c.F*!E,y,{reject:function(t){var e=P(this),i=e.reject;return i(t),e.promise}}),c(c.S+c.F*(a||!E),y,{resolve:function(t){if(t instanceof b&&S(t.constructor,this))return t;var e=P(this),i=e.resolve;return i(t),e.promise}}),c(c.S+c.F*!(E&&i(105)(function(t){b.all(t).catch(w)})),y,{all:function(t){var e=this,i=P(e),n=i.resolve,r=i.reject,o=A(function(){var i=[],o=0,a=1;d(t,!1,function(t){var s=o++,h=!1;i.push(void 0),a++,e.resolve(t).then(function(t){h||(h=!0,i[s]=t,--a||n(i))},r)}),--a||n(i)});return o&&r(o.error),i.promise},race:function(t){var e=this,i=P(e),n=i.reject,r=A(function(){d(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r&&n(r.error),i.promise}})},function(t,e,i){"use strict";var n=i(8),r=i(22),o=i(12),a=i(10),s=i(112),h=i(71).KEY,u=i(21),c=i(75),l=i(34),f=i(47),p=i(7),d=i(79),m=i(78),v=i(360),g=i(357),y=i(103),x=i(14),_=i(23),b=i(77),M=i(33),w=i(44),E=i(364),S=i(107),T=i(11),P=i(27),L=S.f,A=T.f,C=E.f,R=n.Symbol,I=n.JSON,O=I&&I.stringify,D="prototype",N=p("_hidden"),U=p("toPrimitive"),F={}.propertyIsEnumerable,z=c("symbol-registry"),B=c("symbols"),G=c("op-symbols"),j=Object[D],k="function"==typeof R,V=n.QObject,H=!V||!V[D]||!V[D].findChild,W=o&&u(function(){return 7!=w(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=L(j,e);n&&delete j[e],A(t,e,i),n&&t!==j&&A(j,e,n)}:A,q=function(t){var e=B[t]=w(R[D]);return e._k=t,e},X=k&&"symbol"==typeof R.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof R},Y=function(t,e,i){return t===j&&Y(G,e,i),x(t),e=b(e,!0),x(i),r(B,e)?(i.enumerable?(r(t,N)&&t[N][e]&&(t[N][e]=!1),i=w(i,{enumerable:M(0,!1)})):(r(t,N)||A(t,N,M(1,{})),t[N][e]=!0),W(t,e,i)):A(t,e,i)},Z=function(t,e){x(t);for(var i,n=g(e=_(e)),r=0,o=n.length;o>r;)Y(t,i=n[r++],e[i]);return t},Q=function(t,e){return void 0===e?w(t):Z(w(t),e)},J=function(t){var e=F.call(this,t=b(t,!0));return!(this===j&&r(B,t)&&!r(G,t))&&(!(e||!r(this,t)||!r(B,t)||r(this,N)&&this[N][t])||e)},K=function(t,e){if(t=_(t),e=b(e,!0),t!==j||!r(B,e)||r(G,e)){var i=L(t,e);return!i||!r(B,e)||r(t,N)&&t[N][e]||(i.enumerable=!0),i}},$=function(t){for(var e,i=C(_(t)),n=[],o=0;i.length>o;)r(B,e=i[o++])||e==N||e==h||n.push(e);return n},tt=function(t){for(var e,i=t===j,n=C(i?G:_(t)),o=[],a=0;n.length>a;)!r(B,e=n[a++])||i&&!r(j,e)||o.push(B[e]);return o};k||(R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:void 0),e=function(i){this===j&&e.call(G,i),r(this,N)&&r(this[N],t)&&(this[N][t]=!1),W(this,t,M(1,i))};return o&&H&&W(j,t,{configurable:!0,set:e}),q(t)},s(R[D],"toString",function(){return this._k}),S.f=K,T.f=Y,i(108).f=E.f=$,i(45).f=J,i(72).f=tt,o&&!i(43)&&s(j,"propertyIsEnumerable",J,!0),d.f=function(t){return q(p(t))}),a(a.G+a.W+a.F*!k,{Symbol:R});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)p(et[it++]);for(var et=P(p.store),it=0;et.length>it;)m(et[it++]);a(a.S+a.F*!k,"Symbol",{for:function(t){return r(z,t+="")?z[t]:z[t]=R(t)},keyFor:function(t){if(X(t))return v(z,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!k,"Object",{create:Q,defineProperty:Y,defineProperties:Z,getOwnPropertyDescriptor:K,getOwnPropertyNames:$,getOwnPropertySymbols:tt}),I&&a(a.S+a.F*(!k||u(function(){var t=R();return"[null]"!=O([t])||"{}"!=O({a:t})||"{}"!=O(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!X(t)){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);return e=n[1],"function"==typeof e&&(i=e),!i&&y(e)||(e=function(t,e){if(i&&(e=i.call(this,t,e)),!X(e))return e}),n[1]=e,O.apply(I,n)}}}),R[D][U]||i(17)(R[D],U,R[D].valueOf),l(R,"Symbol"),l(Math,"Math",!0),l(n.JSON,"JSON",!0)},function(t,e,i){var n=i(10);n(n.P+n.R,"Map",{toJSON:i(354)("Map")})},function(t,e,i){i(78)("asyncIterator")},function(t,e,i){i(78)("observable")},function(t,e,i){(function(e,n){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(e,i){t.exports=i()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}function o(t){Z=t}function a(t){Q=t}function s(){return function(){return e.nextTick(f)}}function h(){return"undefined"!=typeof Y?function(){Y(f)}:l()}function u(){var t=0,e=new $(f),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=f,function(){return t.port2.postMessage(0)}}function l(){var t=setTimeout;return function(){return t(f,1)}}function f(){for(var t=0;t<X;t+=2){var e=it[t],i=it[t+1];e(i),it[t]=void 0,it[t+1]=void 0}X=0}function p(){try{var t=i(459);return Y=t.runOnLoop||t.runOnContext,h()}catch(t){return l()}}function d(t,e){var i=arguments,n=this,r=new this.constructor(v);void 0===r[rt]&&N(r);var o=n._state;return o?!function(){var t=i[o-1];Q(function(){return I(o,r,t,n._result)})}():L(n,r,t,e),r}function m(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(v);return E(i,t),i}function v(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function x(t){try{return t.then}catch(t){return ht.error=t,ht}}function _(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}function b(t,e,i){Q(function(t){var n=!1,r=_(i,e,function(i){n||(n=!0,e!==i?E(t,i):T(t,i))},function(e){n||(n=!0,P(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&r&&(n=!0,P(t,r))},t)}function M(t,e){e._state===at?T(t,e._result):e._state===st?P(t,e._result):L(e,void 0,function(e){return E(t,e)},function(e){return P(t,e)})}function w(t,e,i){e.constructor===t.constructor&&i===d&&e.constructor.resolve===m?M(t,e):i===ht?P(t,ht.error):void 0===i?T(t,e):r(i)?b(t,e,i):T(t,e)}function E(e,i){e===i?P(e,g()):t(i)?w(e,i,x(i)):T(e,i)}function S(t){t._onerror&&t._onerror(t._result),A(t)}function T(t,e){t._state===ot&&(t._result=e,t._state=at,0!==t._subscribers.length&&Q(A,t))}function P(t,e){t._state===ot&&(t._state=st,t._result=e,Q(S,t))}function L(t,e,i,n){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+at]=i,r[o+st]=n,0===o&&t._state&&Q(A,t)}function A(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,r=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],r=e[a+i],n?I(i,n,r,o):r(o);t._subscribers.length=0}}function C(){this.error=null}function R(t,e){try{return t(e)}catch(t){return ut.error=t,ut}}function I(t,e,i,n){var o=r(i),a=void 0,s=void 0,h=void 0,u=void 0;if(o){if(a=R(i,n),a===ut?(u=!0,s=a.error,a=null):h=!0,e===a)return void P(e,y())}else a=n,h=!0;e._state!==ot||(o&&h?E(e,a):u?P(e,s):t===at?T(e,a):t===st&&P(e,a))}function O(t,e){try{e(function(e){E(t,e)},function(e){P(t,e)})}catch(e){P(t,e)}}function D(){return ct++}function N(t){t[rt]=ct++,t._state=void 0,t._result=void 0,t._subscribers=[]}function U(t,e){this._instanceConstructor=t,this.promise=new t(v),this.promise[rt]||N(this.promise),q(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&T(this.promise,this._result))):P(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function z(t){return new U(this,t).promise}function B(t){var e=this;return new e(q(t)?function(i,n){for(var r=t.length,o=0;o<r;o++)e.resolve(t[o]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function G(t){var e=this,i=new e(v);return P(i,t),i}function j(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function k(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function V(t){this[rt]=D(),this._result=this._state=void 0,this._subscribers=[],v!==t&&("function"!=typeof t&&j(),this instanceof V?O(this,t):k())}function H(){var t=void 0;if("undefined"!=typeof n)t=n;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=V}var W=void 0;W=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var q=W,X=0,Y=void 0,Z=void 0,Q=function(t,e){it[X]=t,it[X+1]=e,X+=2,2===X&&(Z?Z(f):nt())},J="undefined"!=typeof window?window:void 0,K=J||{},$=K.MutationObserver||K.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof e&&"[object process]"==={}.toString.call(e),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,it=new Array(1e3),nt=void 0;nt=tt?s():$?u():et?c():void 0===J?p():l();var rt=Math.random().toString(36).substring(16),ot=void 0,at=1,st=2,ht=new C,ut=new C,ct=0;return U.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===ot&&i<t;i++)this._eachEntry(e[i],i)},U.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===m){var r=x(t);if(r===d&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===V){var o=new i(v);w(o,t,r),this._willSettleAt(o,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},U.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===ot&&(this._remaining--,t===st?P(n,i):this._result[e]=i),0===this._remaining&&T(n,this._result)},U.prototype._willSettleAt=function(t,e){var i=this;L(t,void 0,function(t){return i._settledAt(at,e,t)},function(t){return i._settledAt(st,e,t)})},V.all=z,V.race=B,V.resolve=m,V.reject=G,V._setScheduler=o,V._setAsap=a,V._asap=Q,V.prototype={constructor:V,then:d,catch:function(t){return this.then(null,t)}},V.polyfill=H,V.Promise=V,V})}).call(e,i(387),function(){return this}())},function(t,e){!function(i){if("object"==typeof e&&"undefined"!=typeof t)t.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.PriorityQueue=i()}}(function(){return function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){var n,r,o,a,s,h=function(t,e){function i(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},u={}.hasOwnProperty;n=t("./PriorityQueue/AbstractPriorityQueue"),r=t("./PriorityQueue/ArrayStrategy"),a=t("./PriorityQueue/BinaryHeapStrategy"),o=t("./PriorityQueue/BHeapStrategy"),s=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=a),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return h(e,t),e}(n),s.ArrayStrategy=r,s.BinaryHeapStrategy=a,s.BHeapStrategy=o,e.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,i){var n;e.exports=n=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,i){var n,r;r=function(t,e,i){var n,r,o;for(r=0,n=t.length;r<n;)o=r+n>>>1,i(t[o],e)>=0?r=o+1:n=o;return r},e.exports=n=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=r(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,i){var n;e.exports=n=function(){function t(t){var e,i,n,r,o,a,s,h,u;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,h=0;1<<h<this.pageSize;)h+=1;if(1<<h!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=h,this._emptyMemoryPageTemplate=e=[],i=n=0,a=this.pageSize;0<=a?n<a:n>a;i=0<=a?++n:--n)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(s=t.initialValues,r=0,o=s.length;r<o;r++)u=s[r],this.queue(u)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var i;for(i=t>>this._shift;i>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[i][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var i,n,r,o;for(i=this.comparator;t>1&&(n=t&this._mask,t<this.pageSize||n>3?r=t&~this._mask|n>>1:n<2?(r=t-this.pageSize>>this._shift,r+=r&~(this._mask>>1),r|=this.pageSize>>1):r=t-2,o=this._read(r),!(i(o,e)<0));)this._write(r,e),this._write(t,o),t=r},t.prototype._bubbleDown=function(t,e){var i,n,r,o,a;for(a=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?i=n=t+2:t&this.pageSize>>1?(i=(t&~this._mask)>>1,i|=t&this._mask>>1,i=i+1<<this._shift,n=i+1):(i=t+(t&this._mask),n=i+1),i!==n&&n<=this.length)if(r=this._read(i),o=this._read(n),a(r,e)<0&&a(r,o)<=0)this._write(i,e),this._write(t,r),t=i;else{if(!(a(o,e)<0))break;this._write(n,e),this._write(t,o),t=n}else{if(!(i<=this.length))break;if(r=this._read(i),!(a(r,e)<0))break;this._write(i,e),this._write(t,r),t=i}},t}()},{}],5:[function(t,e,i){var n;e.exports=n=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,i;if(this.data.length>0)for(t=e=1,i=this.data.length;1<=i?e<i:e>i;t=1<=i?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,i;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)i=this.data[e],this.data[e]=this.data[t],this.data[t]=i,t=e},t.prototype._bubbleDown=function(t){var e,i,n,r,o;for(e=this.data.length-1;;){if(i=(t<<1)+1,r=i+1,n=t,i<=e&&this.comparator(this.data[i],this.data[n])<0&&(n=i),r<=e&&this.comparator(this.data[r],this.data[n])<0&&(n=r),n===t)break;o=this.data[n],this.data[n]=this.data[t],this.data[t]=o,t=n}},t}()},{}]},{},[1])(1)})},,function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===n||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function a(){m&&p&&(m=!1,p.length?d=p.concat(d):v=-1,d.length&&s())}function s(){if(!m){var t=r(a);m=!0;for(var e=d.length;e;){for(p=d,d=[];++v<e;)p&&p[v].run();v=-1,e=d.length}p=null,m=!1,o(t)}}function h(t,e){this.fun=t,this.array=e}function u(){}var c,l,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{l="function"==typeof clearTimeout?clearTimeout:n}catch(t){l=n}}();var p,d=[],m=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d.push(new h(t,e)),1!==d.length||m||r(s)},h.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,i){function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var r=i(116);n.fromMGRS=function(t){return new n(r.toPoint(t))},n.prototype.toMGRS=function(t){return r.forward([this.x,this.y],t)},t.exports=n},function(t,e){t.exports=function(t,e,i){var n,r,o,a=i.x,s=i.y,h=i.z||0,u={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==i.z)switch(0===o?(n=a,r="x"):1===o?(n=s,r="y"):(n=h,r="z"),t.axis[o]){case"e":u[r]=n;break;case"w":u[r]=-n;break;case"n":u[r]=n;break;case"s":u[r]=-n;break;case"u":void 0!==i[r]&&(u.z=n);break;case"d":void 0!==i[r]&&(u.z=-n);break;default:return null}return u}},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===t?(t=Math.floor(30*(n(e)+Math.PI)/Math.PI),t<0?0:t>=60?59:t):t>0&&t<=60?t-1:void 0}},function(t,e){var i=Math.PI/2;t.exports=function(t,e){var n=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-n)<1e-6)return e<0?-1*i:i;for(var r,o,a,s,h=Math.asin(.5*e),u=0;u<30;u++)if(o=Math.sin(h),a=Math.cos(h),s=t*o,r=Math.pow(1-s*s,2)/(2*a)*(e/(1-t*t)-o/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),h+=r,Math.abs(r)<=1e-10)return h;return NaN}},function(t,e){t.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},function(t,e){e.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},e.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},e.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},e.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},e.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},e.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},e.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},e.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},e.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},e.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},e.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},e.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},e.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},e.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},e.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},e.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},function(t,e){e.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},e.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},e.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},e.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},e.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},e.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},e.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},e.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},e.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},e.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},e.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},e.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},e.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},e.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},e.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},e.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},e.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},e.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},e.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},e.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},e.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},e.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},e.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},e.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},e.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},e.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},e.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},e.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},e.hough={a:6378270,rf:297,ellipseName:"Hough"},e.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},e.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},e.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},e.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},e.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},e.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},e.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},e.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},e.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},e.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},e.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},e.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},e.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},e.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},function(t,e){e.greenwich=0,e.lisbon=-9.131906111111,e.paris=2.337229166667,e.bogota=-74.080916666667,e.madrid=-3.687938888889,e.rome=12.452333333333,e.bern=7.439583333333,e.jakarta=106.807719444444,e.ferro=-17.666666666667,e.brussels=4.367975,e.stockholm=18.058277777778,e.athens=23.7163375,e.oslo=10.722916666667},function(t,e){e.ft={to_meter:.3048},e["us-ft"]={to_meter:1200/3937}},function(t,e,i){function n(t,e,i){var n;return Array.isArray(i)?(n=s(t,e,i),3===i.length?[n.x,n.y,n.z]:[n.x,n.y]):s(t,e,i)}function r(t){return t instanceof a?t:t.oProj?t.oProj:a(t)}function o(t,e,i){t=r(t);var o,a=!1;return"undefined"==typeof e?(e=t,t=h,a=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(i=e,e=t,t=h,a=!0),e=r(e),i?n(t,e,i):(o={forward:function(i){return n(t,e,i)},inverse:function(i){return n(e,t,i)}},a&&(o.oProj=e),o)}var a=i(82),s=i(232),h=a("WGS84");t.exports=o},function(t,e){function i(t,e,i,h,u,c){var l={};return l.datum_type=o,t&&"none"===t&&(l.datum_type=a),e&&(l.datum_params=e.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=n),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=r,l.datum_params[3]*=s,l.datum_params[4]*=s,l.datum_params[5]*=s,l.datum_params[6]=l.datum_params[6]/1e6+1))),l.a=i,l.b=h,l.es=u,l.ep2=c,l}var n=1,r=2,o=4,a=5,s=484813681109536e-20;t.exports=i},function(t,e){"use strict";var i=1,n=2,r=Math.PI/2;e.compareDatums=function(t,e){return t.datum_type===e.datum_type&&(!(t.a!==e.a||Math.abs(this.es-e.es)>5e-11)&&(t.datum_type===i?this.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==n||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6]))},e.geodeticToGeocentric=function(t,e,i){var n,o,a,s,h=t.x,u=t.y,c=t.z?t.z:0;if(u<-r&&u>-1.001*r)u=-r;else if(u>r&&u<1.001*r)u=r;else if(u<-r||u>r)return null;return h>Math.PI&&(h-=2*Math.PI),o=Math.sin(u),s=Math.cos(u),a=o*o,n=i/Math.sqrt(1-e*a),{x:(n+c)*s*Math.cos(h),y:(n+c)*s*Math.sin(h),z:(n*(1-e)+c)*o}},e.geocentricToGeodetic=function(t,e,i,n){var o,a,s,h,u,c,l,f,p,d,m,v,g,y,x,_,b=1e-12,M=b*b,w=30,E=t.x,S=t.y,T=t.z?t.z:0;if(o=Math.sqrt(E*E+S*S),a=Math.sqrt(E*E+S*S+T*T),o/i<b){if(y=0,a/i<b)return x=r,_=-n,{x:t.x,y:t.y,z:t.z}}else y=Math.atan2(S,E);s=T/a,h=o/a,u=1/Math.sqrt(1-e*(2-e)*h*h),f=h*(1-e)*u,p=s*u,g=0;do g++,l=i/Math.sqrt(1-e*p*p),_=o*f+T*p-l*(1-e*p*p),c=e*l/(l+_),u=1/Math.sqrt(1-c*(2-c)*h*h),d=h*(1-c)*u,m=s*u,v=m*f-d*p,f=d,p=m;while(v*v>M&&g<w);return x=Math.atan(m/Math.abs(d)),{x:y,y:x,z:_}},e.geocentricToWgs84=function(t,e,r){if(e===i)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===n){var o=r[0],a=r[1],s=r[2],h=r[3],u=r[4],c=r[5],l=r[6];return{x:l*(t.x-c*t.y+u*t.z)+o,y:l*(c*t.x+t.y-h*t.z)+a,z:l*(-u*t.x+h*t.y+t.z)+s}}},e.geocentricFromWgs84=function(t,e,r){if(e===i)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===n){var o=r[0],a=r[1],s=r[2],h=r[3],u=r[4],c=r[5],l=r[6],f=(t.x-o)/l,p=(t.y-a)/l,d=(t.z-s)/l;return{x:f+c*p-u*d,y:-c*f+p+h*d,z:u*f-h*p+d}}}},function(t,e,i){function n(t){return t===r||t===o}var r=1,o=2,a=5,s=i(399);t.exports=function(t,e,i){return s.compareDatums(t,e)?i:t.datum_type===a||e.datum_type===a?i:t.es!==e.es||t.a!==e.a||n(t.datum_type)||n(e.datum_type)?(i=s.geodeticToGeocentric(i,t.es,t.a),n(t.datum_type)&&(i=s.geocentricToWgs84(i,t.datum_type,t.datum_params)),n(e.datum_type)&&(i=s.geocentricFromWgs84(i,e.datum_type,e.datum_params)),s.geocentricToGeodetic(i,e.es,e.a,e.b)):i}},function(t,e,i){var n=.16666666666666666,r=.04722222222222222,o=.022156084656084655,a=1e-10,s=i(394);e.eccentricity=function(t,e,i,a){var s=t*t,h=e*e,u=(s-h)/s,c=0;a?(t*=1-u*(n+u*(r+u*o)),s=t*t,u=0):c=Math.sqrt(u);var l=(s-h)/h;return{es:u,e:c,ep2:l}},e.sphere=function(t,e,i,n,r){if(!t){var o=s[n];o||(o=s.WGS84),t=o.a,e=o.b,i=o.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<a)&&(r=!0,e=t),{a:t,b:e,rf:i,sphere:r}}},function(t,e){t.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},function(t,e,i){var n=[i(231),i(429),i(428),i(427),i(426),i(423),i(417),i(415),i(409),i(416),i(407),i(414),i(410),i(411),i(424),i(422),i(420),i(425),i(421),i(412),i(430),i(408)];t.exports=function(t){n.forEach(function(e){t.Proj.projections.add(e)})}},function(t,e,i){var n=i(397);n.defaultDatum="WGS84",n.Proj=i(82),n.WGS84=new n.Proj("WGS84"),n.Point=i(388),n.toPoint=i(227),n.defs=i(228),n.transform=i(232),n.mgrs=i(116),n.version=i(431),i(403)(n),t.exports=n},function(t,e,i){function n(t){return"string"==typeof t}function r(t){return t in h}function o(t){return l.some(function(e){return t.indexOf(e)>-1})}function a(t){return"+"===t[0]}function s(t){return n(t)?r(t)?h[t]:o(t)?u(t):a(t)?c(t):void 0:t}var h=i(228),u=i(233),c=i(230),l=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];t.exports=s},function(t,e,i){function n(t,e){var i=a.length;return t.names?(a[i]=t,t.names.forEach(function(t){o[t.toLowerCase()]=i}),this):(console.log(e),!0)}var r=[i(419),i(418)],o={},a=[];e.add=n,e.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof o[e]&&a[o[e]]?a[o[e]]:void 0},e.start=function(){r.forEach(n)}},function(t,e,i){var n=1e-10,r=i(29),o=i(86),a=i(4),s=i(37);e.init=function(){Math.abs(this.lat1+this.lat2)<n||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r(this.e3,this.sin_po,this.cos_po),this.qs1=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r(this.e3,this.sin_po,this.cos_po),this.qs2=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=o(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>n?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},e.forward=function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=o(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*a(e-this.long0),h=r*Math.sin(s)+this.x0,u=this.rh-r*Math.cos(s)+this.y0;return t.x=h,t.y=u,t},e.inverse=function(t){var e,i,n,r,o,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),r=0,0!==e&&(r=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),o=a(r/this.ns0+this.long0),t.x=o,t.y=s,t},e.phi1z=function(t,e){var i,r,o,a,h,u=s(.5*e);if(t<n)return u;for(var c=t*t,l=1;l<=25;l++)if(i=Math.sin(u),r=Math.cos(u),o=t*i,a=1-o*o,h=.5*a*a/r*(e/(1-c)-i/a+.5/t*Math.log((1-o)/(1+o))),u+=h,Math.abs(h)<=1e-7)return u;return null},e.names=["Albers_Conic_Equal_Area","Albers","aea"]},function(t,e,i){var n=i(4),r=Math.PI/2,o=1e-10,a=i(54),s=i(50),h=i(51),u=i(52),c=i(53),l=i(83),f=i(37),p=i(84);e.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},e.forward=function(t){var e,i,f,p,d,m,v,g,y,x,_,b,M,w,E,S,T,P,L,A,C,R,I,O=t.x,D=t.y,N=Math.sin(t.y),U=Math.cos(t.y),F=n(O-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o?(t.x=this.x0+this.a*(r-D)*Math.sin(F),t.y=this.y0-this.a*(r-D)*Math.cos(F),t):Math.abs(this.sin_p12+1)<=o?(t.x=this.x0+this.a*(r+D)*Math.sin(F),t.y=this.y0+this.a*(r+D)*Math.cos(F),t):(P=this.sin_p12*N+this.cos_p12*U*Math.cos(F),S=Math.acos(P),T=S/Math.sin(S),t.x=this.x0+this.a*T*U*Math.sin(F),t.y=this.y0+this.a*T*(this.cos_p12*N-this.sin_p12*U*Math.cos(F)),t):(e=s(this.es),i=h(this.es),f=u(this.es),p=c(this.es),Math.abs(this.sin_p12-1)<=o?(d=this.a*a(e,i,f,p,r),m=this.a*a(e,i,f,p,D),t.x=this.x0+(d-m)*Math.sin(F),t.y=this.y0-(d-m)*Math.cos(F),t):Math.abs(this.sin_p12+1)<=o?(d=this.a*a(e,i,f,p,r),m=this.a*a(e,i,f,p,D),t.x=this.x0+(d+m)*Math.sin(F),t.y=this.y0+(d+m)*Math.cos(F),t):(v=N/U,g=l(this.a,this.e,this.sin_p12),y=l(this.a,this.e,N),x=Math.atan((1-this.es)*v+this.es*g*this.sin_p12/(y*U)),_=Math.atan2(Math.sin(F),this.cos_p12*Math.tan(x)-this.sin_p12*Math.cos(F)),L=0===_?Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.abs(Math.abs(_)-Math.PI)<=o?-Math.asin(this.cos_p12*Math.sin(x)-this.sin_p12*Math.cos(x)):Math.asin(Math.sin(F)*Math.cos(x)/Math.sin(_)),b=this.e*this.sin_p12/Math.sqrt(1-this.es),M=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),w=b*M,E=M*M,A=L*L,C=A*L,R=C*L,I=R*L,S=g*L*(1-A*E*(1-E)/6+C/8*w*(1-2*E)+R/120*(E*(4-7*E)-3*b*b*(1-7*E))-I/48*w),t.x=this.x0+S*Math.sin(_),t.y=this.y0+S*Math.cos(_),t))},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,d,m,v,g,y,x,_,b,M,w,E,S,T,P,L,A,C,R,I,O,D;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*r*this.a)return;return i=e/this.a,d=Math.sin(i),m=Math.cos(i),v=this.long0,Math.abs(e)<=o?g=this.lat0:(g=f(m*this.sin_p12+t.y*d*this.cos_p12/e),y=Math.abs(this.lat0)-r,v=n(Math.abs(y)<=o?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*d,e*this.cos_p12*m-t.y*this.sin_p12*d))),t.x=v,t.y=g,t}return x=s(this.es),_=h(this.es),b=u(this.es),M=c(this.es),Math.abs(this.sin_p12-1)<=o?(w=this.a*a(x,_,b,M,r),e=Math.sqrt(t.x*t.x+t.y*t.y),E=w-e,g=p(E/this.a,x,_,b,M),v=n(this.long0+Math.atan2(t.x,-1*t.y)),t.x=v,t.y=g,t):Math.abs(this.sin_p12+1)<=o?(w=this.a*a(x,_,b,M,r),e=Math.sqrt(t.x*t.x+t.y*t.y),E=e-w,g=p(E/this.a,x,_,b,M),v=n(this.long0+Math.atan2(t.x,t.y)),t.x=v,t.y=g,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),P=Math.atan2(t.x,t.y),S=l(this.a,this.e,this.sin_p12),L=Math.cos(P),A=this.e*this.cos_p12*L,C=-A*A/(1-this.es),R=3*this.es*(1-C)*this.sin_p12*this.cos_p12*L/(1-this.es),I=e/S,O=I-C*(1+C)*Math.pow(I,3)/6-R*(1+3*C)*Math.pow(I,4)/24,D=1-C*O*O/2-I*O*O*O/6,T=Math.asin(this.sin_p12*Math.cos(O)+this.cos_p12*Math.sin(O)*L),v=n(this.long0+Math.asin(Math.sin(P)*Math.sin(O)/Math.cos(T))),g=Math.atan((1-this.es*D*this.sin_p12/Math.sin(T))*Math.tan(T)/(1-this.es)),t.x=v,t.y=g,t)},e.names=["Azimuthal_Equidistant","aeqd"]},function(t,e,i){var n=i(54),r=i(50),o=i(51),a=i(52),s=i(53),h=i(83),u=i(4),c=i(36),l=i(84),f=Math.PI/2,p=1e-10;e.init=function(){this.sphere||(this.e0=r(this.es),this.e1=o(this.es),this.e2=a(this.es),this.e3=s(this.es),this.ml0=this.a*n(this.e0,this.e1,this.e2,this.e3,this.lat0))},e.forward=function(t){var e,i,r=t.x,o=t.y;if(r=u(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(r)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(r))-this.lat0);else{var a=Math.sin(o),s=Math.cos(o),c=h(this.a,this.e,a),l=Math.tan(o)*Math.tan(o),f=r*Math.cos(o),p=f*f,d=this.es*s*s/(1-this.es),m=this.a*n(this.e0,this.e1,this.e2,this.e3,o);e=c*f*(1-p*l*(1/6-(8-l+8*d)*p/120)),i=m-this.ml0+c*a/s*p*(.5+(5-l+6*d)*p/24)}return t.x=e+this.x0,t.y=i+this.y0,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,r=t.y/this.a;if(this.sphere){var o=r+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(o))}else{var a=this.ml0/this.a+r,s=l(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-f)<=p)return t.x=this.long0,t.y=f,r<0&&(t.y*=-1),t;var d=h(this.a,this.e,Math.sin(s)),m=d*d*d/this.a/this.a*(1-this.es),v=Math.pow(Math.tan(s),2),g=n*this.a/d,y=g*g;e=s-d*Math.tan(s)/m*g*g*(.5-(1+3*v)*g*g/24),i=g*(1-y*(v/3+(1+3*v)*v*y/15))/Math.cos(s)}return t.x=u(i+this.long0),t.y=c(e),t},e.names=["Cassini","Cassini_Soldner","cass"]},function(t,e,i){
var n=i(4),r=i(86),o=i(29),a=i(391);e.init=function(){this.sphere||(this.k0=o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},e.forward=function(t){var e,i,o=t.x,a=t.y,s=n(o-this.long0);if(this.sphere)e=this.x0+this.a*s*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var h=r(this.e,Math.sin(a));e=this.x0+this.a*this.k0*s,i=this.y0+this.a*h*.5/this.k0}return t.x=e,t.y=i,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=n(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=a(this.e,2*t.y*this.k0/this.a),e=n(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},e.names=["cea"]},function(t,e,i){var n=i(4),r=i(36);e.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},e.forward=function(t){var e=t.x,i=t.y,o=n(e-this.long0),a=r(i-this.lat0);return t.x=this.x0+this.a*o*this.rc,t.y=this.y0+this.a*a,t},e.inverse=function(t){var e=t.x,i=t.y;return t.x=n(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=r(this.lat0+(i-this.y0)/this.a),t},e.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},function(t,e,i){var n=i(50),r=i(51),o=i(52),a=i(53),s=i(29),h=i(54),u=i(4),c=i(36),l=i(84),f=1e-10;e.init=function(){Math.abs(this.lat1+this.lat2)<f||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=n(this.es),this.e1=r(this.es),this.e2=o(this.es),this.e3=a(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=s(this.e,this.sinphi,this.cosphi),this.ml1=h(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<f?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=s(this.e,this.sinphi,this.cosphi),this.ml2=h(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=h(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},e.forward=function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var r=h(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-r)}var o=this.ns*u(i-this.long0),a=this.x0+e*Math.sin(o),s=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=s,t},e.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,n,r;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==i&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return r=u(this.long0+o/this.ns),n=c(this.g-i/this.a),t.x=r,t.y=n,t;var a=this.g-i/this.a;return n=l(a,this.e0,this.e1,this.e2,this.e3),r=u(this.long0+o/this.ns),t.x=r,t.y=n,t},e.names=["Equidistant_Conic","eqdc"]},function(t,e,i){var n=Math.PI/4,r=i(392),o=Math.PI/2,a=20;e.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+n)/(Math.pow(Math.tan(.5*this.lat0+n),this.C)*r(this.e*t,this.ratexp))},e.forward=function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+n),this.C)*r(this.e*Math.sin(i),this.ratexp))-o,t.x=this.C*e,t},e.inverse=function(t){for(var e=1e-14,i=t.x/this.C,s=t.y,h=Math.pow(Math.tan(.5*s+n)/this.K,1/this.C),u=a;u>0&&(s=2*Math.atan(h*r(this.e*Math.sin(t.y),-.5*this.e))-o,!(Math.abs(s-t.y)<e));--u)t.y=s;return u?(t.x=i,t.y=s,t):null},e.names=["gauss"]},function(t,e,i){var n=i(4),r=1e-10,o=i(37);e.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},e.forward=function(t){var e,i,o,a,s,h,u,c,l=t.x,f=t.y;return o=n(l-this.long0),e=Math.sin(f),i=Math.cos(f),a=Math.cos(o),h=this.sin_p14*e+this.cos_p14*i*a,s=1,h>0||Math.abs(h)<=r?(u=this.x0+this.a*s*i*Math.sin(o)/h,c=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*i*a)/h):(u=this.x0+this.infinity_dist*i*Math.sin(o),c=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*a)),t.x=u,t.y=c,t},e.inverse=function(t){var e,i,r,a,s,h;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(a=Math.atan2(e,this.rc),i=Math.sin(a),r=Math.cos(a),h=o(r*this.sin_p14+t.y*i*this.cos_p14/e),s=Math.atan2(t.x*i,e*this.cos_p14*r-t.y*this.sin_p14*i),s=n(this.long0+s)):(h=this.phic0,s=0),t.x=s,t.y=h,t},e.names=["gnom"]},function(t,e,i){var n=i(4);e.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},e.forward=function(t){var e,i,r,o,a,s,h,u=t.x,c=t.y,l=n(u-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-l*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),a=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(o)),s=this.n*a,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=h*Math.cos(s)/1,t.x=h*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},e.inverse=function(t){var e,i,n,r,o,a,s,h,u=t.x;t.x=t.y,t.y=u,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.atan2(t.y,t.x),r=o/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,h=0;var c=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(h=1),s=t.y,c+=1;while(0===h&&c<15);return c>=15?null:t},e.names=["Krovak","krovak"]},function(t,e,i){var n=Math.PI/2,r=Math.PI/4,o=1e-10,a=i(86),s=i(4);e.S_POLE=1,e.N_POLE=2,e.EQUIT=3,e.OBLIQ=4,e.init=function(){var t=Math.abs(this.lat0);if(Math.abs(t-n)<o?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<o?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=a(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=a(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},e.forward=function(t){var e,i,h,u,c,l,f,p,d,m,v=t.x,g=t.y;if(v=s(v-this.long0),this.sphere){if(c=Math.sin(g),m=Math.cos(g),h=Math.cos(v),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+m*h:1+this.sinph0*c+this.cosph0*m*h,i<=o)return null;i=Math.sqrt(2/i),e=i*m*Math.sin(v),i*=this.mode===this.EQUIT?c:this.cosph0*c-this.sinph0*m*h}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),Math.abs(g+this.phi0)<o)return null;i=r-.5*g,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(v),i*=h}}else{switch(f=0,p=0,d=0,h=Math.cos(v),u=Math.sin(v),c=Math.sin(g),l=a(this.e,c),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(f=l/this.qp,p=Math.sqrt(1-f*f)),this.mode){case this.OBLIQ:d=1+this.sinb1*f+this.cosb1*p*h;break;case this.EQUIT:d=1+p*h;break;case this.N_POLE:d=n+g,l=this.qp-l;break;case this.S_POLE:d=g-n,l=this.qp+l}if(Math.abs(d)<o)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),i=this.mode===this.OBLIQ?this.ymf*d*(this.cosb1*f-this.sinb1*p*h):(d=Math.sqrt(2/(1+p*h)))*f*this.ymf,e=this.xmf*d*p*u;break;case this.N_POLE:case this.S_POLE:l>=0?(e=(d=Math.sqrt(l))*u,i=h*(this.mode===this.S_POLE?d:-d)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r,a,h,u,c,l=t.x/this.a,f=t.y/this.a;if(this.sphere){var p,d=0,m=0;if(p=Math.sqrt(l*l+f*f),i=.5*p,i>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(i),d=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(p)<=o?0:Math.asin(f*m/p),l*=m,f=d*p;break;case this.OBLIQ:i=Math.abs(p)<=o?this.phi0:Math.asin(d*this.sinph0+f*m*this.cosph0/p),l*=m*this.cosph0,f=(d-Math.sin(i)*this.sinph0)*p;break;case this.N_POLE:f=-f,i=n-i;break;case this.S_POLE:i-=n}e=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,f):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,f*=this.dd,u=Math.sqrt(l*l+f*f),u<o)return t.x=0,t.y=this.phi0,t;a=2*Math.asin(.5*u/this.rq),r=Math.cos(a),l*=a=Math.sin(a),this.mode===this.OBLIQ?(c=r*this.sinb1+f*a*this.cosb1/u,h=this.qp*c,f=u*this.cosb1*r-f*this.sinb1*a):(c=f*a/u,h=this.qp*c,f=u*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),h=l*l+f*f,!h)return t.x=0,t.y=this.phi0,t;c=1-h/this.qp,this.mode===this.S_POLE&&(c=-c)}e=Math.atan2(l,f),i=this.authlat(Math.asin(c),this.apa)}return t.x=s(this.long0+e),t.y=i,t},e.P00=.3333333333333333,e.P01=.17222222222222222,e.P02=.10257936507936508,e.P10=.06388888888888888,e.P11=.0664021164021164,e.P20=.016415012942191543,e.authset=function(t){var e,i=[];return i[0]=t*this.P00,e=t*t,i[0]+=e*this.P01,i[1]=e*this.P10,e*=t,i[0]+=e*this.P02,i[1]+=e*this.P11,i[2]=e*this.P20,i},e.authlat=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)},e.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},function(t,e,i){var n=1e-10,r=i(29),o=i(56),a=Math.PI/2,s=i(38),h=i(4),u=i(55);e.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<n)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),a=r(this.e,e,i),s=o(this.e,this.lat1,e),h=Math.sin(this.lat2),u=Math.cos(this.lat2),c=r(this.e,h,u),l=o(this.e,this.lat2,h),f=o(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>n?this.ns=Math.log(a/c)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=a/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(f,this.ns),this.title||(this.title="Lambert Conformal Conic")}},e.forward=function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=n&&(i=s(i)*(a-2*n));var r,u,c=Math.abs(Math.abs(i)-a);if(c>n)r=o(this.e,i,Math.sin(i)),u=this.a*this.f0*Math.pow(r,this.ns);else{if(c=i*this.ns,c<=0)return null;u=0}var l=this.ns*h(e-this.long0);return t.x=this.k0*(u*Math.sin(l))+this.x0,t.y=this.k0*(this.rh-u*Math.cos(l))+this.y0,t},e.inverse=function(t){var e,i,n,r,o,s=(t.x-this.x0)/this.k0,c=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+c*c),i=1):(e=-Math.sqrt(s*s+c*c),i=-1);var l=0;if(0!==e&&(l=Math.atan2(i*s,i*c)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),r=u(this.e,n),r===-9999)return null}else r=-a;return o=h(l/this.ns+this.long0),t.x=o,t.y=r,t},e.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},function(t,e){function i(t){return t}e.init=function(){},e.forward=i,e.inverse=i,e.names=["longlat","identity"]},function(t,e,i){var n=i(29),r=Math.PI/2,o=1e-10,a=57.29577951308232,s=i(4),h=Math.PI/4,u=i(56),c=i(55);e.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=n(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},e.forward=function(t){var e=t.x,i=t.y;if(i*a>90&&i*a<-90&&e*a>180&&e*a<-180)return null;var n,c;if(Math.abs(Math.abs(i)-r)<=o)return null;if(this.sphere)n=this.x0+this.a*this.k0*s(e-this.long0),c=this.y0+this.a*this.k0*Math.log(Math.tan(h+.5*i));else{var l=Math.sin(i),f=u(this.e,i,l);n=this.x0+this.a*this.k0*s(e-this.long0),c=this.y0-this.a*this.k0*Math.log(f)}return t.x=n,t.y=c,t},e.inverse=function(t){var e,i,n=t.x-this.x0,o=t.y-this.y0;if(this.sphere)i=r-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var a=Math.exp(-o/(this.a*this.k0));if(i=c(this.e,a),i===-9999)return null}return e=s(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},e.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},function(t,e,i){var n=i(4);e.init=function(){},e.forward=function(t){var e=t.x,i=t.y,r=n(e-this.long0),o=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=o,t.y=a,t},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=n(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},e.names=["Miller_Cylindrical","mill"]},function(t,e,i){var n=i(4),r=1e-10;e.init=function(){},e.forward=function(t){for(var e=t.x,i=t.y,o=n(e-this.long0),a=i,s=Math.PI*Math.sin(i),h=0;!0;h++){var u=-(a+Math.sin(a)-s)/(1+Math.cos(a));if(a+=u,Math.abs(u)<r)break}a/=2,Math.PI/2-Math.abs(i)<r&&(o=0);var c=.900316316158*this.a*o*Math.cos(a)+this.x0,l=1.4142135623731*this.a*Math.sin(a)+this.y0;return t.x=c,t.y=l,t},e.inverse=function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var r=n(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return t.x=r,t.y=o,t},e.names=["Mollweide","moll"]},function(t,e){var i=484813681109536e-20;e.iterations=1,e.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},e.forward=function(t){var e,n=t.x,r=t.y,o=r-this.lat0,a=n-this.long0,s=o/i*1e-5,h=a,u=1,c=0;for(e=1;e<=10;e++)u*=s,c+=this.A[e]*u;var l,f,p=c,d=h,m=1,v=0,g=0,y=0;for(e=1;e<=6;e++)l=m*p-v*d,f=v*p+m*d,m=l,v=f,g=g+this.B_re[e]*m-this.B_im[e]*v,y=y+this.B_im[e]*m+this.B_re[e]*v;return t.x=y*this.a+this.x0,t.y=g*this.a+this.y0,t},e.inverse=function(t){var e,n,r,o=t.x,a=t.y,s=o-this.x0,h=a-this.y0,u=h/this.a,c=s/this.a,l=1,f=0,p=0,d=0;for(e=1;e<=6;e++)n=l*u-f*c,r=f*u+l*c,l=n,f=r,p=p+this.C_re[e]*l-this.C_im[e]*f,d=d+this.C_im[e]*l+this.C_re[e]*f;for(var m=0;m<this.iterations;m++){var v,g,y=p,x=d,_=u,b=c;for(e=2;e<=6;e++)v=y*p-x*d,g=x*p+y*d,y=v,x=g,_+=(e-1)*(this.B_re[e]*y-this.B_im[e]*x),b+=(e-1)*(this.B_im[e]*y+this.B_re[e]*x);y=1,x=0;var M=this.B_re[1],w=this.B_im[1];for(e=2;e<=6;e++)v=y*p-x*d,g=x*p+y*d,y=v,x=g,M+=e*(this.B_re[e]*y-this.B_im[e]*x),w+=e*(this.B_im[e]*y+this.B_re[e]*x);var E=M*M+w*w;p=(_*M+b*w)/E,d=(b*M-_*w)/E}var S=p,T=d,P=1,L=0;for(e=1;e<=9;e++)P*=S,L+=this.D[e]*P;var A=this.lat0+L*i*1e5,C=this.long0+T;return t.x=C,t.y=A,t},e.names=["New_Zealand_Map_Grid","nzmg"]},function(t,e,i){var n=i(56),r=i(4),o=i(55),a=Math.PI/2,s=Math.PI/4,h=1e-10;e.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var o=n(this.e,this.lat0,t),a=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));a*a<1&&(a=1);var s,h;if(isNaN(this.longc)){var u=n(this.e,this.lat1,Math.sin(this.lat1)),c=n(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var l=Math.pow(u,this.bl),f=Math.pow(c,this.bl);s=this.el/l,h=.5*(s-1/s);var p=(this.el*this.el-f*l)/(this.el*this.el+f*l),d=(f-l)/(f+l),m=r(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(p*Math.tan(.5*this.bl*m)/d)/this.bl,this.long0=r(this.long0);var v=r(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*v)/h),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else s=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=s*Math.pow(o,this.bl),h=.5*(s-1/s),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(h*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},e.forward=function(t){var e,i,o,u=t.x,c=t.y,l=r(u-this.long0);if(Math.abs(Math.abs(c)-a)<=h)o=c>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(s+o*this.gamma0*.5)),e=-1*o*a*this.al/this.bl;else{var f=n(this.e,c,Math.sin(c)),p=this.el/Math.pow(f,this.bl),d=.5*(p-1/p),m=.5*(p+1/p),v=Math.sin(this.bl*l),g=(d*Math.sin(this.gamma0)-v*Math.cos(this.gamma0))/m;i=Math.abs(Math.abs(g)-1)<=h?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,e=Math.abs(Math.cos(this.bl*l))<=h?this.al*this.bl*l:this.al*Math.atan2(d*Math.cos(this.gamma0)+v*Math.sin(this.gamma0),Math.cos(this.bl*l))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},e.inverse=function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*i/this.al),s=.5*(n-1/n),u=.5*(n+1/n),c=Math.sin(this.bl*e/this.al),l=(c*Math.cos(this.gamma0)+s*Math.sin(this.gamma0))/u,f=Math.pow(this.el/Math.sqrt((1+l)/(1-l)),1/this.bl);return Math.abs(l-1)<h?(t.x=this.long0,t.y=a):Math.abs(l+1)<h?(t.x=this.long0,t.y=-1*a):(t.y=o(this.e,f),t.x=r(this.long0-Math.atan2(s*Math.cos(this.gamma0)-c*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},e.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},function(t,e,i){var n=i(50),r=i(51),o=i(52),a=i(53),s=i(4),h=i(36),u=i(54),c=1e-10,l=i(83),f=20;e.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=n(this.es),this.e1=r(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*u(this.e0,this.e1,this.e2,this.e3,this.lat0)},e.forward=function(t){var e,i,n,r=t.x,o=t.y,a=s(r-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=c?(e=this.a*a,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(o),i=this.a*(h(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=c)e=this.a*a,i=-1*this.ml0;else{var f=l(this.a,this.e,Math.sin(o))/Math.tan(o);e=f*Math.sin(n),i=this.a*u(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+f*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},e.inverse=function(t){var e,i,n,r,o,a,h,l,p;if(n=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=c)e=s(n/this.a+this.long0),i=0;else{a=this.lat0+r/this.a,h=n*n/this.a/this.a+a*a,l=a;var d;for(o=f;o;--o)if(d=Math.tan(l),p=-1*(a*(l*d+1)-l-.5*(l*l+h)*d)/((l-a)/d-1),l+=p,Math.abs(p)<=c){i=l;break}e=s(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=c)i=0,e=s(this.long0+n/this.a);else{a=(this.ml0+r)/this.a,h=n*n/this.a/this.a+a*a,l=a;var m,v,g,y,x;for(o=f;o;--o)if(x=this.e*Math.sin(l),m=Math.sqrt(1-x*x)*Math.tan(l),v=this.a*u(this.e0,this.e1,this.e2,this.e3,l),g=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),y=v/this.a,p=(a*(m*y+1)-y-.5*m*(y*y+h))/(this.es*Math.sin(2*l)*(y*y+h-2*a*y)/(4*m)+(a-y)*(m*g-2/Math.sin(2*l))-g),l-=p,Math.abs(p)<=c){i=l;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=s(this.long0+Math.asin(n*m/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},e.names=["Polyconic","poly"]},function(t,e,i){var n=i(4),r=i(36),o=i(225),a=20,s=i(85),h=i(226),u=Math.PI/2,c=1e-10,l=i(37);e.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=o(this.es)},e.forward=function(t){var e,i,r=t.x,o=t.y;if(r=n(r-this.long0),this.sphere){if(this.m)for(var h=this.n*Math.sin(o),u=a;u;--u){var l=(this.m*o+Math.sin(o)-h)/(this.m+Math.cos(o));if(o-=l,Math.abs(l)<c)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*r*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var f=Math.sin(o),p=Math.cos(o);i=this.a*s(o,f,p,this.en),e=this.a*r*p/Math.sqrt(1-this.es*f*f)}return t.x=e,t.y=i,t},e.inverse=function(t){var e,i,o,a;return t.x-=this.x0,o=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,o/=this.C_x*(this.m+Math.cos(e)),this.m?e=l((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=l(Math.sin(e)/this.n)),o=n(o+this.long0),e=r(e)):(e=h(t.y/this.a,this.es,this.en),a=Math.abs(e),a<u?(a=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*a*a)/(this.a*Math.cos(e)),o=n(i)):a-c<u&&(o=this.long0)),t.x=o,t.y=e,t},e.names=["Sinusoidal","sinu"]},function(t,e){e.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=this.rf,r=1/n,o=2*r-Math.pow(r,2),a=this.e=Math.sqrt(o);this.R=this.k0*i*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+t/2)),u=Math.log((1+a*e)/(1-a*e));this.K=s-this.alpha*h+this.alpha*a/2*u},e.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},e.inverse=function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),s=this.lambda0+a/this.alpha,h=0,u=o,c=-1e3,l=0;Math.abs(u-c)>1e-7;){if(++l>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),c=u,u=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=s,t.y=u,t},e.names=["somerc"]},function(t,e,i){var n=Math.PI/2,r=1e-10,o=i(38),a=i(29),s=i(56),h=i(55),u=i(4);e.ssfn_=function(t,e,i){return e*=i,Math.tan(.5*(n+t))*Math.pow((1-e)/(1+e),.5*i)},e.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r&&(this.k0=.5*(1+o(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=r&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r&&(this.k0=.5*this.cons*a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/s(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=a(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-n,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},e.forward=function(t){var e,i,o,a,h,c,l=t.x,f=t.y,p=Math.sin(f),d=Math.cos(f),m=u(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=r&&Math.abs(f+this.lat0)<=r?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*p+this.coslat0*d*Math.cos(m)),t.x=this.a*e*d*Math.sin(m)+this.x0,t.y=this.a*e*(this.coslat0*p-this.sinlat0*d*Math.cos(m))+this.y0,t):(i=2*Math.atan(this.ssfn_(f,p,this.e))-n,a=Math.cos(i),o=Math.sin(i),Math.abs(this.coslat0)<=r?(h=s(this.e,f*this.con,this.con*p),c=2*this.a*this.k0*h/this.cons,t.x=this.x0+c*Math.sin(l-this.long0),t.y=this.y0-this.con*c*Math.cos(l-this.long0),t):(Math.abs(this.sinlat0)<r?(e=2*this.a*this.k0/(1+a*Math.cos(m)),t.y=e*o):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*a*Math.cos(m))),t.y=e*(this.cosX0*o-this.sinX0*a*Math.cos(m))+this.y0),t.x=e*a*Math.sin(m)+this.x0,t))},e.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,o,a,s,c=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var l=2*Math.atan(c/(.5*this.a*this.k0));return e=this.long0,i=this.lat0,c<=r?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(l)*this.sinlat0+t.y*Math.sin(l)*this.coslat0/c),e=u(Math.abs(this.coslat0)<r?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(l),c*this.coslat0*Math.cos(l)-t.y*this.sinlat0*Math.sin(l))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=r){if(c<=r)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,o=c*this.cons/(2*this.a*this.k0),i=this.con*h(this.e,o),e=this.con*u(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else a=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,c<=r?s=this.X0:(s=Math.asin(Math.cos(a)*this.sinX0+t.y*Math.sin(a)*this.cosX0/c),e=u(this.long0+Math.atan2(t.x*Math.sin(a),c*this.cosX0*Math.cos(a)-t.y*this.sinX0*Math.sin(a)))),i=-1*h(this.e,Math.tan(.5*(n+s)));return t.x=e,t.y=i,t},e.names=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"]},function(t,e,i){var n=i(413),r=i(4);e.init=function(){n.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},e.forward=function(t){var e,i,o,a;return t.x=r(t.x-this.long0),n.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),o=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*o),t.x=a*i*Math.sin(t.x),t.y=a*(this.cosc0*e-this.sinc0*i*o),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},e.inverse=function(t){var e,i,o,a,s;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=Math.sqrt(t.x*t.x+t.y*t.y)){var h=2*Math.atan2(s,this.R2);e=Math.sin(h),i=Math.cos(h),a=Math.asin(i*this.sinc0+t.y*e*this.cosc0/s),o=Math.atan2(t.x*e,s*this.cosc0*i-t.y*this.sinc0*e)}else a=this.phic0,o=0;return t.x=o,t.y=a,n.inverse.apply(this,[t]),t.x=r(t.x+this.long0),t},e.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},function(t,e,i){var n=i(390),r=i(231);e.dependsOn="tmerc",e.init=function(){var t=n(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(t+.5)*Math.PI/30-Math.PI,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,r.init.apply(this),this.forward=r.forward,this.inverse=r.inverse},e.names=["Universal Transverse Mercator System","utm"]},function(t,e,i){var n=i(4),r=Math.PI/2,o=1e-10,a=i(37);e.init=function(){this.R=this.a},e.forward=function(t){var e,i,s=t.x,h=t.y,u=n(s-this.long0);Math.abs(h)<=o&&(e=this.x0+this.R*u,i=this.y0);var c=a(2*Math.abs(h/Math.PI));(Math.abs(u)<=o||Math.abs(Math.abs(h)-r)<=o)&&(e=this.x0,i=h>=0?this.y0+Math.PI*this.R*Math.tan(.5*c):this.y0+Math.PI*this.R*-Math.tan(.5*c));var l=.5*Math.abs(Math.PI/u-u/Math.PI),f=l*l,p=Math.sin(c),d=Math.cos(c),m=d/(p+d-1),v=m*m,g=m*(2/p-1),y=g*g,x=Math.PI*this.R*(l*(m-y)+Math.sqrt(f*(m-y)*(m-y)-(y+f)*(v-y)))/(y+f);u<0&&(x=-x),e=this.x0+x;var _=f+m;return x=Math.PI*this.R*(g*_-l*Math.sqrt((y+f)*(f+1)-_*_))/(y+f),i=h>=0?this.y0+x:this.y0-x,t.x=e,t.y=i,t},e.inverse=function(t){var e,i,r,a,s,h,u,c,l,f,p,d,m;return t.x-=this.x0,t.y-=this.y0,p=Math.PI*this.R,r=t.x/p,a=t.y/p,s=r*r+a*a,h=-Math.abs(a)*(1+s),u=h-2*a*a+r*r,c=-2*h+1+2*a*a+s*s,m=a*a/c+(2*u*u*u/c/c/c-9*h*u/c/c)/27,l=(h-u*u/3/c)/c,f=2*Math.sqrt(-l/3),p=3*m/l/f,Math.abs(p)>1&&(p=p>=0?1:-1),d=Math.acos(p)/3,i=t.y>=0?(-f*Math.cos(d+Math.PI/3)-u/3/c)*Math.PI:-(-f*Math.cos(d+Math.PI/3)-u/3/c)*Math.PI,e=Math.abs(r)<o?this.long0:n(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(r*r-a*a)+s*s))/2/r),t.x=e,t.y=i,t},e.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},function(t,e){t.exports="2.3.17"},function(t,e){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,r){e=e||"&",n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var h=t.length;s>0&&h>s&&(h=s);for(var u=0;u<h;++u){var c,l,f,p,d=t[u].replace(a,"%20"),m=d.indexOf(n);m>=0?(c=d.substr(0,m),l=d.substr(m+1)):(c=d,l=""),f=decodeURIComponent(c),p=decodeURIComponent(l),i(o,f)?Array.isArray(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o}},function(t,e){"use strict";var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,r){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(r){var o=encodeURIComponent(i(r))+n;return Array.isArray(t[r])?t[r].map(function(t){return o+encodeURIComponent(i(t))}).join(e):o+encodeURIComponent(i(t[r]))}).join(e):r?encodeURIComponent(i(r))+n+encodeURIComponent(i(t)):""}},function(t,e,i){"use strict";e.decode=e.parse=i(432),e.encode=e.stringify=i(433)},function(t,e){t.exports="#ifdef USE_LOGDEPTHBUF\n\n    uniform float logDepthBufFC;\n    #define EPSILON 1e-6\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        //#extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n\n    #endif\n\n#endif\n"},function(t,e){t.exports="vec2    pitUV(vec2 uvIn, vec3 pit)\n{\n    vec2  uv;\n    uv.x = uvIn.x* pit.z + pit.x;\n    uv.y = 1.0 -( (1.0 - uvIn.y) * pit.z + pit.y);\n\n    return uv;\n}\n\n"},function(t,e){t.exports="#ifdef USE_LOGDEPTHBUF\n\n    uniform float logDepthBufFC;\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        //#extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n\n    #endif\n\n#endif\n\nuniform vec3 lightPosition;\nuniform sampler2D diffuse;\nuniform float time;\nuniform bool lightingEnabled;\nvarying vec2  vUv;\nvarying vec3 pos;\nvarying vec3 vNormal;\n\nfloat speed = 0.01;\nfloat noiseScale = 0.005;\n\nvoid main()\n{\n     #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    // Correct Y knowing image is -85 85\n    vec2 vUv2 = vec2(vUv.x, clamp(vUv.y + (vUv.y - 0.5) * - 0.45, 0., 1.));\n    float coefDistCam = (length(cameraPosition.xyz) - 6400000.) / 500000.;\n\n    vec2 uvTime =  vUv2 + vec2( -0.1, .1 ) * mod(time * speed, 1.);\n    vec4 noiseColor = texture2D( diffuse, uvTime );\n    vec2 uvNoise = vUv2 + noiseScale * vUv2 * vec2(noiseColor.r, noiseColor.b );\n\n    vec4 color = texture2D( diffuse, uvNoise); //texture2D( diffuse, vUv2 );\n    float l = (max(color.r,max(color.g,color.b)) + min(color.r,min(color.g,color.b))) / 2.;\n    l *= l*1.5;\n    gl_FragColor =  0.25 +  (texture2D( diffuse, vUv2 ) * 0.95);\n    gl_FragColor.b += 0.1;\n\n    gl_FragColor.a = min(time * min( coefDistCam, 1.2) , 1.) * (vUv.y <= 0.75 ? l : (1. - ((vUv.y - 0.75) / 0.25)) * l  );\n\n    if(lightingEnabled){   // Add lighting\n        float light = min(2. * dot(vNormal, lightPosition),1.); //normalize(pos.xyz)\n        gl_FragColor.a *= -light;\n    }\n}";
},function(t,e){t.exports="\n#ifdef USE_LOGDEPTHBUF\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        varying float vFragDepth;\n\n    #endif\n\n    uniform float logDepthBufFC;\n\n#endif\n\n#define EPSILON 1e-6\n\nuniform vec3  lightPosition;\nvarying vec2  vUv;\nvarying vec3 vNormal;\nvarying vec3 pos;\nvec3 normalES;\nvec3 normalCAMES;\n\n\nvoid main()\n{\n\n    vUv = uv;\n    vNormal = normal;\n    pos = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n\n\n    #ifdef USE_LOGDEPTHBUF\n\n        gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n        #ifdef USE_LOGDEPTHBUF_EXT\n\n            vFragDepth = 1.0 + gl_Position.w;\n\n        #else\n\n            gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n        #endif\n\n    #endif\n\n}\n\n\n"},function(t,e){t.exports="const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\nvec4 pack1K ( float depth ) {\n    depth /= 100000000.0;\n    vec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n    res -= res.xxyz * bitMsk;\n    return res;\n}\n\nvoid main() {\n\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\t   gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n        float z = 1.0/ gl_FragCoord.w ;\n        gl_FragColor = pack1K(z);\n    #else\n        float z = gl_FragCoord.z / gl_FragCoord.w;\n        gl_FragColor = pack1K(z);\n    #endif\n\n}\n"},function(t,e){t.exports="// BUG CHROME 50 UBUNTU 16.04\n// Lose context on compiling shader with too many IF STATEMENT\n// runconformance/glsl/bugs/conditional-discard-in-loop.html\n// conformance/glsl/bugs/nested-loops-with-break-and-continue.html\n// Resolve CHROME unstable 52\n\nconst vec4 CFog = vec4( 0.76, 0.85, 1.0, 1.0);\nconst vec4 CWhite = vec4(1.0,1.0,1.0,1.0);\nconst vec4 CBlueOcean = vec4( 0.04, 0.23, 0.35, 1.0);\nconst vec4 COrange = vec4( 1.0, 0.3, 0.0, 1.0);\nconst vec4 CRed = vec4( 1.0, 0.0, 0.0, 1.0);\n\n\nuniform sampler2D   dTextures_01[TEX_UNITS];\nuniform vec3        offsetScale_L01[TEX_UNITS];\n\n// offset texture | Projection | fx | Opacity\nuniform vec4        paramLayers[8];\nuniform int         loadedTexturesCount[8];\nuniform bool        visibility[8];\n\nuniform float       distanceFog;\nuniform int         colorLayersCount;\nuniform vec3        lightPosition;\n\n// Options global\nuniform bool        selected;\nuniform bool        lightingEnabled;\n\nvarying vec2        vUv_WGS84;\nvarying float       vUv_PM;\nvarying vec3        vNormal;\n\n#if defined(DEBUG)\n    uniform bool showOutline;\n    const float sLine = 0.008;\n#endif\n\n// Note see after in code\n// int textureIndex = 0;\n// int getTextureIndex() {\n//     return textureIndex;\n// }\n\nvoid main() {\n\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\t   gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    #if defined(DEBUG)\n         if (showOutline && (vUv_WGS84.x < sLine || vUv_WGS84.x > 1.0 - sLine || vUv_WGS84.y < sLine || vUv_WGS84.y > 1.0 - sLine))\n             gl_FragColor = CRed;\n         else\n    #endif\n    {\n        // Reconstruct PM uv and PM subtexture id (see TileGeometry)\n        vec2 uvPM ;\n        uvPM.x             = vUv_WGS84.x;\n        float y            = vUv_PM;\n        int pmSubTextureIndex = int(floor(y));\n        uvPM.y             = y - float(pmSubTextureIndex);\n\n        #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n            float depth = gl_FragDepthEXT / gl_FragCoord.w;\n            float fogIntensity = 1.0/(exp(depth/distanceFog));\n        #else\n            float fogIntensity = 1.0;\n        #endif\n\n        vec4 diffuseColor = CWhite;\n        bool validTexture = false;\n\n        // TODO Optimisation des uv1 peuvent copier pas lignes!!\n        for (int layer = 0; layer < 8; layer++) {\n            if(layer == colorLayersCount) {\n                break;\n            }\n\n            if(visibility[layer]) {\n                vec4 paramsA = paramLayers[layer];\n\n                if(paramsA.w > 0.0) {\n                    bool projWGS84 = paramsA.y == 0.0;\n                    int textureIndex = int(paramsA.x) + (projWGS84 ? 0 : pmSubTextureIndex);\n\n                    /* if (0 <= textureIndex && textureIndex < loadedTexturesCount[1]) */ {\n\n                        // TODO: Try other OS before delete dead\n                        // get value in array, the index must be constant\n                        // Strangely it's work with function returning a global variable, doesn't work on Chrome Windows\n                        // vec4 layerColor = texture2D(dTextures_01[getTextureIndex()],  pitUV(projWGS84 ? vUv_WGS84 : uvPM,pitScale_L01[getTextureIndex()]));\n                        vec4 layerColor = colorAtIdUv(\n                            dTextures_01,\n                            offsetScale_L01,\n                            textureIndex,\n                            projWGS84 ? vUv_WGS84 : uvPM);\n\n                        if (layerColor.a > 0.0) {\n                            validTexture = true;\n                            float lum = 1.0;\n\n                            if(paramsA.z > 0.0) {\n                                float a = max(0.05,1.0 - length(layerColor.xyz-CWhite.xyz));\n                                if(paramsA.z > 2.0) {\n                                    a = (layerColor.r + layerColor.g + layerColor.b)*0.333333333;\n                                    layerColor*= layerColor*layerColor;\n                                }\n                                lum = 1.0-pow(abs(a),paramsA.z);\n                            }\n\n                            diffuseColor = mix( diffuseColor,layerColor, lum*paramsA.w * layerColor.a);\n\n                        }\n                    }\n                }\n    // #if defined(DEBUG)\n    //                 else {\n    //                     // Invalid texture -> error color\n    //                     diffuseColor = vec4(1.0, 0.0, 1.0, 1.0);\n    //                 }\n    // #endif\n\n            }\n        }\n\n        // No texture color\n        if (!validTexture) {\n\n            diffuseColor = CBlueOcean;\n        }\n\n        // Selected\n        if(selected) {\n            diffuseColor = mix(COrange, diffuseColor, 0.5 );\n        }\n\n        // Fog\n        gl_FragColor = mix(CFog, diffuseColor, fogIntensity);\n\n        if(lightingEnabled) {   // Add lighting\n            float light = min(2. * dot(vNormal, lightPosition),1.);\n            gl_FragColor.rgb *= light;\n        }\n    }\n}\n"},function(t,e){t.exports="const float PI          = 3.14159265359;\nconst float INV_TWO_PI  = 1.0 / (2.0*PI);\nconst float PI4         = 0.78539816339;\n\nattribute float     uv_pm;\nattribute vec2      uv_wgs84;\nattribute vec3      position;\nattribute vec3      normal;\n\nuniform sampler2D   dTextures_00[1];\nuniform vec3        offsetScale_L00[1];\nuniform int         loadedTexturesCount[8];\nuniform bool        useRTC;\nuniform float       periArcLati;\nuniform mat4        mVPMatRTC;\n\nuniform mat4        projectionMatrix;\nuniform mat4        modelViewMatrix;\n\nvarying vec2        vUv_WGS84;\nvarying float       vUv_PM;\nvarying vec3        vNormal;\nvarying vec4        pos;\n\nhighp float decode32(highp vec4 rgba) {\n    highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;\n    highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;\n    highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n    highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));\n    return Result;\n}\n\n//#define RGBA_ELEVATION\n\nvoid main() {\n\n        vUv_WGS84 = uv_wgs84;\n        vUv_PM = uv_pm;\n\n        vec4 vPosition;\n\n        if(loadedTexturesCount[0] > 0)\n        {\n            vec2    vVv = vec2(\n                vUv_WGS84.x * offsetScale_L00[0].z + offsetScale_L00[0].x,\n                (1.0 - vUv_WGS84.y) * offsetScale_L00[0].z + offsetScale_L00[0].y);\n\n\n            #ifdef RGBA_ELEVATION\n                vec4 rgba = texture2D( dTextures_00[0], vVv ) * 255.0;\n\n                rgba.rgba = rgba.abgr;\n\n                float dv = max(decode32(rgba),0.0);\n\n                // In RGBA elevation texture LinearFilter give some errors with nodata value.\n                // need to rewrite sample function in shader\n                // simple solution\n                if(dv>5000.0)\n                    dv = 0.0;\n\n            #else\n                float   dv  = max(texture2D( dTextures_00[0], vVv ).w, 0.);\n            #endif\n\n            vNormal     = normal;\n            vPosition   = vec4( position +  vNormal  * dv ,1.0 );\n        }\n        else\n            vPosition = vec4( position ,1.0 );\n\n        mat4 projModelViewMatrix = useRTC ? mVPMatRTC : projectionMatrix * modelViewMatrix;\n\n        gl_Position = projModelViewMatrix * vPosition;\n\n        #ifdef USE_LOGDEPTHBUF\n\n            gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n            #ifdef USE_LOGDEPTHBUF_EXT\n\n                vFragDepth = 1.0 + gl_Position.w;\n\n            #else\n\n                gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n            #endif\n\n        #endif\n\n}\n"},function(t,e){t.exports="#ifdef USE_LOGDEPTHBUF\n\n    uniform float logDepthBufFC;\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        //#extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n\n    #endif\n\n#endif\n\n\nuniform int atmoIN;\nvarying float intensity;\n\nvec4 glowColor = vec4(0.45, 0.74, 1. ,1.0);\n\nvoid main() \n{\n     #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    gl_FragColor = glowColor * intensity;\n\n}\n\n"},function(t,e){t.exports="\n#ifdef USE_LOGDEPTHBUF\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        varying float vFragDepth;\n\n    #endif\n\n    uniform float logDepthBufFC;\n\n#endif\n\n#define EPSILON 1e-6\n\n\nuniform int atmoIN;\nvarying float intensity;\nvec3 normalES;\nvec3 normalCAMES;\n\nvoid main() \n{\n    normalES    = normalize( normalMatrix * normal );\n    normalCAMES = normalize( normalMatrix * cameraPosition );\n\n    if(atmoIN == 0)\n        intensity = pow(0.666 - dot(normalES, normalCAMES), 4. ); \n      else\n        intensity = pow( 1.  - dot(normalES, normalCAMES), 0.8 );\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n\n    \n    #ifdef USE_LOGDEPTHBUF\n\n        gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n        #ifdef USE_LOGDEPTHBUF_EXT\n\n            vFragDepth = 1.0 + gl_Position.w;\n\n        #else\n\n            gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n        #endif\n\n    #endif\n    \n}\n\n\n"},function(t,e){t.exports="\nuniform sampler2D texture;\nuniform bool useTexture;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPosition;\n\nvoid main() {\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n       gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n\tvec4 c = vColor;\n\n    if(useTexture) {\n        c = texture2D( texture, vUV );\n    }\n\n    gl_FragColor = c;\n}"},function(t,e){t.exports="attribute vec3  position;\nattribute vec3  previous;\nattribute vec3  next;\n\nattribute float side;\nattribute float width;\nattribute vec2 uv;\n\nuniform bool useRTC;\n\nuniform mat4 mVPMatRTC;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nuniform float THICKNESS;  // the thickness of the line in pixels\nuniform float MITER_LIMIT;    // 1.0: always miter, -1.0: never miter, 0.75: default\nuniform vec2 WIN_SCALE;  // the size of the viewport in pixels\n\nuniform float opacity;\nuniform bool sizeAttenuation;\nuniform vec3 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPosition;\n\n\nvec2 screen_space(vec4 vertex)\n{\n    return vec2( vertex.xy / vertex.w ) * WIN_SCALE;\n}\n\nvec2 fix( vec4 i, float aspect ) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n}\n\nvoid main() {\n\n    float aspect = WIN_SCALE.x / WIN_SCALE.y;\n    float pixelWidthRatio = 1. / (WIN_SCALE.x * projectionMatrix[0][0]);\n    vColor = vec4( color, opacity );\n    vUV = uv;\n\n    mat4 projModelViewMatrix = useRTC ? mVPMatRTC : projectionMatrix * modelViewMatrix;\n\n    vec4 projectedPrePoint = projModelViewMatrix * vec4(previous,1.0);\n    vec4 projectedCurPoint = projModelViewMatrix * vec4(position,1.0);\n    vec4 projectedNextPoint = projModelViewMatrix * vec4(next,1.0);\n\n    #ifdef USE_LOGDEPTHBUF\n\n        #ifndef USE_LOGDEPTHBUF_EXT\n\n            projectedPrePoint.z = (projectedPrePoint.z - 1.0) * projectedPrePoint.w;\n            projectedCurPoint.z = (projectedCurPoint.z - 1.0) * projectedCurPoint.w;\n            projectedNextPoint.z = (projectedNextPoint.z - 1.0) * projectedNextPoint.w;\n\n        #else\n\n            projectedPrePoint.z = log2(max( EPSILON, projectedPrePoint.w + 1.0 )) * logDepthBufFC;\n            projectedCurPoint.z = log2(max( EPSILON, projectedCurPoint.w + 1.0 )) * logDepthBufFC;\n            projectedNextPoint.z = log2(max( EPSILON, projectedNextPoint.w + 1.0 )) * logDepthBufFC;\n\n        #endif\n\n    #endif\n\n    vec2 previousScreen = fix( projectedPrePoint,aspect );  // start of previous segment\n    vec2 currentScreen = fix( projectedCurPoint ,aspect);   // end of previous segment, start of current segment\n    vec2 nextScreen = fix( projectedNextPoint ,aspect); // end of current segment, start of next segment\n\n    float pixelWidth = projectedCurPoint.w * pixelWidthRatio;\n    float w = 1.8*pixelWidth * THICKNESS * width;\n\n    if(sizeAttenuation) {\n            w = 1.8 * THICKNESS * width;\n    }\n\n    //starting point uses (next - current)\n    vec2 dir = vec2(0.0);\n    //float len = THICKNESS;\n\n    if (currentScreen == previousScreen) {\n            dir = normalize(nextScreen - currentScreen);\n    }\n    //ending point uses (current - previous)\n    else if (currentScreen == nextScreen) {\n           dir = normalize(currentScreen - previousScreen);\n    }\n    //somewhere in middle, needs a join\n    else {\n             //get directions from (C - B) and (B - A)\n             vec2 dirA = normalize((currentScreen - previousScreen));\n             if (MITER_LIMIT == 1.0) {\n                    vec2 dirB = normalize(nextScreen - currentScreen);\n                    //now compute the miter join normal and length\n                    vec2 tangent = normalize(dirA + dirB);\n                    vec2 perp = vec2(-dirA.y, dirA.x);\n                    vec2 miter = vec2(-tangent.y, tangent.x);\n                    dir = tangent;\n                    //len = THICKNESS / dot(miter, perp);\n                    //w = clamp( w / dot( miter, perp ), 0., 4. * THICKNESS * width );\n            } else {\n                 dir = dirA;\n            }\n    }\n\n    vec2 normal = vec2(-dir.y, dir.x);\n    normal.x /= aspect;\n    normal *= 0.5 * w;\n    //normal *= len/2.0;\n\n    vec4 offset = vec4(normal*side, 0.0, 1.0);\n    projectedCurPoint.xy += offset.xy;\n\n    vPosition    = ( modelViewMatrix * vec4( position, 1. ) ).xyz;\n    gl_Position  = projectedCurPoint;\n    gl_PointSize = 10.0;\n\n    #ifdef USE_LOGDEPTHBUF\n\n        gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n        #ifdef USE_LOGDEPTHBUF_EXT\n\n            vFragDepth = 1.0 + gl_Position.w;\n\n        #else\n\n            gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n        #endif\n\n    #endif\n}"},function(t,e){t.exports="uniform int  uuid;\nuniform vec3 diffuseColor;\n\nconst vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\nvec4 pack1K ( float depth ) {\n\n    depth /= 10000.0;\n    vec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n    res -= res.xxyz * bitMsk;\n    return res;\n}\n\n\nvoid main() {\n\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\t   gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    gl_FragColor = pack1K(float(uuid));\n\n}\n"},function(t,e){t.exports="//#extension GL_OES_standard_derivatives : enable\n\nprecision highp float;\nprecision highp int;\n\n\n#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n\n#ifdef USE_LOGDEPTHBUF\n\n    uniform float logDepthBufFC;\n\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        //#extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n\n    #endif\n\n#endif\n\n\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float useTexture;\nuniform float  opacity;\n\nvarying vec4 vColor;\n\nvoid main() {\n\t\t\n        vec4 c = vColor;\n        if( useTexture == 1. ) {\n            c = texture2D( texture, gl_PointCoord );\n            float alpha = step(0.9, c.a);\n            gl_FragColor = c;//vec4(c.rgb * vLighting, c.a);\n            gl_FragColor *= alpha;\n\t}else\n            gl_FragColor = c;\n}"},function(t,e){t.exports="//#version 100\n\nprecision highp float;\nprecision highp int;\n\n#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n\n#ifdef USE_LOGDEPTHBUF\n\n    #define EPSILON 1e-6\n    #ifdef USE_LOGDEPTHBUF_EXT\n\n        varying float vFragDepth;\n\n    #endif\n\n    uniform float logDepthBufFC;\n\n#endif\n\nconst float SIZE_MULTIPLIER = 300.0;\n\nattribute vec3  position;\nattribute float size;\nattribute vec3  customColor;\n\nuniform float  opacity;\nuniform mat4   projectionMatrix;\nuniform mat4   modelViewMatrix;\nuniform vec2   resolution;\n\nvarying vec4 vColor;\n\nvoid main() {\n\t\tvColor = vec4( customColor, opacity );\n\n\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n\t\tvec4 projectedPoint = projectionMatrix * mvPosition;\n\n                #ifdef USE_LOGDEPTHBUF\n\n                    projectedPoint.z = log2(max( EPSILON, projectedPoint.w + 1.0 )) * logDepthBufFC;\n\n                    #ifdef USE_LOGDEPTHBUF_EXT\n\n                        vFragDepth = 1.0 + gl_Position.w;\n\n                    #else\n\n                        projectedPoint.z = (projectedPoint.z - 1.0) * projectedPoint.w;\n\n                    #endif\n\n                #endif            \n\n\n                float spriteDist;\n\n                if (projectedPoint.w == 0.0) {\n                        spriteDist = 0.00001;\n                } else {\n                        spriteDist = projectedPoint.w;\n                }\n\n                gl_PointSize = (((size * SIZE_MULTIPLIER * (resolution.x/resolution.y)) / spriteDist) * (resolution.x/resolution.y));\n                gl_Position  = projectedPoint;\n}\n"},function(t,e){t.exports="#define SHADER_NAME simpleMaterial\n\nuniform vec3 diffuseColor;\nuniform bool lightingEnabled;\nuniform bool enabledCutColor;\nuniform float opacity;\nvarying float light;\nvarying vec3  vColor;\nvarying vec3  vPosition;\n\nconst float line = 0.05;\n\nvoid main() {\n\n    #if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\t   gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    #endif\n\n    vec3 cutColor = diffuseColor;\n\n    if (enabledCutColor) {\n        if (vPosition.y > 9.0) {\n            cutColor = vec3(1.0,0.2,0.1);\n        }\n    }\n\n    vec3 color = vColor * cutColor;\n\n    if (lightingEnabled) {\n        color = ((vColor) * 0.666 + 0.333) * light * cutColor;\n    }\n\n    gl_FragColor = vec4(color, 1.0);\n}"},function(t,e){t.exports="#define SHADER_NAME SimpleMaterial\n\nattribute vec3      position;\nattribute vec3      normal;\nattribute vec3      color;\n\nuniform mat4        projectionMatrix;\nuniform mat4        modelViewMatrix;\n\nuniform mat4       mVPMatRTC;\nuniform bool       useRTC;\nuniform bool       lightingEnabled;\nvarying float      light;\nvarying vec3       vColor;\nvarying vec3       vPosition;\n\n// IE error : Initializer for const variable must initialize to a constant value\n//const vec3 dir =  normalize(vec3(1.0,1.0,0.5));\n\nvoid main()\n{\n  vec3 dir =  normalize(vec3(1.0,1.0,0.5));\n\n  vColor = color;\n  vPosition = position;\n\n  if (useRTC) {\n        gl_Position = mVPMatRTC * vec4( position ,1.0 );\n  }\n  else {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n  }\n\n    if (lightingEnabled) {\n        light = (0.666 + 0.333 * dot(dir,normal));\n    }\n\n    #ifdef USE_LOGDEPTHBUF\n\n        gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n        #ifdef USE_LOGDEPTHBUF_EXT\n\n            vFragDepth = 1.0 + gl_Position.w;\n\n        #else\n\n            gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n        #endif\n\n    #endif\n\n}"},function(t,e){t.exports="varying vec3 c0;\nvarying vec3 c1;\n\nvoid main (void) {\n\tgl_FragColor = vec4(c1, 1.0 - c0/4.);\n}"},function(t,e){t.exports="uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nvarying vec3 c0;\nvarying vec3 c1;\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n\n     float cameraHeight2 = length(cameraPosition) * length(cameraPosition);\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, position) / length(position);\n    float fLightAngle = dot(v3LightPosition, position) / length(position);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},function(t,e){t.exports="uniform vec3 v3LightPos;\nuniform float g;\nuniform float g2;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\n// Calculates the Mie phase function\nfloat getMiePhase(float fCos, float fCos2, float g, float g2) {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(1.0 + g2 - 2.0 * g * fCos, 1.5);\n}\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(float fCos2) {\n    return 0.75 + 0.75 * fCos2;\n}\n\nvoid main (void) {\n    float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n\n    vec3 color = getRayleighPhase(fCos2) * c0 + getMiePhase(fCos, fCos2, g, g2) * c1;\n\n    gl_FragColor = vec4(color, 1.0);\n    gl_FragColor.a = gl_FragColor.b;\n}"},function(t,e){t.exports="uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\nfloat scale(float fCos) {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n    float lengthCamera = length(cameraPosition);\n    float cameraHeight2 = lengthCamera * lengthCamera;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n    float fStartDepth = exp(-1.0 / fScaleDepth);\n    float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n        float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n    v3Direction = cameraPosition - position;\n}"},function(t,e,i){var n;(function(t,r){!function(o){function a(t){throw RangeError(I[t])}function s(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function h(t,e){var i=t.split("@"),n="";i.length>1&&(n=i[0]+"@",t=i[1]),t=t.replace(R,".");var r=t.split("."),o=s(r,e).join(".");return n+o}function u(t){for(var e,i,n=[],r=0,o=t.length;r<o;)e=t.charCodeAt(r++),e>=55296&&e<=56319&&r<o?(i=t.charCodeAt(r++),56320==(64512&i)?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--)):n.push(e);return n}function c(t){return s(t,function(t){var e="";return t>65535&&(t-=65536,e+=N(t>>>10&1023|55296),t=56320|1023&t),e+=N(t)}).join("")}function l(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:b}function f(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function p(t,e,i){var n=0;for(t=i?D(t/S):t>>1,t+=D(t/e);t>O*w>>1;n+=b)t=D(t/O);return D(n+(O+1)*t/(t+E))}function d(t){var e,i,n,r,o,s,h,u,f,d,m=[],v=t.length,g=0,y=P,x=T;for(i=t.lastIndexOf(L),i<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&a("not-basic"),m.push(t.charCodeAt(n));for(r=i>0?i+1:0;r<v;){for(o=g,s=1,h=b;r>=v&&a("invalid-input"),u=l(t.charCodeAt(r++)),(u>=b||u>D((_-g)/s))&&a("overflow"),g+=u*s,f=h<=x?M:h>=x+w?w:h-x,!(u<f);h+=b)d=b-f,s>D(_/d)&&a("overflow"),s*=d;e=m.length+1,x=p(g-o,e,0==o),D(g/e)>_-y&&a("overflow"),y+=D(g/e),g%=e,m.splice(g++,0,y)}return c(m)}function m(t){var e,i,n,r,o,s,h,c,l,d,m,v,g,y,x,E=[];for(t=u(t),v=t.length,e=P,i=0,o=T,s=0;s<v;++s)m=t[s],m<128&&E.push(N(m));for(n=r=E.length,r&&E.push(L);n<v;){for(h=_,s=0;s<v;++s)m=t[s],m>=e&&m<h&&(h=m);for(g=n+1,h-e>D((_-i)/g)&&a("overflow"),i+=(h-e)*g,e=h,s=0;s<v;++s)if(m=t[s],m<e&&++i>_&&a("overflow"),m==e){for(c=i,l=b;d=l<=o?M:l>=o+w?w:l-o,!(c<d);l+=b)x=c-d,y=b-d,E.push(N(f(d+x%y,0))),c=D(x/y);E.push(N(f(c,0))),o=p(i,g,n==r),i=0,++n}++i,++e}return E.join("")}function v(t){return h(t,function(t){return A.test(t)?d(t.slice(4).toLowerCase()):t})}function g(t){return h(t,function(t){return C.test(t)?"xn--"+m(t):t})}var y=("object"==typeof e&&e&&!e.nodeType&&e,"object"==typeof t&&t&&!t.nodeType&&t,"object"==typeof r&&r);y.global!==y&&y.window!==y&&y.self!==y||(o=y);var x,_=2147483647,b=36,M=1,w=26,E=38,S=700,T=72,P=128,L="-",A=/^xn--/,C=/[^\x20-\x7E]/,R=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=b-M,D=Math.floor,N=String.fromCharCode;x={version:"1.3.2",ucs2:{decode:u,encode:c},decode:d,encode:m,toASCII:g,toUnicode:v},n=function(){return x}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))}(this)}).call(e,i(235)(t),function(){return this}())},function(t,e,i){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(t,e,i){if(t&&u.isObject(t)&&t instanceof n)return t;var r=new n;return r.parse(t,e,i),r}function o(t){return u.isString(t)&&(t=r(t)),t instanceof n?t.format():n.prototype.format.call(t);
}function a(t,e){return r(t,!1,!0).resolve(e)}function s(t,e){return t?r(t,!1,!0).resolveObject(e):e}var h=i(455),u=i(457);e.parse=r,e.resolve=a,e.resolveObject=s,e.format=o,e.Url=n;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(d),v=["%","/","?",";","#"].concat(m),g=["/","?","#"],y=255,x=/^[+a-z0-9A-Z_-]{0,63}$/,_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},M={javascript:!0,"javascript:":!0},w={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},E=i(434);n.prototype.parse=function(t,e,i){if(!u.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),r=n!==-1&&n<t.indexOf("#")?"?":"#",o=t.split(r),a=/\\/g;o[0]=o[0].replace(a,"/"),t=o.join(r);var s=t;if(s=s.trim(),!i&&1===t.split("#").length){var l=f.exec(s);if(l)return this.path=s,this.href=s,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=E.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=c.exec(s);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,s=s.substr(p.length)}if(i||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===s.substr(0,2);!S||p&&M[p]||(s=s.substr(2),this.slashes=!0)}if(!M[p]&&(S||p&&!w[p])){for(var T=-1,P=0;P<g.length;P++){var L=s.indexOf(g[P]);L!==-1&&(T===-1||L<T)&&(T=L)}var A,C;C=T===-1?s.lastIndexOf("@"):s.lastIndexOf("@",T),C!==-1&&(A=s.slice(0,C),s=s.slice(C+1),this.auth=decodeURIComponent(A)),T=-1;for(var P=0;P<v.length;P++){var L=s.indexOf(v[P]);L!==-1&&(T===-1||L<T)&&(T=L)}T===-1&&(T=s.length),this.host=s.slice(0,T),s=s.slice(T),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var I=this.hostname.split(/\./),P=0,O=I.length;P<O;P++){var D=I[P];if(D&&!D.match(x)){for(var N="",U=0,F=D.length;U<F;U++)N+=D.charCodeAt(U)>127?"x":D[U];if(!N.match(x)){var z=I.slice(0,P),B=I.slice(P+1),G=D.match(_);G&&(z.push(G[1]),B.unshift(G[2])),B.length&&(s="/"+B.join(".")+s),this.hostname=z.join(".");break}}}this.hostname.length>y?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=h.toASCII(this.hostname));var j=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+j,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!b[d])for(var P=0,O=m.length;P<O;P++){var V=m[P];if(s.indexOf(V)!==-1){var H=encodeURIComponent(V);H===V&&(H=escape(V)),s=s.split(V).join(H)}}var W=s.indexOf("#");W!==-1&&(this.hash=s.substr(W),s=s.slice(0,W));var q=s.indexOf("?");if(q!==-1?(this.search=s.substr(q),this.query=s.substr(q+1),e&&(this.query=E.parse(this.query)),s=s.slice(0,q)):e&&(this.search="",this.query={}),s&&(this.pathname=s),w[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",X=this.search||"";this.path=j+X}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,o="";this.host?r=t+this.host:this.hostname&&(r=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(o=E.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||w[e])&&r!==!1?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),a=a.replace("#","%23"),e+r+i+a+n},n.prototype.resolve=function(t){return this.resolveObject(r(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if(u.isString(t)){var e=new n;e.parse(t,!1,!0),t=e}for(var i=new n,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];i[a]=this[a]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),h=0;h<s.length;h++){var c=s[h];"protocol"!==c&&(i[c]=t[c])}return w[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!w[t.protocol]){for(var l=Object.keys(t),f=0;f<l.length;f++){var p=l[f];i[p]=t[p]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||M[t.protocol])i.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),i.pathname=d.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var m=i.pathname||"",v=i.search||"";i.path=m+v}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var g=i.pathname&&"/"===i.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=y||g||i.host&&t.pathname,_=x,b=i.pathname&&i.pathname.split("/")||[],d=t.pathname&&t.pathname.split("/")||[],E=i.protocol&&!w[i.protocol];if(E&&(i.hostname="",i.port=null,i.host&&(""===b[0]?b[0]=i.host:b.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),x=x&&(""===d[0]||""===b[0])),y)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,b=d;else if(d.length)b||(b=[]),b.pop(),b=b.concat(d),i.search=t.search,i.query=t.query;else if(!u.isNullOrUndefined(t.search)){if(E){i.hostname=i.host=b.shift();var S=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@");S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())}return i.search=t.search,i.query=t.query,u.isNull(i.pathname)&&u.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!b.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var T=b.slice(-1)[0],P=(i.host||t.host||b.length>1)&&("."===T||".."===T)||""===T,L=0,A=b.length;A>=0;A--)T=b[A],"."===T?b.splice(A,1):".."===T?(b.splice(A,1),L++):L&&(b.splice(A,1),L--);if(!x&&!_)for(;L--;L)b.unshift("..");!x||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),P&&"/"!==b.join("/").substr(-1)&&b.push("");var C=""===b[0]||b[0]&&"/"===b[0].charAt(0);if(E){i.hostname=i.host=C?"":b.length?b.shift():"";var S=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@");S&&(i.auth=S.shift(),i.host=i.hostname=S.shift())}return x=x||i.host&&b.length,x&&!C&&b.unshift(""),b.length?i.pathname=b.join("/"):(i.pathname=null,i.path=null),u.isNull(i.pathname)&&u.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var t=this.host,e=l.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function n(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return g.iterable&&(e[Symbol.iterator]=function(){return e}),e}function r(t){this.map={},t instanceof r?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function a(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function s(t){var e=new FileReader,i=a(e);return e.readAsArrayBuffer(t),i}function h(t){var e=new FileReader,i=a(e);return e.readAsText(t),i}function u(t){for(var e=new Uint8Array(t),i=new Array(e.length),n=0;n<e.length;n++)i[n]=String.fromCharCode(e[n]);return i.join("")}function c(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(g.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(g.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(g.arrayBuffer&&g.blob&&x(t))this._bodyArrayBuffer=c(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!g.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!_(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return h(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function p(t,e){e=e||{};var i=e.body;if(t instanceof p){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new r(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function d(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function m(t){var e=new r;return t.split(/\r?\n/).forEach(function(t){var i=t.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();e.append(n,r)}}),e}function v(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new r(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var g={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(g.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],x=function(t){return t&&DataView.prototype.isPrototypeOf(t)},_=ArrayBuffer.isView||function(t){return t&&y.indexOf(Object.prototype.toString.call(t))>-1};r.prototype.append=function(t,n){t=e(t),n=i(n);var r=this.map[t];this.map[t]=r?r+","+n:n},r.prototype.delete=function(t){delete this.map[e(t)]},r.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(t,n){this.map[e(t)]=i(n)},r.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},r.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),n(t)},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},r.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),n(t)},g.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this,{body:this._bodyInit})},l.call(p.prototype),l.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var M=[301,302,303,307,308];v.redirect=function(t,e){if(M.indexOf(e)===-1)throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},t.Headers=r,t.Request=p,t.Response=v,t.fetch=function(t,e){return new Promise(function(i,n){var r=new p(t,e),o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:m(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;i(new v(e,t))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&g.blob&&(o.responseType="blob"),r.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send("undefined"==typeof r._bodyInit?null:r._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(t,e){}])});
//# sourceMappingURL=itowns.js.map