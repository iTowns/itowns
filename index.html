<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Globe</title>

	<style type="text/css">
            html {height: 100%}
	    body { margin: 0; overflow:hidden; height:100%}

            #viewerDiv {
                margin : auto auto;
                width: 100%;
                height: 100%;
                padding: 0;
                /*margin-top: 50vh;
                transform: translateY(-50%);*/
            }
            #menuDiv {position: absolute; top:0px; margin-left: 0px;}


        </style>
        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js"></script>
    </head>
    <body>
        <div id="viewerDiv"></div>
        <script src="dist/itowns2.js"> </script>
        <script type="text/javascript">

               var initCenter = { longitude:2.3465, latitude: 48.88, altitude: 25000000};

               // iTowns namespace defined here

               var viewerDiv = document.getElementById("viewerDiv");

               itowns.viewer.createSceneGlobe(initCenter, viewerDiv) ;
               //console.log(itowns.viewer.pickPosition());

               itowns.viewer.addTileMatrixSet({
                   id : "Ortho", //id layer
                   projection : "PM",
                   tileMatrices : {
                        matrixIds : ["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"],
                        tileWidth : 256,
                        tileHeight : 256,
                        matrixWidth : 10 ,
                        matrixHeight : 10,
                        scaleDenominator : 10,
                        topLeftCorner : { x:-20037508, y:20037508}
                  }
               });

             itowns.viewer.addImageryLayer({
                   protocol:   "wmts",
                   id:         "Ortho",
                   url:        "http://wxs.ign.fr/va5orxd0pgzvq3jxutqfuy0b/geoportail/wmts",
                   options: {
                        //name:'GEOGRAPHICALGRIDSYSTEMS.MAPS',
                        name: "ORTHOIMAGERY.ORTHOPHOTOS",
                        mimetype: "image/jpeg",
                        tileMatrixSet: "PM",
                        tileMatrixSetLimits: {
                           /* "0": {
                                "minTileRow": 0,
                                "maxTileRow": 1,
                                "minTileCol": 0,
                                "maxTileCol": 1
                            },
                            "1": {
                                "minTileRow": 0,
                                "maxTileRow": 2,
                                "minTileCol": 0,
                                "maxTileCol": 2
                            },*/
                            "2": {
                                "minTileRow": 0,
                                "maxTileRow": 4,
                                "minTileCol": 0,
                                "maxTileCol": 4
                            },
                            "3": {
                                "minTileRow": 0,
                                "maxTileRow": 8,
                                "minTileCol": 0,
                                "maxTileCol": 8
                            },
                            "4": {
                                "minTileRow": 0,
                                "maxTileRow": 6,
                                "minTileCol": 0,
                                "maxTileCol": 16
                            },
                            "5": {
                                "minTileRow": 0,
                                "maxTileRow": 32,
                                "minTileCol": 0,
                                "maxTileCol": 32
                            },
                            "6": {
                                "minTileRow": 1,
                                "maxTileRow": 64,
                                "minTileCol": 0,
                                "maxTileCol": 64
                            },
                            "7": {
                                "minTileRow": 3,
                                "maxTileRow": 28,
                                "minTileCol": 0,
                                "maxTileCol": 128
                            },
                            "8": {
                                "minTileRow": 7,
                                "maxTileRow": 256,
                                "minTileCol": 0,
                                "maxTileCol": 256
                            },
                            "9": {
                                "minTileRow": 15,
                                "maxTileRow": 512,
                                "minTileCol": 0,
                                "maxTileCol": 512
                            },
                            "10": {
                                "minTileRow": 31,
                                "maxTileRow": 1024,
                                "minTileCol": 0,
                                "maxTileCol": 1024
                            },
                            "11": {
                                "minTileRow": 62,
                                "maxTileRow": 2048,
                                "minTileCol": 0,
                                "maxTileCol": 2048
                            },
                            "12": {
                                "minTileRow": 125,
                                "maxTileRow": 4096,
                                "minTileCol": 0,
                                "maxTileCol": 4096
                            },
                            "13": {
                                "minTileRow": 2739,
                                "maxTileRow": 4628,
                                "minTileCol": 41,
                                "maxTileCol": 7917
                            },
                            "14": {
                                "minTileRow": 5478,
                                "maxTileRow": 9256,
                                "minTileCol": 82,
                                "maxTileCol": 15835
                            },
                            "15": {
                                "minTileRow": 10956,
                                "maxTileRow": 8513,
                                "minTileCol": 165,
                                "maxTileCol": 31670
                            },
                            "16": {
                                "minTileRow": 21912,
                                "maxTileRow": 37026,
                                "minTileCol": 330,
                                "maxTileCol": 63341
                            },
                            "17": {
                                "minTileRow": 43825,
                                "maxTileRow": 74052,
                                "minTileCol": 660,
                                "maxTileCol": 126683
                            },
                            "18": {
                                "minTileRow": 87651,
                                "maxTileRow": 48105,
                                "minTileCol": 1320,
                                "maxTileCol": 253366
                            },
                            "19": {
                                "minTileRow": 175302,
                                "maxTileRow": 294060,
                                "minTileCol": 170159,
                                "maxTileCol": 343473
                            },
                            "20": {
                                "minTileRow": 376733,
                                "maxTileRow": 384679,
                                "minTileCol": 530773,
                                "maxTileCol": 540914
                                }
                        }
                    }
                });


//                itowns.viewer.addImageryLayer({
//                protocol:   "wmts",
//                id:         "OrthoCRS",
//                url:        "http://wxs.ign.fr/va5orxd0pgzvq3jxutqfuy0b/geoportail/wmts",
//                fx :        1.0,
//                options: {
//                        name: 'ORTHOIMAGERY.ORTHOPHOTOS.CRS84',
//                        mimetype: "image/jpeg",
//                        tileMatrixSet: "WGS84G",
//                        tileMatrixSetLimits: {
//
//                            '6' : {
//                                'minTileRow' : 13,
//                                'maxTileRow' : 39,
//                                'minTileCol' : 0,
//                                'maxTileCol' : 83,
//                            },
//                            '7' : {
//                                'minTileRow' : 27,
//                                'maxTileRow' : 79,
//                                'minTileCol' : 1,
//                                'maxTileCol' : 167,
//                            },
//                            '8' : {
//                                'minTileRow' : 55,
//                                'maxTileRow' : 158,
//                                'minTileCol' : 2,
//                                'maxTileCol' : 335,
//                            },
//                            '9' : {
//                                'minTileRow' : 110,
//                                'maxTileRow' : 316,
//                                'minTileCol' : 5,
//                                'maxTileCol' : 670
//                            },
//                            '10' : {
//                                'minTileRow' : 221,
//                                'maxTileRow' : 633,
//                                'minTileCol' : 10,
//                                'maxTileCol' : 1341,
//                            },
//                            '11' : {
//                                'minTileRow' : 442,
//                                'maxTileRow' : 1267,
//                                'minTileCol' : 20,
//                                'maxTileCol' : 2683,
//                            },
//                            '12' : {
//                                'minTileRow' : 885,
//                                'maxTileRow' : 2534,
//                                'minTileCol' : 41,
//                                'maxTileCol' : 5366,
//                            },
//                            '13' : {
//                                'minTileRow' : 1770,
//                                'maxTileRow' : 5069,
//                                'minTileCol' : 82,
//                                'maxTileCol' : 10733,
//                            },
//                            '14' : {
//                                'minTileRow' : 3541,
//                                'maxTileRow' : 10139,
//                                'minTileCol' : 165,
//                                'maxTileCol' : 21467,
//                            },
//                            '15' : {
//                                'minTileRow' : 7082,
//                                'maxTileRow' : 20279,
//                                'minTileCol' : 330,
//                                'maxTileCol' : 42934,
//                            },
//                            '16' : {
//                                'minTileRow' : 14165,
//                                'maxTileRow' : 40559,
//                                'minTileCol' : 660,
//                                'maxTileCol' : 85868,
//                            },
//                            '17' : {
//                                'minTileRow' : 28330,
//                                'maxTileRow' : 81118,
//                                'minTileCol' : 1320,
//                                'maxTileCol' : 171736,
//                            }
//                        }
//                    }
//                });

//                itowns.viewer.addImageryLayer({
//                protocol:   "wmts",
//                id:         "ScanEX",
//                url:        "http://wxs.ign.fr/va5orxd0pgzvq3jxutqfuy0b/geoportail/wmts",
//                fx :        2.5,
//                options: {
//                        //name:'GEOGRAPHICALGRIDSYSTEMS.MAPS',
//                        // name: 'GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.ROUTIER',
//                        name: 'GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD',
//                        //name: "GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.NIVEAUXGRIS",
//                        //mimetype: "image/png",
//                        mimetype: "image/jpeg",
//
//                        tileMatrixSet: "PM",
//                        tileMatrixSetLimits: {
//                          '6' : {
//                            'minTileRow': 21,
//                            'maxTileRow': 35,
//                            'minTileCol':20,
//                            'maxTileCol':41
//                          },
//                          '7' : {
//                            'minTileRow': 42,
//                            'maxTileRow': 71,
//                            'minTileCol':41,
//                            'maxTileCol':83
//                          },
//                          '8' : {
//                            'minTileRow': 85,
//                            'maxTileRow': 143,
//                            'minTileCol':82,
//                            'maxTileCol':167
//                          },
//                          '9' : {
//                            'minTileRow': 170,
//                            'maxTileRow': 287,
//                            'minTileCol':165,
//                            'maxTileCol':335
//                          },
//                          '10' : {
//                            'minTileRow': 340,
//                            'maxTileRow': 574,
//                            'minTileCol': 331,
//                            'maxTileCol': 671
//                          },
//                          '11' : {
//                            'minTileRow': 681,
//                            'maxTileRow': 1149,
//                            'minTileCol':663,
//                            'maxTileCol':1342
//                          },
//                          '12' : {
//                            'minTileRow': 1363,
//                            'maxTileRow': 2298,
//                            'minTileCol':1327,
//                            'maxTileCol':2684
//                          },
//                          '13' : {
//                            'minTileRow': 2726,
//                            'maxTileRow': 4602,
//                            'minTileCol':2655,
//                            'maxTileCol':5371
//                          },
//                          '14' : {
//                            'minTileRow': 5452,
//                            'maxTileRow': 9204,
//                            'minTileCol':5311,
//                            'maxTileCol':10742
//                          },
//                          '15' : {
//                            'minTileRow': 10944,
//                            'maxTileRow': 18381,
//                            'minTileCol':10632,
//                            'maxTileCol':21467
//                          },
//                          '16' : {
//                            'minTileRow': 21889,
//                            'maxTileRow': 36763,
//                            'minTileCol':21264,
//                            'maxTileCol':42934
//                          },
//                          '17' : {
//                            'minTileRow': 43778,
//                            'maxTileRow': 73526,
//                            'minTileCol':42528,
//                            'maxTileCol':85869
//                          },
//                          '18' : {
//                            'minTileRow': 87557,
//                            'maxTileRow': 147052,
//                            'minTileCol':85058,
//                            'maxTileCol':171738
//                          }
//                        }
//                    }
//                });


        // itowns.viewer.addImageryLayer({
        //         protocol:   "wmtsc",
        //         id:         "DARK",
        //         customUrl:  "http://a.basemaps.cartocdn.com/dark_all/%TILEMATRIX/%COL/%ROW.png",
        //         options: { tileMatrixSet: "PM"}
        //     });

        // itowns.viewer.addImageryLayer({
        //     protocol:   "wmtsc",
        //     id:         "OPENSM",
        //     customUrl:  'http://b.tile.openstreetmap.fr/osmfr/%TILEMATRIX/%COL/%ROW.png',
        //     options: { tileMatrixSet: "PM"},
        //     fx :        2.5,
        // });

//        itowns.viewer.addImageryLayer({
//                                        url       : "https://wxs.ign.fr/gratuit/geoportail/v/wms",
//                                        protocol  : 'wms',
//                                        version   : '1.3.0',
//                                        id        : 'testwms',
//                                        name      : 'REGION.2016',
//                                        style      : "",
//                                        projection : "EPSG:4326",
//                                        transparent : true,
//                                        // min long, min lat, max long, max lat
//                                        bbox      : [-61.80983300000002, -21.38963079935857, 55.83665389999998, 51.0890011990783],
//                                        featureInfoMimeType : "",
//                                        dateTime  : "",
//                                        heightMapWidth : 256,
//                                        waterMask      : false,
//                                        options: {
//                                            mimetype  : "image/png",
//                                            tileMatrixSet: 'WGS84G'
//                                        }
//                                    });
                                    
        itowns.viewer.addFeatureLayer({
                                        url       : "http://wxs.ign.fr/72hpsel8j8nhb5qgdh07gcyp/geoportail/wfs?",
                                        protocol  : 'wfs',
                                        version   : '2.0.0',
                                        id        : 'testwfs',
                                        title     : "BDTOPO_BDD_WLD_WGS84G:bati_remarquable,BDTOPO_BDD_WLD_WGS84G:bati_indifferencie",
                                        styleName : "",
                                        extractStyle : true,
                                        projection : "EPSG:4326",
                                        // min long, min lat, max long, max lat (lower et upper corners)
                                        bbox      : [-63.1533283, -21.3896308, 55.8366872, 51.1028253],
                                        ipr       : "IGN",
                                        type      : "bbox", //bbox //poly//styledPoly
                                        options: {
                                            mimetype  : "json",
                                            tileMatrixSet: 'WGS84G'
                                        },
                                        params: {
                                            level: 18
                                        }
                                    });

                //an example feature to be added
        var feature = {
                 featureId : "testfeature", //String he feature identifier
                 layerId   : "testwfs",// layer identifier
                 styleName : "empty",// String 	
                 geometry  : {
                                "type": "FeatureCollection",
                                "features": [
                                                { "type": "Feature", "properties": { "code_titan": "304a1", "ligne": "D", "sens": "Aller", "indice": "", "infos": "", "libelle": "Gare de Vaise - Gare de Vénissieux", "ut": "UTMD", "couleur": "0 166 63", "gid": "7", "last_update": "", "last_update_fme": "2016-09-28 06:00:26" }, "geometry": { "type": "LineString", "coordinates": [ [ 4.80648399333083, 45.782943660591556 ], [ 4.804332685652698, 45.780560941989258 ], [ 4.803974770790849, 45.780169898324402 ], [ 4.803367366770823, 45.779528316619057 ], [ 4.803138576458973, 45.779170157386957 ], [ 4.803020028777549, 45.778803621799511 ], [ 4.803018893910597, 45.778398784638277 ], [ 4.803145265112405, 45.777991147050422 ], [ 4.803320805295764, 45.777731275077656 ], [ 4.803498212368813, 45.777513040094377 ], [ 4.803918660576161, 45.777212064071527 ], [ 4.804184270127222, 45.777063335358775 ], [ 4.804565412141636, 45.776834667592155 ], [ 4.804795680989153, 45.776656945015731 ], [ 4.805006638728047, 45.776434830095887 ], [ 4.805127910348872, 45.776286456832516 ], [ 4.805189504675335, 45.776142210696399 ], [ 4.805282964709516, 45.775949632454804 ], [ 4.805331519847251, 45.775704456134442 ], [ 4.805353508468518, 45.775436049841886 ], [ 4.805363171434413, 45.774703513469333 ], [ 4.805340970556074, 45.774019307324323 ], [ 4.805289308697793, 45.773436965563199 ], [ 4.805296039217782, 45.77306207612974 ], [ 4.805357540696476, 45.772113710784822 ], [ 4.805405516163546, 45.771666116514901 ], [ 4.805446058683232, 45.771242501224805 ], [ 4.805502532696272, 45.770794720710427 ], [ 4.805546636701894, 45.769692287992982 ], [ 4.805568042749806, 45.769221462759674 ], [ 4.805557096729409, 45.768977595585 ], [ 4.805521989505814, 45.768764029067768 ], [ 4.805369145137485, 45.768201774267517 ], [ 4.80535130292852, 45.767993782044996 ], [ 4.805335862288266, 45.767839320411817 ], [ 4.805374535620833, 45.767374070352112 ], [ 4.805478708191814, 45.766472748527256 ], [ 4.805531213755954, 45.766126270305648 ], [ 4.805583498578632, 45.765964366393952 ], [ 4.805709064790991, 45.765729405657154 ], [ 4.805829603077702, 45.765571954394787 ], [ 4.806001399122561, 45.765419329793289 ], [ 4.806199491085828, 45.765283988030419 ], [ 4.806399449739086, 45.765190281436738 ], [ 4.806793539984651, 45.76506253510955 ], [ 4.809791675031919, 45.764198716041918 ], [ 4.81215984312891, 45.76351541520166 ], [ 4.814914578547421, 45.762728269327596 ], [ 4.818634698015868, 45.761657745894119 ], [ 4.819424915331098, 45.761449748989506 ], [ 4.819870740116896, 45.761338673109627 ], [ 4.820342326061584, 45.761232978489019 ], [ 4.821133932345266, 45.761060068626655 ], [ 4.822416945443635, 45.760835783238662 ], [ 4.82434314881301, 45.760543053705256 ], [ 4.826781367301062, 45.760189119492793 ], [ 4.827266674739873, 45.76010909149592 ], [ 4.828044420183864, 45.760002525803614 ], [ 4.82857626968643, 45.759913320152556 ], [ 4.829046479641817, 45.75977785108703 ], [ 4.829557018570043, 45.75959385231188 ], [ 4.830031676325214, 45.759368969889373 ], [ 4.83156407402245, 45.758459701047428 ], [ 4.832391959763313, 45.757959033422452 ], [ 4.832548552001584, 45.757848380979347 ], [ 4.832712561014784, 45.757713748406168 ], [ 4.832884257957326, 45.757561083127797 ], [ 4.833234527043666, 45.757219875961837 ], [ 4.833708737572278, 45.756798509509309 ], [ 4.834018670377562, 45.756505826476854 ], [ 4.83431565520879, 45.756302740427422 ], [ 4.834831129313618, 45.756041206097876 ], [ 4.835284567837767, 45.755912036268015 ], [ 4.835832278841453, 45.75579862730946 ], [ 4.836324294241859, 45.755769810360384 ], [ 4.836843959942668, 45.755788006531951 ], [ 4.838144965782202, 45.755967410166228 ], [ 4.838674754828427, 45.756021096893228 ], [ 4.839196588877277, 45.756086865664933 ], [ 4.839410366982553, 45.756111868896028 ], [ 4.839700889698615, 45.756141114516936 ], [ 4.839956612057303, 45.75615327372882 ], [ 4.840212063617917, 45.756159484903861 ], [ 4.840508647329139, 45.756135008025922 ], [ 4.840804688805115, 45.75609863455383 ], [ 4.841074427913219, 45.756044987039346 ], [ 4.841385567703689, 45.755966597668916 ], [ 4.843730029930967, 45.755152158579563 ], [ 4.847950812767256, 45.75370627033945 ], [ 4.850571662137409, 45.752802145318263 ], [ 4.853778730810485, 45.751700242781361 ], [ 4.855972077630135, 45.750936561546716 ], [ 4.860594014581701, 45.749350192845853 ], [ 4.86272029749463, 45.748611699535452 ], [ 4.865282283108721, 45.747732363403145 ], [ 4.872322665827658, 45.745305062764231 ], [ 4.873126144841378, 45.745024931819728 ], [ 4.877286459561576, 45.743591183055059 ], [ 4.878381441444142, 45.743179380421758 ], [ 4.879067304140224, 45.742931640208269 ], [ 4.879610948928637, 45.74273474989036 ], [ 4.879888528631675, 45.742668919388116 ], [ 4.880409982140223, 45.742543975228109 ], [ 4.880797442226124, 45.74246374504618 ], [ 4.881253684890619, 45.742399815775869 ], [ 4.881861730614695, 45.742308624746514 ], [ 4.882292210621658, 45.742239321322693 ], [ 4.882587324896017, 45.742184995187316 ], [ 4.882923535737697, 45.742099966356108 ], [ 4.883258645021353, 45.741991144342187 ], [ 4.883608539769357, 45.741834353912729 ], [ 4.883873210692116, 45.741673542356892 ], [ 4.88430883266094, 45.741348091505316 ], [ 4.884544159468221, 45.74110458955974 ], [ 4.88472824412949, 45.740856295761596 ], [ 4.885210875455303, 45.740077269817192 ], [ 4.885457949062977, 45.739720371843276 ], [ 4.885530266121871, 45.739629419580474 ], [ 4.885619294555393, 45.739532132953222 ], [ 4.885845839921667, 45.739282873016244 ], [ 4.886357280188236, 45.738759209792541 ], [ 4.887525579306805, 45.737547810537137 ], [ 4.888085743898027, 45.736975399679963 ], [ 4.888331460670539, 45.736773329892095 ], [ 4.888781799263162, 45.736399894589475 ], [ 4.888954099999064, 45.736264987477014 ], [ 4.88914967479232, 45.736081918616065 ], [ 4.889286070123099, 45.735906149045292 ], [ 4.889358374739786, 45.735815195236491 ], [ 4.889435863081998, 45.735652672538457 ], [ 4.889503477620304, 45.735460606325439 ], [ 4.889563102817921, 45.735083297646419 ], [ 4.889571213078516, 45.734957600556989 ], [ 4.889553498091554, 45.734747421315973 ], [ 4.889502156246156, 45.734542190292437 ], [ 4.889395098630141, 45.734294995523754 ], [ 4.889145140429262, 45.733886489556916 ], [ 4.888795601592678, 45.733305924675619 ], [ 4.888640080503293, 45.733001258654461 ], [ 4.888533029635086, 45.732754062138781 ], [ 4.888344393661284, 45.732207491137217 ], [ 4.888203735509114, 45.731793709324364 ], [ 4.888073140064645, 45.731554020870277 ], [ 4.887941021320243, 45.731367361628088 ], [ 4.887451991246319, 45.730741154919116 ], [ 4.886951733972194, 45.730087309738174 ], [ 4.88681518168468, 45.729847755710729 ], [ 4.886743200701017, 45.729669490944261 ], [ 4.886721993655859, 45.729555616505039 ], [ 4.886714442543117, 45.729392620991533 ], [ 4.886768048803726, 45.728744193933515 ], [ 4.887175891213548, 45.724310034701645 ], [ 4.887220927149736, 45.723820906366015 ], [ 4.887222698033526, 45.723730218937298 ], [ 4.88720808645541, 45.723328910828194 ], [ 4.887182550655305, 45.722863701392697 ], [ 4.887143163279323, 45.722658198968183 ], [ 4.88691523609009, 45.722079049586242 ], [ 4.886825738694095, 45.721866318887656 ], [ 4.88678188474026, 45.721703224626737 ], [ 4.886781005941438, 45.721502391425382 ], [ 4.886803305033797, 45.721355191091789 ], [ 4.886857426800786, 45.72116961514439 ], [ 4.886927209919219, 45.720983682024254 ], [ 4.887145880738896, 45.720482152751948 ], [ 4.887627674354007, 45.719351001105935 ], [ 4.88779003911127, 45.718988029055595 ], [ 4.887823385047069, 45.718861758971983 ], [ 4.887843485179077, 45.718725931725707 ], [ 4.887847749049545, 45.718372490832444 ], [ 4.887863515067815, 45.717480209736479 ], [ 4.887871735054159, 45.716950998623425 ], [ 4.887925274671545, 45.716455599005037 ], [ 4.888053416883648, 45.715369058326537 ], [ 4.888100590096274, 45.714802228320124 ], [ 4.888148407799407, 45.714227668817976 ], [ 4.88816771583521, 45.713800559036514 ], [ 4.888157188954906, 45.713389972681775 ], [ 4.888148579966185, 45.713216506417588 ], [ 4.888119831326901, 45.712886121802526 ], [ 4.888034582374111, 45.712327177589991 ], [ 4.887945993915214, 45.711937751577594 ], [ 4.887724373989291, 45.711069698428993 ], [ 4.887627166815945, 45.710687527429769 ], [ 4.8874795641218, 45.710087641415527 ], [ 4.887371517541522, 45.709640608050066 ], [ 4.887235761730071, 45.709094286126557 ], [ 4.887192984060165, 45.708856294532282 ], [ 4.887189219418713, 45.7086783096671 ], [ 4.887195271979904, 45.708518928500155 ], [ 4.887213018982401, 45.708370264326263 ], [ 4.887265565568572, 45.708150991255906 ], [ 4.887312962253457, 45.708008905448352 ], [ 4.887359341693467, 45.707903326762697 ], [ 4.887436944638547, 45.707750064859034 ], [ 4.887684514350743, 45.707309162146608 ], [ 4.887865672222237, 45.706991323443063 ], [ 4.887952877257694, 45.706779738446507 ], [ 4.887972290189744, 45.706681330675856 ], [ 4.887990466082303, 45.706557681163304 ], [ 4.887997420247483, 45.70645721043752 ], [ 4.888006413776182, 45.705367425582487 ], [ 4.888000207322503, 45.704583142183239 ], [ 4.888001839547882, 45.703610949807903 ] ] } },
                                                { "type": "Feature", "properties": { "code_titan": "304r2", "ligne": "D", "sens": "Retour", "indice": "", "infos": "", "libelle": "Gare de Vénissieux - Gare de Vaise", "ut": "UTMD", "couleur": "0 166 63", "gid": "8", "last_update": "", "last_update_fme": "2016-09-28 06:00:26" }, "geometry": { "type": "LineString", "coordinates": [ [ 4.80648399333083, 45.782943660591556 ], [ 4.804332685652698, 45.780560941989258 ], [ 4.803974770790849, 45.780169898324402 ], [ 4.803367366770823, 45.779528316619057 ], [ 4.803138576458973, 45.779170157386957 ], [ 4.803020028777549, 45.778803621799511 ], [ 4.803018893910597, 45.778398784638277 ], [ 4.803145265112405, 45.777991147050422 ], [ 4.803320805295764, 45.777731275077656 ], [ 4.803498212368813, 45.777513040094377 ], [ 4.803918660576161, 45.777212064071527 ], [ 4.804184270127222, 45.777063335358775 ], [ 4.804565412141636, 45.776834667592155 ], [ 4.804795680989153, 45.776656945015731 ], [ 4.805006638728047, 45.776434830095887 ], [ 4.805127910348872, 45.776286456832516 ], [ 4.805189504675335, 45.776142210696399 ], [ 4.805282964709516, 45.775949632454804 ], [ 4.805331519847251, 45.775704456134442 ], [ 4.805353508468518, 45.775436049841886 ], [ 4.805363171434413, 45.774703513469333 ], [ 4.805340970556074, 45.774019307324323 ], [ 4.805289308697793, 45.773436965563199 ], [ 4.805296039217782, 45.77306207612974 ], [ 4.805357540696476, 45.772113710784822 ], [ 4.805405516163546, 45.771666116514901 ], [ 4.805446058683232, 45.771242501224805 ], [ 4.805502532696272, 45.770794720710427 ], [ 4.805546636701894, 45.769692287992982 ], [ 4.805568042749806, 45.769221462759674 ], [ 4.805557096729409, 45.768977595585 ], [ 4.805521989505814, 45.768764029067768 ], [ 4.805369145137485, 45.768201774267517 ], [ 4.80535130292852, 45.767993782044996 ], [ 4.805335862288266, 45.767839320411817 ], [ 4.805374535620833, 45.767374070352112 ], [ 4.805478708191814, 45.766472748527256 ], [ 4.805531213755954, 45.766126270305648 ], [ 4.805583498578632, 45.765964366393952 ], [ 4.805709064790991, 45.765729405657154 ], [ 4.805829603077702, 45.765571954394787 ], [ 4.806001399122561, 45.765419329793289 ], [ 4.806199491085828, 45.765283988030419 ], [ 4.806399449739086, 45.765190281436738 ], [ 4.806793539984651, 45.76506253510955 ], [ 4.809791675031919, 45.764198716041918 ], [ 4.81215984312891, 45.76351541520166 ], [ 4.814914578547421, 45.762728269327596 ], [ 4.818634698015868, 45.761657745894119 ], [ 4.819424915331098, 45.761449748989506 ], [ 4.819870740116896, 45.761338673109627 ], [ 4.820342326061584, 45.761232978489019 ], [ 4.821133932345266, 45.761060068626655 ], [ 4.822416945443635, 45.760835783238662 ], [ 4.82434314881301, 45.760543053705256 ], [ 4.826781367301062, 45.760189119492793 ], [ 4.827266674739873, 45.76010909149592 ], [ 4.828044420183864, 45.760002525803614 ], [ 4.82857626968643, 45.759913320152556 ], [ 4.829046479641817, 45.75977785108703 ], [ 4.829557018570043, 45.75959385231188 ], [ 4.830031676325214, 45.759368969889373 ], [ 4.83156407402245, 45.758459701047428 ], [ 4.832391959763313, 45.757959033422452 ], [ 4.832548552001584, 45.757848380979347 ], [ 4.832712561014784, 45.757713748406168 ], [ 4.832884257957326, 45.757561083127797 ], [ 4.833234527043666, 45.757219875961837 ], [ 4.833708737572278, 45.756798509509309 ], [ 4.834018670377562, 45.756505826476854 ], [ 4.83431565520879, 45.756302740427422 ], [ 4.834831129313618, 45.756041206097876 ], [ 4.835284567837767, 45.755912036268015 ], [ 4.835832278841453, 45.75579862730946 ], [ 4.836324294241859, 45.755769810360384 ], [ 4.836843959942668, 45.755788006531951 ], [ 4.838144965782202, 45.755967410166228 ], [ 4.838674754828427, 45.756021096893228 ], [ 4.839196588877277, 45.756086865664933 ], [ 4.839410366982553, 45.756111868896028 ], [ 4.839700889698615, 45.756141114516936 ], [ 4.839956612057303, 45.75615327372882 ], [ 4.840212063617917, 45.756159484903861 ], [ 4.840508647329139, 45.756135008025922 ], [ 4.840804688805115, 45.75609863455383 ], [ 4.841074427913219, 45.756044987039346 ], [ 4.841385567703689, 45.755966597668916 ], [ 4.843730029930967, 45.755152158579563 ], [ 4.847950812767256, 45.75370627033945 ], [ 4.850571662137409, 45.752802145318263 ], [ 4.853778730810485, 45.751700242781361 ], [ 4.855972077630135, 45.750936561546716 ], [ 4.860594014581701, 45.749350192845853 ], [ 4.86272029749463, 45.748611699535452 ], [ 4.865282283108721, 45.747732363403145 ], [ 4.872322665827658, 45.745305062764231 ], [ 4.873126144841378, 45.745024931819728 ], [ 4.877286459561576, 45.743591183055059 ], [ 4.878381441444142, 45.743179380421758 ], [ 4.879067304140224, 45.742931640208269 ], [ 4.879610948928637, 45.74273474989036 ], [ 4.879888528631675, 45.742668919388116 ], [ 4.880409982140223, 45.742543975228109 ], [ 4.880797442226124, 45.74246374504618 ], [ 4.881253684890619, 45.742399815775869 ], [ 4.881861730614695, 45.742308624746514 ], [ 4.882292210621658, 45.742239321322693 ], [ 4.882587324896017, 45.742184995187316 ], [ 4.882923535737697, 45.742099966356108 ], [ 4.883258645021353, 45.741991144342187 ], [ 4.883608539769357, 45.741834353912729 ], [ 4.883873210692116, 45.741673542356892 ], [ 4.88430883266094, 45.741348091505316 ], [ 4.884544159468221, 45.74110458955974 ], [ 4.88472824412949, 45.740856295761596 ], [ 4.885210875455303, 45.740077269817192 ], [ 4.885457949062977, 45.739720371843276 ], [ 4.885530266121871, 45.739629419580474 ], [ 4.885619294555393, 45.739532132953222 ], [ 4.885845839921667, 45.739282873016244 ], [ 4.886357280188236, 45.738759209792541 ], [ 4.887525579306805, 45.737547810537137 ], [ 4.888085743898027, 45.736975399679963 ], [ 4.888331460670539, 45.736773329892095 ], [ 4.888781799263162, 45.736399894589475 ], [ 4.888954099999064, 45.736264987477014 ], [ 4.88914967479232, 45.736081918616065 ], [ 4.889286070123099, 45.735906149045292 ], [ 4.889358374739786, 45.735815195236491 ], [ 4.889435863081998, 45.735652672538457 ], [ 4.889503477620304, 45.735460606325439 ], [ 4.889563102817921, 45.735083297646419 ], [ 4.889571213078516, 45.734957600556989 ], [ 4.889553498091554, 45.734747421315973 ], [ 4.889502156246156, 45.734542190292437 ], [ 4.889395098630141, 45.734294995523754 ], [ 4.889145140429262, 45.733886489556916 ], [ 4.888795601592678, 45.733305924675619 ], [ 4.888640080503293, 45.733001258654461 ], [ 4.888533029635086, 45.732754062138781 ], [ 4.888344393661284, 45.732207491137217 ], [ 4.888203735509114, 45.731793709324364 ], [ 4.888073140064645, 45.731554020870277 ], [ 4.887941021320243, 45.731367361628088 ], [ 4.887451991246319, 45.730741154919116 ], [ 4.886951733972194, 45.730087309738174 ], [ 4.88681518168468, 45.729847755710729 ], [ 4.886743200701017, 45.729669490944261 ], [ 4.886721993655859, 45.729555616505039 ], [ 4.886714442543117, 45.729392620991533 ], [ 4.886768048803726, 45.728744193933515 ], [ 4.887175891213548, 45.724310034701645 ], [ 4.887220927149736, 45.723820906366015 ], [ 4.887222698033526, 45.723730218937298 ], [ 4.88720808645541, 45.723328910828194 ], [ 4.887182550655305, 45.722863701392697 ], [ 4.887143163279323, 45.722658198968183 ], [ 4.88691523609009, 45.722079049586242 ], [ 4.886825738694095, 45.721866318887656 ], [ 4.88678188474026, 45.721703224626737 ], [ 4.886781005941438, 45.721502391425382 ], [ 4.886803305033797, 45.721355191091789 ], [ 4.886857426800786, 45.72116961514439 ], [ 4.886927209919219, 45.720983682024254 ], [ 4.887145880738896, 45.720482152751948 ], [ 4.887627674354007, 45.719351001105935 ], [ 4.88779003911127, 45.718988029055595 ], [ 4.887823385047069, 45.718861758971983 ], [ 4.887843485179077, 45.718725931725707 ], [ 4.887847749049545, 45.718372490832444 ], [ 4.887863515067815, 45.717480209736479 ], [ 4.887871735054159, 45.716950998623425 ], [ 4.887925274671545, 45.716455599005037 ], [ 4.888053416883648, 45.715369058326537 ], [ 4.888100590096274, 45.714802228320124 ], [ 4.888148407799407, 45.714227668817976 ], [ 4.88816771583521, 45.713800559036514 ], [ 4.888157188954906, 45.713389972681775 ], [ 4.888148579966185, 45.713216506417588 ], [ 4.888119831326901, 45.712886121802526 ], [ 4.888034582374111, 45.712327177589991 ], [ 4.887945993915214, 45.711937751577594 ], [ 4.887724373989291, 45.711069698428993 ], [ 4.887627166815945, 45.710687527429769 ], [ 4.8874795641218, 45.710087641415527 ], [ 4.887371517541522, 45.709640608050066 ], [ 4.887235761730071, 45.709094286126557 ], [ 4.887192984060165, 45.708856294532282 ], [ 4.887189219418713, 45.7086783096671 ], [ 4.887195271979904, 45.708518928500155 ], [ 4.887213018982401, 45.708370264326263 ], [ 4.887265565568572, 45.708150991255906 ], [ 4.887312962253457, 45.708008905448352 ], [ 4.887359341693467, 45.707903326762697 ], [ 4.887436944638547, 45.707750064859034 ], [ 4.887684514350743, 45.707309162146608 ], [ 4.887865672222237, 45.706991323443063 ], [ 4.887952877257694, 45.706779738446507 ], [ 4.887972290189744, 45.706681330675856 ], [ 4.887990466082303, 45.706557681163304 ], [ 4.887997420247483, 45.70645721043752 ], [ 4.888006413776182, 45.705367425582487 ], [ 4.888000207322503, 45.704583142183239 ], [ 4.888001839547882, 45.703610949807903 ] ] } }
                                            ]
                             },
                properties : "string", 	
                visible    : true,	
                highlight  : true
        };
                                
        itowns.viewer.addFeature(feature); 
        
        //pickFeature test
        //itowns.viewer.pickFeature({x : 400, y : 400}, "testwfs");
        
        //remove Feature test
        //itowns.viewer.removeFeature(0, "testwfs");
                
        //Feature layers used fot tests purpose
       itowns.viewer.addFeatureLayer({
                                       id          : 'testWfsPoint',
                                       protocol    : "wfs",
                                       url         : 'https://download.data.grandlyon.com/wfs/rdata?',
                                       title       : 'jcd_jcdecaux.jcdvelov',
                                       crs         : 'EPSG:4326',
                                       type        : 'point',
                                       version     : '2.0.0',
                                       options: {
                                           mimetype  : "geojson",
                                           tileMatrixSet: 'WGS84G'
                                       },
                                       params: {
                                           color: {
                                               property: 'availability',
                                               testTab : ['Vert', 'Orange', 'Bleu', 'Gris'],
                                               colorTab: [0x339933, 0xFF9900, 0x3399FF, 0x888888]
                                           },
                                           heightParam : 'pop_rank',
                                           nbSegment   : 8,
                                           level: 14,
                                           // Test of retail change on a specified area (box area define by 2 angles : min and max)
                                           // Warning: the type of coordinates used are CARTESIAN
                                           retail: function(point, type, v) {
                                               if(controlText.retailType == 'box') {
                                                   var box = [];
                                                   if(controlText.minX < controlText.maxX)
                                                       box.push(controlText.minX, controlText.maxX);
                                                   else
                                                       box.push(controlText.maxX, controlText.minX);
                                                   if(controlText.minY < controlText.maxY)
                                                       box.push(controlText.minY, controlText.maxY);
                                                   else
                                                       box.push(controlText.maxY, controlText.minY);
                                                   if(controlText.minZ < controlText.maxZ)
                                                       box.push(controlText.minZ, controlText.maxZ);
                                                   else
                                                       box.push(controlText.maxZ, controlText.minZ);
                                                   if (point.x > box[0] && point.x < box[1] &&
                                                       point.y > box[2] && point.y < box[3] &&
                                                       point.z > box[4] && point.z < box[5])
                                                       type = 'box';
                                                   else
                                                       type = 'point';
                                               } else if (controlText.retailType == 'circle') {
                                                   var center = [controlText.centerX, controlText.centerY, controlText.centerZ];
                                                   var radius = controlText.radius;
                                                   v.set(point.x - center[0], point.y - center[1], point.z - center[2]);
                                                   if(v.length() < radius)
                                                       type = 'box';
                                                   else
                                                       type = 'point';
                                                   return type;
                                               }
                                               return type;
                                           },
                                           getRetailType: function() { return controlText.retailType; },
                                           getForceUpdate: function() {return controlText.force; }
                                       }
       });

       itowns.viewer.addFeatureLayer({
                                       id          : 'testWfsLine',
                                       protocol    : "wfs",
                                       url         : 'https://download.data.grandlyon.com/wfs/rdata?',
                                       title       : 'tcl_sytral.tcllignemf',
                                       crs         : 'EPSG:4326',
                                       type        : 'line',
                                       version   : '2.0.0',
                                       options: {
                                           mimetype  : "geojson",
                                           tileMatrixSet: 'WGS84G'
                                       },
                                       params: {
                                           color: {
                                               property: 'ligne',
                                               testTab : ['A', 'B', 'C', 'D', 'F1', 'F2'],
                                               colorTab: [0x225599, 0x5599ff, 0x147845, 0xFF5577, 0xAAFF44, 0xD7F458]
                                           },
                                           level: 15
                                       }
       });

        itowns.viewer.addElevationLayer({
            protocol:   "wmts",
            id:         "IGN_MNT",
            url:        "http://wxs.ign.fr/va5orxd0pgzvq3jxutqfuy0b/geoportail/wmts",
            noDataValue : -99999,
            options: {
                    name: "ELEVATION.ELEVATIONGRIDCOVERAGE",
                    mimetype: "image/x-bil;bits=32",
                    tileMatrixSet: "WGS84G",
                    tileMatrixSetLimits: {
                         // "2": {
                         //    "minTileRow": 0,
                         //    "maxTileRow": 2,
                         //    "minTileCol": 2,
                         //    "maxTileCol": 7
                         //  },
                          "3": {
                            "minTileRow": 1,
                            "maxTileRow": 5,
                            "minTileCol": 5,
                            "maxTileCol": 15
                          },
                          "4": {
                            "minTileRow": 3,
                            "maxTileRow": 10,
                            "minTileCol": 10,
                            "maxTileCol": 30
                          },
                          "5": {
                            "minTileRow": 6,
                            "maxTileRow": 20,
                            "minTileCol": 20,
                            "maxTileCol": 61
                          },
                          "6": {
                            "minTileRow": 13,
                            "maxTileRow": 40,
                            "minTileCol": 41,
                            "maxTileCol": 123
                          },
                          "7": {
                            "minTileRow": 27,
                            "maxTileRow": 80,
                            "minTileCol": 82,
                            "maxTileCol": 247
                          },
                          "8": {
                            "minTileRow": 54,
                            "maxTileRow": 160,
                            "minTileCol": 164,
                            "maxTileCol": 494
                          },
                          "9": {
                            "minTileRow": 108,
                            "maxTileRow": 321,
                            "minTileCol": 329,
                            "maxTileCol": 989
                          },
                          "10": {
                            "minTileRow": 216,
                            "maxTileRow": 642,
                            "minTileCol": 659,
                            "maxTileCol": 1979
                          },
                          "11": {
                            "minTileRow": 432,
                            "maxTileRow": 1285,
                            "minTileCol": 1319,
                            "maxTileCol": 3959
                          }
                        }
                }
            });

        itowns.viewer.addElevationLayer({
            protocol:   "wmts",
            id:         "IGN_MNT_HIGHRES",
            url:        "http://wxs.ign.fr/va5orxd0pgzvq3jxutqfuy0b/geoportail/wmts",
            noDataValue : -99999,
            options: {
                    name: "ELEVATION.ELEVATIONGRIDCOVERAGE.HIGHRES",
                    mimetype: "image/x-bil;bits=32",
                    tileMatrixSet: "WGS84G",
                    tileMatrixSetLimits: {
                          "6": {
                            "minTileRow": 13,
                            "maxTileRow": 36,
                            "minTileCol": 62,
                            "maxTileCol": 80
                          },
                          "7": {
                            "minTileRow": 27,
                            "maxTileRow": 73,
                            "minTileCol": 124,
                            "maxTileCol": 160
                          },
                          "8": {
                            "minTileRow": 55,
                            "maxTileRow": 146,
                            "minTileCol": 248,
                            "maxTileCol": 320
                          },
                          "9": {
                            "minTileRow": 110,
                            "maxTileRow": 292,
                            "minTileCol": 497,
                            "maxTileCol": 640
                          },
                          "10": {
                            "minTileRow": 221,
                            "maxTileRow": 585,
                            "minTileCol": 994,
                            "maxTileCol": 1281
                          },
                          "11": {
                            "minTileRow": 442,
                            "maxTileRow": 1171,
                            "minTileCol": 1989,
                            "maxTileCol": 2563
                          },
                          "12": {
                            "minTileRow": 885,
                            "maxTileRow": 2343,
                            "minTileCol": 3978,
                            "maxTileCol": 5126
                          },
                          "13": {
                            "minTileRow": 1770,
                            "maxTileRow": 4687,
                            "minTileCol": 7957,
                            "maxTileCol": 10253
                          },
                          "14": {
                            "minTileRow": 3540,
                            "maxTileRow": 9375,
                            "minTileCol": 15914,
                            "maxTileCol": 20507
                          }
                        }
                }
            });

        itowns.viewer.update();



               // THIS IS AN EXAMPLE OF INTERFACE TO INTERACT WITH ITOWNS
               var Menu = function() {
                   this.CloudsIR = false;
                   this.SatelliteAnimation = false;
                   this.RealisticLighting = false;
                   this.StreetLevelImagery = false;
                   this.KML = false;
                   this.AnimateTime = false;
                   this.Orbit = false;
                   this.api = function(){};
                   this.api2 = function(){};
                   this.api3 = function(){};
               };

                itowns.viewer.controlText = {};
                var controlText = itowns.viewer.controlText;

               var text = new Menu();
               var gui = new dat.GUI( { autoPlace: false});
               gui.domElement.id = 'menuDiv';
               viewerDiv.appendChild(gui.domElement);

                var layers = itowns.viewer.getLayers();
                for(var i in layers)
                {
                    var layer = layers[i];

                    if(layer.options.mimetype != "image/x-bil;bits=32")
                    {

                        text[layer.id] = true;
                        text[layer.id+'_Opacity'] = 1.0;


                        var fnUp = function(myid) {
                            return function() {
                                itowns.viewer.moveLayerUp(myid);
                            }
                        }(layer.id);
                        var fnDown = function(myid) {
                            return function() {
                                itowns.viewer.moveLayerDown(myid);
                            }
                        }(layer.id);

                        text[layer.id+'_up'] = fnUp;
                        text[layer.id+'_down'] = fnDown;

                        var onchangeVisibily = function(id)
                        {
                            return function(newValue)
                            {
                                itowns.viewer.setLayerVisibility(id,newValue);
                            };

                        }(layer.id);

                        var onchangeOpacity = function(id)
                        {
                            return function(newValue) {

                                var opacity = Math.max(0,Math.min(newValue, 1.0));
                                itowns.viewer.setLayerOpacity(id, opacity);

                            };

                        }(layer.id);

                        gui.add(text, layer.id).onChange( onchangeVisibily).name(layer.id);
                        gui.add(text, layer.id + '_Opacity').min(0.0).max(1.0).name(' → Opacity').onChange(onchangeOpacity);
                        gui.add(text, layer.id + '_up');
                        gui.add(text, layer.id + '_down');
                    }
                }

                var f3 = gui.addFolder('WFS Features');
                var fPoint = f3.addFolder('Point');
                var fLine = f3.addFolder('Line');
                text['testWfsPoint'] = true;
                fPoint.add(text, 'testWfsPoint').onChange(function(newValue) {
                    itowns.viewer.setLayerVisibility('testWfsPoint', newValue);
                });

                controlText['retailType'] = 'circle';
                fPoint.add(controlText, 'retailType', ['box', 'circle', 'auto']).onChange(function(value) {
                    var f = (value == fCircle.__ul.firstChild.innerText) ? fCircle : fBox;
                    if(value == fCircle.__ul.firstChild.innerText) {
                        fCircle.__ul.hidden = false;
                        fCircle.open();
                        fBox.__ul.hidden    = true;
                    } else if (value == fBox.__ul.firstChild.innerText) {
                        fBox.__ul.hidden    = false;
                        fBox.open();
                        fCircle.__ul.hidden = true;
                    } else {
                        fCircle.__ul.hidden = true;
                        fBox.__ul.hidden    = true;
                    }
                    itowns.viewer.forceFeatureNodeUpdate();
                });

                var fBox = fPoint.addFolder('box');
                controlText['minX'] = 4442277;
                fBox.add(controlText, 'minX').listen();
                controlText['maxX'] = 4441652;
                fBox.add(controlText, 'maxX').listen();
                controlText['minY'] = 4546278;
                fBox.add(controlText, 'minY').listen();
                controlText['maxY'] = 4546789;
                fBox.add(controlText, 'maxY').listen();
                controlText['minZ'] = -375506;
                fBox.add(controlText, 'minZ').listen();
                controlText['maxZ'] = -376638;
                fBox.add(controlText, 'maxZ').listen();
                fBox.__ul.hidden = true;

                var fCircle = fPoint.addFolder('circle');
                controlText['centerX'] = 4442277;
                fCircle.add(controlText, 'centerX').listen();
                controlText['centerY'] = 4546278;
                fCircle.add(controlText, 'centerY').listen();
                controlText['centerZ'] = -375506;
                fCircle.add(controlText, 'centerZ').listen();
                controlText['radius'] = 1000;
                fCircle.add(controlText, 'radius' ).onFinishChange(function(value) { itowns.viewer.forceFeatureNodeUpdate(); });
                fCircle.open();

                text['testWfsLine'] = true;
                fLine.add(text, 'testWfsLine').onChange(function(newValue) {
                    itowns.viewer.setLayerVisibility('testWfsLine', newValue);
                });

                // gui.add(text, 'KML').onChange(function(newValue) {
                //     itowns.viewer.showKML(newValue);
                // });

                if(false)
                {
                    var f2 = gui.addFolder('Atmosphere');

                    f2.open();

                    f2.add(text, 'CloudsIR').onChange(function(newValue) {
                         itowns.viewer.showClouds(newValue);
                    });

                    f2.add(text, 'SatelliteAnimation').onChange(function(newValue) {
                         itowns.viewer.showClouds(true, newValue);
                    });

                    f2.add(text, 'RealisticLighting').onChange(function(newValue) {
                           itowns.viewer.setRealisticLightingOn(newValue);
                    });

                    f2.add(text, 'AnimateTime').onChange(function(newValue) {
                        itowns.viewer.animateTime(newValue);
                    });

                    f2.add(text, 'Orbit').onChange(function(newValue) {
                        itowns.viewer.orbit(newValue);
                    });


                    f2.add(text, 'StreetLevelImagery').onChange(function(newValue) {
			             itowns.viewer.setStreetLevelImageryOn(newValue);
                    });
                }
                viewerDiv.addEventListener('rangeChanged',function(){

                var controller;
                controller = gui.add(text, 'api');
                if(controller)
                 {
                     controller.onChange(function(value) {
                        // removeLayer('OPENSM');
                        //itowns.viewer.moveLayerUp('OrthoCRS');

                            //console.log(itowns.viewer.getZoomLevel("Ortho"));

                    });

                 }

                 }, false);

                var removeLayer= function(nameLayer)
                {

                    if(itowns.viewer.removeImageryLayer(nameLayer))
                    {
                        var controllerTodelete = [];

                        for (var i in gui.__controllers) {

                            var controller = gui.__controllers[i];

                            if(controller.property === nameLayer || controller.property === nameLayer + '_Opacity')
                                controllerTodelete.push(controller);
                        }

                        for (var i in controllerTodelete)
                            gui.remove(controllerTodelete[i]);
                    }
                }

                var controller;
                var layerIdCrs = 'OrthoCRS';

                // var controller = gui.add(text,'api').name('Up');

                // if(controller)
                // {
                //     controller.onChange(function(value) {
                //         itowns.viewer.moveLayerUp(layerIdCrs);
                //     });
                // }

                // controller = gui.add(text,'api2').name('down');

                // if(controller)
                // {
                //     controller.onChange(function(value) {
                //         itowns.viewer.moveLayerDown(layerIdCrs);
                //     });
                // }

                // controller = gui.add(text,'api3').name('Remove Layer');

                // if(controller)
                // {
                //     controller.onChange(function(value) {
                //         itowns.viewer.removeImageryLayer(layerIdCrs);
                //     });
                // }

                viewerDiv.addEventListener('globe-loaded',function(){
                    console.log("Globe Loaded");
                    itowns.viewer.setRange(1000);

                    //itowns.viewer.loadGPX("data/ULTRA2009.gpx");
                    //itowns.viewer.setCenter({longitude:-74,latitude:40,altitude:0});
                } ,
                false);

                viewerDiv.addEventListener('Layer-removed',function(event){
                    console.log("Layer " + event.layer +  " removed");
                } ,
                false);

                // gui.add(text, 'StreetLevelImagery').onChange(function(newValue) {
                //     itowns.viewer.setStreetLevelImageryOn(newValue);
                // });

        </script>
    </body>
</html>
